var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{c as o,R as s,L as c,u as i,a as r,r as m,b as d,d as g,w as p,S as u,f as h,e as E,g as b,h as f,B as w,H as v,t as y,s as N,i as k,j as I,P as A}from"./vendor.js";var x={apiKey:"AIzaSyDnb7CnJxySsm2_w1Yq1l3ZlsRsN2qe16c",authDomain:"collectio-photo-2233e.firebaseapp.com",projectId:"collectio-photo-2233e",storageBucket:"collectio-photo-2233e.appspot.com",messagingSenderId:"590643802391",appId:"1:590643802391:web:ad661fba7fb099ca018752",measurementId:"G-X7DEP88WR5"};const j=o({name:"user",initialState:{user:null},reducers:{setUser:(e,t)=>{e.user=t.payload}}}),{setUser:S}=j.actions,C=e=>e.userReducer.user;var P=j.reducer;const $=o({name:"albums",initialState:{albums:[]},reducers:{setAlbums:(e,t)=>{e.albums=t.payload},unshiftAlbums:(e,t)=>{e.albums.unshift(t.payload)},pushAlbums:(e,t)=>{e.albums.push(t.payload)},replaceAlbum:(e,t)=>{const a=e.albums.findIndex((e=>e.id===t.payload.id));e.albums[a]=t.payload},removeAlbum:(e,t)=>{const a=[];e.albums.forEach((e=>{e.id!==t.payload&&a.push(e)})),e.albums=a}}}),{setAlbums:O,unshiftAlbums:R,pushAlbums:D,replaceAlbum:T,removeAlbum:U}=$.actions,L=e=>e.albumsReducer.albums;var _=$.reducer;const M=e=>s.createElement("div",{id:"home"},s.createElement("nav",null,s.createElement("span",null),s.createElement(c,{to:"/"},s.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"})),s.createElement("span",{style:{width:"66px"}})),s.createElement("div",{className:"loading"},s.createElement("p",null,"読み込み中..."))),z=e=>s.createElement("div",{id:"home"},s.createElement("nav",null,s.createElement(c,{to:"/"},s.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"}))),s.createElement("div",{className:"login"},s.createElement("h2",null,"Collectio Photoへようこそ"),s.createElement("p",null,"このアプリは、ボードゲームを遊んだ時の写真をアルバムにまとめて、遊んだゲームを記録できるアプリです。",s.createElement("br",null),s.createElement("br",null),"「この前、あの時、遊んだゲームはなんだった？」",s.createElement("br",null),"そんな時に役立ちます。",s.createElement("br",null),s.createElement("br",null),"どんな風に使えるか、ログインしてサンプルのアルバムを見てみましょう。"),s.createElement("p",null,s.createElement("button",{className:"google",onClick:e.GoogleLogin},"Googleでログイン")),window.cordova&&"iOS"===device.platform?s.createElement("p",null,s.createElement("button",{className:"apple",onClick:e.AppleLogin},"Signin with Apple")):null)),B=e=>{const t=i(L),a=i(C),l=r();return s.createElement("div",{id:"home"},s.createElement("nav",null,s.createElement("span",null),s.createElement(c,{to:"/"},s.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"})),s.createElement("button",{onClick:e.signOut},"ログアウト")),e.uploading?s.createElement("div",{className:"progress"},s.createElement("p",null,"アップロード中...")):null,s.createElement("div",{className:"albums"},t.map((e=>s.createElement("div",{className:"album",key:e.id},s.createElement(c,{to:`/album/${e.id}`},s.createElement("div",{className:"image"},s.createElement("h4",null,e.title),s.createElement("span",null,e.date),s.createElement("div",{className:"photos"},e.photos.map((e=>s.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`}})))))),s.createElement("div",{className:"games"},e.games.map(((e,t)=>s.createElement(c,{to:{pathname:`/game/${e.id}`,state:{game:e}},key:e.id+e.title},s.createElement("div",{className:"game"},s.createElement("div",{style:{backgroundImage:`url(${e.image})`}}),s.createElement("span",{className:"title"},e.title)))))))))),s.createElement("form",{action:"",encType:"multipart/form-data"},s.createElement("input",{className:"file",title:"写真を選択",onChange:t=>e.createAlbum(t,a,l),id:"file",type:"file",name:"file",accept:"image/*",multiple:!0}),s.createElement("label",{htmlFor:"file"})))},q=e=>{const t=i(L),[a,l]=m.exports.useState(null),[n,o]=m.exports.useState(!1),p=[],[u,h]=m.exports.useState(p),[E,b]=m.exports.useState(0),f=r(),w=d();let{id:v}=g();m.exports.useEffect((()=>{if(!a){const e=t.find((e=>e.id===v));e&&l(e)}}),[]),m.exports.useEffect((()=>{const e=t.find((e=>e.id===v));e&&l(e),o(!1),h(p),b(0)}),[t]);const y=i(C);return null===a?null:s.createElement("div",{id:"album"},s.createElement("nav",null,s.createElement(c,{to:"/"},s.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),s.createElement("span",null),s.createElement("span",{className:"menu"},s.createElement("span",{onClick:()=>{confirm(`「${a.title}」を削除します。\nよろしいですか？`)&&(e.deleteAlbum(a,f),w.push("/"))}},s.createElement("img",{src:"/delete.svg",alt:"削除"})))),s.createElement("div",{className:"album"},s.createElement("div",{className:"hero"},s.createElement("h4",{onClick:()=>{const t=prompt("アルバムのタイトルを変更",a.title===X?"":a.title);if(t){const n=Object.assign({},a,{title:t});l(n),e.updateAlbum(n,f)}}},a.title,s.createElement("span",null,s.createElement("img",{src:"/edit-white.svg",alt:"編集"}))),s.createElement("span",null,a.date),a.photos&&a.photos.length>0?s.createElement("div",{className:"cover",style:{backgroundImage:`url(${a.photos[0].image})`}}):null),s.createElement("div",{className:"actions"},s.createElement("h4",null,"遊んだゲーム"),"sample"===a.id?s.createElement("a",{onClick:()=>alert("サンプルのため、シェアできません。"),className:"share"},"シェア"):s.createElement(c,{to:{pathname:`/share/${a.id}`},className:"share"},"シェア")),s.createElement("div",{className:"games"},a.games.map(((e,t)=>s.createElement(c,{to:{pathname:`/game/${e.id}`,state:{game:e}},key:e.id+e.title},s.createElement("div",{key:"game"+t,className:"game"},s.createElement("div",{style:{backgroundImage:`url(${e.image})`}}),s.createElement("span",{className:"title"},e.title))))),"sample"===a.id?s.createElement("a",{onClick:()=>alert("サンプルのため、ゲームは追加できません。"),className:"add"},"+"):s.createElement(c,{to:`/select/${v}`,className:"add"},"+"),0===a.games.length?s.createElement("p",null,"遊んだゲームを追加しましょう"):null),s.createElement("div",{className:"tabs"},s.createElement("span",{className:n?"":" active",onClick:()=>{o(!1)}},"写真"),s.createElement("span",{className:n?" active":"",onClick:()=>{o(!0)}},s.createElement("img",{src:n?"/edit-white.svg":"/edit-gray.svg",alt:"編集"}),"編集")),s.createElement("div",{className:"photos"},a.photos.map(((e,t)=>{if(n){const t=void 0!==u.find((t=>t.image===e.image));return s.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`},onClick:()=>{if(t){const t=u.filter((t=>t.image!==e.image));h(t)}else h([...u,e])}},s.createElement("span",{className:"select"+(t?" selected":"")}))}return s.createElement(c,{to:{pathname:`/photo/${a.id}`,state:{album:a,index:t}},key:e.image},s.createElement("div",{className:"photo",style:{backgroundImage:`url(${e.image})`}}))})),Array.from({length:E}).map(((e,t)=>s.createElement("div",{className:"photo loading",key:t}))))),n?s.createElement("div",{className:"delete",onClick:()=>{u.length>0&&e.deletePhotos(y,a,f,u)}},u.length>0?s.createElement(s.Fragment,null,s.createElement("img",{src:"/delete-white.svg",alt:""}),u.length+"枚の写真を削除"):"写真を選択してください"):s.createElement("form",{action:"",encType:"multipart/form-data"},s.createElement("input",{className:"file",title:"写真選択",onChange:t=>{e.addPhotos(t,y,a,f),t.target.files&&b(t.target.files.length)},id:"file",type:"file",name:"file",accept:"image/*",multiple:!0}),s.createElement("label",{htmlFor:"file"})))};var F=p((e=>{const{game:t}=e.location.state,[a,l]=m.exports.useState("");return m.exports.useEffect((()=>{if(t.id){const e="https://db.collectio.jp/wp-json/wp/v2/posts/"+t.id;fetch(e).then((e=>e.json())).then((e=>{e.acf.amazon&&l(e.acf.amazon)}))}}),[]),s.createElement("div",{id:"game"},s.createElement("nav",null,s.createElement("a",{onClick:()=>e.history.goBack()},s.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),s.createElement("span",null),s.createElement("span",null)),s.createElement("div",{className:"game"},t.image?s.createElement("img",{src:t.image,alt:t.title}):s.createElement("div",{className:"noimage"},t.title),s.createElement("p",{className:"title"},t.title),"0"!==t.year?s.createElement("p",{className:"year"},t.year):null,s.createElement("div",{className:"links"},""===a?s.createElement("a",{href:"https://www.amazon.co.jp/s?i=toys&tag=collectio0c-22&k="+encodeURIComponent(t.title.replace(":"," ").replace("："," ")),className:"amazon",target:"_blank"},"Amazonで探す"):s.createElement("a",{href:a+"?tag=collectio0c-22",className:"amazon",target:"_blank"},"Amazonで見る"),t.bodogema?s.createElement("a",{href:t.bodogema,className:"bodogema",target:"_blank"},"ボドゲーマ"):null,t.bgg?s.createElement("a",{href:t.bgg,className:"bgg",target:"_blank"},"BoardGameGeek"):null,t.bgdb?s.createElement("a",{href:t.bgdb,className:"bgdb",target:"_blank"},"ボードゲームデータベース"):null)))}));var G=p((e=>{const o=i(L),[r,d]=m.exports.useState({album:null});let{index:p}=e.location.state,{id:h}=g();m.exports.useEffect((()=>{if(!r.album){const e=o.filter((e=>e.id===h))[0];e&&d({album:e})}}));const E={dots:!1,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,initialSlide:p};return r.album?s.createElement("div",{id:"photo"},s.createElement(c,{to:{pathname:`/album/${h}`},className:"close"},s.createElement("img",{src:"/close.svg"})),s.createElement(u,((e,o)=>{for(var s in o||(o={}))a.call(o,s)&&n(e,s,o[s]);if(t)for(var s of t(o))l.call(o,s)&&n(e,s,o[s]);return e})({},E),r.album.photos.map((e=>s.createElement(s.Fragment,{key:e.image},s.createElement("div",{style:{backgroundImage:`url(${e.image})`}})))))):null}));var W=p((e=>{const t=i(L),[a,l]=m.exports.useState(null),[n,o]=m.exports.useState([]),[r,d]=m.exports.useState(!1);let{id:p}=g();m.exports.useEffect((()=>{if(!a){const e=t.filter((e=>e.id===p))[0];e&&l(e)}}));return a?s.createElement("div",{id:"shareSelect"},s.createElement("nav",null,s.createElement(c,{to:{pathname:`/album/${a.id}`}},s.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),s.createElement("span",null,"写真の選択"),s.createElement("span",null)),s.createElement("div",{className:"album"},s.createElement("div",{className:"photos"},a.photos.map(((e,t)=>s.createElement("div",{key:e.image,className:"photo"+(r?" disabled":""),onClick:()=>(e=>{-1===n.indexOf(e)?!1===r&&(n.push(e),n.length>=4&&d(!0),o([...n])):(n.splice(n.indexOf(e),1),o([...n]),d(!1))})(t),style:{backgroundImage:`url(${e.image})`}},s.createElement("span",{className:"select"+(n.indexOf(t)>-1?" selected":"")}))))),s.createElement("div",{className:"bottomActions",onClick:()=>{if(0===n.length)return alert("写真を選択してください");const t=a.photos.filter(((e,t)=>n.indexOf(t)>-1));e.history.push({pathname:"/share",state:{photos:t,album:a}})}},s.createElement("span",{className:"share"},"次へ")))):null}));const V=async(e,t)=>{const a=await fetch(e).then((e=>e.blob()));return new File([a],`test${t}.jpg`,{type:a.type})};var J=p((e=>{const[t,a]=m.exports.useState({album:{},photos:[]});m.exports.useEffect((()=>{try{const{photos:t}=e.location.state,{album:l}=e.location.state;a({album:l,photos:t})}catch{e.history.push("/"),location.reload()}return scrollTo(0,0),()=>{}}),[t.album,t.photos]);return null===t.album?null:s.createElement("div",{id:"share"},s.createElement("nav",null,s.createElement("a",{onClick:()=>e.history.goBack()},s.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"}))),s.createElement("div",{className:"photos"},t.photos.map(((e,t)=>s.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`}})))),s.createElement("button",{onClick:async()=>{const e=[],a=[];for(const l of t.photos){const t=await V(l.image,Math.floor(10*Math.random()));e.push(t),a.push(l.image)}window.cordova?window.plugins.socialsharing.share(null,"Android filename",a,null):navigator.share?navigator.share({url:"https://collectio.jp/",files:e}).then((()=>{console.log("Share was successful.")})).catch((e=>{console.log("Sharing failed",e)})):alert("このブラウザではシェア機能が使えません。\n最新のSafari, Chromeをお使いください。")}},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19.067",height:"24.245",viewBox:"0 0 19.067 24.245"},s.createElement("path",{d:"M.005-4.834a.855.855,0,0,0,.849-.838V-16.7L.79-18.315l.73.763,1.622,1.74a.784.784,0,0,0,.58.258.751.751,0,0,0,.784-.763.75.75,0,0,0-.247-.559l-3.631-3.5a.838.838,0,0,0-.623-.29.838.838,0,0,0-.623.29l-3.631,3.5a.76.76,0,0,0-.258.559.748.748,0,0,0,.773.763.79.79,0,0,0,.591-.258l1.633-1.74.73-.763L-.854-16.7V-5.672A.865.865,0,0,0,.005-4.834ZM-6.161,3.577H6.161c2.245,0,3.373-1.117,3.373-3.33V-10.474c0-2.213-1.128-3.33-3.373-3.33h-3v1.729H6.128a1.519,1.519,0,0,1,1.676,1.7V.15a1.519,1.519,0,0,1-1.676,1.7H-6.139A1.507,1.507,0,0,1-7.8.15V-10.377a1.507,1.507,0,0,1,1.665-1.7h2.976V-13.8h-3c-2.245,0-3.373,1.117-3.373,3.33V.247C-9.534,2.46-8.406,3.577-6.161,3.577Z",transform:"translate(9.534 20.668)"})),"共有する"))}));const H=e=>e.replace(/[\u3041-\u3096]/g,(function(e){const t=e.charCodeAt(0)+96;return String.fromCharCode(t)})),Z=e=>{const t=i(L),a=m.exports.useRef(null),[l,n]=m.exports.useState(!1),[o,c]=m.exports.useState(null),[p,u]=m.exports.useState([]);let{id:E}=g();const b=r(),f=d();let w="";m.exports.useEffect((()=>{if(scrollTo(0,0),!o){const e=t.filter((e=>e.id===E))[0];e&&c(e)}a.current&&a.current.focus(),fetch("https://db-api-mxiq5qapta-an.a.run.app/search")}),[t]);const v=async e=>{e.preventDefault();const t=a.current.value;if(""===t)return u([]);if(t===w)return;w=t;let l=await y(t);if(n(!0),l.length>0?(n(!1),u(l)):H(t)!==t&&(l=await y(H(t))),l.length<=0){const e=await N(t);l=l.concat(e)}n(!1),u(l)},y=async e=>{const t=await fetch("https://db-api-mxiq5qapta-an.a.run.app/search?q="+encodeURIComponent(e)).then((e=>e.json())),a=[];return t.map((e=>{a.push(e)})),a},N=async e=>{const t=await h("https://www.google.com/complete/search?hl=ja&client=firefox&q="+encodeURIComponent(e)).then((e=>e.json())),a=[];if(t[1].map((e=>{const t={id:null,title:e,image:null};a.push(t)})),0===a.length||-1===a.findIndex((t=>e===t.title))){const t={id:null,title:e,image:null};a.unshift(t)}return a},k=async e=>{if(e.id){const t=(await fetch(`https://db.collectio.jp/wp-json/wp/v2/posts/${e.id}?_embed`).then((e=>e.json()))).featured_image.src;if(e.image="https://db.collectio.jp/wp-includes/images/media/default.png"!==t?t:null,-1===o.games.findIndex((t=>t.id===e.id))){const t=Object.assign({},o,{games:[...o.games,e]});c(t)}}else if(-1===o.games.findIndex((t=>t.title===e.title))){const t=Object.assign({},o,{games:[...o.games,e]});c(t)}u([]),a.current.value=""};return null===o?null:s.createElement("div",{id:"select"},s.createElement("nav",null,s.createElement("a",{onClick:()=>f.goBack()},s.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),0===p.length?s.createElement("a",{onClick:()=>{(async()=>{e.updateAlbum(o,b),f.push(`/album/${o.id}`)})()}},"完了"):null),s.createElement("form",{action:"",onSubmit:v},s.createElement("div",{className:"bg"},s.createElement("input",{type:"text",ref:a,placeholder:"ゲームを検索",onChange:v})),0===p.length&&l?s.createElement("div",{className:"suggests"},"読み込み中..."):null,p.length>0?s.createElement("div",{className:"suggests"},p.slice(0,100).map(((e,t)=>s.createElement("div",{key:"suggest"+t,onClick:k.bind(void 0,e)},e.title)))):null),o.games.length>0?s.createElement("div",{className:"games"},s.createElement("h3",null,"遊んだゲーム"),o.games.map(((e,t)=>s.createElement("div",{key:"game"+t,className:"game"},e.image?s.createElement("img",{src:e.image,alt:""}):s.createElement("span",{className:"image"}),s.createElement("span",{className:"data"},s.createElement("span",{className:"title"},e.title),s.createElement("span",{className:"delete",onClick:()=>{(e=>{const t=Object.assign({},o,{games:o.games.filter((t=>t.id!==e.id||null==t.id&&t.title!==e.title))});c(t)})(e)}},s.createElement("img",{src:"/delete.svg",alt:"削除"}))))))):null)};let Y=w;Y=window.cordova?v:w,E.initializeApp(x);const K=E.firestore();E.storage(),E.analytics();const X="ある日のボードゲーム会",Q={id:"sample",title:"サンプルのボードゲーム会",date:`${(new Date).getFullYear()}/${(new Date).getMonth()+1}/${(new Date).getDate()}`,photos:[{image:"https://storage.googleapis.com/collectio-photo-assets/sample/1.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/2.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/3.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/4.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/5.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/6.jpg"}],games:[{bgdb:"http://www.gamers-jp.com/playgame/db_gamea.php?game_id=6959",bgg:"https://boardgamegeek.com/boardgame/191895",bodogema:"https://bodoge.hoobby.net/games/golovonogi",etitle:"Toddles-Bobbles Green",hasJPURL:1,id:"95735",keyword:"なんじゃもんじゃ,みどり,緑",maxPlayers:6,minPlayers:2,playAge:4,playingTime:15,title:"ナンジャモンジャ・ミドリ",year:"2010",image:"https://db.collectio.jp/wp-content/uploads/2019/05/95735.jpg"},{bgdb:"",bgg:"https://boardgamegeek.com/boardgame/230802",bodogema:"https://bodoge.hoobby.net/games/azul",etitle:"Azul",hasJPURL:1,id:"72660",keyword:"",maxPlayers:4,minPlayers:2,playAge:8,playingTime:45,title:"アズール",year:"2017",image:"https://db.collectio.jp/wp-content/uploads/2019/05/72660.jpg"},{bgdb:"http://www.gamers-jp.com/playgame/db_gamea.php?game_id=4786",bgg:"https://boardgamegeek.com/boardgame/68448",bodogema:"https://bodoge.hoobby.net/games/7-wonders",etitle:"7 Wonders",hasJPURL:1,id:"81063",keyword:"せかいのななふしぎ せぶんわんだー 7わんだー",maxPlayers:"",minPlayers:"",playAge:"",playingTime:"",title:"世界の七不思議",year:"2010",image:"https://db.collectio.jp/wp-content/uploads/2019/05/81063.jpg"},{bgdb:null,bgg:null,bodogema:null,etitle:"",hasJPURL:1,id:"110318",keyword:"",maxPlayers:null,minPlayers:null,playAge:null,playingTime:null,title:"Escape from the Office: The exciting escape game – escape your boss",year:"0",image:null}],userId:""},ee=async(e,t,a,l)=>{if(e.target.files){const n=[];for(const t of e.target.files){const e=await te(t).catch((e=>console.log(e)));e&&n.push(e)}const o=K.collection("albums").doc(a.id);await o.update(a).then((async()=>{console.log("Document written with ID: ",o.id);const e=[].concat(a.photos);for(const a of n){const l=await ae(t,o,a).catch((e=>console.log(e)));l&&e.push({image:l})}o.update({photos:e}).catch((e=>console.log(e)));const s=Object.assign({},a,{photos:e});l(T(s))})).catch((e=>console.log(e)))}},te=e=>new Promise(((t,a)=>{const l=new FileReader;l.onload=async e=>{t(await oe(e.target.result))},l.readAsDataURL(e)})),ae=(e,t,a)=>(console.log("uploadPhoto"),new Promise(((l,n)=>{const o=E.storage().ref().child(`albums/${e.uid}/${t.id}/${(new Date).getTime()}.jpg`).putString(a,"data_url");o.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case E.storage.TaskState.PAUSED:console.log("Upload is paused");break;case E.storage.TaskState.RUNNING:console.log("Upload is running")}}),(e=>{console.log(e),n()}),(async()=>{const e=await o.snapshot.ref.getDownloadURL();console.log("File available at",e),l(e)}))}))),le=(e,t,a)=>new Promise(((l,n)=>{const o=K.collection("albums").doc(t.id),s=E.storage().ref(),c=a.image.split("?")[0].split("%2F")[3];s.child(`albums/${e.uid}/${o.id}/${c}`).delete().then((()=>{console.log("File deleted"),l()})).catch((e=>{console.log(e),n()}))})),ne=async(e,t,a,l)=>{for(const c of l)await le(e,t,c).catch((e=>console.log(e)));const n=[];for(const c of t.photos){void 0===l.find((e=>e.image===c.image))&&void 0===n.find((e=>e.image===c.image))&&n.push(c)}const o=K.collection("albums").doc(t.id);await o.update({photos:n}).catch((e=>console.log(e)));const s=Object.assign({},t,{photos:n});a(T(s))},oe=e=>new Promise(((t,a)=>{const l=640,n=document.createElement("canvas"),o=n.getContext("2d");if(o){const a=new Image;a.crossOrigin="Anonymous",a.onload=async a=>{const s=a.target;let c,i;if(s.width>s.height?(c=l,i=s.height*l/s.width):(i=l,c=s.width*l/s.height),n.width=c,n.height=i,o.drawImage(s,0,0,s.width,s.height,0,0,c,i),void 0===document.createElement("img").style.imageOrientation){const a=((e,t)=>{var a=document.createElement("canvas"),l=a.getContext("2d");if(l){switch(t){case 3:a.width=e.width,a.height=e.height,l.rotate(Math.PI),l.drawImage(e,-e.width,-e.height),l.rotate(-Math.PI);break;case 6:a.width=e.height,a.height=e.width,l.rotate(.5*Math.PI),l.drawImage(e,0,-e.height),l.rotate(.5*-Math.PI);break;case 8:a.width=e.height,a.height=e.width,l.rotate(.5*-Math.PI),l.drawImage(e,-e.width,0),l.rotate(.5*Math.PI);break;default:a.width=e.width,a.height=e.height,l.drawImage(e,0,0)}return a.toDataURL("image/jpeg",.8)}})(s,await y.orientation(e));t(a)}else t(n.toDataURL("image/jpeg",.8))},a.src=e}else a()})),se=async(e,t)=>{const a=K.collection("albums").doc(e.id);await a.update(e).then((()=>{t(T(e))})).catch((e=>console.log(e)))},ce=async(e,t)=>{console.log(e),await K.collection("albums").doc(e.id).delete(),t(U(e.id))},ie=async e=>{let t=[];e.forEach((e=>{e.games.forEach((e=>{e.id&&t.push(parseInt(e.id))}))})),t=Array.from(new Set(t));const a="https://db.collectio.jp/wp-json/wp/v2/posts?include="+t.join(",");console.log(a);const l=await fetch(a).then((e=>e.json()));return e.forEach((e=>{e.games.forEach((e=>{l.map((t=>{"https://db.collectio.jp/wp-includes/images/media/default.png"!==t.featured_image.src&&e.id==t.id&&(e.image=t.featured_image.src)}))}))})),e};function re(){const[e,t]=m.exports.useState(!0),[a,l]=m.exports.useState(!1),n=i(C);i(L);const o=r();m.exports.useEffect((()=>{if(!n)return E.auth().onAuthStateChanged((e=>{e&&(o(S({uid:e.uid})),((e,t)=>{let a=[];K.collection("albums").where("userId","==",e.uid).orderBy("date","desc").get().then((async e=>{e.forEach((e=>{const t=e.data();t.id=e.id,delete t.date,a.push(t)})),e.empty?t(D(Q)):(a=await ie(a),t(O(a)))})).catch((e=>{console.log("Error getting documents: ",e)}))})(e,o)),t(!1)})),()=>{console.log("Clean up")}}));const c=()=>{if(window.cordova){let e={};"ios"!==window.cordova.platformId&&(e={webClientId:"16919798390-gt4d4vanvgu1n0u93nasrv7vt277r9gd.apps.googleusercontent.com",offline:!1}),window.plugins.googleplus.login(e,(e=>{let t=(new E.auth.GoogleAuthProvider).credential(e.idToken);E.auth().signInWithCredential(t)}),(e=>{console.log("error: "+e)}))}else{const e=new E.auth.GoogleAuthProvider;E.auth().signInWithRedirect(e)}};E.auth();const d=()=>{window.cordova&&SignInWithApple.isAvailable().then((function(e){console.info(e);const t=function(e){let t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=a.length;for(let n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*l));return t}(32);return SignInWithApple.request({requestedScopes:[SignInWithApple.Scope.Email],nonce:N(t).toString()}).then((e=>{let a=new E.auth.OAuthProvider("apple.com").credential({idToken:e.identityToken,rawNonce:t});E.auth().signInWithCredential(a).then((()=>{})).catch((e=>{e.code;const t=e.message;console.log("firebase auth failed with Apple Sign In"),console.log(t),alert(e.message||"エラーが発生しました")}))})).catch((e=>{console.error(e),alert(e.message||"エラーが発生しました")}))})).catch((e=>{console.log(e),alert("この機種ではAppleアカウントのログインをサポートしていません")}))},g=()=>{E.auth().signOut().then((()=>{location.reload()})).catch((e=>{}))};return s.createElement(Y,null,s.createElement("div",null,s.createElement(b,null,s.createElement(f,{path:"/select/:id",render:()=>s.createElement(Z,{updateAlbum:se})}),s.createElement(f,{path:"/share/:id"},s.createElement(W,null)),s.createElement(f,{path:"/share"},s.createElement(J,null)),s.createElement(f,{path:"/photo/:id"},s.createElement(G,null)),s.createElement(f,{path:"/game/:id"},s.createElement(F,null)),s.createElement(f,{path:"/album/:id",render:()=>s.createElement(q,{updateAlbum:se,addPhotos:ee,deletePhotos:ne,deleteAlbum:ce})}),s.createElement(f,{path:"/",render:()=>e?s.createElement(M,null):n?s.createElement(B,{uploading:a,signOut:g,createAlbum:(e,t,a)=>{l(!0),(async(e,t,a,l)=>{if(e.target.files){const n=[];for(const t of e.target.files){const e=await te(t).catch((e=>console.log(e)));e&&n.push(e)}const o={id:"",title:X,date:new Date,photos:[],games:[],userId:t.uid},s=await K.collection("albums").add(o).catch((e=>{console.error("Error adding document: ",e)}));if(s){console.log("Document written with ID: ",s.id);const e=[];for(const a of n){const l=await ae(t,s,a).catch((e=>console.log(e)));l&&e.push({image:l})}s.update({id:s.id,photos:e}).catch((e=>console.log(e))),o.id=s.id,o.photos=e,delete o.date,a(R(o)),l(!1)}}})(e,t,a,l)}}):s.createElement(z,{GoogleLogin:c,AppleLogin:d})}))))}const me=k({reducer:{userReducer:P,albumsReducer:_}});const de=()=>{I.render(s.createElement(s.StrictMode,null,s.createElement(A,{store:me},s.createElement(re,null))),document.getElementById("root"))};var ge;"true"===(ge={},location.search.substr(1).split("&").map((function(e){var t=e.split("=");ge[t[0]]=decodeURIComponent(t[1])})),ge).cordova?document.addEventListener("deviceready",de,!1):de();
