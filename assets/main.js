var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{c as s,R as n,L as c,u as i,a as r,r as m,b as d,d as g,w as p,S as u,f as h,e as E,g as b,h as f,B as v,H as w,t as y,s as N,i as k,j as I,P as A}from"./vendor.js";var j={apiKey:"AIzaSyDnb7CnJxySsm2_w1Yq1l3ZlsRsN2qe16c",authDomain:"collectio-photo-2233e.firebaseapp.com",projectId:"collectio-photo-2233e",storageBucket:"collectio-photo-2233e.appspot.com",messagingSenderId:"590643802391",appId:"1:590643802391:web:ad661fba7fb099ca018752",measurementId:"G-X7DEP88WR5"};const x=s({name:"user",initialState:{user:null},reducers:{setUser:(e,t)=>{e.user=t.payload}}}),{setUser:S}=x.actions,C=e=>e.userReducer.user;var P=x.reducer;const $=s({name:"albums",initialState:{albums:[]},reducers:{setAlbums:(e,t)=>{e.albums=t.payload},unshiftAlbums:(e,t)=>{e.albums.unshift(t.payload)},pushAlbums:(e,t)=>{e.albums.push(t.payload)},replaceAlbum:(e,t)=>{const a=e.albums.findIndex((e=>e.id===t.payload.id));e.albums[a]=t.payload},removeAlbum:(e,t)=>{const a=[];e.albums.forEach((e=>{e.id!==t.payload&&a.push(e)})),e.albums=a}}}),{setAlbums:R,unshiftAlbums:O,pushAlbums:U,replaceAlbum:D,removeAlbum:L}=$.actions,T=e=>e.albumsReducer.albums;var _=$.reducer;const M=e=>n.createElement("div",{id:"home"},n.createElement("nav",null,n.createElement(c,{to:"/"},n.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"}))),n.createElement("div",{className:"loading"},n.createElement("p",null,"読み込み中..."))),z=e=>n.createElement("div",{id:"home"},n.createElement("nav",null,n.createElement(c,{to:"/"},n.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"}))),n.createElement("div",{className:"login"},n.createElement("h2",null,"Collectio Photoへようこそ"),n.createElement("p",null,"このアプリは、ボードゲームを遊んだ時の写真をアルバムにまとめて、遊んだゲームを記録できるアプリです。",n.createElement("br",null),n.createElement("br",null),"「この前、あの時、遊んだゲームはなんだった？」",n.createElement("br",null),"そんな時に役立ちます。",n.createElement("br",null),n.createElement("br",null),"どんな風に使えるか、ログインしてサンプルのアルバムを見てみましょう。"),n.createElement("p",null,n.createElement("button",{className:"google",onClick:e.GoogleLogin},"Googleでログイン")),window.cordova&&"Android"===device.platform?null:n.createElement("p",null,n.createElement("button",{className:"apple",onClick:e.AppleLogin},"Signin with Apple")))),B=e=>{const t=i(T),a=i(C),l=r();return n.createElement("div",{id:"home"},n.createElement("nav",null,n.createElement(c,{to:"/"},n.createElement("img",{className:"logo",src:"/collectio.svg",alt:"Collectio"}))),n.createElement("div",{className:"profile"},n.createElement("img",{src:a.photoURL,alt:""}),n.createElement("p",null,a.displayName),n.createElement("button",{onClick:e.signOut},"ログアウト")),e.uploading?n.createElement("div",{className:"progress"},n.createElement("p",null,"アップロード中...")):null,n.createElement("div",{className:"albums"},t.map((e=>n.createElement("div",{className:"album",key:e.id},n.createElement(c,{to:`/album/${e.id}`},n.createElement("div",{className:"image"},n.createElement("h4",null,e.title),n.createElement("span",null,e.date),n.createElement("div",{className:"photos"},e.photos.map((e=>n.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`}})))))),n.createElement("div",{className:"games"},e.games.map(((e,t)=>n.createElement(c,{to:{pathname:`/game/${e.id}`,state:{game:e}},key:e.id+e.title},n.createElement("div",{className:"game"},n.createElement("div",{style:{backgroundImage:`url(${e.image})`}}),n.createElement("span",{className:"title"},e.title)))))))))),n.createElement("form",{action:"",encType:"multipart/form-data"},n.createElement("input",{className:"file",title:"写真を選択",onChange:t=>e.createAlbum(t,a,l),id:"file",type:"file",name:"file",accept:"image/*",multiple:!0}),n.createElement("label",{htmlFor:"file"})))},q=e=>{const t=i(T),[a,l]=m.exports.useState(null),[o,s]=m.exports.useState(!1),p=[],[u,h]=m.exports.useState(p),[E,b]=m.exports.useState(0),f=r(),v=d();let{id:w}=g();m.exports.useEffect((()=>{if(!a){const e=t.find((e=>e.id===w));e&&l(e)}}),[]),m.exports.useEffect((()=>{const e=t.find((e=>e.id===w));e&&l(e),s(!1),h(p),b(0)}),[t]);const y=i(C);return null===a?null:n.createElement("div",{id:"album"},n.createElement("nav",null,n.createElement(c,{to:"/"},n.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),n.createElement("span",null),n.createElement("span",{className:"menu"},n.createElement("span",{onClick:()=>{confirm(`「${a.title}」を削除します。\nよろしいですか？`)&&(e.deleteAlbum(a,f),v.push("/"))}},n.createElement("img",{src:"/delete.svg",alt:"削除"})))),n.createElement("div",{className:"album"},n.createElement("div",{className:"hero"},n.createElement("h4",{onClick:()=>{const t=prompt("アルバムのタイトルを変更",a.title===X?"":a.title);if(t){const o=Object.assign({},a,{title:t});l(o),e.updateAlbum(o,f)}}},a.title,n.createElement("span",null,n.createElement("img",{src:"/edit-white.svg",alt:"編集"}))),n.createElement("span",null,a.date),a.photos&&a.photos.length>0?n.createElement("div",{className:"cover",style:{backgroundImage:`url(${a.photos[0].image})`}}):null),n.createElement("div",{className:"actions"},n.createElement("h4",null,"遊んだゲーム"),"sample"===a.id?n.createElement("a",{onClick:()=>alert("サンプルのため、シェアできません。"),className:"share"},"シェア"):n.createElement(c,{to:{pathname:`/share/${a.id}`},className:"share"},"シェア")),n.createElement("div",{className:"games"},a.games.map(((e,t)=>n.createElement(c,{to:{pathname:`/game/${e.id}`,state:{game:e}},key:e.id+e.title},n.createElement("div",{key:"game"+t,className:"game"},n.createElement("div",{style:{backgroundImage:`url(${e.image})`}}),n.createElement("span",{className:"title"},e.title))))),"sample"===a.id?n.createElement("a",{onClick:()=>alert("サンプルのため、ゲームは追加できません。"),className:"add"},"+"):n.createElement(c,{to:`/select/${w}`,className:"add"},"+"),0===a.games.length?n.createElement("p",null,"遊んだゲームを追加しましょう"):null),n.createElement("div",{className:"tabs"},n.createElement("span",{className:o?"":" active",onClick:()=>{s(!1)}},"写真"),n.createElement("span",{className:o?" active":"",onClick:()=>{s(!0)}},n.createElement("img",{src:o?"/edit-white.svg":"/edit-gray.svg",alt:"編集"}),"編集")),n.createElement("div",{className:"photos"},a.photos.map(((e,t)=>{if(o){const t=void 0!==u.find((t=>t.image===e.image));return n.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`},onClick:()=>{if(t){const t=u.filter((t=>t.image!==e.image));h(t)}else h([...u,e])}},n.createElement("span",{className:"select"+(t?" selected":"")}))}return n.createElement(c,{to:{pathname:`/photo/${a.id}`,state:{album:a,index:t}},key:e.image},n.createElement("div",{className:"photo",style:{backgroundImage:`url(${e.image})`}}))})),Array.from({length:E}).map(((e,t)=>n.createElement("div",{className:"photo loading",key:t}))))),o?n.createElement("div",{className:"delete",onClick:()=>{u.length>0&&e.deletePhotos(y,a,f,u)}},u.length>0?n.createElement(n.Fragment,null,n.createElement("img",{src:"/delete-white.svg",alt:""}),u.length+"枚の写真を削除"):"写真を選択してください"):n.createElement("form",{action:"",encType:"multipart/form-data"},n.createElement("input",{className:"file",title:"写真選択",onChange:t=>{e.addPhotos(t,y,a,f),t.target.files&&b(t.target.files.length)},id:"file",type:"file",name:"file",accept:"image/*",multiple:!0}),n.createElement("label",{htmlFor:"file"})))};var F=p((e=>{const{game:t}=e.location.state,[a,l]=m.exports.useState("");return m.exports.useEffect((()=>{if(t.id){const e="https://db.collectio.jp/wp-json/wp/v2/posts/"+t.id;fetch(e).then((e=>e.json())).then((e=>{e.acf.amazon&&l(e.acf.amazon)}))}}),[]),n.createElement("div",{id:"game"},n.createElement("nav",null,n.createElement("a",{onClick:()=>e.history.goBack()},n.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),n.createElement("span",null),n.createElement("span",null)),n.createElement("div",{className:"game"},t.image?n.createElement("img",{src:t.image,alt:t.title}):n.createElement("div",{className:"noimage"},t.title),n.createElement("p",{className:"title"},t.title),"0"!==t.year?n.createElement("p",{className:"year"},t.year):null,n.createElement("div",{className:"links"},""===a?n.createElement("a",{href:"https://www.amazon.co.jp/s?i=toys&tag=collectio0c-22&k="+encodeURIComponent(t.title.replace(":"," ").replace("："," ")),className:"amazon",target:"_blank"},"Amazonで探す"):n.createElement("a",{href:a+"?tag=collectio0c-22",className:"amazon",target:"_blank"},"Amazonで見る"),t.bodogema?n.createElement("a",{href:t.bodogema,className:"bodogema",target:"_blank"},"ボドゲーマ"):null,t.bgg?n.createElement("a",{href:t.bgg,className:"bgg",target:"_blank"},"BoardGameGeek"):null,t.bgdb?n.createElement("a",{href:t.bgdb,className:"bgdb",target:"_blank"},"ボードゲームデータベース"):null)))}));var G=p((e=>{const s=i(T),[r,d]=m.exports.useState({album:null});let{index:p}=e.location.state,{id:h}=g();m.exports.useEffect((()=>{if(!r.album){const e=s.filter((e=>e.id===h))[0];e&&d({album:e})}}));const E={dots:!1,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,initialSlide:p};return r.album?n.createElement("div",{id:"photo"},n.createElement(c,{to:{pathname:`/album/${h}`},className:"close"},n.createElement("img",{src:"/close.svg"})),n.createElement(u,((e,s)=>{for(var n in s||(s={}))a.call(s,n)&&o(e,n,s[n]);if(t)for(var n of t(s))l.call(s,n)&&o(e,n,s[n]);return e})({},E),r.album.photos.map((e=>n.createElement(n.Fragment,{key:e.image},n.createElement("div",{style:{backgroundImage:`url(${e.image})`}})))))):null}));var W=p((e=>{const t=i(T),[a,l]=m.exports.useState(null),[o,s]=m.exports.useState([]),[r,d]=m.exports.useState(!1);let{id:p}=g();m.exports.useEffect((()=>{if(!a){const e=t.filter((e=>e.id===p))[0];e&&l(e)}}));return a?n.createElement("div",{id:"shareSelect"},n.createElement("nav",null,n.createElement(c,{to:{pathname:`/album/${a.id}`}},n.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),n.createElement("span",null,"写真の選択"),n.createElement("span",null)),n.createElement("div",{className:"album"},n.createElement("div",{className:"photos"},a.photos.map(((e,t)=>n.createElement("div",{key:e.image,className:"photo"+(r?" disabled":""),onClick:()=>(e=>{-1===o.indexOf(e)?!1===r&&(o.push(e),o.length>=4&&d(!0),s([...o])):(o.splice(o.indexOf(e),1),s([...o]),d(!1))})(t),style:{backgroundImage:`url(${e.image})`}},n.createElement("span",{className:"select"+(o.indexOf(t)>-1?" selected":"")}))))),n.createElement("div",{className:"bottomActions",onClick:()=>{if(0===o.length)return alert("写真を選択してください");const t=a.photos.filter(((e,t)=>o.indexOf(t)>-1));e.history.push({pathname:"/share",state:{photos:t,album:a}})}},n.createElement("span",{className:"share"},"次へ")))):null}));const V=async(e,t)=>{const a=await fetch(e).then((e=>e.blob()));return new File([a],`test${t}.jpg`,{type:a.type})};var J=p((e=>{const[t,a]=m.exports.useState({album:{},photos:[]});m.exports.useEffect((()=>{try{const{photos:t}=e.location.state,{album:l}=e.location.state;a({album:l,photos:t})}catch{e.history.push("/"),location.reload()}return scrollTo(0,0),()=>{}}),[t.album,t.photos]);return null===t.album?null:n.createElement("div",{id:"share"},n.createElement("nav",null,n.createElement("a",{onClick:()=>e.history.goBack()},n.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"}))),n.createElement("div",{className:"photos"},t.photos.map(((e,t)=>n.createElement("div",{key:e.image,className:"photo",style:{backgroundImage:`url(${e.image})`}})))),n.createElement("button",{onClick:async()=>{const e=[];for(const a of t.photos){const t=await V(a.image,Math.floor(10*Math.random()));e.push(t)}navigator.share?navigator.share({url:"https://collectio.jp/",files:e}).then((()=>{console.log("Share was successful.")})).catch((e=>{console.log("Sharing failed",e)})):alert("このブラウザではシェア機能が使えません。\n最新のSafari, Chromeをお使いください。")}},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19.067",height:"24.245",viewBox:"0 0 19.067 24.245"},n.createElement("path",{d:"M.005-4.834a.855.855,0,0,0,.849-.838V-16.7L.79-18.315l.73.763,1.622,1.74a.784.784,0,0,0,.58.258.751.751,0,0,0,.784-.763.75.75,0,0,0-.247-.559l-3.631-3.5a.838.838,0,0,0-.623-.29.838.838,0,0,0-.623.29l-3.631,3.5a.76.76,0,0,0-.258.559.748.748,0,0,0,.773.763.79.79,0,0,0,.591-.258l1.633-1.74.73-.763L-.854-16.7V-5.672A.865.865,0,0,0,.005-4.834ZM-6.161,3.577H6.161c2.245,0,3.373-1.117,3.373-3.33V-10.474c0-2.213-1.128-3.33-3.373-3.33h-3v1.729H6.128a1.519,1.519,0,0,1,1.676,1.7V.15a1.519,1.519,0,0,1-1.676,1.7H-6.139A1.507,1.507,0,0,1-7.8.15V-10.377a1.507,1.507,0,0,1,1.665-1.7h2.976V-13.8h-3c-2.245,0-3.373,1.117-3.373,3.33V.247C-9.534,2.46-8.406,3.577-6.161,3.577Z",transform:"translate(9.534 20.668)"})),"共有する"))}));const H=e=>e.replace(/[\u3041-\u3096]/g,(function(e){const t=e.charCodeAt(0)+96;return String.fromCharCode(t)})),Z=e=>{const t=i(T),a=m.exports.useRef(null),[l,o]=m.exports.useState(!1),[s,c]=m.exports.useState(null),[p,u]=m.exports.useState([]);let{id:E}=g();const b=r(),f=d();let v="";m.exports.useEffect((()=>{if(scrollTo(0,0),!s){const e=t.filter((e=>e.id===E))[0];e&&c(e)}a.current&&a.current.focus(),fetch("https://db-api-mxiq5qapta-an.a.run.app/search")}),[t]);const w=async e=>{e.preventDefault();const t=a.current.value;if(""===t)return u([]);if(t===v)return;v=t;let l=await y(t);if(o(!0),l.length>0?(o(!1),u(l)):H(t)!==t&&(l=await y(H(t))),l.length<=0){const e=await N(t);l=l.concat(e)}o(!1),u(l)},y=async e=>{const t=await fetch("https://db-api-mxiq5qapta-an.a.run.app/search?q="+encodeURIComponent(e)).then((e=>e.json())),a=[];return t.map((e=>{a.push(e)})),a},N=async e=>{const t=await h("https://www.google.com/complete/search?hl=ja&client=firefox&q="+encodeURIComponent(e)).then((e=>e.json())),a=[];if(t[1].map((e=>{const t={id:null,title:e,image:null};a.push(t)})),0===a.length||-1===a.findIndex((t=>e===t.title))){const t={id:null,title:e,image:null};a.unshift(t)}return a},k=async e=>{if(e.id){const t=(await fetch(`https://db.collectio.jp/wp-json/wp/v2/posts/${e.id}?_embed`).then((e=>e.json()))).featured_image.src;if(e.image="https://db.collectio.jp/wp-includes/images/media/default.png"!==t?t:null,-1===s.games.findIndex((t=>t.id===e.id))){const t=Object.assign({},s,{games:[...s.games,e]});c(t)}}else if(-1===s.games.findIndex((t=>t.title===e.title))){const t=Object.assign({},s,{games:[...s.games,e]});c(t)}u([]),a.current.value=""};return null===s?null:n.createElement("div",{id:"select"},n.createElement("nav",null,n.createElement("a",{onClick:()=>f.goBack()},n.createElement("img",{className:"logo",src:"/back.svg",alt:"戻る"})),0===p.length?n.createElement("a",{onClick:()=>{(async()=>{e.updateAlbum(s,b),f.push(`/album/${s.id}`)})()}},"完了"):null),n.createElement("form",{action:"",onSubmit:w},n.createElement("div",{className:"bg"},n.createElement("input",{type:"text",ref:a,placeholder:"ゲームを検索",onChange:w})),0===p.length&&l?n.createElement("div",{className:"suggests"},"読み込み中..."):null,p.length>0?n.createElement("div",{className:"suggests"},p.slice(0,100).map(((e,t)=>n.createElement("div",{key:"suggest"+t,onClick:k.bind(void 0,e)},e.title)))):null),s.games.length>0?n.createElement("div",{className:"games"},n.createElement("h3",null,"遊んだゲーム"),s.games.map(((e,t)=>n.createElement("div",{key:"game"+t,className:"game"},e.image?n.createElement("img",{src:e.image,alt:""}):n.createElement("span",{className:"image"}),n.createElement("span",{className:"data"},n.createElement("span",{className:"title"},e.title),n.createElement("span",{className:"delete",onClick:()=>{(e=>{const t=Object.assign({},s,{games:s.games.filter((t=>t.id!==e.id||null==t.id&&t.title!==e.title))});c(t)})(e)}},n.createElement("img",{src:"/delete.svg",alt:"削除"}))))))):null)};let Y=v;Y=window.cordova?w:v,E.initializeApp(j);const K=E.firestore();E.storage(),E.analytics();const X="ある日のボードゲーム会",Q={id:"sample",title:"サンプルのボードゲーム会",date:`${(new Date).getFullYear()}/${(new Date).getMonth()+1}/${(new Date).getDate()}`,photos:[{image:"https://storage.googleapis.com/collectio-photo-assets/sample/1.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/2.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/3.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/4.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/5.jpg"},{image:"https://storage.googleapis.com/collectio-photo-assets/sample/6.jpg"}],games:[{bgdb:"http://www.gamers-jp.com/playgame/db_gamea.php?game_id=6959",bgg:"https://boardgamegeek.com/boardgame/191895",bodogema:"https://bodoge.hoobby.net/games/golovonogi",etitle:"Toddles-Bobbles Green",hasJPURL:1,id:"95735",keyword:"なんじゃもんじゃ,みどり,緑",maxPlayers:6,minPlayers:2,playAge:4,playingTime:15,title:"ナンジャモンジャ・ミドリ",year:"2010",image:"https://db.collectio.jp/wp-content/uploads/2019/05/95735.jpg"},{bgdb:"",bgg:"https://boardgamegeek.com/boardgame/230802",bodogema:"https://bodoge.hoobby.net/games/azul",etitle:"Azul",hasJPURL:1,id:"72660",keyword:"",maxPlayers:4,minPlayers:2,playAge:8,playingTime:45,title:"アズール",year:"2017",image:"https://db.collectio.jp/wp-content/uploads/2019/05/72660.jpg"},{bgdb:"http://www.gamers-jp.com/playgame/db_gamea.php?game_id=4786",bgg:"https://boardgamegeek.com/boardgame/68448",bodogema:"https://bodoge.hoobby.net/games/7-wonders",etitle:"7 Wonders",hasJPURL:1,id:"81063",keyword:"せかいのななふしぎ せぶんわんだー 7わんだー",maxPlayers:"",minPlayers:"",playAge:"",playingTime:"",title:"世界の七不思議",year:"2010",image:"https://db.collectio.jp/wp-content/uploads/2019/05/81063.jpg"},{bgdb:null,bgg:null,bodogema:null,etitle:"",hasJPURL:1,id:"110318",keyword:"",maxPlayers:null,minPlayers:null,playAge:null,playingTime:null,title:"Escape from the Office: The exciting escape game – escape your boss",year:"0",image:null}],userId:""},ee=async(e,t,a,l)=>{if(e.target.files){const o=[];for(const t of e.target.files){const e=await te(t).catch((e=>console.log(e)));e&&o.push(e)}const s=K.collection("albums").doc(a.id);await s.update(a).then((async()=>{console.log("Document written with ID: ",s.id);const e=[].concat(a.photos);for(const a of o){const l=await ae(t,s,a).catch((e=>console.log(e)));l&&e.push({image:l})}s.update({photos:e}).catch((e=>console.log(e)));const n=Object.assign({},a,{photos:e});l(D(n))})).catch((e=>console.log(e)))}},te=e=>new Promise(((t,a)=>{const l=new FileReader;l.onload=async e=>{t(await se(e.target.result))},l.readAsDataURL(e)})),ae=(e,t,a)=>(console.log("uploadPhoto"),new Promise(((l,o)=>{const s=E.storage().ref().child(`albums/${e.uid}/${t.id}/${(new Date).getTime()}.jpg`).putString(a,"data_url");s.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;switch(console.log("Upload is "+t+"% done"),e.state){case E.storage.TaskState.PAUSED:console.log("Upload is paused");break;case E.storage.TaskState.RUNNING:console.log("Upload is running")}}),(e=>{console.log(e),o()}),(async()=>{const e=await s.snapshot.ref.getDownloadURL();console.log("File available at",e),l(e)}))}))),le=(e,t,a)=>new Promise(((l,o)=>{const s=K.collection("albums").doc(t.id),n=E.storage().ref(),c=a.image.split("?")[0].split("%2F")[3];n.child(`albums/${e.uid}/${s.id}/${c}`).delete().then((()=>{console.log("File deleted"),l()})).catch((e=>{console.log(e),o()}))})),oe=async(e,t,a,l)=>{for(const c of l)await le(e,t,c).catch((e=>console.log(e)));const o=[];for(const c of t.photos){void 0===l.find((e=>e.image===c.image))&&void 0===o.find((e=>e.image===c.image))&&o.push(c)}const s=K.collection("albums").doc(t.id);await s.update({photos:o}).catch((e=>console.log(e)));const n=Object.assign({},t,{photos:o});a(D(n))},se=e=>new Promise(((t,a)=>{const l=640,o=document.createElement("canvas"),s=o.getContext("2d");if(s){const a=new Image;a.crossOrigin="Anonymous",a.onload=async a=>{const n=a.target;let c,i;if(n.width>n.height?(c=l,i=n.height*l/n.width):(i=l,c=n.width*l/n.height),o.width=c,o.height=i,s.drawImage(n,0,0,n.width,n.height,0,0,c,i),void 0===document.createElement("img").style.imageOrientation){const a=((e,t)=>{var a=document.createElement("canvas"),l=a.getContext("2d");if(l){switch(t){case 3:a.width=e.width,a.height=e.height,l.rotate(Math.PI),l.drawImage(e,-e.width,-e.height),l.rotate(-Math.PI);break;case 6:a.width=e.height,a.height=e.width,l.rotate(.5*Math.PI),l.drawImage(e,0,-e.height),l.rotate(.5*-Math.PI);break;case 8:a.width=e.height,a.height=e.width,l.rotate(.5*-Math.PI),l.drawImage(e,-e.width,0),l.rotate(.5*Math.PI);break;default:a.width=e.width,a.height=e.height,l.drawImage(e,0,0)}return a.toDataURL("image/jpeg",.8)}})(n,await y.orientation(e));t(a)}else t(o.toDataURL("image/jpeg",.8))},a.src=e}else a()})),ne=async(e,t)=>{const a=K.collection("albums").doc(e.id);await a.update(e).then((()=>{t(D(e))})).catch((e=>console.log(e)))},ce=async(e,t)=>{console.log(e),await K.collection("albums").doc(e.id).delete(),t(L(e.id))},ie=async e=>{let t=[];e.forEach((e=>{e.games.forEach((e=>{e.id&&t.push(parseInt(e.id))}))})),t=Array.from(new Set(t));const a="https://db.collectio.jp/wp-json/wp/v2/posts?include="+t.join(",");console.log(a);const l=await fetch(a).then((e=>e.json()));return e.forEach((e=>{e.games.forEach((e=>{l.map((t=>{"https://db.collectio.jp/wp-includes/images/media/default.png"!==t.featured_image.src&&e.id==t.id&&(e.image=t.featured_image.src)}))}))})),e};function re(){const[e,t]=m.exports.useState(!0),[a,l]=m.exports.useState(!1),o=i(C);i(T);const s=r();m.exports.useEffect((()=>{if(!o)return E.auth().onAuthStateChanged((e=>{e&&(s(S({uid:e.uid,photoURL:e.photoURL,displayName:e.displayName})),((e,t)=>{let a=[];K.collection("albums").where("userId","==",e.uid).orderBy("date","desc").get().then((async e=>{e.forEach((e=>{const t=e.data();t.id=e.id,delete t.date,a.push(t)})),e.empty?t(U(Q)):(a=await ie(a),t(R(a)))})).catch((e=>{console.log("Error getting documents: ",e)}))})(e,s)),t(!1)})),()=>{console.log("Clean up")}}));const c=()=>{if(window.cordova){let e={};"ios"!==window.cordova.platformId&&(e={webClientId:"16919798390-gt4d4vanvgu1n0u93nasrv7vt277r9gd.apps.googleusercontent.com",offline:!1}),window.plugins.googleplus.login(e,(e=>{let t=(new E.auth.GoogleAuthProvider).credential(e.idToken);E.auth().signInWithCredential(t)}),(e=>{console.log("error: "+e)}))}else{const e=new E.auth.GoogleAuthProvider;E.auth().signInWithRedirect(e)}};E.auth();const d=()=>{window.cordova&&SignInWithApple.isAvailable().then((function(e){console.info(e);const t=function(e){let t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=a.length;for(let o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*l));return t}(32);return SignInWithApple.request({requestedScopes:[SignInWithApple.Scope.Email],nonce:N(t).toString()}).then((e=>{let a=new E.auth.OAuthProvider("apple.com").credential({idToken:e.identityToken,rawNonce:t});E.auth().signInWithCredential(a).then((()=>{})).catch((e=>{e.code;const t=e.message;console.log("firebase auth failed with Apple Sign In"),console.log(t),alert(e.message||"エラーが発生しました")}))})).catch((e=>{console.error(e),alert(e.message||"エラーが発生しました")}))})).catch((e=>{console.log(e),alert("この機種ではAppleアカウントのログインをサポートしていません")}))},g=()=>{E.auth().signOut().then((()=>{location.reload()})).catch((e=>{}))};return n.createElement(Y,null,n.createElement("div",null,n.createElement(b,null,n.createElement(f,{path:"/select/:id",render:()=>n.createElement(Z,{updateAlbum:ne})}),n.createElement(f,{path:"/share/:id"},n.createElement(W,null)),n.createElement(f,{path:"/share"},n.createElement(J,null)),n.createElement(f,{path:"/photo/:id"},n.createElement(G,null)),n.createElement(f,{path:"/game/:id"},n.createElement(F,null)),n.createElement(f,{path:"/album/:id",render:()=>n.createElement(q,{updateAlbum:ne,addPhotos:ee,deletePhotos:oe,deleteAlbum:ce})}),n.createElement(f,{path:"/",render:()=>e?n.createElement(M,null):o?n.createElement(B,{uploading:a,signOut:g,createAlbum:(e,t,a)=>{l(!0),(async(e,t,a,l)=>{if(e.target.files){const o=[];for(const t of e.target.files){const e=await te(t).catch((e=>console.log(e)));e&&o.push(e)}const s={id:"",title:X,date:new Date,photos:[],games:[],userId:t.uid},n=await K.collection("albums").add(s).catch((e=>{console.error("Error adding document: ",e)}));if(n){console.log("Document written with ID: ",n.id);const e=[];for(const a of o){const l=await ae(t,n,a).catch((e=>console.log(e)));l&&e.push({image:l})}n.update({id:n.id,photos:e}).catch((e=>console.log(e))),s.id=n.id,s.photos=e,delete s.date,a(O(s)),l(!1)}}})(e,t,a,l)}}):n.createElement(z,{GoogleLogin:c,AppleLogin:d})}))))}const me=k({reducer:{userReducer:P,albumsReducer:_}});const de=()=>{I.render(n.createElement(n.StrictMode,null,n.createElement(A,{store:me},n.createElement(re,null))),document.getElementById("root"))};var ge;"true"===(ge={},location.search.substr(1).split("&").map((function(e){var t=e.split("=");ge[t[0]]=decodeURIComponent(t[1])})),ge).cordova?document.addEventListener("deviceready",de,!1):de();
