import {
  Component,
  LogLevel,
  Logger,
  __awaiter,
  __extends,
  __generator,
  __spreadArray,
  createMockUserToken,
  getModularInstance,
  getUA,
  index_esm_default,
  isBrowserExtension,
  isElectron,
  isIE,
  isMobileCordova,
  isReactNative,
  isUWP
} from "./chunk-LTTFIC3U.js";
import "./chunk-HV27UI33.js";

// node_modules/@firebase/webchannel-wrapper/dist/index.esm.js
var extendStatics = function(d2, b) {
  extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b2) {
    d3.__proto__ = b2;
  } || function(d3, b2) {
    for (var p2 in b2)
      if (Object.prototype.hasOwnProperty.call(b2, p2))
        d3[p2] = b2[p2];
  };
  return extendStatics(d2, b);
};
function __extends2(d2, b) {
  if (typeof b !== "function" && b !== null)
    throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
  extendStatics(d2, b);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m)
    return m.call(o);
  if (o && typeof o.length === "number")
    return {
      next: function() {
        if (o && i >= o.length)
          o = void 0;
        return { value: o && o[i++], done: !o };
      }
    };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
var k;
var goog = goog || {};
var l = commonjsGlobal || self;
function aa() {
}
function ba(a) {
  var b = typeof a;
  b = b != "object" ? b : a ? Array.isArray(a) ? "array" : b : "null";
  return b == "array" || b == "object" && typeof a.length == "number";
}
function p(a) {
  var b = typeof a;
  return b == "object" && a != null || b == "function";
}
function da(a) {
  return Object.prototype.hasOwnProperty.call(a, ea) && a[ea] || (a[ea] = ++fa);
}
var ea = "closure_uid_" + (1e9 * Math.random() >>> 0);
var fa = 0;
function ha(a, b, c) {
  return a.call.apply(a.bind, arguments);
}
function ia(a, b, c) {
  if (!a)
    throw Error();
  if (2 < arguments.length) {
    var d2 = Array.prototype.slice.call(arguments, 2);
    return function() {
      var e = Array.prototype.slice.call(arguments);
      Array.prototype.unshift.apply(e, d2);
      return a.apply(b, e);
    };
  }
  return function() {
    return a.apply(b, arguments);
  };
}
function q(a, b, c) {
  Function.prototype.bind && Function.prototype.bind.toString().indexOf("native code") != -1 ? q = ha : q = ia;
  return q.apply(null, arguments);
}
function ja(a, b) {
  var c = Array.prototype.slice.call(arguments, 1);
  return function() {
    var d2 = c.slice();
    d2.push.apply(d2, arguments);
    return a.apply(this, d2);
  };
}
function t(a, b) {
  function c() {
  }
  c.prototype = b.prototype;
  a.Z = b.prototype;
  a.prototype = new c();
  a.prototype.constructor = a;
  a.Vb = function(d2, e, f) {
    for (var h = Array(arguments.length - 2), n = 2; n < arguments.length; n++)
      h[n - 2] = arguments[n];
    return b.prototype[e].apply(d2, h);
  };
}
function v() {
  this.s = this.s;
  this.o = this.o;
}
var ka = 0;
var la = {};
v.prototype.s = false;
v.prototype.na = function() {
  if (!this.s && (this.s = true, this.M(), ka != 0)) {
    var a = da(this);
    delete la[a];
  }
};
v.prototype.M = function() {
  if (this.o)
    for (; this.o.length; )
      this.o.shift()();
};
var ma = Array.prototype.indexOf ? function(a, b) {
  return Array.prototype.indexOf.call(a, b, void 0);
} : function(a, b) {
  if (typeof a === "string")
    return typeof b !== "string" || b.length != 1 ? -1 : a.indexOf(b, 0);
  for (var c = 0; c < a.length; c++)
    if (c in a && a[c] === b)
      return c;
  return -1;
};
var na = Array.prototype.forEach ? function(a, b, c) {
  Array.prototype.forEach.call(a, b, c);
} : function(a, b, c) {
  var d2 = a.length, e = typeof a === "string" ? a.split("") : a;
  for (var f = 0; f < d2; f++)
    f in e && b.call(c, e[f], f, a);
};
function oa(a) {
  a: {
    var b = pa;
    var c = a.length, d2 = typeof a === "string" ? a.split("") : a;
    for (var e = 0; e < c; e++)
      if (e in d2 && b.call(void 0, d2[e], e, a)) {
        b = e;
        break a;
      }
    b = -1;
  }
  return 0 > b ? null : typeof a === "string" ? a.charAt(b) : a[b];
}
function qa(a) {
  return Array.prototype.concat.apply([], arguments);
}
function ra(a) {
  var b = a.length;
  if (0 < b) {
    var c = Array(b);
    for (var d2 = 0; d2 < b; d2++)
      c[d2] = a[d2];
    return c;
  }
  return [];
}
function sa(a) {
  return /^[\s\xa0]*$/.test(a);
}
var ta = String.prototype.trim ? function(a) {
  return a.trim();
} : function(a) {
  return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1];
};
function w(a, b) {
  return a.indexOf(b) != -1;
}
function ua(a, b) {
  return a < b ? -1 : a > b ? 1 : 0;
}
var x;
a: {
  va2 = l.navigator;
  if (va2) {
    wa2 = va2.userAgent;
    if (wa2) {
      x = wa2;
      break a;
    }
  }
  x = "";
}
var va2;
var wa2;
function xa(a, b, c) {
  for (var d2 in a)
    b.call(c, a[d2], d2, a);
}
function ya(a) {
  var b = {};
  for (var c in a)
    b[c] = a[c];
  return b;
}
var za = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Aa(a, b) {
  var c, d2;
  for (var e = 1; e < arguments.length; e++) {
    d2 = arguments[e];
    for (c in d2)
      a[c] = d2[c];
    for (var f = 0; f < za.length; f++)
      c = za[f], Object.prototype.hasOwnProperty.call(d2, c) && (a[c] = d2[c]);
  }
}
function Ca(a) {
  Ca[" "](a);
  return a;
}
Ca[" "] = aa;
function Fa(a) {
  var b = Ga;
  return Object.prototype.hasOwnProperty.call(b, 9) ? b[9] : b[9] = a(9);
}
var Ha = w(x, "Opera");
var y = w(x, "Trident") || w(x, "MSIE");
var Ia = w(x, "Edge");
var Ja = Ia || y;
var Ka = w(x, "Gecko") && !(w(x.toLowerCase(), "webkit") && !w(x, "Edge")) && !(w(x, "Trident") || w(x, "MSIE")) && !w(x, "Edge");
var La = w(x.toLowerCase(), "webkit") && !w(x, "Edge");
function Ma() {
  var a = l.document;
  return a ? a.documentMode : void 0;
}
var Na;
a: {
  Oa2 = "", Pa2 = function() {
    var a = x;
    if (Ka)
      return /rv:([^\);]+)(\)|;)/.exec(a);
    if (Ia)
      return /Edge\/([\d\.]+)/.exec(a);
    if (y)
      return /\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);
    if (La)
      return /WebKit\/(\S+)/.exec(a);
    if (Ha)
      return /(?:Version)[ \/]?(\S+)/.exec(a);
  }();
  Pa2 && (Oa2 = Pa2 ? Pa2[1] : "");
  if (y) {
    Qa2 = Ma();
    if (Qa2 != null && Qa2 > parseFloat(Oa2)) {
      Na = String(Qa2);
      break a;
    }
  }
  Na = Oa2;
}
var Oa2;
var Pa2;
var Qa2;
var Ga = {};
function Ra() {
  return Fa(function() {
    var a = 0;
    var b = ta(String(Na)).split("."), c = ta("9").split("."), d2 = Math.max(b.length, c.length);
    for (var h = 0; a == 0 && h < d2; h++) {
      var e = b[h] || "", f = c[h] || "";
      do {
        e = /(\d*)(\D*)(.*)/.exec(e) || ["", "", "", ""];
        f = /(\d*)(\D*)(.*)/.exec(f) || ["", "", "", ""];
        if (e[0].length == 0 && f[0].length == 0)
          break;
        a = ua(e[1].length == 0 ? 0 : parseInt(e[1], 10), f[1].length == 0 ? 0 : parseInt(f[1], 10)) || ua(e[2].length == 0, f[2].length == 0) || ua(e[2], f[2]);
        e = e[3];
        f = f[3];
      } while (a == 0);
    }
    return 0 <= a;
  });
}
var Sa;
if (l.document && y) {
  Ta2 = Ma();
  Sa = Ta2 ? Ta2 : parseInt(Na, 10) || void 0;
} else
  Sa = void 0;
var Ta2;
var Ua = Sa;
var Va = function() {
  if (!l.addEventListener || !Object.defineProperty)
    return false;
  var a = false, b = Object.defineProperty({}, "passive", { get: function() {
    a = true;
  } });
  try {
    l.addEventListener("test", aa, b), l.removeEventListener("test", aa, b);
  } catch (c) {
  }
  return a;
}();
function z(a, b) {
  this.type = a;
  this.g = this.target = b;
  this.defaultPrevented = false;
}
z.prototype.h = function() {
  this.defaultPrevented = true;
};
function A(a, b) {
  z.call(this, a ? a.type : "");
  this.relatedTarget = this.g = this.target = null;
  this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
  this.key = "";
  this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
  this.state = null;
  this.pointerId = 0;
  this.pointerType = "";
  this.i = null;
  if (a) {
    var c = this.type = a.type, d2 = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
    this.target = a.target || a.srcElement;
    this.g = b;
    if (b = a.relatedTarget) {
      if (Ka) {
        a: {
          try {
            Ca(b.nodeName);
            var e = true;
            break a;
          } catch (f) {
          }
          e = false;
        }
        e || (b = null);
      }
    } else
      c == "mouseover" ? b = a.fromElement : c == "mouseout" && (b = a.toElement);
    this.relatedTarget = b;
    d2 ? (this.clientX = d2.clientX !== void 0 ? d2.clientX : d2.pageX, this.clientY = d2.clientY !== void 0 ? d2.clientY : d2.pageY, this.screenX = d2.screenX || 0, this.screenY = d2.screenY || 0) : (this.clientX = a.clientX !== void 0 ? a.clientX : a.pageX, this.clientY = a.clientY !== void 0 ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
    this.button = a.button;
    this.key = a.key || "";
    this.ctrlKey = a.ctrlKey;
    this.altKey = a.altKey;
    this.shiftKey = a.shiftKey;
    this.metaKey = a.metaKey;
    this.pointerId = a.pointerId || 0;
    this.pointerType = typeof a.pointerType === "string" ? a.pointerType : Wa[a.pointerType] || "";
    this.state = a.state;
    this.i = a;
    a.defaultPrevented && A.Z.h.call(this);
  }
}
t(A, z);
var Wa = { 2: "touch", 3: "pen", 4: "mouse" };
A.prototype.h = function() {
  A.Z.h.call(this);
  var a = this.i;
  a.preventDefault ? a.preventDefault() : a.returnValue = false;
};
var B = "closure_listenable_" + (1e6 * Math.random() | 0);
var Xa = 0;
function Ya(a, b, c, d2, e) {
  this.listener = a;
  this.proxy = null;
  this.src = b;
  this.type = c;
  this.capture = !!d2;
  this.ia = e;
  this.key = ++Xa;
  this.ca = this.fa = false;
}
function Za(a) {
  a.ca = true;
  a.listener = null;
  a.proxy = null;
  a.src = null;
  a.ia = null;
}
function $a(a) {
  this.src = a;
  this.g = {};
  this.h = 0;
}
$a.prototype.add = function(a, b, c, d2, e) {
  var f = a.toString();
  a = this.g[f];
  a || (a = this.g[f] = [], this.h++);
  var h = ab(a, b, d2, e);
  -1 < h ? (b = a[h], c || (b.fa = false)) : (b = new Ya(b, this.src, f, !!d2, e), b.fa = c, a.push(b));
  return b;
};
function bb(a, b) {
  var c = b.type;
  if (c in a.g) {
    var d2 = a.g[c], e = ma(d2, b), f;
    (f = 0 <= e) && Array.prototype.splice.call(d2, e, 1);
    f && (Za(b), a.g[c].length == 0 && (delete a.g[c], a.h--));
  }
}
function ab(a, b, c, d2) {
  for (var e = 0; e < a.length; ++e) {
    var f = a[e];
    if (!f.ca && f.listener == b && f.capture == !!c && f.ia == d2)
      return e;
  }
  return -1;
}
var cb = "closure_lm_" + (1e6 * Math.random() | 0);
var db = {};
function fb(a, b, c, d2, e) {
  if (d2 && d2.once)
    return gb(a, b, c, d2, e);
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      fb(a, b[f], c, d2, e);
    return null;
  }
  c = hb(c);
  return a && a[B] ? a.N(b, c, p(d2) ? !!d2.capture : !!d2, e) : ib(a, b, c, false, d2, e);
}
function ib(a, b, c, d2, e, f) {
  if (!b)
    throw Error("Invalid event type");
  var h = p(e) ? !!e.capture : !!e, n = jb(a);
  n || (a[cb] = n = new $a(a));
  c = n.add(b, c, d2, h, f);
  if (c.proxy)
    return c;
  d2 = kb();
  c.proxy = d2;
  d2.src = a;
  d2.listener = c;
  if (a.addEventListener)
    Va || (e = h), e === void 0 && (e = false), a.addEventListener(b.toString(), d2, e);
  else if (a.attachEvent)
    a.attachEvent(lb(b.toString()), d2);
  else if (a.addListener && a.removeListener)
    a.addListener(d2);
  else
    throw Error("addEventListener and attachEvent are unavailable.");
  return c;
}
function kb() {
  function a(c) {
    return b.call(a.src, a.listener, c);
  }
  var b = mb;
  return a;
}
function gb(a, b, c, d2, e) {
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      gb(a, b[f], c, d2, e);
    return null;
  }
  c = hb(c);
  return a && a[B] ? a.O(b, c, p(d2) ? !!d2.capture : !!d2, e) : ib(a, b, c, true, d2, e);
}
function nb(a, b, c, d2, e) {
  if (Array.isArray(b))
    for (var f = 0; f < b.length; f++)
      nb(a, b[f], c, d2, e);
  else
    (d2 = p(d2) ? !!d2.capture : !!d2, c = hb(c), a && a[B]) ? (a = a.i, b = String(b).toString(), b in a.g && (f = a.g[b], c = ab(f, c, d2, e), -1 < c && (Za(f[c]), Array.prototype.splice.call(f, c, 1), f.length == 0 && (delete a.g[b], a.h--)))) : a && (a = jb(a)) && (b = a.g[b.toString()], a = -1, b && (a = ab(b, c, d2, e)), (c = -1 < a ? b[a] : null) && ob(c));
}
function ob(a) {
  if (typeof a !== "number" && a && !a.ca) {
    var b = a.src;
    if (b && b[B])
      bb(b.i, a);
    else {
      var c = a.type, d2 = a.proxy;
      b.removeEventListener ? b.removeEventListener(c, d2, a.capture) : b.detachEvent ? b.detachEvent(lb(c), d2) : b.addListener && b.removeListener && b.removeListener(d2);
      (c = jb(b)) ? (bb(c, a), c.h == 0 && (c.src = null, b[cb] = null)) : Za(a);
    }
  }
}
function lb(a) {
  return a in db ? db[a] : db[a] = "on" + a;
}
function mb(a, b) {
  if (a.ca)
    a = true;
  else {
    b = new A(b, this);
    var c = a.listener, d2 = a.ia || a.src;
    a.fa && ob(a);
    a = c.call(d2, b);
  }
  return a;
}
function jb(a) {
  a = a[cb];
  return a instanceof $a ? a : null;
}
var pb = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
function hb(a) {
  if (typeof a === "function")
    return a;
  a[pb] || (a[pb] = function(b) {
    return a.handleEvent(b);
  });
  return a[pb];
}
function C() {
  v.call(this);
  this.i = new $a(this);
  this.P = this;
  this.I = null;
}
t(C, v);
C.prototype[B] = true;
C.prototype.removeEventListener = function(a, b, c, d2) {
  nb(this, a, b, c, d2);
};
function D(a, b) {
  var c, d2 = a.I;
  if (d2)
    for (c = []; d2; d2 = d2.I)
      c.push(d2);
  a = a.P;
  d2 = b.type || b;
  if (typeof b === "string")
    b = new z(b, a);
  else if (b instanceof z)
    b.target = b.target || a;
  else {
    var e = b;
    b = new z(d2, a);
    Aa(b, e);
  }
  e = true;
  if (c)
    for (var f = c.length - 1; 0 <= f; f--) {
      var h = b.g = c[f];
      e = qb(h, d2, true, b) && e;
    }
  h = b.g = a;
  e = qb(h, d2, true, b) && e;
  e = qb(h, d2, false, b) && e;
  if (c)
    for (f = 0; f < c.length; f++)
      h = b.g = c[f], e = qb(h, d2, false, b) && e;
}
C.prototype.M = function() {
  C.Z.M.call(this);
  if (this.i) {
    var a = this.i, c;
    for (c in a.g) {
      for (var d2 = a.g[c], e = 0; e < d2.length; e++)
        Za(d2[e]);
      delete a.g[c];
      a.h--;
    }
  }
  this.I = null;
};
C.prototype.N = function(a, b, c, d2) {
  return this.i.add(String(a), b, false, c, d2);
};
C.prototype.O = function(a, b, c, d2) {
  return this.i.add(String(a), b, true, c, d2);
};
function qb(a, b, c, d2) {
  b = a.i.g[String(b)];
  if (!b)
    return true;
  b = b.concat();
  for (var e = true, f = 0; f < b.length; ++f) {
    var h = b[f];
    if (h && !h.ca && h.capture == c) {
      var n = h.listener, u = h.ia || h.src;
      h.fa && bb(a.i, h);
      e = n.call(u, d2) !== false && e;
    }
  }
  return e && !d2.defaultPrevented;
}
var rb = l.JSON.stringify;
function sb() {
  var a = tb;
  var b = null;
  a.g && (b = a.g, a.g = a.g.next, a.g || (a.h = null), b.next = null);
  return b;
}
var ub = function() {
  function ub2() {
    this.h = this.g = null;
  }
  ub2.prototype.add = function(a, b) {
    var c = vb.get();
    c.set(a, b);
    this.h ? this.h.next = c : this.g = c;
    this.h = c;
  };
  return ub2;
}();
var vb = new (function() {
  function class_2(a, b) {
    this.i = a;
    this.j = b;
    this.h = 0;
    this.g = null;
  }
  class_2.prototype.get = function() {
    var a;
    0 < this.h ? (this.h--, a = this.g, this.g = a.next, a.next = null) : a = this.i();
    return a;
  };
  return class_2;
}())(function() {
  return new wb();
}, function(a) {
  return a.reset();
});
var wb = function() {
  function wb2() {
    this.next = this.g = this.h = null;
  }
  wb2.prototype.set = function(a, b) {
    this.h = a;
    this.g = b;
    this.next = null;
  };
  wb2.prototype.reset = function() {
    this.next = this.g = this.h = null;
  };
  return wb2;
}();
function yb(a) {
  l.setTimeout(function() {
    throw a;
  }, 0);
}
function zb(a, b) {
  Ab || Bb();
  Cb || (Ab(), Cb = true);
  tb.add(a, b);
}
var Ab;
function Bb() {
  var a = l.Promise.resolve(void 0);
  Ab = function() {
    a.then(Db);
  };
}
var Cb = false;
var tb = new ub();
function Db() {
  for (var a; a = sb(); ) {
    try {
      a.h.call(a.g);
    } catch (c) {
      yb(c);
    }
    var b = vb;
    b.j(a);
    100 > b.h && (b.h++, a.next = b.g, b.g = a);
  }
  Cb = false;
}
function Eb(a, b) {
  C.call(this);
  this.h = a || 1;
  this.g = b || l;
  this.j = q(this.kb, this);
  this.l = Date.now();
}
t(Eb, C);
k = Eb.prototype;
k.da = false;
k.S = null;
k.kb = function() {
  if (this.da) {
    var a = Date.now() - this.l;
    0 < a && a < 0.8 * this.h ? this.S = this.g.setTimeout(this.j, this.h - a) : (this.S && (this.g.clearTimeout(this.S), this.S = null), D(this, "tick"), this.da && (Fb(this), this.start()));
  }
};
k.start = function() {
  this.da = true;
  this.S || (this.S = this.g.setTimeout(this.j, this.h), this.l = Date.now());
};
function Fb(a) {
  a.da = false;
  a.S && (a.g.clearTimeout(a.S), a.S = null);
}
k.M = function() {
  Eb.Z.M.call(this);
  Fb(this);
  delete this.g;
};
function Gb(a, b, c) {
  if (typeof a === "function")
    c && (a = q(a, c));
  else if (a && typeof a.handleEvent == "function")
    a = q(a.handleEvent, a);
  else
    throw Error("Invalid listener argument");
  return 2147483647 < Number(b) ? -1 : l.setTimeout(a, b || 0);
}
function Hb(a) {
  a.g = Gb(function() {
    a.g = null;
    a.i && (a.i = false, Hb(a));
  }, a.j);
  var b = a.h;
  a.h = null;
  a.m.apply(null, b);
}
var Ib = function(_super) {
  __extends2(Ib2, _super);
  function Ib2(a, b) {
    var _this = _super.call(this) || this;
    _this.m = a;
    _this.j = b;
    _this.h = null;
    _this.i = false;
    _this.g = null;
    return _this;
  }
  Ib2.prototype.l = function(a) {
    this.h = arguments;
    this.g ? this.i = true : Hb(this);
  };
  Ib2.prototype.M = function() {
    _super.prototype.M.call(this);
    this.g && (l.clearTimeout(this.g), this.g = null, this.i = false, this.h = null);
  };
  return Ib2;
}(v);
function E(a) {
  v.call(this);
  this.h = a;
  this.g = {};
}
t(E, v);
var Jb = [];
function Kb(a, b, c, d2) {
  Array.isArray(c) || (c && (Jb[0] = c.toString()), c = Jb);
  for (var e = 0; e < c.length; e++) {
    var f = fb(b, c[e], d2 || a.handleEvent, false, a.h || a);
    if (!f)
      break;
    a.g[f.key] = f;
  }
}
function Lb(a) {
  xa(a.g, function(b, c) {
    this.g.hasOwnProperty(c) && ob(b);
  }, a);
  a.g = {};
}
E.prototype.M = function() {
  E.Z.M.call(this);
  Lb(this);
};
E.prototype.handleEvent = function() {
  throw Error("EventHandler.handleEvent not implemented");
};
function Mb() {
  this.g = true;
}
Mb.prototype.Aa = function() {
  this.g = false;
};
function Nb(a, b, c, d2, e, f) {
  a.info(function() {
    if (a.g)
      if (f) {
        var h = "";
        for (var n = f.split("&"), u = 0; u < n.length; u++) {
          var m = n[u].split("=");
          if (1 < m.length) {
            var r = m[0];
            m = m[1];
            var G2 = r.split("_");
            h = 2 <= G2.length && G2[1] == "type" ? h + (r + "=" + m + "&") : h + (r + "=redacted&");
          }
        }
      } else
        h = null;
    else
      h = f;
    return "XMLHTTP REQ (" + d2 + ") [attempt " + e + "]: " + b + "\n" + c + "\n" + h;
  });
}
function Ob(a, b, c, d2, e, f, h) {
  a.info(function() {
    return "XMLHTTP RESP (" + d2 + ") [ attempt " + e + "]: " + b + "\n" + c + "\n" + f + " " + h;
  });
}
function F(a, b, c, d2) {
  a.info(function() {
    return "XMLHTTP TEXT (" + b + "): " + Pb(a, c) + (d2 ? " " + d2 : "");
  });
}
function Qb(a, b) {
  a.info(function() {
    return "TIMEOUT: " + b;
  });
}
Mb.prototype.info = function() {
};
function Pb(a, b) {
  if (!a.g)
    return b;
  if (!b)
    return null;
  try {
    var c = JSON.parse(b);
    if (c) {
      for (a = 0; a < c.length; a++)
        if (Array.isArray(c[a])) {
          var d2 = c[a];
          if (!(2 > d2.length)) {
            var e = d2[1];
            if (Array.isArray(e) && !(1 > e.length)) {
              var f = e[0];
              if (f != "noop" && f != "stop" && f != "close")
                for (var h = 1; h < e.length; h++)
                  e[h] = "";
            }
          }
        }
    }
    return rb(c);
  } catch (n) {
    return b;
  }
}
var H = {};
var Rb = null;
function Sb() {
  return Rb = Rb || new C();
}
H.Ma = "serverreachability";
function Tb(a) {
  z.call(this, H.Ma, a);
}
t(Tb, z);
function I(a) {
  var b = Sb();
  D(b, new Tb(b, a));
}
H.STAT_EVENT = "statevent";
function Ub(a, b) {
  z.call(this, H.STAT_EVENT, a);
  this.stat = b;
}
t(Ub, z);
function J(a) {
  var b = Sb();
  D(b, new Ub(b, a));
}
H.Na = "timingevent";
function Vb(a, b) {
  z.call(this, H.Na, a);
  this.size = b;
}
t(Vb, z);
function K(a, b) {
  if (typeof a !== "function")
    throw Error("Fn must not be null and must be a function");
  return l.setTimeout(function() {
    a();
  }, b);
}
var Wb = { NO_ERROR: 0, lb: 1, yb: 2, xb: 3, sb: 4, wb: 5, zb: 6, Ja: 7, TIMEOUT: 8, Cb: 9 };
var Xb = { qb: "complete", Mb: "success", Ka: "error", Ja: "abort", Eb: "ready", Fb: "readystatechange", TIMEOUT: "timeout", Ab: "incrementaldata", Db: "progress", tb: "downloadprogress", Ub: "uploadprogress" };
function Yb() {
}
Yb.prototype.h = null;
function Zb(a) {
  return a.h || (a.h = a.i());
}
function $b() {
}
var L = { OPEN: "a", pb: "b", Ka: "c", Bb: "d" };
function ac() {
  z.call(this, "d");
}
t(ac, z);
function bc() {
  z.call(this, "c");
}
t(bc, z);
var cc;
function dc() {
}
t(dc, Yb);
dc.prototype.g = function() {
  return new XMLHttpRequest();
};
dc.prototype.i = function() {
  return {};
};
cc = new dc();
function M(a, b, c, d2) {
  this.l = a;
  this.j = b;
  this.m = c;
  this.X = d2 || 1;
  this.V = new E(this);
  this.P = ec;
  a = Ja ? 125 : void 0;
  this.W = new Eb(a);
  this.H = null;
  this.i = false;
  this.s = this.A = this.v = this.K = this.F = this.Y = this.B = null;
  this.D = [];
  this.g = null;
  this.C = 0;
  this.o = this.u = null;
  this.N = -1;
  this.I = false;
  this.O = 0;
  this.L = null;
  this.aa = this.J = this.$ = this.U = false;
  this.h = new fc();
}
function fc() {
  this.i = null;
  this.g = "";
  this.h = false;
}
var ec = 45e3;
var gc = {};
var hc = {};
k = M.prototype;
k.setTimeout = function(a) {
  this.P = a;
};
function ic(a, b, c) {
  a.K = 1;
  a.v = jc(N(b));
  a.s = c;
  a.U = true;
  kc(a, null);
}
function kc(a, b) {
  a.F = Date.now();
  lc(a);
  a.A = N(a.v);
  var c = a.A, d2 = a.X;
  Array.isArray(d2) || (d2 = [String(d2)]);
  mc(c.h, "t", d2);
  a.C = 0;
  c = a.l.H;
  a.h = new fc();
  a.g = nc(a.l, c ? b : null, !a.s);
  0 < a.O && (a.L = new Ib(q(a.Ia, a, a.g), a.O));
  Kb(a.V, a.g, "readystatechange", a.gb);
  b = a.H ? ya(a.H) : {};
  a.s ? (a.u || (a.u = "POST"), b["Content-Type"] = "application/x-www-form-urlencoded", a.g.ea(a.A, a.u, a.s, b)) : (a.u = "GET", a.g.ea(a.A, a.u, null, b));
  I(1);
  Nb(a.j, a.u, a.A, a.m, a.X, a.s);
}
k.gb = function(a) {
  a = a.target;
  var b = this.L;
  b && O(a) == 3 ? b.l() : this.Ia(a);
};
k.Ia = function(a) {
  try {
    if (a == this.g)
      a: {
        var r = O(this.g);
        var b = this.g.Da();
        var G2 = this.g.ba();
        if (!(3 > r) && (r != 3 || Ja || this.g && (this.h.h || this.g.ga() || oc(this.g)))) {
          this.I || r != 4 || b == 7 || (b == 8 || 0 >= G2 ? I(3) : I(2));
          pc(this);
          var c = this.g.ba();
          this.N = c;
          b:
            if (qc(this)) {
              var d2 = oc(this.g);
              a = "";
              var e = d2.length, f = O(this.g) == 4;
              if (!this.h.i) {
                if (typeof TextDecoder === "undefined") {
                  P(this);
                  rc(this);
                  var h = "";
                  break b;
                }
                this.h.i = new l.TextDecoder();
              }
              for (b = 0; b < e; b++)
                this.h.h = true, a += this.h.i.decode(d2[b], { stream: f && b == e - 1 });
              d2.splice(0, e);
              this.h.g += a;
              this.C = 0;
              h = this.h.g;
            } else
              h = this.g.ga();
          this.i = c == 200;
          Ob(this.j, this.u, this.A, this.m, this.X, r, c);
          if (this.i) {
            if (this.$ && !this.J) {
              b: {
                if (this.g) {
                  var n, u = this.g;
                  if ((n = u.g ? u.g.getResponseHeader("X-HTTP-Initial-Response") : null) && !sa(n)) {
                    var m = n;
                    break b;
                  }
                }
                m = null;
              }
              if (c = m)
                F(this.j, this.m, c, "Initial handshake response via X-HTTP-Initial-Response"), this.J = true, sc(this, c);
              else {
                this.i = false;
                this.o = 3;
                J(12);
                P(this);
                rc(this);
                break a;
              }
            }
            this.U ? (tc(this, r, h), Ja && this.i && r == 3 && (Kb(this.V, this.W, "tick", this.fb), this.W.start())) : (F(this.j, this.m, h, null), sc(this, h));
            r == 4 && P(this);
            this.i && !this.I && (r == 4 ? uc(this.l, this) : (this.i = false, lc(this)));
          } else
            c == 400 && 0 < h.indexOf("Unknown SID") ? (this.o = 3, J(12)) : (this.o = 0, J(13)), P(this), rc(this);
        }
      }
  } catch (r2) {
  } finally {
  }
};
function qc(a) {
  return a.g ? a.u == "GET" && a.K != 2 && a.l.Ba : false;
}
function tc(a, b, c) {
  var d2 = true, e;
  for (; !a.I && a.C < c.length; )
    if (e = vc(a, c), e == hc) {
      b == 4 && (a.o = 4, J(14), d2 = false);
      F(a.j, a.m, null, "[Incomplete Response]");
      break;
    } else if (e == gc) {
      a.o = 4;
      J(15);
      F(a.j, a.m, c, "[Invalid Chunk]");
      d2 = false;
      break;
    } else
      F(a.j, a.m, e, null), sc(a, e);
  qc(a) && e != hc && e != gc && (a.h.g = "", a.C = 0);
  b != 4 || c.length != 0 || a.h.h || (a.o = 1, J(16), d2 = false);
  a.i = a.i && d2;
  d2 ? 0 < c.length && !a.aa && (a.aa = true, b = a.l, b.g == a && b.$ && !b.L && (b.h.info("Great, no buffering proxy detected. Bytes received: " + c.length), wc(b), b.L = true, J(11))) : (F(a.j, a.m, c, "[Invalid Chunked Response]"), P(a), rc(a));
}
k.fb = function() {
  if (this.g) {
    var a = O(this.g), b = this.g.ga();
    this.C < b.length && (pc(this), tc(this, a, b), this.i && a != 4 && lc(this));
  }
};
function vc(a, b) {
  var c = a.C, d2 = b.indexOf("\n", c);
  if (d2 == -1)
    return hc;
  c = Number(b.substring(c, d2));
  if (isNaN(c))
    return gc;
  d2 += 1;
  if (d2 + c > b.length)
    return hc;
  b = b.substr(d2, c);
  a.C = d2 + c;
  return b;
}
k.cancel = function() {
  this.I = true;
  P(this);
};
function lc(a) {
  a.Y = Date.now() + a.P;
  xc(a, a.P);
}
function xc(a, b) {
  if (a.B != null)
    throw Error("WatchDog timer not null");
  a.B = K(q(a.eb, a), b);
}
function pc(a) {
  a.B && (l.clearTimeout(a.B), a.B = null);
}
k.eb = function() {
  this.B = null;
  var a = Date.now();
  0 <= a - this.Y ? (Qb(this.j, this.A), this.K != 2 && (I(3), J(17)), P(this), this.o = 2, rc(this)) : xc(this, this.Y - a);
};
function rc(a) {
  a.l.G == 0 || a.I || uc(a.l, a);
}
function P(a) {
  pc(a);
  var b = a.L;
  b && typeof b.na == "function" && b.na();
  a.L = null;
  Fb(a.W);
  Lb(a.V);
  a.g && (b = a.g, a.g = null, b.abort(), b.na());
}
function sc(a, b) {
  try {
    var c = a.l;
    if (c.G != 0 && (c.g == a || yc(c.i, a))) {
      if (c.I = a.N, !a.J && yc(c.i, a) && c.G == 3) {
        try {
          var d2 = c.Ca.g.parse(b);
        } catch (m2) {
          d2 = null;
        }
        if (Array.isArray(d2) && d2.length == 3) {
          var e = d2;
          if (e[0] == 0)
            a: {
              if (!c.u) {
                if (c.g)
                  if (c.g.F + 3e3 < a.F)
                    zc(c), Ac(c);
                  else
                    break a;
                Bc(c);
                J(18);
              }
            }
          else
            c.ta = e[1], 0 < c.ta - c.U && 37500 > e[2] && c.N && c.A == 0 && !c.v && (c.v = K(q(c.ab, c), 6e3));
          if (1 >= Cc(c.i) && c.ka) {
            try {
              c.ka();
            } catch (m2) {
            }
            c.ka = void 0;
          }
        } else
          Q(c, 11);
      } else if ((a.J || c.g == a) && zc(c), !sa(b))
        for (e = c.Ca.g.parse(b), b = 0; b < e.length; b++) {
          var m = e[b];
          c.U = m[0];
          m = m[1];
          if (c.G == 2)
            if (m[0] == "c") {
              c.J = m[1];
              c.la = m[2];
              var r = m[3];
              r != null && (c.ma = r, c.h.info("VER=" + c.ma));
              var G2 = m[4];
              G2 != null && (c.za = G2, c.h.info("SVER=" + c.za));
              var Da2 = m[5];
              Da2 != null && typeof Da2 === "number" && 0 < Da2 && (d2 = 1.5 * Da2, c.K = d2, c.h.info("backChannelRequestTimeoutMs_=" + d2));
              d2 = c;
              var ca2 = a.g;
              if (ca2) {
                var Ea2 = ca2.g ? ca2.g.getResponseHeader("X-Client-Wire-Protocol") : null;
                if (Ea2) {
                  var f = d2.i;
                  !f.g && (w(Ea2, "spdy") || w(Ea2, "quic") || w(Ea2, "h2")) && (f.j = f.l, f.g = new Set(), f.h && (Dc(f, f.h), f.h = null));
                }
                if (d2.D) {
                  var xb = ca2.g ? ca2.g.getResponseHeader("X-HTTP-Session-Id") : null;
                  xb && (d2.sa = xb, R(d2.F, d2.D, xb));
                }
              }
              c.G = 3;
              c.j && c.j.xa();
              c.$ && (c.O = Date.now() - a.F, c.h.info("Handshake RTT: " + c.O + "ms"));
              d2 = c;
              var h = a;
              d2.oa = Ec(d2, d2.H ? d2.la : null, d2.W);
              if (h.J) {
                Fc(d2.i, h);
                var n = h, u = d2.K;
                u && n.setTimeout(u);
                n.B && (pc(n), lc(n));
                d2.g = h;
              } else
                Gc(d2);
              0 < c.l.length && Hc(c);
            } else
              m[0] != "stop" && m[0] != "close" || Q(c, 7);
          else
            c.G == 3 && (m[0] == "stop" || m[0] == "close" ? m[0] == "stop" ? Q(c, 7) : Ic(c) : m[0] != "noop" && c.j && c.j.wa(m), c.A = 0);
        }
    }
    I(4);
  } catch (m2) {
  }
}
function Jc(a) {
  if (a.R && typeof a.R == "function")
    return a.R();
  if (typeof a === "string")
    return a.split("");
  if (ba(a)) {
    for (var b = [], c = a.length, d2 = 0; d2 < c; d2++)
      b.push(a[d2]);
    return b;
  }
  b = [];
  c = 0;
  for (d2 in a)
    b[c++] = a[d2];
  return b;
}
function Kc(a, b) {
  if (a.forEach && typeof a.forEach == "function")
    a.forEach(b, void 0);
  else if (ba(a) || typeof a === "string")
    na(a, b, void 0);
  else {
    if (a.T && typeof a.T == "function")
      var c = a.T();
    else if (a.R && typeof a.R == "function")
      c = void 0;
    else if (ba(a) || typeof a === "string") {
      c = [];
      for (var d2 = a.length, e = 0; e < d2; e++)
        c.push(e);
    } else
      for (e in c = [], d2 = 0, a)
        c[d2++] = e;
    d2 = Jc(a);
    e = d2.length;
    for (var f = 0; f < e; f++)
      b.call(void 0, d2[f], c && c[f], a);
  }
}
function S(a, b) {
  this.h = {};
  this.g = [];
  this.i = 0;
  var c = arguments.length;
  if (1 < c) {
    if (c % 2)
      throw Error("Uneven number of arguments");
    for (var d2 = 0; d2 < c; d2 += 2)
      this.set(arguments[d2], arguments[d2 + 1]);
  } else if (a)
    if (a instanceof S)
      for (c = a.T(), d2 = 0; d2 < c.length; d2++)
        this.set(c[d2], a.get(c[d2]));
    else
      for (d2 in a)
        this.set(d2, a[d2]);
}
k = S.prototype;
k.R = function() {
  Lc(this);
  for (var a = [], b = 0; b < this.g.length; b++)
    a.push(this.h[this.g[b]]);
  return a;
};
k.T = function() {
  Lc(this);
  return this.g.concat();
};
function Lc(a) {
  if (a.i != a.g.length) {
    for (var b = 0, c = 0; b < a.g.length; ) {
      var d2 = a.g[b];
      T(a.h, d2) && (a.g[c++] = d2);
      b++;
    }
    a.g.length = c;
  }
  if (a.i != a.g.length) {
    var e = {};
    for (c = b = 0; b < a.g.length; )
      d2 = a.g[b], T(e, d2) || (a.g[c++] = d2, e[d2] = 1), b++;
    a.g.length = c;
  }
}
k.get = function(a, b) {
  return T(this.h, a) ? this.h[a] : b;
};
k.set = function(a, b) {
  T(this.h, a) || (this.i++, this.g.push(a));
  this.h[a] = b;
};
k.forEach = function(a, b) {
  for (var c = this.T(), d2 = 0; d2 < c.length; d2++) {
    var e = c[d2], f = this.get(e);
    a.call(b, f, e, this);
  }
};
function T(a, b) {
  return Object.prototype.hasOwnProperty.call(a, b);
}
var Mc = /^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;
function Nc(a, b) {
  if (a) {
    a = a.split("&");
    for (var c = 0; c < a.length; c++) {
      var d2 = a[c].indexOf("="), e = null;
      if (0 <= d2) {
        var f = a[c].substring(0, d2);
        e = a[c].substring(d2 + 1);
      } else
        f = a[c];
      b(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
    }
  }
}
function U(a, b) {
  this.i = this.s = this.j = "";
  this.m = null;
  this.o = this.l = "";
  this.g = false;
  if (a instanceof U) {
    this.g = b !== void 0 ? b : a.g;
    Oc(this, a.j);
    this.s = a.s;
    Pc(this, a.i);
    Qc(this, a.m);
    this.l = a.l;
    b = a.h;
    var c = new Rc();
    c.i = b.i;
    b.g && (c.g = new S(b.g), c.h = b.h);
    Sc(this, c);
    this.o = a.o;
  } else
    a && (c = String(a).match(Mc)) ? (this.g = !!b, Oc(this, c[1] || "", true), this.s = Tc(c[2] || ""), Pc(this, c[3] || "", true), Qc(this, c[4]), this.l = Tc(c[5] || "", true), Sc(this, c[6] || "", true), this.o = Tc(c[7] || "")) : (this.g = !!b, this.h = new Rc(null, this.g));
}
U.prototype.toString = function() {
  var a = [], b = this.j;
  b && a.push(Uc(b, Vc, true), ":");
  var c = this.i;
  if (c || b == "file")
    a.push("//"), (b = this.s) && a.push(Uc(b, Vc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.m, c != null && a.push(":", String(c));
  if (c = this.l)
    this.i && c.charAt(0) != "/" && a.push("/"), a.push(Uc(c, c.charAt(0) == "/" ? Wc : Xc, true));
  (c = this.h.toString()) && a.push("?", c);
  (c = this.o) && a.push("#", Uc(c, Yc));
  return a.join("");
};
function N(a) {
  return new U(a);
}
function Oc(a, b, c) {
  a.j = c ? Tc(b, true) : b;
  a.j && (a.j = a.j.replace(/:$/, ""));
}
function Pc(a, b, c) {
  a.i = c ? Tc(b, true) : b;
}
function Qc(a, b) {
  if (b) {
    b = Number(b);
    if (isNaN(b) || 0 > b)
      throw Error("Bad port number " + b);
    a.m = b;
  } else
    a.m = null;
}
function Sc(a, b, c) {
  b instanceof Rc ? (a.h = b, Zc(a.h, a.g)) : (c || (b = Uc(b, $c)), a.h = new Rc(b, a.g));
}
function R(a, b, c) {
  a.h.set(b, c);
}
function jc(a) {
  R(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ Date.now()).toString(36));
  return a;
}
function ad(a) {
  return a instanceof U ? N(a) : new U(a, void 0);
}
function bd(a, b, c, d2) {
  var e = new U(null, void 0);
  a && Oc(e, a);
  b && Pc(e, b);
  c && Qc(e, c);
  d2 && (e.l = d2);
  return e;
}
function Tc(a, b) {
  return a ? b ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
}
function Uc(a, b, c) {
  return typeof a === "string" ? (a = encodeURI(a).replace(b, cd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
}
function cd(a) {
  a = a.charCodeAt(0);
  return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
}
var Vc = /[#\/\?@]/g;
var Xc = /[#\?:]/g;
var Wc = /[#\?]/g;
var $c = /[#\?@]/g;
var Yc = /#/g;
function Rc(a, b) {
  this.h = this.g = null;
  this.i = a || null;
  this.j = !!b;
}
function V(a) {
  a.g || (a.g = new S(), a.h = 0, a.i && Nc(a.i, function(b, c) {
    a.add(decodeURIComponent(b.replace(/\+/g, " ")), c);
  }));
}
k = Rc.prototype;
k.add = function(a, b) {
  V(this);
  this.i = null;
  a = W(this, a);
  var c = this.g.get(a);
  c || this.g.set(a, c = []);
  c.push(b);
  this.h += 1;
  return this;
};
function dd(a, b) {
  V(a);
  b = W(a, b);
  T(a.g.h, b) && (a.i = null, a.h -= a.g.get(b).length, a = a.g, T(a.h, b) && (delete a.h[b], a.i--, a.g.length > 2 * a.i && Lc(a)));
}
function ed(a, b) {
  V(a);
  b = W(a, b);
  return T(a.g.h, b);
}
k.forEach = function(a, b) {
  V(this);
  this.g.forEach(function(c, d2) {
    na(c, function(e) {
      a.call(b, e, d2, this);
    }, this);
  }, this);
};
k.T = function() {
  V(this);
  for (var a = this.g.R(), b = this.g.T(), c = [], d2 = 0; d2 < b.length; d2++)
    for (var e = a[d2], f = 0; f < e.length; f++)
      c.push(b[d2]);
  return c;
};
k.R = function(a) {
  V(this);
  var b = [];
  if (typeof a === "string")
    ed(this, a) && (b = qa(b, this.g.get(W(this, a))));
  else {
    a = this.g.R();
    for (var c = 0; c < a.length; c++)
      b = qa(b, a[c]);
  }
  return b;
};
k.set = function(a, b) {
  V(this);
  this.i = null;
  a = W(this, a);
  ed(this, a) && (this.h -= this.g.get(a).length);
  this.g.set(a, [b]);
  this.h += 1;
  return this;
};
k.get = function(a, b) {
  if (!a)
    return b;
  a = this.R(a);
  return 0 < a.length ? String(a[0]) : b;
};
function mc(a, b, c) {
  dd(a, b);
  0 < c.length && (a.i = null, a.g.set(W(a, b), ra(c)), a.h += c.length);
}
k.toString = function() {
  if (this.i)
    return this.i;
  if (!this.g)
    return "";
  for (var a = [], b = this.g.T(), c = 0; c < b.length; c++) {
    var d2 = b[c], e = encodeURIComponent(String(d2));
    d2 = this.R(d2);
    for (var f = 0; f < d2.length; f++) {
      var h = e;
      d2[f] !== "" && (h += "=" + encodeURIComponent(String(d2[f])));
      a.push(h);
    }
  }
  return this.i = a.join("&");
};
function W(a, b) {
  b = String(b);
  a.j && (b = b.toLowerCase());
  return b;
}
function Zc(a, b) {
  b && !a.j && (V(a), a.i = null, a.g.forEach(function(c, d2) {
    var e = d2.toLowerCase();
    d2 != e && (dd(this, d2), mc(this, e, c));
  }, a));
  a.j = b;
}
var fd = function() {
  function fd2(a, b) {
    this.h = a;
    this.g = b;
  }
  return fd2;
}();
function gd(a) {
  this.l = a || hd;
  l.PerformanceNavigationTiming ? (a = l.performance.getEntriesByType("navigation"), a = 0 < a.length && (a[0].nextHopProtocol == "hq" || a[0].nextHopProtocol == "h2")) : a = !!(l.g && l.g.Ea && l.g.Ea() && l.g.Ea().Zb);
  this.j = a ? this.l : 1;
  this.g = null;
  1 < this.j && (this.g = new Set());
  this.h = null;
  this.i = [];
}
var hd = 10;
function id(a) {
  return a.h ? true : a.g ? a.g.size >= a.j : false;
}
function Cc(a) {
  return a.h ? 1 : a.g ? a.g.size : 0;
}
function yc(a, b) {
  return a.h ? a.h == b : a.g ? a.g.has(b) : false;
}
function Dc(a, b) {
  a.g ? a.g.add(b) : a.h = b;
}
function Fc(a, b) {
  a.h && a.h == b ? a.h = null : a.g && a.g.has(b) && a.g.delete(b);
}
gd.prototype.cancel = function() {
  var e_1, _a2;
  this.i = jd(this);
  if (this.h)
    this.h.cancel(), this.h = null;
  else if (this.g && this.g.size !== 0) {
    try {
      for (var _b = __values(this.g.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var a = _c2.value;
        a.cancel();
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_1)
          throw e_1.error;
      }
    }
    this.g.clear();
  }
};
function jd(a) {
  var e_2, _a2;
  if (a.h != null)
    return a.i.concat(a.h.D);
  if (a.g != null && a.g.size !== 0) {
    var b = a.i;
    try {
      for (var _b = __values(a.g.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var c = _c2.value;
        b = b.concat(c.D);
      }
    } catch (e_2_1) {
      e_2 = { error: e_2_1 };
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_2)
          throw e_2.error;
      }
    }
    return b;
  }
  return ra(a.i);
}
function kd() {
}
kd.prototype.stringify = function(a) {
  return l.JSON.stringify(a, void 0);
};
kd.prototype.parse = function(a) {
  return l.JSON.parse(a, void 0);
};
function ld() {
  this.g = new kd();
}
function md(a, b, c) {
  var d2 = c || "";
  try {
    Kc(a, function(e, f) {
      var h = e;
      p(e) && (h = rb(e));
      b.push(d2 + f + "=" + encodeURIComponent(h));
    });
  } catch (e) {
    throw b.push(d2 + "type=" + encodeURIComponent("_badmap")), e;
  }
}
function nd(a, b) {
  var c = new Mb();
  if (l.Image) {
    var d_1 = new Image();
    d_1.onload = ja(od, c, d_1, "TestLoadImage: loaded", true, b);
    d_1.onerror = ja(od, c, d_1, "TestLoadImage: error", false, b);
    d_1.onabort = ja(od, c, d_1, "TestLoadImage: abort", false, b);
    d_1.ontimeout = ja(od, c, d_1, "TestLoadImage: timeout", false, b);
    l.setTimeout(function() {
      if (d_1.ontimeout)
        d_1.ontimeout();
    }, 1e4);
    d_1.src = a;
  } else
    b(false);
}
function od(a, b, c, d2, e) {
  try {
    b.onload = null, b.onerror = null, b.onabort = null, b.ontimeout = null, e(d2);
  } catch (f) {
  }
}
function pd(a) {
  this.l = a.$b || null;
  this.j = a.ib || false;
}
t(pd, Yb);
pd.prototype.g = function() {
  return new qd(this.l, this.j);
};
pd.prototype.i = function(a) {
  return function() {
    return a;
  };
}({});
function qd(a, b) {
  C.call(this);
  this.D = a;
  this.u = b;
  this.m = void 0;
  this.readyState = rd;
  this.status = 0;
  this.responseType = this.responseText = this.response = this.statusText = "";
  this.onreadystatechange = null;
  this.v = new Headers();
  this.h = null;
  this.C = "GET";
  this.B = "";
  this.g = false;
  this.A = this.j = this.l = null;
}
t(qd, C);
var rd = 0;
k = qd.prototype;
k.open = function(a, b) {
  if (this.readyState != rd)
    throw this.abort(), Error("Error reopening a connection");
  this.C = a;
  this.B = b;
  this.readyState = 1;
  sd(this);
};
k.send = function(a) {
  if (this.readyState != 1)
    throw this.abort(), Error("need to call open() first. ");
  this.g = true;
  var b = { headers: this.v, method: this.C, credentials: this.m, cache: void 0 };
  a && (b.body = a);
  (this.D || l).fetch(new Request(this.B, b)).then(this.Va.bind(this), this.ha.bind(this));
};
k.abort = function() {
  this.response = this.responseText = "";
  this.v = new Headers();
  this.status = 0;
  this.j && this.j.cancel("Request was aborted.");
  1 <= this.readyState && this.g && this.readyState != 4 && (this.g = false, td(this));
  this.readyState = rd;
};
k.Va = function(a) {
  if (this.g && (this.l = a, this.h || (this.status = this.l.status, this.statusText = this.l.statusText, this.h = a.headers, this.readyState = 2, sd(this)), this.g && (this.readyState = 3, sd(this), this.g)))
    if (this.responseType === "arraybuffer")
      a.arrayBuffer().then(this.Ta.bind(this), this.ha.bind(this));
    else if (typeof l.ReadableStream !== "undefined" && "body" in a) {
      this.j = a.body.getReader();
      if (this.u) {
        if (this.responseType)
          throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');
        this.response = [];
      } else
        this.response = this.responseText = "", this.A = new TextDecoder();
      ud(this);
    } else
      a.text().then(this.Ua.bind(this), this.ha.bind(this));
};
function ud(a) {
  a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a));
}
k.Sa = function(a) {
  if (this.g) {
    if (this.u && a.value)
      this.response.push(a.value);
    else if (!this.u) {
      var b = a.value ? a.value : new Uint8Array(0);
      if (b = this.A.decode(b, { stream: !a.done }))
        this.response = this.responseText += b;
    }
    a.done ? td(this) : sd(this);
    this.readyState == 3 && ud(this);
  }
};
k.Ua = function(a) {
  this.g && (this.response = this.responseText = a, td(this));
};
k.Ta = function(a) {
  this.g && (this.response = a, td(this));
};
k.ha = function() {
  this.g && td(this);
};
function td(a) {
  a.readyState = 4;
  a.l = null;
  a.j = null;
  a.A = null;
  sd(a);
}
k.setRequestHeader = function(a, b) {
  this.v.append(a, b);
};
k.getResponseHeader = function(a) {
  return this.h ? this.h.get(a.toLowerCase()) || "" : "";
};
k.getAllResponseHeaders = function() {
  if (!this.h)
    return "";
  var a = [], b = this.h.entries();
  for (var c = b.next(); !c.done; )
    c = c.value, a.push(c[0] + ": " + c[1]), c = b.next();
  return a.join("\r\n");
};
function sd(a) {
  a.onreadystatechange && a.onreadystatechange.call(a);
}
Object.defineProperty(qd.prototype, "withCredentials", { get: function() {
  return this.m === "include";
}, set: function(a) {
  this.m = a ? "include" : "same-origin";
} });
var vd = l.JSON.parse;
function X(a) {
  C.call(this);
  this.headers = new S();
  this.u = a || null;
  this.h = false;
  this.C = this.g = null;
  this.H = "";
  this.m = 0;
  this.j = "";
  this.l = this.F = this.v = this.D = false;
  this.B = 0;
  this.A = null;
  this.J = wd;
  this.K = this.L = false;
}
t(X, C);
var wd = "";
var xd = /^https?$/i;
var yd = ["POST", "PUT"];
k = X.prototype;
k.ea = function(a, b, c, d2) {
  if (this.g)
    throw Error("[goog.net.XhrIo] Object is active with another request=" + this.H + "; newUri=" + a);
  b = b ? b.toUpperCase() : "GET";
  this.H = a;
  this.j = "";
  this.m = 0;
  this.D = false;
  this.h = true;
  this.g = this.u ? this.u.g() : cc.g();
  this.C = this.u ? Zb(this.u) : Zb(cc);
  this.g.onreadystatechange = q(this.Fa, this);
  try {
    this.F = true, this.g.open(b, String(a), true), this.F = false;
  } catch (f) {
    zd(this, f);
    return;
  }
  a = c || "";
  var e = new S(this.headers);
  d2 && Kc(d2, function(f, h) {
    e.set(h, f);
  });
  d2 = oa(e.T());
  c = l.FormData && a instanceof l.FormData;
  !(0 <= ma(yd, b)) || d2 || c || e.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
  e.forEach(function(f, h) {
    this.g.setRequestHeader(h, f);
  }, this);
  this.J && (this.g.responseType = this.J);
  "withCredentials" in this.g && this.g.withCredentials !== this.L && (this.g.withCredentials = this.L);
  try {
    Ad(this), 0 < this.B && ((this.K = Bd(this.g)) ? (this.g.timeout = this.B, this.g.ontimeout = q(this.pa, this)) : this.A = Gb(this.pa, this.B, this)), this.v = true, this.g.send(a), this.v = false;
  } catch (f) {
    zd(this, f);
  }
};
function Bd(a) {
  return y && Ra() && typeof a.timeout === "number" && a.ontimeout !== void 0;
}
function pa(a) {
  return a.toLowerCase() == "content-type";
}
k.pa = function() {
  typeof goog != "undefined" && this.g && (this.j = "Timed out after " + this.B + "ms, aborting", this.m = 8, D(this, "timeout"), this.abort(8));
};
function zd(a, b) {
  a.h = false;
  a.g && (a.l = true, a.g.abort(), a.l = false);
  a.j = b;
  a.m = 5;
  Cd(a);
  Dd(a);
}
function Cd(a) {
  a.D || (a.D = true, D(a, "complete"), D(a, "error"));
}
k.abort = function(a) {
  this.g && this.h && (this.h = false, this.l = true, this.g.abort(), this.l = false, this.m = a || 7, D(this, "complete"), D(this, "abort"), Dd(this));
};
k.M = function() {
  this.g && (this.h && (this.h = false, this.l = true, this.g.abort(), this.l = false), Dd(this, true));
  X.Z.M.call(this);
};
k.Fa = function() {
  this.s || (this.F || this.v || this.l ? Ed(this) : this.cb());
};
k.cb = function() {
  Ed(this);
};
function Ed(a) {
  if (a.h && typeof goog != "undefined" && (!a.C[1] || O(a) != 4 || a.ba() != 2)) {
    if (a.v && O(a) == 4)
      Gb(a.Fa, 0, a);
    else if (D(a, "readystatechange"), O(a) == 4) {
      a.h = false;
      try {
        var n = a.ba();
        a:
          switch (n) {
            case 200:
            case 201:
            case 202:
            case 204:
            case 206:
            case 304:
            case 1223:
              var b = true;
              break a;
            default:
              b = false;
          }
        var c;
        if (!(c = b)) {
          var d2;
          if (d2 = n === 0) {
            var e = String(a.H).match(Mc)[1] || null;
            if (!e && l.self && l.self.location) {
              var f = l.self.location.protocol;
              e = f.substr(0, f.length - 1);
            }
            d2 = !xd.test(e ? e.toLowerCase() : "");
          }
          c = d2;
        }
        if (c)
          D(a, "complete"), D(a, "success");
        else {
          a.m = 6;
          try {
            var h = 2 < O(a) ? a.g.statusText : "";
          } catch (u) {
            h = "";
          }
          a.j = h + " [" + a.ba() + "]";
          Cd(a);
        }
      } finally {
        Dd(a);
      }
    }
  }
}
function Dd(a, b) {
  if (a.g) {
    Ad(a);
    var c = a.g, d2 = a.C[0] ? aa : null;
    a.g = null;
    a.C = null;
    b || D(a, "ready");
    try {
      c.onreadystatechange = d2;
    } catch (e) {
    }
  }
}
function Ad(a) {
  a.g && a.K && (a.g.ontimeout = null);
  a.A && (l.clearTimeout(a.A), a.A = null);
}
function O(a) {
  return a.g ? a.g.readyState : 0;
}
k.ba = function() {
  try {
    return 2 < O(this) ? this.g.status : -1;
  } catch (a) {
    return -1;
  }
};
k.ga = function() {
  try {
    return this.g ? this.g.responseText : "";
  } catch (a) {
    return "";
  }
};
k.Qa = function(a) {
  if (this.g) {
    var b = this.g.responseText;
    a && b.indexOf(a) == 0 && (b = b.substring(a.length));
    return vd(b);
  }
};
function oc(a) {
  try {
    if (!a.g)
      return null;
    if ("response" in a.g)
      return a.g.response;
    switch (a.J) {
      case wd:
      case "text":
        return a.g.responseText;
      case "arraybuffer":
        if ("mozResponseArrayBuffer" in a.g)
          return a.g.mozResponseArrayBuffer;
    }
    return null;
  } catch (b) {
    return null;
  }
}
k.Da = function() {
  return this.m;
};
k.La = function() {
  return typeof this.j === "string" ? this.j : String(this.j);
};
function Fd(a) {
  var b = "";
  xa(a, function(c, d2) {
    b += d2;
    b += ":";
    b += c;
    b += "\r\n";
  });
  return b;
}
function Gd(a, b, c) {
  a: {
    for (d2 in c) {
      var d2 = false;
      break a;
    }
    d2 = true;
  }
  d2 || (c = Fd(c), typeof a === "string" ? c != null && encodeURIComponent(String(c)) : R(a, b, c));
}
function Hd(a, b, c) {
  return c && c.internalChannelParams ? c.internalChannelParams[a] || b : b;
}
function Id(a) {
  this.za = 0;
  this.l = [];
  this.h = new Mb();
  this.la = this.oa = this.F = this.W = this.g = this.sa = this.D = this.aa = this.o = this.P = this.s = null;
  this.Za = this.V = 0;
  this.Xa = Hd("failFast", false, a);
  this.N = this.v = this.u = this.m = this.j = null;
  this.X = true;
  this.I = this.ta = this.U = -1;
  this.Y = this.A = this.C = 0;
  this.Pa = Hd("baseRetryDelayMs", 5e3, a);
  this.$a = Hd("retryDelaySeedMs", 1e4, a);
  this.Ya = Hd("forwardChannelMaxRetries", 2, a);
  this.ra = Hd("forwardChannelRequestTimeoutMs", 2e4, a);
  this.qa = a && a.xmlHttpFactory || void 0;
  this.Ba = a && a.Yb || false;
  this.K = void 0;
  this.H = a && a.supportsCrossDomainXhr || false;
  this.J = "";
  this.i = new gd(a && a.concurrentRequestLimit);
  this.Ca = new ld();
  this.ja = a && a.fastHandshake || false;
  this.Ra = a && a.Wb || false;
  a && a.Aa && this.h.Aa();
  a && a.forceLongPolling && (this.X = false);
  this.$ = !this.ja && this.X && a && a.detectBufferingProxy || false;
  this.ka = void 0;
  this.O = 0;
  this.L = false;
  this.B = null;
  this.Wa = !a || a.Xb !== false;
}
k = Id.prototype;
k.ma = 8;
k.G = 1;
function Ic(a) {
  Jd(a);
  if (a.G == 3) {
    var b = a.V++, c = N(a.F);
    R(c, "SID", a.J);
    R(c, "RID", b);
    R(c, "TYPE", "terminate");
    Kd(a, c);
    b = new M(a, a.h, b, void 0);
    b.K = 2;
    b.v = jc(N(c));
    c = false;
    l.navigator && l.navigator.sendBeacon && (c = l.navigator.sendBeacon(b.v.toString(), ""));
    !c && l.Image && (new Image().src = b.v, c = true);
    c || (b.g = nc(b.l, null), b.g.ea(b.v));
    b.F = Date.now();
    lc(b);
  }
  Ld(a);
}
k.hb = function(a) {
  try {
    this.h.info("Origin Trials invoked: " + a);
  } catch (b) {
  }
};
function Ac(a) {
  a.g && (wc(a), a.g.cancel(), a.g = null);
}
function Jd(a) {
  Ac(a);
  a.u && (l.clearTimeout(a.u), a.u = null);
  zc(a);
  a.i.cancel();
  a.m && (typeof a.m === "number" && l.clearTimeout(a.m), a.m = null);
}
function Md(a, b) {
  a.l.push(new fd(a.Za++, b));
  a.G == 3 && Hc(a);
}
function Hc(a) {
  id(a.i) || a.m || (a.m = true, zb(a.Ha, a), a.C = 0);
}
function Nd(a, b) {
  if (Cc(a.i) >= a.i.j - (a.m ? 1 : 0))
    return false;
  if (a.m)
    return a.l = b.D.concat(a.l), true;
  if (a.G == 1 || a.G == 2 || a.C >= (a.Xa ? 0 : a.Ya))
    return false;
  a.m = K(q(a.Ha, a, b), Od(a, a.C));
  a.C++;
  return true;
}
k.Ha = function(a) {
  if (this.m)
    if (this.m = null, this.G == 1) {
      if (!a) {
        this.V = Math.floor(1e5 * Math.random());
        a = this.V++;
        var e = new M(this, this.h, a, void 0);
        var f = this.s;
        this.P && (f ? (f = ya(f), Aa(f, this.P)) : f = this.P);
        this.o === null && (e.H = f);
        if (this.ja)
          a: {
            var b = 0;
            for (var c = 0; c < this.l.length; c++) {
              b: {
                var d2 = this.l[c];
                if ("__data__" in d2.g && (d2 = d2.g.__data__, typeof d2 === "string")) {
                  d2 = d2.length;
                  break b;
                }
                d2 = void 0;
              }
              if (d2 === void 0)
                break;
              b += d2;
              if (4096 < b) {
                b = c;
                break a;
              }
              if (b === 4096 || c === this.l.length - 1) {
                b = c + 1;
                break a;
              }
            }
            b = 1e3;
          }
        else
          b = 1e3;
        b = Pd(this, e, b);
        c = N(this.F);
        R(c, "RID", a);
        R(c, "CVER", 22);
        this.D && R(c, "X-HTTP-Session-Id", this.D);
        Kd(this, c);
        this.o && f && Gd(c, this.o, f);
        Dc(this.i, e);
        this.Ra && R(c, "TYPE", "init");
        this.ja ? (R(c, "$req", b), R(c, "SID", "null"), e.$ = true, ic(e, c, null)) : ic(e, c, b);
        this.G = 2;
      }
    } else
      this.G == 3 && (a ? Qd(this, a) : this.l.length == 0 || id(this.i) || Qd(this));
};
function Qd(a, b) {
  var c;
  b ? c = b.m : c = a.V++;
  var d2 = N(a.F);
  R(d2, "SID", a.J);
  R(d2, "RID", c);
  R(d2, "AID", a.U);
  Kd(a, d2);
  a.o && a.s && Gd(d2, a.o, a.s);
  c = new M(a, a.h, c, a.C + 1);
  a.o === null && (c.H = a.s);
  b && (a.l = b.D.concat(a.l));
  b = Pd(a, c, 1e3);
  c.setTimeout(Math.round(0.5 * a.ra) + Math.round(0.5 * a.ra * Math.random()));
  Dc(a.i, c);
  ic(c, d2, b);
}
function Kd(a, b) {
  a.j && Kc({}, function(c, d2) {
    R(b, d2, c);
  });
}
function Pd(a, b, c) {
  c = Math.min(a.l.length, c);
  var d2 = a.j ? q(a.j.Oa, a.j, a) : null;
  a: {
    var e = a.l;
    var f = -1;
    for (; ; ) {
      var h = ["count=" + c];
      f == -1 ? 0 < c ? (f = e[0].h, h.push("ofs=" + f)) : f = 0 : h.push("ofs=" + f);
      var n = true;
      for (var u = 0; u < c; u++) {
        var m = e[u].h;
        var r = e[u].g;
        m -= f;
        if (0 > m)
          f = Math.max(0, e[u].h - 100), n = false;
        else
          try {
            md(r, h, "req" + m + "_");
          } catch (G2) {
            d2 && d2(r);
          }
      }
      if (n) {
        d2 = h.join("&");
        break a;
      }
    }
  }
  a = a.l.splice(0, c);
  b.D = a;
  return d2;
}
function Gc(a) {
  a.g || a.u || (a.Y = 1, zb(a.Ga, a), a.A = 0);
}
function Bc(a) {
  if (a.g || a.u || 3 <= a.A)
    return false;
  a.Y++;
  a.u = K(q(a.Ga, a), Od(a, a.A));
  a.A++;
  return true;
}
k.Ga = function() {
  this.u = null;
  Rd(this);
  if (this.$ && !(this.L || this.g == null || 0 >= this.O)) {
    var a = 2 * this.O;
    this.h.info("BP detection timer enabled: " + a);
    this.B = K(q(this.bb, this), a);
  }
};
k.bb = function() {
  this.B && (this.B = null, this.h.info("BP detection timeout reached."), this.h.info("Buffering proxy detected and switch to long-polling!"), this.N = false, this.L = true, J(10), Ac(this), Rd(this));
};
function wc(a) {
  a.B != null && (l.clearTimeout(a.B), a.B = null);
}
function Rd(a) {
  a.g = new M(a, a.h, "rpc", a.Y);
  a.o === null && (a.g.H = a.s);
  a.g.O = 0;
  var b = N(a.oa);
  R(b, "RID", "rpc");
  R(b, "SID", a.J);
  R(b, "CI", a.N ? "0" : "1");
  R(b, "AID", a.U);
  Kd(a, b);
  R(b, "TYPE", "xmlhttp");
  a.o && a.s && Gd(b, a.o, a.s);
  a.K && a.g.setTimeout(a.K);
  var c = a.g;
  a = a.la;
  c.K = 1;
  c.v = jc(N(b));
  c.s = null;
  c.U = true;
  kc(c, a);
}
k.ab = function() {
  this.v != null && (this.v = null, Ac(this), Bc(this), J(19));
};
function zc(a) {
  a.v != null && (l.clearTimeout(a.v), a.v = null);
}
function uc(a, b) {
  var c = null;
  if (a.g == b) {
    zc(a);
    wc(a);
    a.g = null;
    var d2 = 2;
  } else if (yc(a.i, b))
    c = b.D, Fc(a.i, b), d2 = 1;
  else
    return;
  a.I = b.N;
  if (a.G != 0) {
    if (b.i)
      if (d2 == 1) {
        c = b.s ? b.s.length : 0;
        b = Date.now() - b.F;
        var e = a.C;
        d2 = Sb();
        D(d2, new Vb(d2, c, b, e));
        Hc(a);
      } else
        Gc(a);
    else if (e = b.o, e == 3 || e == 0 && 0 < a.I || !(d2 == 1 && Nd(a, b) || d2 == 2 && Bc(a)))
      switch (c && 0 < c.length && (b = a.i, b.i = b.i.concat(c)), e) {
        case 1:
          Q(a, 5);
          break;
        case 4:
          Q(a, 10);
          break;
        case 3:
          Q(a, 6);
          break;
        default:
          Q(a, 2);
      }
  }
}
function Od(a, b) {
  var c = a.Pa + Math.floor(Math.random() * a.$a);
  a.j || (c *= 2);
  return c * b;
}
function Q(a, b) {
  a.h.info("Error code " + b);
  if (b == 2) {
    var c = null;
    a.j && (c = null);
    var d2 = q(a.jb, a);
    c || (c = new U("//www.google.com/images/cleardot.gif"), l.location && l.location.protocol == "http" || Oc(c, "https"), jc(c));
    nd(c.toString(), d2);
  } else
    J(2);
  a.G = 0;
  a.j && a.j.va(b);
  Ld(a);
  Jd(a);
}
k.jb = function(a) {
  a ? (this.h.info("Successfully pinged google.com"), J(2)) : (this.h.info("Failed to ping google.com"), J(1));
};
function Ld(a) {
  a.G = 0;
  a.I = -1;
  if (a.j) {
    if (jd(a.i).length != 0 || a.l.length != 0)
      a.i.i.length = 0, ra(a.l), a.l.length = 0;
    a.j.ua();
  }
}
function Ec(a, b, c) {
  var d2 = ad(c);
  if (d2.i != "")
    b && Pc(d2, b + "." + d2.i), Qc(d2, d2.m);
  else {
    var e = l.location;
    d2 = bd(e.protocol, b ? b + "." + e.hostname : e.hostname, +e.port, c);
  }
  a.aa && xa(a.aa, function(e2, f) {
    R(d2, f, e2);
  });
  b = a.D;
  c = a.sa;
  b && c && R(d2, b, c);
  R(d2, "VER", a.ma);
  Kd(a, d2);
  return d2;
}
function nc(a, b, c) {
  if (b && !a.H)
    throw Error("Can't create secondary domain capable XhrIo object.");
  b = c && a.Ba && !a.qa ? new X(new pd({ ib: true })) : new X(a.qa);
  b.L = a.H;
  return b;
}
function Sd() {
}
k = Sd.prototype;
k.xa = function() {
};
k.wa = function() {
};
k.va = function() {
};
k.ua = function() {
};
k.Oa = function() {
};
function Td() {
  if (y && !(10 <= Number(Ua)))
    throw Error("Environmental error: no available transport.");
}
Td.prototype.g = function(a, b) {
  return new Y(a, b);
};
function Y(a, b) {
  C.call(this);
  this.g = new Id(b);
  this.l = a;
  this.h = b && b.messageUrlParams || null;
  a = b && b.messageHeaders || null;
  b && b.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = { "X-Client-Protocol": "webchannel" });
  this.g.s = a;
  a = b && b.initMessageHeaders || null;
  b && b.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b.messageContentType : a = { "X-WebChannel-Content-Type": b.messageContentType });
  b && b.ya && (a ? a["X-WebChannel-Client-Profile"] = b.ya : a = { "X-WebChannel-Client-Profile": b.ya });
  this.g.P = a;
  (a = b && b.httpHeadersOverwriteParam) && !sa(a) && (this.g.o = a);
  this.A = b && b.supportsCrossDomainXhr || false;
  this.v = b && b.sendRawJson || false;
  (b = b && b.httpSessionIdParam) && !sa(b) && (this.g.D = b, a = this.h, a !== null && b in a && (a = this.h, b in a && delete a[b]));
  this.j = new Z(this);
}
t(Y, C);
Y.prototype.m = function() {
  this.g.j = this.j;
  this.A && (this.g.H = true);
  var a = this.g, b = this.l, c = this.h || void 0;
  a.Wa && (a.h.info("Origin Trials enabled."), zb(q(a.hb, a, b)));
  J(0);
  a.W = b;
  a.aa = c || {};
  a.N = a.X;
  a.F = Ec(a, null, a.W);
  Hc(a);
};
Y.prototype.close = function() {
  Ic(this.g);
};
Y.prototype.u = function(a) {
  if (typeof a === "string") {
    var b = {};
    b.__data__ = a;
    Md(this.g, b);
  } else
    this.v ? (b = {}, b.__data__ = rb(a), Md(this.g, b)) : Md(this.g, a);
};
Y.prototype.M = function() {
  this.g.j = null;
  delete this.j;
  Ic(this.g);
  delete this.g;
  Y.Z.M.call(this);
};
function Ud(a) {
  ac.call(this);
  var b = a.__sm__;
  if (b) {
    a: {
      for (var c in b) {
        a = c;
        break a;
      }
      a = void 0;
    }
    if (this.i = a)
      a = this.i, b = b !== null && a in b ? b[a] : void 0;
    this.data = b;
  } else
    this.data = a;
}
t(Ud, ac);
function Vd() {
  bc.call(this);
  this.status = 1;
}
t(Vd, bc);
function Z(a) {
  this.g = a;
}
t(Z, Sd);
Z.prototype.xa = function() {
  D(this.g, "a");
};
Z.prototype.wa = function(a) {
  D(this.g, new Ud(a));
};
Z.prototype.va = function(a) {
  D(this.g, new Vd(a));
};
Z.prototype.ua = function() {
  D(this.g, "b");
};
Td.prototype.createWebChannel = Td.prototype.g;
Y.prototype.send = Y.prototype.u;
Y.prototype.open = Y.prototype.m;
Y.prototype.close = Y.prototype.close;
Wb.NO_ERROR = 0;
Wb.TIMEOUT = 8;
Wb.HTTP_ERROR = 6;
Xb.COMPLETE = "complete";
$b.EventType = L;
L.OPEN = "a";
L.CLOSE = "b";
L.ERROR = "c";
L.MESSAGE = "d";
C.prototype.listen = C.prototype.N;
X.prototype.listenOnce = X.prototype.O;
X.prototype.getLastError = X.prototype.La;
X.prototype.getLastErrorCode = X.prototype.Da;
X.prototype.getStatus = X.prototype.ba;
X.prototype.getResponseJson = X.prototype.Qa;
X.prototype.getResponseText = X.prototype.ga;
X.prototype.send = X.prototype.ea;
var createWebChannelTransport = function() {
  return new Td();
};
var getStatEventTarget = function() {
  return Sb();
};
var ErrorCode = Wb;
var EventType = Xb;
var Event = H;
var Stat = { rb: 0, ub: 1, vb: 2, Ob: 3, Tb: 4, Qb: 5, Rb: 6, Pb: 7, Nb: 8, Sb: 9, PROXY: 10, NOPROXY: 11, Lb: 12, Hb: 13, Ib: 14, Gb: 15, Jb: 16, Kb: 17, nb: 18, mb: 19, ob: 20 };
var FetchXmlHttpFactory = pd;
var WebChannel = $b;
var XhrIo = X;

// node_modules/@firebase/firestore/dist/esm5/prebuilt-038c95ef-26ab9a06.js
var _ = function() {
  function t2(t3, e) {
    var n = this;
    this.previousValue = t3, e && (e.sequenceNumberHandler = function(t4) {
      return n.t(t4);
    }, this.i = function(t4) {
      return e.writeSequenceNumber(t4);
    });
  }
  return t2.prototype.t = function(t3) {
    return this.previousValue = Math.max(t3, this.previousValue), this.previousValue;
  }, t2.prototype.next = function() {
    var t3 = ++this.previousValue;
    return this.i && this.i(t3), t3;
  }, t2;
}();
_.o = -1;
var S2 = {
  OK: "ok",
  CANCELLED: "cancelled",
  UNKNOWN: "unknown",
  INVALID_ARGUMENT: "invalid-argument",
  DEADLINE_EXCEEDED: "deadline-exceeded",
  NOT_FOUND: "not-found",
  ALREADY_EXISTS: "already-exists",
  PERMISSION_DENIED: "permission-denied",
  UNAUTHENTICATED: "unauthenticated",
  RESOURCE_EXHAUSTED: "resource-exhausted",
  FAILED_PRECONDITION: "failed-precondition",
  ABORTED: "aborted",
  OUT_OF_RANGE: "out-of-range",
  UNIMPLEMENTED: "unimplemented",
  INTERNAL: "internal",
  UNAVAILABLE: "unavailable",
  DATA_LOSS: "data-loss"
};
var N2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, n2) || this).code = t2, r.message = n2, r.name = "FirebaseError", r.toString = function() {
      return r.name + ": [code=" + r.code + "]: " + r.message;
    }, r;
  }
  return __extends(n, e), n;
}(Error);
var D2 = new Logger("@firebase/firestore");
function A2() {
  return D2.logLevel;
}
function k2(t2) {
  for (var n = [], r = 1; r < arguments.length; r++)
    n[r - 1] = arguments[r];
  if (D2.logLevel <= LogLevel.DEBUG) {
    var i = n.map(R2);
    D2.debug.apply(D2, __spreadArray(["Firestore (8.7.0): " + t2], i));
  }
}
function C2(t2) {
  for (var n = [], r = 1; r < arguments.length; r++)
    n[r - 1] = arguments[r];
  if (D2.logLevel <= LogLevel.ERROR) {
    var i = n.map(R2);
    D2.error.apply(D2, __spreadArray(["Firestore (8.7.0): " + t2], i));
  }
}
function x2(t2) {
  for (var n = [], r = 1; r < arguments.length; r++)
    n[r - 1] = arguments[r];
  if (D2.logLevel <= LogLevel.WARN) {
    var i = n.map(R2);
    D2.warn.apply(D2, __spreadArray(["Firestore (8.7.0): " + t2], i));
  }
}
function R2(t2) {
  if (typeof t2 == "string")
    return t2;
  try {
    return e = t2, JSON.stringify(e);
  } catch (e2) {
    return t2;
  }
  var e;
}
function L2(t2) {
  t2 === void 0 && (t2 = "Unexpected state");
  var e = "FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: " + t2;
  throw C2(e), new Error(e);
}
function O2(t2, e) {
  t2 || L2();
}
function P2(t2, e) {
  return t2;
}
function F2(t2) {
  var e = typeof self != "undefined" && (self.crypto || self.msCrypto), n = new Uint8Array(t2);
  if (e && typeof e.getRandomValues == "function")
    e.getRandomValues(n);
  else
    for (var r = 0; r < t2; r++)
      n[r] = Math.floor(256 * Math.random());
  return n;
}
var M2 = function() {
  function t2() {
  }
  return t2.u = function() {
    for (var t3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", e = Math.floor(256 / t3.length) * t3.length, n = ""; n.length < 20; )
      for (var r = F2(40), i = 0; i < r.length; ++i)
        n.length < 20 && r[i] < e && (n += t3.charAt(r[i] % t3.length));
    return n;
  }, t2;
}();
function V2(t2, e) {
  return t2 < e ? -1 : t2 > e ? 1 : 0;
}
function q2(t2, e, n) {
  return t2.length === e.length && t2.every(function(t3, r) {
    return n(t3, e[r]);
  });
}
function U2(t2) {
  return t2 + "\0";
}
var B2 = function() {
  function t2(t3, e) {
    if (this.seconds = t3, this.nanoseconds = e, e < 0)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (e >= 1e9)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (t3 < -62135596800)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
    if (t3 >= 253402300800)
      throw new N2(S2.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
  }
  return t2.now = function() {
    return t2.fromMillis(Date.now());
  }, t2.fromDate = function(e) {
    return t2.fromMillis(e.getTime());
  }, t2.fromMillis = function(e) {
    var n = Math.floor(e / 1e3);
    return new t2(n, Math.floor(1e6 * (e - 1e3 * n)));
  }, t2.prototype.toDate = function() {
    return new Date(this.toMillis());
  }, t2.prototype.toMillis = function() {
    return 1e3 * this.seconds + this.nanoseconds / 1e6;
  }, t2.prototype._compareTo = function(t3) {
    return this.seconds === t3.seconds ? V2(this.nanoseconds, t3.nanoseconds) : V2(this.seconds, t3.seconds);
  }, t2.prototype.isEqual = function(t3) {
    return t3.seconds === this.seconds && t3.nanoseconds === this.nanoseconds;
  }, t2.prototype.toString = function() {
    return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
  }, t2.prototype.toJSON = function() {
    return {
      seconds: this.seconds,
      nanoseconds: this.nanoseconds
    };
  }, t2.prototype.valueOf = function() {
    var t3 = this.seconds - -62135596800;
    return String(t3).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
  }, t2;
}();
var j = function() {
  function t2(t3) {
    this.timestamp = t3;
  }
  return t2.fromTimestamp = function(e) {
    return new t2(e);
  }, t2.min = function() {
    return new t2(new B2(0, 0));
  }, t2.prototype.compareTo = function(t3) {
    return this.timestamp._compareTo(t3.timestamp);
  }, t2.prototype.isEqual = function(t3) {
    return this.timestamp.isEqual(t3.timestamp);
  }, t2.prototype.toMicroseconds = function() {
    return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
  }, t2.prototype.toString = function() {
    return "SnapshotVersion(" + this.timestamp.toString() + ")";
  }, t2.prototype.toTimestamp = function() {
    return this.timestamp;
  }, t2;
}();
function K2(t2) {
  var e = 0;
  for (var n in t2)
    Object.prototype.hasOwnProperty.call(t2, n) && e++;
  return e;
}
function Q2(t2, e) {
  for (var n in t2)
    Object.prototype.hasOwnProperty.call(t2, n) && e(n, t2[n]);
}
function G(t2) {
  for (var e in t2)
    if (Object.prototype.hasOwnProperty.call(t2, e))
      return false;
  return true;
}
var z2 = function() {
  function t2(t3, e, n) {
    e === void 0 ? e = 0 : e > t3.length && L2(), n === void 0 ? n = t3.length - e : n > t3.length - e && L2(), this.segments = t3, this.offset = e, this.len = n;
  }
  return Object.defineProperty(t2.prototype, "length", {
    get: function() {
      return this.len;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return t2.comparator(this, e) === 0;
  }, t2.prototype.child = function(e) {
    var n = this.segments.slice(this.offset, this.limit());
    return e instanceof t2 ? e.forEach(function(t3) {
      n.push(t3);
    }) : n.push(e), this.construct(n);
  }, t2.prototype.limit = function() {
    return this.offset + this.length;
  }, t2.prototype.popFirst = function(t3) {
    return t3 = t3 === void 0 ? 1 : t3, this.construct(this.segments, this.offset + t3, this.length - t3);
  }, t2.prototype.popLast = function() {
    return this.construct(this.segments, this.offset, this.length - 1);
  }, t2.prototype.firstSegment = function() {
    return this.segments[this.offset];
  }, t2.prototype.lastSegment = function() {
    return this.get(this.length - 1);
  }, t2.prototype.get = function(t3) {
    return this.segments[this.offset + t3];
  }, t2.prototype.isEmpty = function() {
    return this.length === 0;
  }, t2.prototype.isPrefixOf = function(t3) {
    if (t3.length < this.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.isImmediateParentOf = function(t3) {
    if (this.length + 1 !== t3.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.forEach = function(t3) {
    for (var e = this.offset, n = this.limit(); e < n; e++)
      t3(this.segments[e]);
  }, t2.prototype.toArray = function() {
    return this.segments.slice(this.offset, this.limit());
  }, t2.comparator = function(t3, e) {
    for (var n = Math.min(t3.length, e.length), r = 0; r < n; r++) {
      var i = t3.get(r), o = e.get(r);
      if (i < o)
        return -1;
      if (i > o)
        return 1;
    }
    return t3.length < e.length ? -1 : t3.length > e.length ? 1 : 0;
  }, t2;
}();
var W2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype.construct = function(t2, e2, r) {
    return new n(t2, e2, r);
  }, n.prototype.canonicalString = function() {
    return this.toArray().join("/");
  }, n.prototype.toString = function() {
    return this.canonicalString();
  }, n.fromString = function() {
    for (var t2 = [], e2 = 0; e2 < arguments.length; e2++)
      t2[e2] = arguments[e2];
    for (var r = [], i = 0, o = t2; i < o.length; i++) {
      var s = o[i];
      if (s.indexOf("//") >= 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid segment (" + s + "). Paths must not contain // in them.");
      r.push.apply(r, s.split("/").filter(function(t3) {
        return t3.length > 0;
      }));
    }
    return new n(r);
  }, n.emptyPath = function() {
    return new n([]);
  }, n;
}(z2);
var H2 = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
var Y2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype.construct = function(t2, e2, r) {
    return new n(t2, e2, r);
  }, n.isValidIdentifier = function(t2) {
    return H2.test(t2);
  }, n.prototype.canonicalString = function() {
    return this.toArray().map(function(t2) {
      return t2 = t2.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), n.isValidIdentifier(t2) || (t2 = "`" + t2 + "`"), t2;
    }).join(".");
  }, n.prototype.toString = function() {
    return this.canonicalString();
  }, n.prototype.isKeyField = function() {
    return this.length === 1 && this.get(0) === "__name__";
  }, n.keyField = function() {
    return new n(["__name__"]);
  }, n.fromServerFormat = function(t2) {
    for (var e2 = [], r = "", i = 0, o = function() {
      if (r.length === 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid field path (" + t2 + "). Paths must not be empty, begin with '.', end with '.', or contain '..'");
      e2.push(r), r = "";
    }, s = false; i < t2.length; ) {
      var u = t2[i];
      if (u === "\\") {
        if (i + 1 === t2.length)
          throw new N2(S2.INVALID_ARGUMENT, "Path has trailing escape character: " + t2);
        var a = t2[i + 1];
        if (a !== "\\" && a !== "." && a !== "`")
          throw new N2(S2.INVALID_ARGUMENT, "Path has invalid escape sequence: " + t2);
        r += a, i += 2;
      } else
        u === "`" ? (s = !s, i++) : u !== "." || s ? (r += u, i++) : (o(), i++);
    }
    if (o(), s)
      throw new N2(S2.INVALID_ARGUMENT, "Unterminated ` in path: " + t2);
    return new n(e2);
  }, n.emptyPath = function() {
    return new n([]);
  }, n;
}(z2);
var $ = function() {
  function t2(t3) {
    this.fields = t3, t3.sort(Y2.comparator);
  }
  return t2.prototype.covers = function(t3) {
    for (var e = 0, n = this.fields; e < n.length; e++) {
      if (n[e].isPrefixOf(t3))
        return true;
    }
    return false;
  }, t2.prototype.isEqual = function(t3) {
    return q2(this.fields, t3.fields, function(t4, e) {
      return t4.isEqual(e);
    });
  }, t2;
}();
var X2 = function() {
  function t2(t3) {
    this.binaryString = t3;
  }
  return t2.fromBase64String = function(e) {
    return new t2(atob(e));
  }, t2.fromUint8Array = function(e) {
    return new t2(function(t3) {
      for (var e2 = "", n = 0; n < t3.length; ++n)
        e2 += String.fromCharCode(t3[n]);
      return e2;
    }(e));
  }, t2.prototype.toBase64 = function() {
    return t3 = this.binaryString, btoa(t3);
    var t3;
  }, t2.prototype.toUint8Array = function() {
    return function(t3) {
      for (var e = new Uint8Array(t3.length), n = 0; n < t3.length; n++)
        e[n] = t3.charCodeAt(n);
      return e;
    }(this.binaryString);
  }, t2.prototype.approximateByteSize = function() {
    return 2 * this.binaryString.length;
  }, t2.prototype.compareTo = function(t3) {
    return V2(this.binaryString, t3.binaryString);
  }, t2.prototype.isEqual = function(t3) {
    return this.binaryString === t3.binaryString;
  }, t2;
}();
X2.EMPTY_BYTE_STRING = new X2("");
var J2 = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
function Z2(t2) {
  if (O2(!!t2), typeof t2 == "string") {
    var e = 0, n = J2.exec(t2);
    if (O2(!!n), n[1]) {
      var r = n[1];
      r = (r + "000000000").substr(0, 9), e = Number(r);
    }
    var i = new Date(t2);
    return {
      seconds: Math.floor(i.getTime() / 1e3),
      nanos: e
    };
  }
  return {
    seconds: tt(t2.seconds),
    nanos: tt(t2.nanos)
  };
}
function tt(t2) {
  return typeof t2 == "number" ? t2 : typeof t2 == "string" ? Number(t2) : 0;
}
function et(t2) {
  return typeof t2 == "string" ? X2.fromBase64String(t2) : X2.fromUint8Array(t2);
}
function nt(t2) {
  var e, n;
  return ((n = (((e = t2 == null ? void 0 : t2.mapValue) === null || e === void 0 ? void 0 : e.fields) || {}).__type__) === null || n === void 0 ? void 0 : n.stringValue) === "server_timestamp";
}
function rt(t2) {
  var e = t2.mapValue.fields.__previous_value__;
  return nt(e) ? rt(e) : e;
}
function it(t2) {
  var e = Z2(t2.mapValue.fields.__local_write_time__.timestampValue);
  return new B2(e.seconds, e.nanos);
}
function ot(t2) {
  return t2 == null;
}
function st(t2) {
  return t2 === 0 && 1 / t2 == -1 / 0;
}
function ut(t2) {
  return typeof t2 == "number" && Number.isInteger(t2) && !st(t2) && t2 <= Number.MAX_SAFE_INTEGER && t2 >= Number.MIN_SAFE_INTEGER;
}
var at = function() {
  function t2(t3) {
    this.path = t3;
  }
  return t2.fromPath = function(e) {
    return new t2(W2.fromString(e));
  }, t2.fromName = function(e) {
    return new t2(W2.fromString(e).popFirst(5));
  }, t2.prototype.hasCollectionId = function(t3) {
    return this.path.length >= 2 && this.path.get(this.path.length - 2) === t3;
  }, t2.prototype.isEqual = function(t3) {
    return t3 !== null && W2.comparator(this.path, t3.path) === 0;
  }, t2.prototype.toString = function() {
    return this.path.toString();
  }, t2.comparator = function(t3, e) {
    return W2.comparator(t3.path, e.path);
  }, t2.isDocumentKey = function(t3) {
    return t3.length % 2 == 0;
  }, t2.fromSegments = function(e) {
    return new t2(new W2(e.slice()));
  }, t2;
}();
function ct(t2) {
  return "nullValue" in t2 ? 0 : "booleanValue" in t2 ? 1 : "integerValue" in t2 || "doubleValue" in t2 ? 2 : "timestampValue" in t2 ? 3 : "stringValue" in t2 ? 5 : "bytesValue" in t2 ? 6 : "referenceValue" in t2 ? 7 : "geoPointValue" in t2 ? 8 : "arrayValue" in t2 ? 9 : "mapValue" in t2 ? nt(t2) ? 4 : 10 : L2();
}
function ht(t2, e) {
  var n = ct(t2);
  if (n !== ct(e))
    return false;
  switch (n) {
    case 0:
      return true;
    case 1:
      return t2.booleanValue === e.booleanValue;
    case 4:
      return it(t2).isEqual(it(e));
    case 3:
      return function(t3, e2) {
        if (typeof t3.timestampValue == "string" && typeof e2.timestampValue == "string" && t3.timestampValue.length === e2.timestampValue.length)
          return t3.timestampValue === e2.timestampValue;
        var n2 = Z2(t3.timestampValue), r = Z2(e2.timestampValue);
        return n2.seconds === r.seconds && n2.nanos === r.nanos;
      }(t2, e);
    case 5:
      return t2.stringValue === e.stringValue;
    case 6:
      return function(t3, e2) {
        return et(t3.bytesValue).isEqual(et(e2.bytesValue));
      }(t2, e);
    case 7:
      return t2.referenceValue === e.referenceValue;
    case 8:
      return function(t3, e2) {
        return tt(t3.geoPointValue.latitude) === tt(e2.geoPointValue.latitude) && tt(t3.geoPointValue.longitude) === tt(e2.geoPointValue.longitude);
      }(t2, e);
    case 2:
      return function(t3, e2) {
        if ("integerValue" in t3 && "integerValue" in e2)
          return tt(t3.integerValue) === tt(e2.integerValue);
        if ("doubleValue" in t3 && "doubleValue" in e2) {
          var n2 = tt(t3.doubleValue), r = tt(e2.doubleValue);
          return n2 === r ? st(n2) === st(r) : isNaN(n2) && isNaN(r);
        }
        return false;
      }(t2, e);
    case 9:
      return q2(t2.arrayValue.values || [], e.arrayValue.values || [], ht);
    case 10:
      return function(t3, e2) {
        var n2 = t3.mapValue.fields || {}, r = e2.mapValue.fields || {};
        if (K2(n2) !== K2(r))
          return false;
        for (var i in n2)
          if (n2.hasOwnProperty(i) && (r[i] === void 0 || !ht(n2[i], r[i])))
            return false;
        return true;
      }(t2, e);
    default:
      return L2();
  }
}
function ft(t2, e) {
  return (t2.values || []).find(function(t3) {
    return ht(t3, e);
  }) !== void 0;
}
function lt(t2, e) {
  var n = ct(t2), r = ct(e);
  if (n !== r)
    return V2(n, r);
  switch (n) {
    case 0:
      return 0;
    case 1:
      return V2(t2.booleanValue, e.booleanValue);
    case 2:
      return function(t3, e2) {
        var n2 = tt(t3.integerValue || t3.doubleValue), r2 = tt(e2.integerValue || e2.doubleValue);
        return n2 < r2 ? -1 : n2 > r2 ? 1 : n2 === r2 ? 0 : isNaN(n2) ? isNaN(r2) ? 0 : -1 : 1;
      }(t2, e);
    case 3:
      return dt(t2.timestampValue, e.timestampValue);
    case 4:
      return dt(it(t2), it(e));
    case 5:
      return V2(t2.stringValue, e.stringValue);
    case 6:
      return function(t3, e2) {
        var n2 = et(t3), r2 = et(e2);
        return n2.compareTo(r2);
      }(t2.bytesValue, e.bytesValue);
    case 7:
      return function(t3, e2) {
        for (var n2 = t3.split("/"), r2 = e2.split("/"), i = 0; i < n2.length && i < r2.length; i++) {
          var o = V2(n2[i], r2[i]);
          if (o !== 0)
            return o;
        }
        return V2(n2.length, r2.length);
      }(t2.referenceValue, e.referenceValue);
    case 8:
      return function(t3, e2) {
        var n2 = V2(tt(t3.latitude), tt(e2.latitude));
        return n2 !== 0 ? n2 : V2(tt(t3.longitude), tt(e2.longitude));
      }(t2.geoPointValue, e.geoPointValue);
    case 9:
      return function(t3, e2) {
        for (var n2 = t3.values || [], r2 = e2.values || [], i = 0; i < n2.length && i < r2.length; ++i) {
          var o = lt(n2[i], r2[i]);
          if (o)
            return o;
        }
        return V2(n2.length, r2.length);
      }(t2.arrayValue, e.arrayValue);
    case 10:
      return function(t3, e2) {
        var n2 = t3.fields || {}, r2 = Object.keys(n2), i = e2.fields || {}, o = Object.keys(i);
        r2.sort(), o.sort();
        for (var s = 0; s < r2.length && s < o.length; ++s) {
          var u = V2(r2[s], o[s]);
          if (u !== 0)
            return u;
          var a = lt(n2[r2[s]], i[o[s]]);
          if (a !== 0)
            return a;
        }
        return V2(r2.length, o.length);
      }(t2.mapValue, e.mapValue);
    default:
      throw L2();
  }
}
function dt(t2, e) {
  if (typeof t2 == "string" && typeof e == "string" && t2.length === e.length)
    return V2(t2, e);
  var n = Z2(t2), r = Z2(e), i = V2(n.seconds, r.seconds);
  return i !== 0 ? i : V2(n.nanos, r.nanos);
}
function pt(t2) {
  return yt(t2);
}
function yt(t2) {
  return "nullValue" in t2 ? "null" : "booleanValue" in t2 ? "" + t2.booleanValue : "integerValue" in t2 ? "" + t2.integerValue : "doubleValue" in t2 ? "" + t2.doubleValue : "timestampValue" in t2 ? function(t3) {
    var e2 = Z2(t3);
    return "time(" + e2.seconds + "," + e2.nanos + ")";
  }(t2.timestampValue) : "stringValue" in t2 ? t2.stringValue : "bytesValue" in t2 ? et(t2.bytesValue).toBase64() : "referenceValue" in t2 ? (n = t2.referenceValue, at.fromName(n).toString()) : "geoPointValue" in t2 ? "geo(" + (e = t2.geoPointValue).latitude + "," + e.longitude + ")" : "arrayValue" in t2 ? function(t3) {
    for (var e2 = "[", n2 = true, r = 0, i = t3.values || []; r < i.length; r++) {
      n2 ? n2 = false : e2 += ",", e2 += yt(i[r]);
    }
    return e2 + "]";
  }(t2.arrayValue) : "mapValue" in t2 ? function(t3) {
    for (var e2 = "{", n2 = true, r = 0, i = Object.keys(t3.fields || {}).sort(); r < i.length; r++) {
      var o = i[r];
      n2 ? n2 = false : e2 += ",", e2 += o + ":" + yt(t3.fields[o]);
    }
    return e2 + "}";
  }(t2.mapValue) : L2();
  var e, n;
}
function vt(t2, e) {
  return {
    referenceValue: "projects/" + t2.projectId + "/databases/" + t2.database + "/documents/" + e.path.canonicalString()
  };
}
function mt(t2) {
  return !!t2 && "integerValue" in t2;
}
function gt(t2) {
  return !!t2 && "arrayValue" in t2;
}
function wt(t2) {
  return !!t2 && "nullValue" in t2;
}
function bt(t2) {
  return !!t2 && "doubleValue" in t2 && isNaN(Number(t2.doubleValue));
}
function It(t2) {
  return !!t2 && "mapValue" in t2;
}
function Et(t2) {
  if (t2.geoPointValue)
    return {
      geoPointValue: Object.assign({}, t2.geoPointValue)
    };
  if (t2.timestampValue)
    return {
      timestampValue: Object.assign({}, Z2(t2.timestampValue))
    };
  if (t2.mapValue) {
    var e = {
      mapValue: {
        fields: {}
      }
    };
    return Q2(t2.mapValue.fields, function(t3, n2) {
      return e.mapValue.fields[t3] = Et(n2);
    }), e;
  }
  if (t2.arrayValue) {
    for (var n = {
      arrayValue: {
        values: []
      }
    }, r = 0; r < (t2.arrayValue.values || []).length; ++r)
      n.arrayValue.values[r] = Et(t2.arrayValue.values[r]);
    return n;
  }
  return Object.assign({}, t2);
}
var Tt = function() {
  function t2(t3) {
    this.value = t3;
  }
  return t2.empty = function() {
    return new t2({
      mapValue: {}
    });
  }, t2.prototype.field = function(t3) {
    if (t3.isEmpty())
      return this.value;
    for (var e = this.value, n = 0; n < t3.length - 1; ++n)
      if (!It(e = (e.mapValue.fields || {})[t3.get(n)]))
        return null;
    return (e = (e.mapValue.fields || {})[t3.lastSegment()]) || null;
  }, t2.prototype.set = function(t3, e) {
    this.getFieldsMap(t3.popLast())[t3.lastSegment()] = Et(e);
  }, t2.prototype.setAll = function(t3) {
    var e = this, n = Y2.emptyPath(), r = {}, i = [];
    t3.forEach(function(t4, o2) {
      if (!n.isImmediateParentOf(o2)) {
        var s = e.getFieldsMap(n);
        e.applyChanges(s, r, i), r = {}, i = [], n = o2.popLast();
      }
      t4 ? r[o2.lastSegment()] = Et(t4) : i.push(o2.lastSegment());
    });
    var o = this.getFieldsMap(n);
    this.applyChanges(o, r, i);
  }, t2.prototype.delete = function(t3) {
    var e = this.field(t3.popLast());
    It(e) && e.mapValue.fields && delete e.mapValue.fields[t3.lastSegment()];
  }, t2.prototype.isEqual = function(t3) {
    return ht(this.value, t3.value);
  }, t2.prototype.getFieldsMap = function(t3) {
    var e = this.value;
    e.mapValue.fields || (e.mapValue = {
      fields: {}
    });
    for (var n = 0; n < t3.length; ++n) {
      var r = e.mapValue.fields[t3.get(n)];
      It(r) && r.mapValue.fields || (r = {
        mapValue: {
          fields: {}
        }
      }, e.mapValue.fields[t3.get(n)] = r), e = r;
    }
    return e.mapValue.fields;
  }, t2.prototype.applyChanges = function(t3, e, n) {
    Q2(e, function(e2, n2) {
      return t3[e2] = n2;
    });
    for (var r = 0, i = n; r < i.length; r++) {
      var o = i[r];
      delete t3[o];
    }
  }, t2.prototype.clone = function() {
    return new t2(Et(this.value));
  }, t2;
}();
function _t(t2) {
  var e = [];
  return Q2(t2.fields, function(t3, n) {
    var r = new Y2([t3]);
    if (It(n)) {
      var i = _t(n.mapValue).fields;
      if (i.length === 0)
        e.push(r);
      else
        for (var o = 0, s = i; o < s.length; o++) {
          var u = s[o];
          e.push(r.child(u));
        }
    } else
      e.push(r);
  }), new $(e);
}
var St = function() {
  function t2(t3, e, n, r, i) {
    this.key = t3, this.documentType = e, this.version = n, this.data = r, this.documentState = i;
  }
  return t2.newInvalidDocument = function(e) {
    return new t2(e, 0, j.min(), Tt.empty(), 0);
  }, t2.newFoundDocument = function(e, n, r) {
    return new t2(e, 1, n, r, 0);
  }, t2.newNoDocument = function(e, n) {
    return new t2(e, 2, n, Tt.empty(), 0);
  }, t2.newUnknownDocument = function(e, n) {
    return new t2(e, 3, n, Tt.empty(), 2);
  }, t2.prototype.convertToFoundDocument = function(t3, e) {
    return this.version = t3, this.documentType = 1, this.data = e, this.documentState = 0, this;
  }, t2.prototype.convertToNoDocument = function(t3) {
    return this.version = t3, this.documentType = 2, this.data = Tt.empty(), this.documentState = 0, this;
  }, t2.prototype.convertToUnknownDocument = function(t3) {
    return this.version = t3, this.documentType = 3, this.data = Tt.empty(), this.documentState = 2, this;
  }, t2.prototype.setHasCommittedMutations = function() {
    return this.documentState = 2, this;
  }, t2.prototype.setHasLocalMutations = function() {
    return this.documentState = 1, this;
  }, Object.defineProperty(t2.prototype, "hasLocalMutations", {
    get: function() {
      return this.documentState === 1;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "hasCommittedMutations", {
    get: function() {
      return this.documentState === 2;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return this.hasLocalMutations || this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isValidDocument = function() {
    return this.documentType !== 0;
  }, t2.prototype.isFoundDocument = function() {
    return this.documentType === 1;
  }, t2.prototype.isNoDocument = function() {
    return this.documentType === 2;
  }, t2.prototype.isUnknownDocument = function() {
    return this.documentType === 3;
  }, t2.prototype.isEqual = function(e) {
    return e instanceof t2 && this.key.isEqual(e.key) && this.version.isEqual(e.version) && this.documentType === e.documentType && this.documentState === e.documentState && this.data.isEqual(e.data);
  }, t2.prototype.clone = function() {
    return new t2(this.key, this.documentType, this.version, this.data.clone(), this.documentState);
  }, t2.prototype.toString = function() {
    return "Document(" + this.key + ", " + this.version + ", " + JSON.stringify(this.data.value) + ", {documentType: " + this.documentType + "}), {documentState: " + this.documentState + "})";
  }, t2;
}();
var Nt = function(t2, e, n, r, i, o, s) {
  e === void 0 && (e = null), n === void 0 && (n = []), r === void 0 && (r = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), this.path = t2, this.collectionGroup = e, this.orderBy = n, this.filters = r, this.limit = i, this.startAt = o, this.endAt = s, this.h = null;
};
function Dt(t2, e, n, r, i, o, s) {
  return e === void 0 && (e = null), n === void 0 && (n = []), r === void 0 && (r = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), new Nt(t2, e, n, r, i, o, s);
}
function At(t2) {
  var e = P2(t2);
  if (e.h === null) {
    var n = e.path.canonicalString();
    e.collectionGroup !== null && (n += "|cg:" + e.collectionGroup), n += "|f:", n += e.filters.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.op.toString() + pt(t4.value);
      }(t3);
    }).join(","), n += "|ob:", n += e.orderBy.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.dir;
      }(t3);
    }).join(","), ot(e.limit) || (n += "|l:", n += e.limit), e.startAt && (n += "|lb:", n += Bt(e.startAt)), e.endAt && (n += "|ub:", n += Bt(e.endAt)), e.h = n;
  }
  return e.h;
}
function kt(t2, e) {
  if (t2.limit !== e.limit)
    return false;
  if (t2.orderBy.length !== e.orderBy.length)
    return false;
  for (var n = 0; n < t2.orderBy.length; n++)
    if (!Kt(t2.orderBy[n], e.orderBy[n]))
      return false;
  if (t2.filters.length !== e.filters.length)
    return false;
  for (var r = 0; r < t2.filters.length; r++)
    if (i = t2.filters[r], o = e.filters[r], i.op !== o.op || !i.field.isEqual(o.field) || !ht(i.value, o.value))
      return false;
  var i, o;
  return t2.collectionGroup === e.collectionGroup && !!t2.path.isEqual(e.path) && !!Gt(t2.startAt, e.startAt) && Gt(t2.endAt, e.endAt);
}
function Ct(t2) {
  return at.isDocumentKey(t2.path) && t2.collectionGroup === null && t2.filters.length === 0;
}
var xt = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).field = t2, i.op = n2, i.value = r, i;
  }
  return __extends(n, e), n.create = function(t2, e2, r) {
    return t2.isKeyField() ? e2 === "in" || e2 === "not-in" ? this.l(t2, e2, r) : new Rt(t2, e2, r) : e2 === "array-contains" ? new Ft(t2, r) : e2 === "in" ? new Mt(t2, r) : e2 === "not-in" ? new Vt(t2, r) : e2 === "array-contains-any" ? new qt(t2, r) : new n(t2, e2, r);
  }, n.l = function(t2, e2, n2) {
    return e2 === "in" ? new Lt(t2, n2) : new Ot(t2, n2);
  }, n.prototype.matches = function(t2) {
    var e2 = t2.data.field(this.field);
    return this.op === "!=" ? e2 !== null && this.m(lt(e2, this.value)) : e2 !== null && ct(this.value) === ct(e2) && this.m(lt(e2, this.value));
  }, n.prototype.m = function(t2) {
    switch (this.op) {
      case "<":
        return t2 < 0;
      case "<=":
        return t2 <= 0;
      case "==":
        return t2 === 0;
      case "!=":
        return t2 !== 0;
      case ">":
        return t2 > 0;
      case ">=":
        return t2 >= 0;
      default:
        return L2();
    }
  }, n.prototype.g = function() {
    return ["<", "<=", ">", ">=", "!=", "not-in"].indexOf(this.op) >= 0;
  }, n;
}(function() {
});
var Rt = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this, t2, n2, r) || this).key = at.fromName(r.referenceValue), i;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    var e2 = at.comparator(t2.key, this.key);
    return this.m(e2);
  }, n;
}(xt);
var Lt = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2, "in", n2) || this).keys = Pt("in", n2), r;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    return this.keys.some(function(e2) {
      return e2.isEqual(t2.key);
    });
  }, n;
}(xt);
var Ot = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2, "not-in", n2) || this).keys = Pt("not-in", n2), r;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    return !this.keys.some(function(e2) {
      return e2.isEqual(t2.key);
    });
  }, n;
}(xt);
function Pt(t2, e) {
  var n;
  return (((n = e.arrayValue) === null || n === void 0 ? void 0 : n.values) || []).map(function(t3) {
    return at.fromName(t3.referenceValue);
  });
}
var Ft = function(e) {
  function n(t2, n2) {
    return e.call(this, t2, "array-contains", n2) || this;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    var e2 = t2.data.field(this.field);
    return gt(e2) && ft(e2.arrayValue, this.value);
  }, n;
}(xt);
var Mt = function(e) {
  function n(t2, n2) {
    return e.call(this, t2, "in", n2) || this;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    var e2 = t2.data.field(this.field);
    return e2 !== null && ft(this.value.arrayValue, e2);
  }, n;
}(xt);
var Vt = function(e) {
  function n(t2, n2) {
    return e.call(this, t2, "not-in", n2) || this;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    if (ft(this.value.arrayValue, {
      nullValue: "NULL_VALUE"
    }))
      return false;
    var e2 = t2.data.field(this.field);
    return e2 !== null && !ft(this.value.arrayValue, e2);
  }, n;
}(xt);
var qt = function(e) {
  function n(t2, n2) {
    return e.call(this, t2, "array-contains-any", n2) || this;
  }
  return __extends(n, e), n.prototype.matches = function(t2) {
    var e2 = this, n2 = t2.data.field(this.field);
    return !(!gt(n2) || !n2.arrayValue.values) && n2.arrayValue.values.some(function(t3) {
      return ft(e2.value.arrayValue, t3);
    });
  }, n;
}(xt);
var Ut = function(t2, e) {
  this.position = t2, this.before = e;
};
function Bt(t2) {
  return (t2.before ? "b" : "a") + ":" + t2.position.map(function(t3) {
    return pt(t3);
  }).join(",");
}
var jt = function(t2, e) {
  e === void 0 && (e = "asc"), this.field = t2, this.dir = e;
};
function Kt(t2, e) {
  return t2.dir === e.dir && t2.field.isEqual(e.field);
}
function Qt(t2, e, n) {
  for (var r = 0, i = 0; i < t2.position.length; i++) {
    var o = e[i], s = t2.position[i];
    if (r = o.field.isKeyField() ? at.comparator(at.fromName(s.referenceValue), n.key) : lt(s, n.data.field(o.field)), o.dir === "desc" && (r *= -1), r !== 0)
      break;
  }
  return t2.before ? r <= 0 : r < 0;
}
function Gt(t2, e) {
  if (t2 === null)
    return e === null;
  if (e === null)
    return false;
  if (t2.before !== e.before || t2.position.length !== e.position.length)
    return false;
  for (var n = 0; n < t2.position.length; n++)
    if (!ht(t2.position[n], e.position[n]))
      return false;
  return true;
}
var zt = function(t2, e, n, r, i, o, s, u) {
  e === void 0 && (e = null), n === void 0 && (n = []), r === void 0 && (r = []), i === void 0 && (i = null), o === void 0 && (o = "F"), s === void 0 && (s = null), u === void 0 && (u = null), this.path = t2, this.collectionGroup = e, this.explicitOrderBy = n, this.filters = r, this.limit = i, this.limitType = o, this.startAt = s, this.endAt = u, this.p = null, this.T = null, this.startAt, this.endAt;
};
function Wt(t2, e, n, r, i, o, s, u) {
  return new zt(t2, e, n, r, i, o, s, u);
}
function Ht(t2) {
  return new zt(t2);
}
function Yt(t2) {
  return !ot(t2.limit) && t2.limitType === "F";
}
function $t(t2) {
  return !ot(t2.limit) && t2.limitType === "L";
}
function Xt(t2) {
  return t2.explicitOrderBy.length > 0 ? t2.explicitOrderBy[0].field : null;
}
function Jt(t2) {
  for (var e = 0, n = t2.filters; e < n.length; e++) {
    var r = n[e];
    if (r.g())
      return r.field;
  }
  return null;
}
function Zt(t2) {
  return t2.collectionGroup !== null;
}
function te(t2) {
  var e = P2(t2);
  if (e.p === null) {
    e.p = [];
    var n = Jt(e), r = Xt(e);
    if (n !== null && r === null)
      n.isKeyField() || e.p.push(new jt(n)), e.p.push(new jt(Y2.keyField(), "asc"));
    else {
      for (var i = false, o = 0, s = e.explicitOrderBy; o < s.length; o++) {
        var u = s[o];
        e.p.push(u), u.field.isKeyField() && (i = true);
      }
      if (!i) {
        var a = e.explicitOrderBy.length > 0 ? e.explicitOrderBy[e.explicitOrderBy.length - 1].dir : "asc";
        e.p.push(new jt(Y2.keyField(), a));
      }
    }
  }
  return e.p;
}
function ee(t2) {
  var e = P2(t2);
  if (!e.T)
    if (e.limitType === "F")
      e.T = Dt(e.path, e.collectionGroup, te(e), e.filters, e.limit, e.startAt, e.endAt);
    else {
      for (var n = [], r = 0, i = te(e); r < i.length; r++) {
        var o = i[r], s = o.dir === "desc" ? "asc" : "desc";
        n.push(new jt(o.field, s));
      }
      var u = e.endAt ? new Ut(e.endAt.position, !e.endAt.before) : null, a = e.startAt ? new Ut(e.startAt.position, !e.startAt.before) : null;
      e.T = Dt(e.path, e.collectionGroup, n, e.filters, e.limit, u, a);
    }
  return e.T;
}
function ne(t2, e, n) {
  return new zt(t2.path, t2.collectionGroup, t2.explicitOrderBy.slice(), t2.filters.slice(), e, n, t2.startAt, t2.endAt);
}
function re(t2, e) {
  return kt(ee(t2), ee(e)) && t2.limitType === e.limitType;
}
function ie(t2) {
  return At(ee(t2)) + "|lt:" + t2.limitType;
}
function oe(t2) {
  return "Query(target=" + function(t3) {
    var e = t3.path.canonicalString();
    return t3.collectionGroup !== null && (e += " collectionGroup=" + t3.collectionGroup), t3.filters.length > 0 && (e += ", filters: [" + t3.filters.map(function(t4) {
      return (e2 = t4).field.canonicalString() + " " + e2.op + " " + pt(e2.value);
      var e2;
    }).join(", ") + "]"), ot(t3.limit) || (e += ", limit: " + t3.limit), t3.orderBy.length > 0 && (e += ", orderBy: [" + t3.orderBy.map(function(t4) {
      return function(t5) {
        return t5.field.canonicalString() + " (" + t5.dir + ")";
      }(t4);
    }).join(", ") + "]"), t3.startAt && (e += ", startAt: " + Bt(t3.startAt)), t3.endAt && (e += ", endAt: " + Bt(t3.endAt)), "Target(" + e + ")";
  }(ee(t2)) + "; limitType=" + t2.limitType + ")";
}
function se(t2, e) {
  return e.isFoundDocument() && function(t3, e2) {
    var n = e2.key.path;
    return t3.collectionGroup !== null ? e2.key.hasCollectionId(t3.collectionGroup) && t3.path.isPrefixOf(n) : at.isDocumentKey(t3.path) ? t3.path.isEqual(n) : t3.path.isImmediateParentOf(n);
  }(t2, e) && function(t3, e2) {
    for (var n = 0, r = t3.explicitOrderBy; n < r.length; n++) {
      var i = r[n];
      if (!i.field.isKeyField() && e2.data.field(i.field) === null)
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    for (var n = 0, r = t3.filters; n < r.length; n++) {
      if (!r[n].matches(e2))
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    return !(t3.startAt && !Qt(t3.startAt, te(t3), e2)) && (!t3.endAt || !Qt(t3.endAt, te(t3), e2));
  }(t2, e);
}
function ue(t2) {
  return function(e, n) {
    for (var r = false, i = 0, o = te(t2); i < o.length; i++) {
      var s = o[i], u = ae(s, e, n);
      if (u !== 0)
        return u;
      r = r || s.field.isKeyField();
    }
    return 0;
  };
}
function ae(t2, e, n) {
  var r = t2.field.isKeyField() ? at.comparator(e.key, n.key) : function(t3, e2, n2) {
    var r2 = e2.data.field(t3), i = n2.data.field(t3);
    return r2 !== null && i !== null ? lt(r2, i) : L2();
  }(t2.field, e, n);
  switch (t2.dir) {
    case "asc":
      return r;
    case "desc":
      return -1 * r;
    default:
      return L2();
  }
}
function ce(t2, e) {
  if (t2.I) {
    if (isNaN(e))
      return {
        doubleValue: "NaN"
      };
    if (e === 1 / 0)
      return {
        doubleValue: "Infinity"
      };
    if (e === -1 / 0)
      return {
        doubleValue: "-Infinity"
      };
  }
  return {
    doubleValue: st(e) ? "-0" : e
  };
}
function he(t2) {
  return {
    integerValue: "" + t2
  };
}
function fe(t2, e) {
  return ut(e) ? he(e) : ce(t2, e);
}
var le = function() {
  this._ = void 0;
};
function de(t2, e, n) {
  return t2 instanceof ve ? function(t3, e2) {
    var n2 = {
      fields: {
        __type__: {
          stringValue: "server_timestamp"
        },
        __local_write_time__: {
          timestampValue: {
            seconds: t3.seconds,
            nanos: t3.nanoseconds
          }
        }
      }
    };
    return e2 && (n2.fields.__previous_value__ = e2), {
      mapValue: n2
    };
  }(n, e) : t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : function(t3, e2) {
    var n2 = ye(t3, e2), r = Ee(n2) + Ee(t3.A);
    return mt(n2) && mt(t3.A) ? he(r) : ce(t3.R, r);
  }(t2, e);
}
function pe(t2, e, n) {
  return t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : n;
}
function ye(t2, e) {
  return t2 instanceof Ie ? mt(n = e) || function(t3) {
    return !!t3 && "doubleValue" in t3;
  }(n) ? e : {
    integerValue: 0
  } : null;
  var n;
}
var ve = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n;
}(le);
var me = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).elements = t2, n2;
  }
  return __extends(n, e), n;
}(le);
function ge(t2, e) {
  for (var n = Te(e), r = function(t3) {
    n.some(function(e2) {
      return ht(e2, t3);
    }) || n.push(t3);
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r(o[i]);
  }
  return {
    arrayValue: {
      values: n
    }
  };
}
var we = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).elements = t2, n2;
  }
  return __extends(n, e), n;
}(le);
function be(t2, e) {
  for (var n = Te(e), r = function(t3) {
    n = n.filter(function(e2) {
      return !ht(e2, t3);
    });
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r(o[i]);
  }
  return {
    arrayValue: {
      values: n
    }
  };
}
var Ie = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).R = t2, r.A = n2, r;
  }
  return __extends(n, e), n;
}(le);
function Ee(t2) {
  return tt(t2.integerValue || t2.doubleValue);
}
function Te(t2) {
  return gt(t2) && t2.arrayValue.values ? t2.arrayValue.values.slice() : [];
}
var _e = function(t2, e) {
  this.field = t2, this.transform = e;
};
var Se = function(t2, e) {
  this.version = t2, this.transformResults = e;
};
var Ne = function() {
  function t2(t3, e) {
    this.updateTime = t3, this.exists = e;
  }
  return t2.none = function() {
    return new t2();
  }, t2.exists = function(e) {
    return new t2(void 0, e);
  }, t2.updateTime = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "isNone", {
    get: function() {
      return this.updateTime === void 0 && this.exists === void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this.exists === t3.exists && (this.updateTime ? !!t3.updateTime && this.updateTime.isEqual(t3.updateTime) : !t3.updateTime);
  }, t2;
}();
function De(t2, e) {
  return t2.updateTime !== void 0 ? e.isFoundDocument() && e.version.isEqual(t2.updateTime) : t2.exists === void 0 || t2.exists === e.isFoundDocument();
}
var Ae = function() {
};
function ke(t2, e, n) {
  t2 instanceof Oe ? function(t3, e2, n2) {
    var r = t3.value.clone(), i = Me(t3.fieldTransforms, e2, n2.transformResults);
    r.setAll(i), e2.convertToFoundDocument(n2.version, r).setHasCommittedMutations();
  }(t2, e, n) : t2 instanceof Pe ? function(t3, e2, n2) {
    if (De(t3.precondition, e2)) {
      var r = Me(t3.fieldTransforms, e2, n2.transformResults), i = e2.data;
      i.setAll(Fe(t3)), i.setAll(r), e2.convertToFoundDocument(n2.version, i).setHasCommittedMutations();
    } else
      e2.convertToUnknownDocument(n2.version);
  }(t2, e, n) : function(t3, e2, n2) {
    e2.convertToNoDocument(n2.version).setHasCommittedMutations();
  }(0, e, n);
}
function Ce(t2, e, n) {
  t2 instanceof Oe ? function(t3, e2, n2) {
    if (De(t3.precondition, e2)) {
      var r = t3.value.clone(), i = Ve(t3.fieldTransforms, n2, e2);
      r.setAll(i), e2.convertToFoundDocument(Le(e2), r).setHasLocalMutations();
    }
  }(t2, e, n) : t2 instanceof Pe ? function(t3, e2, n2) {
    if (De(t3.precondition, e2)) {
      var r = Ve(t3.fieldTransforms, n2, e2), i = e2.data;
      i.setAll(Fe(t3)), i.setAll(r), e2.convertToFoundDocument(Le(e2), i).setHasLocalMutations();
    }
  }(t2, e, n) : function(t3, e2) {
    De(t3.precondition, e2) && e2.convertToNoDocument(j.min());
  }(t2, e);
}
function xe(t2, e) {
  for (var n = null, r = 0, i = t2.fieldTransforms; r < i.length; r++) {
    var o = i[r], s = e.data.field(o.field), u = ye(o.transform, s || null);
    u != null && (n == null && (n = Tt.empty()), n.set(o.field, u));
  }
  return n || null;
}
function Re(t2, e) {
  return t2.type === e.type && !!t2.key.isEqual(e.key) && !!t2.precondition.isEqual(e.precondition) && !!function(t3, e2) {
    return t3 === void 0 && e2 === void 0 || !(!t3 || !e2) && q2(t3, e2, function(t4, e3) {
      return function(t5, e4) {
        return t5.field.isEqual(e4.field) && function(t6, e5) {
          return t6 instanceof me && e5 instanceof me || t6 instanceof we && e5 instanceof we ? q2(t6.elements, e5.elements, ht) : t6 instanceof Ie && e5 instanceof Ie ? ht(t6.A, e5.A) : t6 instanceof ve && e5 instanceof ve;
        }(t5.transform, e4.transform);
      }(t4, e3);
    });
  }(t2.fieldTransforms, e.fieldTransforms) && (t2.type === 0 ? t2.value.isEqual(e.value) : t2.type !== 1 || t2.data.isEqual(e.data) && t2.fieldMask.isEqual(e.fieldMask));
}
function Le(t2) {
  return t2.isFoundDocument() ? t2.version : j.min();
}
var Oe = function(e) {
  function n(t2, n2, r, i) {
    i === void 0 && (i = []);
    var o = this;
    return (o = e.call(this) || this).key = t2, o.value = n2, o.precondition = r, o.fieldTransforms = i, o.type = 0, o;
  }
  return __extends(n, e), n;
}(Ae);
var Pe = function(e) {
  function n(t2, n2, r, i, o) {
    o === void 0 && (o = []);
    var s = this;
    return (s = e.call(this) || this).key = t2, s.data = n2, s.fieldMask = r, s.precondition = i, s.fieldTransforms = o, s.type = 1, s;
  }
  return __extends(n, e), n;
}(Ae);
function Fe(t2) {
  var e = new Map();
  return t2.fieldMask.fields.forEach(function(n) {
    if (!n.isEmpty()) {
      var r = t2.data.field(n);
      e.set(n, r);
    }
  }), e;
}
function Me(t2, e, n) {
  var r = new Map();
  O2(t2.length === n.length);
  for (var i = 0; i < n.length; i++) {
    var o = t2[i], s = o.transform, u = e.data.field(o.field);
    r.set(o.field, pe(s, u, n[i]));
  }
  return r;
}
function Ve(t2, e, n) {
  for (var r = new Map(), i = 0, o = t2; i < o.length; i++) {
    var s = o[i], u = s.transform, a = n.data.field(s.field);
    r.set(s.field, de(u, a, e));
  }
  return r;
}
var qe;
var Ue;
var Be = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).key = t2, r.precondition = n2, r.type = 2, r.fieldTransforms = [], r;
  }
  return __extends(n, e), n;
}(Ae);
var je = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).key = t2, r.precondition = n2, r.type = 3, r.fieldTransforms = [], r;
  }
  return __extends(n, e), n;
}(Ae);
var Ke = function(t2) {
  this.count = t2;
};
function Qe(t2) {
  switch (t2) {
    case S2.OK:
      return L2();
    case S2.CANCELLED:
    case S2.UNKNOWN:
    case S2.DEADLINE_EXCEEDED:
    case S2.RESOURCE_EXHAUSTED:
    case S2.INTERNAL:
    case S2.UNAVAILABLE:
    case S2.UNAUTHENTICATED:
      return false;
    case S2.INVALID_ARGUMENT:
    case S2.NOT_FOUND:
    case S2.ALREADY_EXISTS:
    case S2.PERMISSION_DENIED:
    case S2.FAILED_PRECONDITION:
    case S2.ABORTED:
    case S2.OUT_OF_RANGE:
    case S2.UNIMPLEMENTED:
    case S2.DATA_LOSS:
      return true;
    default:
      return L2();
  }
}
function Ge(t2) {
  if (t2 === void 0)
    return C2("GRPC error has no .code"), S2.UNKNOWN;
  switch (t2) {
    case qe.OK:
      return S2.OK;
    case qe.CANCELLED:
      return S2.CANCELLED;
    case qe.UNKNOWN:
      return S2.UNKNOWN;
    case qe.DEADLINE_EXCEEDED:
      return S2.DEADLINE_EXCEEDED;
    case qe.RESOURCE_EXHAUSTED:
      return S2.RESOURCE_EXHAUSTED;
    case qe.INTERNAL:
      return S2.INTERNAL;
    case qe.UNAVAILABLE:
      return S2.UNAVAILABLE;
    case qe.UNAUTHENTICATED:
      return S2.UNAUTHENTICATED;
    case qe.INVALID_ARGUMENT:
      return S2.INVALID_ARGUMENT;
    case qe.NOT_FOUND:
      return S2.NOT_FOUND;
    case qe.ALREADY_EXISTS:
      return S2.ALREADY_EXISTS;
    case qe.PERMISSION_DENIED:
      return S2.PERMISSION_DENIED;
    case qe.FAILED_PRECONDITION:
      return S2.FAILED_PRECONDITION;
    case qe.ABORTED:
      return S2.ABORTED;
    case qe.OUT_OF_RANGE:
      return S2.OUT_OF_RANGE;
    case qe.UNIMPLEMENTED:
      return S2.UNIMPLEMENTED;
    case qe.DATA_LOSS:
      return S2.DATA_LOSS;
    default:
      return L2();
  }
}
(Ue = qe || (qe = {}))[Ue.OK = 0] = "OK", Ue[Ue.CANCELLED = 1] = "CANCELLED", Ue[Ue.UNKNOWN = 2] = "UNKNOWN", Ue[Ue.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", Ue[Ue.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", Ue[Ue.NOT_FOUND = 5] = "NOT_FOUND", Ue[Ue.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", Ue[Ue.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", Ue[Ue.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", Ue[Ue.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", Ue[Ue.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", Ue[Ue.ABORTED = 10] = "ABORTED", Ue[Ue.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", Ue[Ue.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", Ue[Ue.INTERNAL = 13] = "INTERNAL", Ue[Ue.UNAVAILABLE = 14] = "UNAVAILABLE", Ue[Ue.DATA_LOSS = 15] = "DATA_LOSS";
var ze = function() {
  function t2(t3, e) {
    this.comparator = t3, this.root = e || He.EMPTY;
  }
  return t2.prototype.insert = function(e, n) {
    return new t2(this.comparator, this.root.insert(e, n, this.comparator).copy(null, null, He.BLACK, null, null));
  }, t2.prototype.remove = function(e) {
    return new t2(this.comparator, this.root.remove(e, this.comparator).copy(null, null, He.BLACK, null, null));
  }, t2.prototype.get = function(t3) {
    for (var e = this.root; !e.isEmpty(); ) {
      var n = this.comparator(t3, e.key);
      if (n === 0)
        return e.value;
      n < 0 ? e = e.left : n > 0 && (e = e.right);
    }
    return null;
  }, t2.prototype.indexOf = function(t3) {
    for (var e = 0, n = this.root; !n.isEmpty(); ) {
      var r = this.comparator(t3, n.key);
      if (r === 0)
        return e + n.left.size;
      r < 0 ? n = n.left : (e += n.left.size + 1, n = n.right);
    }
    return -1;
  }, t2.prototype.isEmpty = function() {
    return this.root.isEmpty();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.root.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.minKey = function() {
    return this.root.minKey();
  }, t2.prototype.maxKey = function() {
    return this.root.maxKey();
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.root.inorderTraversal(t3);
  }, t2.prototype.forEach = function(t3) {
    this.inorderTraversal(function(e, n) {
      return t3(e, n), false;
    });
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.inorderTraversal(function(e, n) {
      return t3.push(e + ":" + n), false;
    }), "{" + t3.join(", ") + "}";
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.root.reverseTraversal(t3);
  }, t2.prototype.getIterator = function() {
    return new We(this.root, null, this.comparator, false);
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new We(this.root, t3, this.comparator, false);
  }, t2.prototype.getReverseIterator = function() {
    return new We(this.root, null, this.comparator, true);
  }, t2.prototype.getReverseIteratorFrom = function(t3) {
    return new We(this.root, t3, this.comparator, true);
  }, t2;
}();
var We = function() {
  function t2(t3, e, n, r) {
    this.isReverse = r, this.nodeStack = [];
    for (var i = 1; !t3.isEmpty(); )
      if (i = e ? n(t3.key, e) : 1, r && (i *= -1), i < 0)
        t3 = this.isReverse ? t3.left : t3.right;
      else {
        if (i === 0) {
          this.nodeStack.push(t3);
          break;
        }
        this.nodeStack.push(t3), t3 = this.isReverse ? t3.right : t3.left;
      }
  }
  return t2.prototype.getNext = function() {
    var t3 = this.nodeStack.pop(), e = {
      key: t3.key,
      value: t3.value
    };
    if (this.isReverse)
      for (t3 = t3.left; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.right;
    else
      for (t3 = t3.right; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.left;
    return e;
  }, t2.prototype.hasNext = function() {
    return this.nodeStack.length > 0;
  }, t2.prototype.peek = function() {
    if (this.nodeStack.length === 0)
      return null;
    var t3 = this.nodeStack[this.nodeStack.length - 1];
    return {
      key: t3.key,
      value: t3.value
    };
  }, t2;
}();
var He = function() {
  function t2(e, n, r, i, o) {
    this.key = e, this.value = n, this.color = r != null ? r : t2.RED, this.left = i != null ? i : t2.EMPTY, this.right = o != null ? o : t2.EMPTY, this.size = this.left.size + 1 + this.right.size;
  }
  return t2.prototype.copy = function(e, n, r, i, o) {
    return new t2(e != null ? e : this.key, n != null ? n : this.value, r != null ? r : this.color, i != null ? i : this.left, o != null ? o : this.right);
  }, t2.prototype.isEmpty = function() {
    return false;
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.left.inorderTraversal(t3) || t3(this.key, this.value) || this.right.inorderTraversal(t3);
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.right.reverseTraversal(t3) || t3(this.key, this.value) || this.left.reverseTraversal(t3);
  }, t2.prototype.min = function() {
    return this.left.isEmpty() ? this : this.left.min();
  }, t2.prototype.minKey = function() {
    return this.min().key;
  }, t2.prototype.maxKey = function() {
    return this.right.isEmpty() ? this.key : this.right.maxKey();
  }, t2.prototype.insert = function(t3, e, n) {
    var r = this, i = n(t3, r.key);
    return (r = i < 0 ? r.copy(null, null, null, r.left.insert(t3, e, n), null) : i === 0 ? r.copy(null, e, null, null, null) : r.copy(null, null, null, null, r.right.insert(t3, e, n))).fixUp();
  }, t2.prototype.removeMin = function() {
    if (this.left.isEmpty())
      return t2.EMPTY;
    var e = this;
    return e.left.isRed() || e.left.left.isRed() || (e = e.moveRedLeft()), (e = e.copy(null, null, null, e.left.removeMin(), null)).fixUp();
  }, t2.prototype.remove = function(e, n) {
    var r, i = this;
    if (n(e, i.key) < 0)
      i.left.isEmpty() || i.left.isRed() || i.left.left.isRed() || (i = i.moveRedLeft()), i = i.copy(null, null, null, i.left.remove(e, n), null);
    else {
      if (i.left.isRed() && (i = i.rotateRight()), i.right.isEmpty() || i.right.isRed() || i.right.left.isRed() || (i = i.moveRedRight()), n(e, i.key) === 0) {
        if (i.right.isEmpty())
          return t2.EMPTY;
        r = i.right.min(), i = i.copy(r.key, r.value, null, null, i.right.removeMin());
      }
      i = i.copy(null, null, null, null, i.right.remove(e, n));
    }
    return i.fixUp();
  }, t2.prototype.isRed = function() {
    return this.color;
  }, t2.prototype.fixUp = function() {
    var t3 = this;
    return t3.right.isRed() && !t3.left.isRed() && (t3 = t3.rotateLeft()), t3.left.isRed() && t3.left.left.isRed() && (t3 = t3.rotateRight()), t3.left.isRed() && t3.right.isRed() && (t3 = t3.colorFlip()), t3;
  }, t2.prototype.moveRedLeft = function() {
    var t3 = this.colorFlip();
    return t3.right.left.isRed() && (t3 = (t3 = (t3 = t3.copy(null, null, null, null, t3.right.rotateRight())).rotateLeft()).colorFlip()), t3;
  }, t2.prototype.moveRedRight = function() {
    var t3 = this.colorFlip();
    return t3.left.left.isRed() && (t3 = (t3 = t3.rotateRight()).colorFlip()), t3;
  }, t2.prototype.rotateLeft = function() {
    var e = this.copy(null, null, t2.RED, null, this.right.left);
    return this.right.copy(null, null, this.color, e, null);
  }, t2.prototype.rotateRight = function() {
    var e = this.copy(null, null, t2.RED, this.left.right, null);
    return this.left.copy(null, null, this.color, null, e);
  }, t2.prototype.colorFlip = function() {
    var t3 = this.left.copy(null, null, !this.left.color, null, null), e = this.right.copy(null, null, !this.right.color, null, null);
    return this.copy(null, null, !this.color, t3, e);
  }, t2.prototype.checkMaxDepth = function() {
    var t3 = this.check();
    return Math.pow(2, t3) <= this.size + 1;
  }, t2.prototype.check = function() {
    if (this.isRed() && this.left.isRed())
      throw L2();
    if (this.right.isRed())
      throw L2();
    var t3 = this.left.check();
    if (t3 !== this.right.check())
      throw L2();
    return t3 + (this.isRed() ? 0 : 1);
  }, t2;
}();
He.EMPTY = null, He.RED = true, He.BLACK = false, He.EMPTY = new (function() {
  function t2() {
    this.size = 0;
  }
  return Object.defineProperty(t2.prototype, "key", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "value", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "color", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "left", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "right", {
    get: function() {
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.copy = function(t3, e, n, r, i) {
    return this;
  }, t2.prototype.insert = function(t3, e, n) {
    return new He(t3, e);
  }, t2.prototype.remove = function(t3, e) {
    return this;
  }, t2.prototype.isEmpty = function() {
    return true;
  }, t2.prototype.inorderTraversal = function(t3) {
    return false;
  }, t2.prototype.reverseTraversal = function(t3) {
    return false;
  }, t2.prototype.minKey = function() {
    return null;
  }, t2.prototype.maxKey = function() {
    return null;
  }, t2.prototype.isRed = function() {
    return false;
  }, t2.prototype.checkMaxDepth = function() {
    return true;
  }, t2.prototype.check = function() {
    return 0;
  }, t2;
}())();
var Ye = function() {
  function t2(t3) {
    this.comparator = t3, this.data = new ze(this.comparator);
  }
  return t2.prototype.has = function(t3) {
    return this.data.get(t3) !== null;
  }, t2.prototype.first = function() {
    return this.data.minKey();
  }, t2.prototype.last = function() {
    return this.data.maxKey();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.data.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.indexOf = function(t3) {
    return this.data.indexOf(t3);
  }, t2.prototype.forEach = function(t3) {
    this.data.inorderTraversal(function(e, n) {
      return t3(e), false;
    });
  }, t2.prototype.forEachInRange = function(t3, e) {
    for (var n = this.data.getIteratorFrom(t3[0]); n.hasNext(); ) {
      var r = n.getNext();
      if (this.comparator(r.key, t3[1]) >= 0)
        return;
      e(r.key);
    }
  }, t2.prototype.forEachWhile = function(t3, e) {
    var n;
    for (n = e !== void 0 ? this.data.getIteratorFrom(e) : this.data.getIterator(); n.hasNext(); )
      if (!t3(n.getNext().key))
        return;
  }, t2.prototype.firstAfterOrEqual = function(t3) {
    var e = this.data.getIteratorFrom(t3);
    return e.hasNext() ? e.getNext().key : null;
  }, t2.prototype.getIterator = function() {
    return new $e(this.data.getIterator());
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new $e(this.data.getIteratorFrom(t3));
  }, t2.prototype.add = function(t3) {
    return this.copy(this.data.remove(t3).insert(t3, true));
  }, t2.prototype.delete = function(t3) {
    return this.has(t3) ? this.copy(this.data.remove(t3)) : this;
  }, t2.prototype.isEmpty = function() {
    return this.data.isEmpty();
  }, t2.prototype.unionWith = function(t3) {
    var e = this;
    return e.size < t3.size && (e = t3, t3 = this), t3.forEach(function(t4) {
      e = e.add(t4);
    }), e;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n = this.data.getIterator(), r = e.data.getIterator(); n.hasNext(); ) {
      var i = n.getNext().key, o = r.getNext().key;
      if (this.comparator(i, o) !== 0)
        return false;
    }
    return true;
  }, t2.prototype.toArray = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e);
    }), t3;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      return t3.push(e);
    }), "SortedSet(" + t3.toString() + ")";
  }, t2.prototype.copy = function(e) {
    var n = new t2(this.comparator);
    return n.data = e, n;
  }, t2;
}();
var $e = function() {
  function t2(t3) {
    this.iter = t3;
  }
  return t2.prototype.getNext = function() {
    return this.iter.getNext().key;
  }, t2.prototype.hasNext = function() {
    return this.iter.hasNext();
  }, t2;
}();
var Xe = new ze(at.comparator);
function Je() {
  return Xe;
}
var Ze = new ze(at.comparator);
function tn() {
  return Ze;
}
var en = new ze(at.comparator);
function nn() {
  return en;
}
var rn = new Ye(at.comparator);
function on() {
  for (var t2 = [], e = 0; e < arguments.length; e++)
    t2[e] = arguments[e];
  for (var n = rn, r = 0, i = t2; r < i.length; r++) {
    var o = i[r];
    n = n.add(o);
  }
  return n;
}
var sn = new Ye(V2);
function un() {
  return sn;
}
var an = function() {
  function t2(t3, e, n, r, i) {
    this.snapshotVersion = t3, this.targetChanges = e, this.targetMismatches = n, this.documentUpdates = r, this.resolvedLimboDocuments = i;
  }
  return t2.createSynthesizedRemoteEventForCurrentChange = function(e, n) {
    var r = new Map();
    return r.set(e, cn.createSynthesizedTargetChangeForCurrentChange(e, n)), new t2(j.min(), r, un(), Je(), on());
  }, t2;
}();
var cn = function() {
  function t2(t3, e, n, r, i) {
    this.resumeToken = t3, this.current = e, this.addedDocuments = n, this.modifiedDocuments = r, this.removedDocuments = i;
  }
  return t2.createSynthesizedTargetChangeForCurrentChange = function(e, n) {
    return new t2(X2.EMPTY_BYTE_STRING, n, on(), on(), on());
  }, t2;
}();
var hn = function(t2, e, n, r) {
  this.v = t2, this.removedTargetIds = e, this.key = n, this.P = r;
};
var fn = function(t2, e) {
  this.targetId = t2, this.V = e;
};
var ln = function(t2, e, n, r) {
  n === void 0 && (n = X2.EMPTY_BYTE_STRING), r === void 0 && (r = null), this.state = t2, this.targetIds = e, this.resumeToken = n, this.cause = r;
};
var dn = function() {
  function t2() {
    this.S = 0, this.D = vn(), this.C = X2.EMPTY_BYTE_STRING, this.N = false, this.F = true;
  }
  return Object.defineProperty(t2.prototype, "current", {
    get: function() {
      return this.N;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "resumeToken", {
    get: function() {
      return this.C;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "k", {
    get: function() {
      return this.S !== 0;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "$", {
    get: function() {
      return this.F;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.O = function(t3) {
    t3.approximateByteSize() > 0 && (this.F = true, this.C = t3);
  }, t2.prototype.M = function() {
    var t3 = on(), e = on(), n = on();
    return this.D.forEach(function(r, i) {
      switch (i) {
        case 0:
          t3 = t3.add(r);
          break;
        case 2:
          e = e.add(r);
          break;
        case 1:
          n = n.add(r);
          break;
        default:
          L2();
      }
    }), new cn(this.C, this.N, t3, e, n);
  }, t2.prototype.L = function() {
    this.F = false, this.D = vn();
  }, t2.prototype.B = function(t3, e) {
    this.F = true, this.D = this.D.insert(t3, e);
  }, t2.prototype.q = function(t3) {
    this.F = true, this.D = this.D.remove(t3);
  }, t2.prototype.U = function() {
    this.S += 1;
  }, t2.prototype.K = function() {
    this.S -= 1;
  }, t2.prototype.j = function() {
    this.F = true, this.N = true;
  }, t2;
}();
var pn = function() {
  function t2(t3) {
    this.W = t3, this.G = new Map(), this.H = Je(), this.J = yn(), this.Y = new Ye(V2);
  }
  return t2.prototype.X = function(t3) {
    for (var e = 0, n = t3.v; e < n.length; e++) {
      var r = n[e];
      t3.P && t3.P.isFoundDocument() ? this.Z(r, t3.P) : this.tt(r, t3.key, t3.P);
    }
    for (var i = 0, o = t3.removedTargetIds; i < o.length; i++) {
      r = o[i];
      this.tt(r, t3.key, t3.P);
    }
  }, t2.prototype.et = function(t3) {
    var e = this;
    this.forEachTarget(t3, function(n) {
      var r = e.nt(n);
      switch (t3.state) {
        case 0:
          e.st(n) && r.O(t3.resumeToken);
          break;
        case 1:
          r.K(), r.k || r.L(), r.O(t3.resumeToken);
          break;
        case 2:
          r.K(), r.k || e.removeTarget(n);
          break;
        case 3:
          e.st(n) && (r.j(), r.O(t3.resumeToken));
          break;
        case 4:
          e.st(n) && (e.it(n), r.O(t3.resumeToken));
          break;
        default:
          L2();
      }
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    var n = this;
    t3.targetIds.length > 0 ? t3.targetIds.forEach(e) : this.G.forEach(function(t4, r) {
      n.st(r) && e(r);
    });
  }, t2.prototype.rt = function(t3) {
    var e = t3.targetId, n = t3.V.count, r = this.ot(e);
    if (r) {
      var i = r.target;
      if (Ct(i))
        if (n === 0) {
          var o = new at(i.path);
          this.tt(e, o, St.newNoDocument(o, j.min()));
        } else
          O2(n === 1);
      else
        this.ct(e) !== n && (this.it(e), this.Y = this.Y.add(e));
    }
  }, t2.prototype.ut = function(t3) {
    var e = this, n = new Map();
    this.G.forEach(function(r2, i2) {
      var o = e.ot(i2);
      if (o) {
        if (r2.current && Ct(o.target)) {
          var s = new at(o.target.path);
          e.H.get(s) !== null || e.at(i2, s) || e.tt(i2, s, St.newNoDocument(s, t3));
        }
        r2.$ && (n.set(i2, r2.M()), r2.L());
      }
    });
    var r = on();
    this.J.forEach(function(t4, n2) {
      var i2 = true;
      n2.forEachWhile(function(t5) {
        var n3 = e.ot(t5);
        return !n3 || n3.purpose === 2 || (i2 = false, false);
      }), i2 && (r = r.add(t4));
    });
    var i = new an(t3, n, this.Y, this.H, r);
    return this.H = Je(), this.J = yn(), this.Y = new Ye(V2), i;
  }, t2.prototype.Z = function(t3, e) {
    if (this.st(t3)) {
      var n = this.at(t3, e.key) ? 2 : 0;
      this.nt(t3).B(e.key, n), this.H = this.H.insert(e.key, e), this.J = this.J.insert(e.key, this.ht(e.key).add(t3));
    }
  }, t2.prototype.tt = function(t3, e, n) {
    if (this.st(t3)) {
      var r = this.nt(t3);
      this.at(t3, e) ? r.B(e, 1) : r.q(e), this.J = this.J.insert(e, this.ht(e).delete(t3)), n && (this.H = this.H.insert(e, n));
    }
  }, t2.prototype.removeTarget = function(t3) {
    this.G.delete(t3);
  }, t2.prototype.ct = function(t3) {
    var e = this.nt(t3).M();
    return this.W.getRemoteKeysForTarget(t3).size + e.addedDocuments.size - e.removedDocuments.size;
  }, t2.prototype.U = function(t3) {
    this.nt(t3).U();
  }, t2.prototype.nt = function(t3) {
    var e = this.G.get(t3);
    return e || (e = new dn(), this.G.set(t3, e)), e;
  }, t2.prototype.ht = function(t3) {
    var e = this.J.get(t3);
    return e || (e = new Ye(V2), this.J = this.J.insert(t3, e)), e;
  }, t2.prototype.st = function(t3) {
    var e = this.ot(t3) !== null;
    return e || k2("WatchChangeAggregator", "Detected inactive target", t3), e;
  }, t2.prototype.ot = function(t3) {
    var e = this.G.get(t3);
    return e && e.k ? null : this.W.lt(t3);
  }, t2.prototype.it = function(t3) {
    var e = this;
    this.G.set(t3, new dn()), this.W.getRemoteKeysForTarget(t3).forEach(function(n) {
      e.tt(t3, n, null);
    });
  }, t2.prototype.at = function(t3, e) {
    return this.W.getRemoteKeysForTarget(t3).has(e);
  }, t2;
}();
function yn() {
  return new ze(at.comparator);
}
function vn() {
  return new ze(at.comparator);
}
var mn = {
  asc: "ASCENDING",
  desc: "DESCENDING"
};
var gn = {
  "<": "LESS_THAN",
  "<=": "LESS_THAN_OR_EQUAL",
  ">": "GREATER_THAN",
  ">=": "GREATER_THAN_OR_EQUAL",
  "==": "EQUAL",
  "!=": "NOT_EQUAL",
  "array-contains": "ARRAY_CONTAINS",
  in: "IN",
  "not-in": "NOT_IN",
  "array-contains-any": "ARRAY_CONTAINS_ANY"
};
var wn = function(t2, e) {
  this.databaseId = t2, this.I = e;
};
function bn(t2, e) {
  return t2.I ? new Date(1e3 * e.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "") + "." + ("000000000" + e.nanoseconds).slice(-9) + "Z" : {
    seconds: "" + e.seconds,
    nanos: e.nanoseconds
  };
}
function In(t2, e) {
  return t2.I ? e.toBase64() : e.toUint8Array();
}
function En(t2, e) {
  return bn(t2, e.toTimestamp());
}
function Tn(t2) {
  return O2(!!t2), j.fromTimestamp(function(t3) {
    var e = Z2(t3);
    return new B2(e.seconds, e.nanos);
  }(t2));
}
function _n(t2, e) {
  return function(t3) {
    return new W2(["projects", t3.projectId, "databases", t3.database]);
  }(t2).child("documents").child(e).canonicalString();
}
function Sn(t2) {
  var e = W2.fromString(t2);
  return O2(Yn(e)), e;
}
function Nn(t2, e) {
  return _n(t2.databaseId, e.path);
}
function Dn(t2, e) {
  var n = Sn(e);
  if (n.get(1) !== t2.databaseId.projectId)
    throw new N2(S2.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n.get(1) + " vs " + t2.databaseId.projectId);
  if (n.get(3) !== t2.databaseId.database)
    throw new N2(S2.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n.get(3) + " vs " + t2.databaseId.database);
  return new at(xn(n));
}
function An(t2, e) {
  return _n(t2.databaseId, e);
}
function kn(t2) {
  var e = Sn(t2);
  return e.length === 4 ? W2.emptyPath() : xn(e);
}
function Cn(t2) {
  return new W2(["projects", t2.databaseId.projectId, "databases", t2.databaseId.database]).canonicalString();
}
function xn(t2) {
  return O2(t2.length > 4 && t2.get(4) === "documents"), t2.popFirst(5);
}
function Rn(t2, e, n) {
  return {
    name: Nn(t2, e),
    fields: n.value.mapValue.fields
  };
}
function Ln(t2, e, n) {
  var r = Dn(t2, e.name), i = Tn(e.updateTime), o = new Tt({
    mapValue: {
      fields: e.fields
    }
  }), s = St.newFoundDocument(r, i, o);
  return n && s.setHasCommittedMutations(), n ? s.setHasCommittedMutations() : s;
}
function On(t2, e) {
  var n;
  if (e instanceof Oe)
    n = {
      update: Rn(t2, e.key, e.value)
    };
  else if (e instanceof Be)
    n = {
      delete: Nn(t2, e.key)
    };
  else if (e instanceof Pe)
    n = {
      update: Rn(t2, e.key, e.data),
      updateMask: Hn(e.fieldMask)
    };
  else {
    if (!(e instanceof je))
      return L2();
    n = {
      verify: Nn(t2, e.key)
    };
  }
  return e.fieldTransforms.length > 0 && (n.updateTransforms = e.fieldTransforms.map(function(t3) {
    return function(t4, e2) {
      var n2 = e2.transform;
      if (n2 instanceof ve)
        return {
          fieldPath: e2.field.canonicalString(),
          setToServerValue: "REQUEST_TIME"
        };
      if (n2 instanceof me)
        return {
          fieldPath: e2.field.canonicalString(),
          appendMissingElements: {
            values: n2.elements
          }
        };
      if (n2 instanceof we)
        return {
          fieldPath: e2.field.canonicalString(),
          removeAllFromArray: {
            values: n2.elements
          }
        };
      if (n2 instanceof Ie)
        return {
          fieldPath: e2.field.canonicalString(),
          increment: n2.A
        };
      throw L2();
    }(0, t3);
  })), e.precondition.isNone || (n.currentDocument = function(t3, e2) {
    return e2.updateTime !== void 0 ? {
      updateTime: En(t3, e2.updateTime)
    } : e2.exists !== void 0 ? {
      exists: e2.exists
    } : L2();
  }(t2, e.precondition)), n;
}
function Pn(t2, e) {
  var n = e.currentDocument ? function(t3) {
    return t3.updateTime !== void 0 ? Ne.updateTime(Tn(t3.updateTime)) : t3.exists !== void 0 ? Ne.exists(t3.exists) : Ne.none();
  }(e.currentDocument) : Ne.none(), r = e.updateTransforms ? e.updateTransforms.map(function(e2) {
    return function(t3, e3) {
      var n2 = null;
      if ("setToServerValue" in e3)
        O2(e3.setToServerValue === "REQUEST_TIME"), n2 = new ve();
      else if ("appendMissingElements" in e3) {
        var r2 = e3.appendMissingElements.values || [];
        n2 = new me(r2);
      } else if ("removeAllFromArray" in e3) {
        var i2 = e3.removeAllFromArray.values || [];
        n2 = new we(i2);
      } else
        "increment" in e3 ? n2 = new Ie(t3, e3.increment) : L2();
      var o2 = Y2.fromServerFormat(e3.fieldPath);
      return new _e(o2, n2);
    }(t2, e2);
  }) : [];
  if (e.update) {
    e.update.name;
    var i = Dn(t2, e.update.name), o = new Tt({
      mapValue: {
        fields: e.update.fields
      }
    });
    if (e.updateMask) {
      var s = function(t3) {
        var e2 = t3.fieldPaths || [];
        return new $(e2.map(function(t4) {
          return Y2.fromServerFormat(t4);
        }));
      }(e.updateMask);
      return new Pe(i, o, s, n, r);
    }
    return new Oe(i, o, n, r);
  }
  if (e.delete) {
    var u = Dn(t2, e.delete);
    return new Be(u, n);
  }
  if (e.verify) {
    var a = Dn(t2, e.verify);
    return new je(a, n);
  }
  return L2();
}
function Fn(t2, e) {
  return {
    documents: [An(t2, e.path)]
  };
}
function Mn(t2, e) {
  var n = {
    structuredQuery: {}
  }, r = e.path;
  e.collectionGroup !== null ? (n.parent = An(t2, r), n.structuredQuery.from = [{
    collectionId: e.collectionGroup,
    allDescendants: true
  }]) : (n.parent = An(t2, r.popLast()), n.structuredQuery.from = [{
    collectionId: r.lastSegment()
  }]);
  var i = function(t3) {
    if (t3.length !== 0) {
      var e2 = t3.map(function(t4) {
        return function(t5) {
          if (t5.op === "==") {
            if (bt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NAN"
                }
              };
            if (wt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NULL"
                }
              };
          } else if (t5.op === "!=") {
            if (bt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NOT_NAN"
                }
              };
            if (wt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NOT_NULL"
                }
              };
          }
          return {
            fieldFilter: {
              field: Qn(t5.field),
              op: Kn(t5.op),
              value: t5.value
            }
          };
        }(t4);
      });
      return e2.length === 1 ? e2[0] : {
        compositeFilter: {
          op: "AND",
          filters: e2
        }
      };
    }
  }(e.filters);
  i && (n.structuredQuery.where = i);
  var o = function(t3) {
    if (t3.length !== 0)
      return t3.map(function(t4) {
        return function(t5) {
          return {
            field: Qn(t5.field),
            direction: jn(t5.dir)
          };
        }(t4);
      });
  }(e.orderBy);
  o && (n.structuredQuery.orderBy = o);
  var s = function(t3, e2) {
    return t3.I || ot(e2) ? e2 : {
      value: e2
    };
  }(t2, e.limit);
  return s !== null && (n.structuredQuery.limit = s), e.startAt && (n.structuredQuery.startAt = Un(e.startAt)), e.endAt && (n.structuredQuery.endAt = Un(e.endAt)), n;
}
function Vn(t2) {
  var e = kn(t2.parent), n = t2.structuredQuery, r = n.from ? n.from.length : 0, i = null;
  if (r > 0) {
    O2(r === 1);
    var o = n.from[0];
    o.allDescendants ? i = o.collectionId : e = e.child(o.collectionId);
  }
  var s = [];
  n.where && (s = qn(n.where));
  var u = [];
  n.orderBy && (u = n.orderBy.map(function(t3) {
    return function(t4) {
      return new jt(Gn(t4.field), function(t5) {
        switch (t5) {
          case "ASCENDING":
            return "asc";
          case "DESCENDING":
            return "desc";
          default:
            return;
        }
      }(t4.direction));
    }(t3);
  }));
  var a = null;
  n.limit && (a = function(t3) {
    var e2;
    return ot(e2 = typeof t3 == "object" ? t3.value : t3) ? null : e2;
  }(n.limit));
  var c = null;
  n.startAt && (c = Bn(n.startAt));
  var h = null;
  return n.endAt && (h = Bn(n.endAt)), Wt(e, i, u, s, a, "F", c, h);
}
function qn(t2) {
  return t2 ? t2.unaryFilter !== void 0 ? [Wn(t2)] : t2.fieldFilter !== void 0 ? [zn(t2)] : t2.compositeFilter !== void 0 ? t2.compositeFilter.filters.map(function(t3) {
    return qn(t3);
  }).reduce(function(t3, e) {
    return t3.concat(e);
  }) : L2() : [];
}
function Un(t2) {
  return {
    before: t2.before,
    values: t2.position
  };
}
function Bn(t2) {
  var e = !!t2.before, n = t2.values || [];
  return new Ut(n, e);
}
function jn(t2) {
  return mn[t2];
}
function Kn(t2) {
  return gn[t2];
}
function Qn(t2) {
  return {
    fieldPath: t2.canonicalString()
  };
}
function Gn(t2) {
  return Y2.fromServerFormat(t2.fieldPath);
}
function zn(t2) {
  return xt.create(Gn(t2.fieldFilter.field), function(t3) {
    switch (t3) {
      case "EQUAL":
        return "==";
      case "NOT_EQUAL":
        return "!=";
      case "GREATER_THAN":
        return ">";
      case "GREATER_THAN_OR_EQUAL":
        return ">=";
      case "LESS_THAN":
        return "<";
      case "LESS_THAN_OR_EQUAL":
        return "<=";
      case "ARRAY_CONTAINS":
        return "array-contains";
      case "IN":
        return "in";
      case "NOT_IN":
        return "not-in";
      case "ARRAY_CONTAINS_ANY":
        return "array-contains-any";
      case "OPERATOR_UNSPECIFIED":
      default:
        return L2();
    }
  }(t2.fieldFilter.op), t2.fieldFilter.value);
}
function Wn(t2) {
  switch (t2.unaryFilter.op) {
    case "IS_NAN":
      var e = Gn(t2.unaryFilter.field);
      return xt.create(e, "==", {
        doubleValue: NaN
      });
    case "IS_NULL":
      var n = Gn(t2.unaryFilter.field);
      return xt.create(n, "==", {
        nullValue: "NULL_VALUE"
      });
    case "IS_NOT_NAN":
      var r = Gn(t2.unaryFilter.field);
      return xt.create(r, "!=", {
        doubleValue: NaN
      });
    case "IS_NOT_NULL":
      var i = Gn(t2.unaryFilter.field);
      return xt.create(i, "!=", {
        nullValue: "NULL_VALUE"
      });
    case "OPERATOR_UNSPECIFIED":
    default:
      return L2();
  }
}
function Hn(t2) {
  var e = [];
  return t2.fields.forEach(function(t3) {
    return e.push(t3.canonicalString());
  }), {
    fieldPaths: e
  };
}
function Yn(t2) {
  return t2.length >= 4 && t2.get(0) === "projects" && t2.get(2) === "databases";
}
function $n(t2) {
  for (var e = "", n = 0; n < t2.length; n++)
    e.length > 0 && (e = Jn(e)), e = Xn(t2.get(n), e);
  return Jn(e);
}
function Xn(t2, e) {
  for (var n = e, r = t2.length, i = 0; i < r; i++) {
    var o = t2.charAt(i);
    switch (o) {
      case "\0":
        n += "";
        break;
      case "":
        n += "";
        break;
      default:
        n += o;
    }
  }
  return n;
}
function Jn(t2) {
  return t2 + "";
}
function Zn(t2) {
  var e = t2.length;
  if (O2(e >= 2), e === 2)
    return O2(t2.charAt(0) === "" && t2.charAt(1) === ""), W2.emptyPath();
  for (var n = e - 2, r = [], i = "", o = 0; o < e; ) {
    var s = t2.indexOf("", o);
    switch ((s < 0 || s > n) && L2(), t2.charAt(s + 1)) {
      case "":
        var u = t2.substring(o, s), a = void 0;
        i.length === 0 ? a = u : (a = i += u, i = ""), r.push(a);
        break;
      case "":
        i += t2.substring(o, s), i += "\0";
        break;
      case "":
        i += t2.substring(o, s + 1);
        break;
      default:
        L2();
    }
    o = s + 2;
  }
  return new W2(r);
}
var tr = function(t2, e) {
  this.seconds = t2, this.nanoseconds = e;
};
var er = function(t2, e, n) {
  this.ownerId = t2, this.allowTabSynchronization = e, this.leaseTimestampMs = n;
};
er.store = "owner", er.key = "owner";
var nr = function(t2, e, n) {
  this.userId = t2, this.lastAcknowledgedBatchId = e, this.lastStreamToken = n;
};
nr.store = "mutationQueues", nr.keyPath = "userId";
var rr = function(t2, e, n, r, i) {
  this.userId = t2, this.batchId = e, this.localWriteTimeMs = n, this.baseMutations = r, this.mutations = i;
};
rr.store = "mutations", rr.keyPath = "batchId", rr.userMutationsIndex = "userMutationsIndex", rr.userMutationsKeyPath = ["userId", "batchId"];
var ir = function() {
  function t2() {
  }
  return t2.prefixForUser = function(t3) {
    return [t3];
  }, t2.prefixForPath = function(t3, e) {
    return [t3, $n(e)];
  }, t2.key = function(t3, e, n) {
    return [t3, $n(e), n];
  }, t2;
}();
ir.store = "documentMutations", ir.PLACEHOLDER = new ir();
var or = function(t2, e) {
  this.path = t2, this.readTime = e;
};
var sr = function(t2, e) {
  this.path = t2, this.version = e;
};
var ur = function(t2, e, n, r, i, o) {
  this.unknownDocument = t2, this.noDocument = e, this.document = n, this.hasCommittedMutations = r, this.readTime = i, this.parentPath = o;
};
ur.store = "remoteDocuments", ur.readTimeIndex = "readTimeIndex", ur.readTimeIndexPath = "readTime", ur.collectionReadTimeIndex = "collectionReadTimeIndex", ur.collectionReadTimeIndexPath = ["parentPath", "readTime"];
var ar = function(t2) {
  this.byteSize = t2;
};
ar.store = "remoteDocumentGlobal", ar.key = "remoteDocumentGlobalKey";
var cr = function(t2, e, n, r, i, o, s) {
  this.targetId = t2, this.canonicalId = e, this.readTime = n, this.resumeToken = r, this.lastListenSequenceNumber = i, this.lastLimboFreeSnapshotVersion = o, this.query = s;
};
cr.store = "targets", cr.keyPath = "targetId", cr.queryTargetsIndexName = "queryTargetsIndex", cr.queryTargetsKeyPath = ["canonicalId", "targetId"];
var hr = function(t2, e, n) {
  this.targetId = t2, this.path = e, this.sequenceNumber = n;
};
hr.store = "targetDocuments", hr.keyPath = ["targetId", "path"], hr.documentTargetsIndex = "documentTargetsIndex", hr.documentTargetsKeyPath = ["path", "targetId"];
var fr = function(t2, e, n, r) {
  this.highestTargetId = t2, this.highestListenSequenceNumber = e, this.lastRemoteSnapshotVersion = n, this.targetCount = r;
};
fr.key = "targetGlobalKey", fr.store = "targetGlobal";
var lr = function(t2, e) {
  this.collectionId = t2, this.parent = e;
};
lr.store = "collectionParents", lr.keyPath = ["collectionId", "parent"];
var dr = function(t2, e, n, r) {
  this.clientId = t2, this.updateTimeMs = e, this.networkEnabled = n, this.inForeground = r;
};
dr.store = "clientMetadata", dr.keyPath = "clientId";
var pr = function(t2, e, n) {
  this.bundleId = t2, this.createTime = e, this.version = n;
};
pr.store = "bundles", pr.keyPath = "bundleId";
var yr = function(t2, e, n) {
  this.name = t2, this.readTime = e, this.bundledQuery = n;
};
yr.store = "namedQueries", yr.keyPath = "name";
var vr = __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], [nr.store, rr.store, ir.store, ur.store, cr.store, er.store, fr.store, hr.store]), [dr.store])), [ar.store])), [lr.store])), [pr.store, yr.store]);
var mr = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
var gr = function() {
  function t2() {
    this.onCommittedListeners = [];
  }
  return t2.prototype.addOnCommittedListener = function(t3) {
    this.onCommittedListeners.push(t3);
  }, t2.prototype.raiseOnCommittedEvent = function() {
    this.onCommittedListeners.forEach(function(t3) {
      return t3();
    });
  }, t2;
}();
var wr = function() {
  var t2 = this;
  this.promise = new Promise(function(e, n) {
    t2.resolve = e, t2.reject = n;
  });
};
var br = function() {
  function t2(t3) {
    var e = this;
    this.nextCallback = null, this.catchCallback = null, this.result = void 0, this.error = void 0, this.isDone = false, this.callbackAttached = false, t3(function(t4) {
      e.isDone = true, e.result = t4, e.nextCallback && e.nextCallback(t4);
    }, function(t4) {
      e.isDone = true, e.error = t4, e.catchCallback && e.catchCallback(t4);
    });
  }
  return t2.prototype.catch = function(t3) {
    return this.next(void 0, t3);
  }, t2.prototype.next = function(e, n) {
    var r = this;
    return this.callbackAttached && L2(), this.callbackAttached = true, this.isDone ? this.error ? this.wrapFailure(n, this.error) : this.wrapSuccess(e, this.result) : new t2(function(t3, i) {
      r.nextCallback = function(n2) {
        r.wrapSuccess(e, n2).next(t3, i);
      }, r.catchCallback = function(e2) {
        r.wrapFailure(n, e2).next(t3, i);
      };
    });
  }, t2.prototype.toPromise = function() {
    var t3 = this;
    return new Promise(function(e, n) {
      t3.next(e, n);
    });
  }, t2.prototype.wrapUserFunction = function(e) {
    try {
      var n = e();
      return n instanceof t2 ? n : t2.resolve(n);
    } catch (e2) {
      return t2.reject(e2);
    }
  }, t2.prototype.wrapSuccess = function(e, n) {
    return e ? this.wrapUserFunction(function() {
      return e(n);
    }) : t2.resolve(n);
  }, t2.prototype.wrapFailure = function(e, n) {
    return e ? this.wrapUserFunction(function() {
      return e(n);
    }) : t2.reject(n);
  }, t2.resolve = function(e) {
    return new t2(function(t3, n) {
      t3(e);
    });
  }, t2.reject = function(e) {
    return new t2(function(t3, n) {
      n(e);
    });
  }, t2.waitFor = function(e) {
    return new t2(function(t3, n) {
      var r = 0, i = 0, o = false;
      e.forEach(function(e2) {
        ++r, e2.next(function() {
          ++i, o && i === r && t3();
        }, function(t4) {
          return n(t4);
        });
      }), o = true, i === r && t3();
    });
  }, t2.or = function(e) {
    for (var n = t2.resolve(false), r = function(e2) {
      n = n.next(function(n2) {
        return n2 ? t2.resolve(n2) : e2();
      });
    }, i = 0, o = e; i < o.length; i++) {
      r(o[i]);
    }
    return n;
  }, t2.forEach = function(t3, e) {
    var n = this, r = [];
    return t3.forEach(function(t4, i) {
      r.push(e.call(n, t4, i));
    }), this.waitFor(r);
  }, t2;
}();
var Ir = function() {
  function t2(t3, e) {
    var n = this;
    this.action = t3, this.transaction = e, this.aborted = false, this.ft = new wr(), this.transaction.oncomplete = function() {
      n.ft.resolve();
    }, this.transaction.onabort = function() {
      e.error ? n.ft.reject(new _r(t3, e.error)) : n.ft.resolve();
    }, this.transaction.onerror = function(e2) {
      var r = kr(e2.target.error);
      n.ft.reject(new _r(t3, r));
    };
  }
  return t2.open = function(e, n, r, i) {
    try {
      return new t2(n, e.transaction(i, r));
    } catch (e2) {
      throw new _r(n, e2);
    }
  }, Object.defineProperty(t2.prototype, "dt", {
    get: function() {
      return this.ft.promise;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.abort = function(t3) {
    t3 && this.ft.reject(t3), this.aborted || (k2("SimpleDb", "Aborting transaction:", t3 ? t3.message : "Client-initiated abort"), this.aborted = true, this.transaction.abort());
  }, t2.prototype.store = function(t3) {
    var e = this.transaction.objectStore(t3);
    return new Nr(e);
  }, t2;
}();
var Er = function() {
  function t2(e, n, r) {
    this.name = e, this.version = n, this.wt = r, t2._t(getUA()) === 12.2 && C2("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
  }
  return t2.delete = function(t3) {
    return k2("SimpleDb", "Removing database:", t3), Dr(window.indexedDB.deleteDatabase(t3)).toPromise();
  }, t2.yt = function() {
    if (typeof indexedDB == "undefined")
      return false;
    if (t2.gt())
      return true;
    var e = getUA(), n = t2._t(e), r = 0 < n && n < 10, o = t2.Et(e), s = 0 < o && o < 4.5;
    return !(e.indexOf("MSIE ") > 0 || e.indexOf("Trident/") > 0 || e.indexOf("Edge/") > 0 || r || s);
  }, t2.gt = function() {
    var t3;
    return typeof process != "undefined" && ((t3 = process.env) === null || t3 === void 0 ? void 0 : t3.Tt) === "YES";
  }, t2.It = function(t3, e) {
    return t3.store(e);
  }, t2._t = function(t3) {
    var e = t3.match(/i(?:phone|pad|pod) os ([\d_]+)/i), n = e ? e[1].split("_").slice(0, 2).join(".") : "-1";
    return Number(n);
  }, t2.Et = function(t3) {
    var e = t3.match(/Android ([\d.]+)/i), n = e ? e[1].split(".").slice(0, 2).join(".") : "-1";
    return Number(n);
  }, t2.prototype.At = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n = this;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return this.db ? [3, 2] : (k2("SimpleDb", "Opening database:", this.name), e = this, [4, new Promise(function(e2, r2) {
              var i = indexedDB.open(n.name, n.version);
              i.onsuccess = function(t4) {
                var n2 = t4.target.result;
                e2(n2);
              }, i.onblocked = function() {
                r2(new _r(t3, "Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."));
              }, i.onerror = function(e3) {
                var n2 = e3.target.error;
                n2.name === "VersionError" ? r2(new N2(S2.FAILED_PRECONDITION, "A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")) : r2(new _r(t3, n2));
              }, i.onupgradeneeded = function(t4) {
                k2("SimpleDb", 'Database "' + n.name + '" requires upgrade from version:', t4.oldVersion);
                var e3 = t4.target.result;
                n.wt.Rt(e3, i.transaction, t4.oldVersion, n.version).next(function() {
                  k2("SimpleDb", "Database upgrade to version " + n.version + " complete");
                });
              };
            })]);
          case 1:
            e.db = r.sent(), r.label = 2;
          case 2:
            return [2, (this.bt && (this.db.onversionchange = function(t4) {
              return n.bt(t4);
            }), this.db)];
        }
      });
    });
  }, t2.prototype.vt = function(t3) {
    this.bt = t3, this.db && (this.db.onversionchange = function(e) {
      return t3(e);
    });
  }, t2.prototype.runTransaction = function(t3, e, i, o) {
    return __awaiter(this, void 0, void 0, function() {
      var n, s, u, a, c;
      return __generator(this, function(h) {
        switch (h.label) {
          case 0:
            n = e === "readonly", s = 0, u = function() {
              var e2, u2, c2, h2, f;
              return __generator(this, function(r) {
                switch (r.label) {
                  case 0:
                    ++s, r.label = 1;
                  case 1:
                    return r.trys.push([1, 4, , 5]), [4, a.At(t3)];
                  case 2:
                    return a.db = r.sent(), e2 = Ir.open(a.db, t3, n ? "readonly" : "readwrite", i), u2 = o(e2).catch(function(t4) {
                      return e2.abort(t4), br.reject(t4);
                    }).toPromise(), c2 = {}, u2.catch(function() {
                    }), [4, e2.dt];
                  case 3:
                    return [2, (c2.value = (r.sent(), u2), c2)];
                  case 4:
                    return h2 = r.sent(), f = h2.name !== "FirebaseError" && s < 3, k2("SimpleDb", "Transaction failed with error:", h2.message, "Retrying:", f), a.close(), f ? [3, 5] : [2, {
                      value: Promise.reject(h2)
                    }];
                  case 5:
                    return [2];
                }
              });
            }, a = this, h.label = 1;
          case 1:
            return [5, u()];
          case 2:
            if (typeof (c = h.sent()) == "object")
              return [2, c.value];
            h.label = 3;
          case 3:
            return [3, 1];
          case 4:
            return [2];
        }
      });
    });
  }, t2.prototype.close = function() {
    this.db && this.db.close(), this.db = void 0;
  }, t2;
}();
var Tr = function() {
  function t2(t3) {
    this.Pt = t3, this.Vt = false, this.St = null;
  }
  return Object.defineProperty(t2.prototype, "isDone", {
    get: function() {
      return this.Vt;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Dt", {
    get: function() {
      return this.St;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "cursor", {
    set: function(t3) {
      this.Pt = t3;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.done = function() {
    this.Vt = true;
  }, t2.prototype.Ct = function(t3) {
    this.St = t3;
  }, t2.prototype.delete = function() {
    return Dr(this.Pt.delete());
  }, t2;
}();
var _r = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, S2.UNAVAILABLE, "IndexedDB transaction '" + t2 + "' failed: " + n2) || this).name = "IndexedDbTransactionError", r;
  }
  return __extends(n, e), n;
}(N2);
function Sr(t2) {
  return t2.name === "IndexedDbTransactionError";
}
var Nr = function() {
  function t2(t3) {
    this.store = t3;
  }
  return t2.prototype.put = function(t3, e) {
    var n;
    return e !== void 0 ? (k2("SimpleDb", "PUT", this.store.name, t3, e), n = this.store.put(e, t3)) : (k2("SimpleDb", "PUT", this.store.name, "<auto-key>", t3), n = this.store.put(t3)), Dr(n);
  }, t2.prototype.add = function(t3) {
    return k2("SimpleDb", "ADD", this.store.name, t3, t3), Dr(this.store.add(t3));
  }, t2.prototype.get = function(t3) {
    var e = this;
    return Dr(this.store.get(t3)).next(function(n) {
      return n === void 0 && (n = null), k2("SimpleDb", "GET", e.store.name, t3, n), n;
    });
  }, t2.prototype.delete = function(t3) {
    return k2("SimpleDb", "DELETE", this.store.name, t3), Dr(this.store.delete(t3));
  }, t2.prototype.count = function() {
    return k2("SimpleDb", "COUNT", this.store.name), Dr(this.store.count());
  }, t2.prototype.Nt = function(t3, e) {
    var n = this.cursor(this.options(t3, e)), r = [];
    return this.xt(n, function(t4, e2) {
      r.push(e2);
    }).next(function() {
      return r;
    });
  }, t2.prototype.Ft = function(t3, e) {
    k2("SimpleDb", "DELETE ALL", this.store.name);
    var n = this.options(t3, e);
    n.kt = false;
    var r = this.cursor(n);
    return this.xt(r, function(t4, e2, n2) {
      return n2.delete();
    });
  }, t2.prototype.$t = function(t3, e) {
    var n;
    e ? n = t3 : (n = {}, e = t3);
    var r = this.cursor(n);
    return this.xt(r, e);
  }, t2.prototype.Ot = function(t3) {
    var e = this.cursor({});
    return new br(function(n, r) {
      e.onerror = function(t4) {
        var e2 = kr(t4.target.error);
        r(e2);
      }, e.onsuccess = function(e2) {
        var r2 = e2.target.result;
        r2 ? t3(r2.primaryKey, r2.value).next(function(t4) {
          t4 ? r2.continue() : n();
        }) : n();
      };
    });
  }, t2.prototype.xt = function(t3, e) {
    var n = [];
    return new br(function(r, i) {
      t3.onerror = function(t4) {
        i(t4.target.error);
      }, t3.onsuccess = function(t4) {
        var i2 = t4.target.result;
        if (i2) {
          var o = new Tr(i2), s = e(i2.primaryKey, i2.value, o);
          if (s instanceof br) {
            var u = s.catch(function(t5) {
              return o.done(), br.reject(t5);
            });
            n.push(u);
          }
          o.isDone ? r() : o.Dt === null ? i2.continue() : i2.continue(o.Dt);
        } else
          r();
      };
    }).next(function() {
      return br.waitFor(n);
    });
  }, t2.prototype.options = function(t3, e) {
    var n;
    return t3 !== void 0 && (typeof t3 == "string" ? n = t3 : e = t3), {
      index: n,
      range: e
    };
  }, t2.prototype.cursor = function(t3) {
    var e = "next";
    if (t3.reverse && (e = "prev"), t3.index) {
      var n = this.store.index(t3.index);
      return t3.kt ? n.openKeyCursor(t3.range, e) : n.openCursor(t3.range, e);
    }
    return this.store.openCursor(t3.range, e);
  }, t2;
}();
function Dr(t2) {
  return new br(function(e, n) {
    t2.onsuccess = function(t3) {
      var n2 = t3.target.result;
      e(n2);
    }, t2.onerror = function(t3) {
      var e2 = kr(t3.target.error);
      n(e2);
    };
  });
}
var Ar = false;
function kr(t2) {
  var e = Er._t(getUA());
  if (e >= 12.2 && e < 13) {
    var n = "An internal error was encountered in the Indexed Database server";
    if (t2.message.indexOf(n) >= 0) {
      var r = new N2("internal", "IOS_INDEXEDDB_BUG1: IndexedDb has thrown '" + n + "'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
      return Ar || (Ar = true, setTimeout(function() {
        throw r;
      }, 0)), r;
    }
  }
  return t2;
}
var Cr = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).Mt = t2, r.currentSequenceNumber = n2, r;
  }
  return __extends(n, e), n;
}(gr);
function xr(t2, e) {
  var n = P2(t2);
  return Er.It(n.Mt, e);
}
var Rr = function() {
  function t2(t3, e, n, r) {
    this.batchId = t3, this.localWriteTime = e, this.baseMutations = n, this.mutations = r;
  }
  return t2.prototype.applyToRemoteDocument = function(t3, e) {
    for (var n = e.mutationResults, r = 0; r < this.mutations.length; r++) {
      var i = this.mutations[r];
      i.key.isEqual(t3.key) && ke(i, t3, n[r]);
    }
  }, t2.prototype.applyToLocalView = function(t3) {
    for (var e = 0, n = this.baseMutations; e < n.length; e++) {
      (o = n[e]).key.isEqual(t3.key) && Ce(o, t3, this.localWriteTime);
    }
    for (var r = 0, i = this.mutations; r < i.length; r++) {
      var o;
      (o = i[r]).key.isEqual(t3.key) && Ce(o, t3, this.localWriteTime);
    }
  }, t2.prototype.applyToLocalDocumentSet = function(t3) {
    var e = this;
    this.mutations.forEach(function(n) {
      var r = t3.get(n.key), i = r;
      e.applyToLocalView(i), r.isValidDocument() || i.convertToNoDocument(j.min());
    });
  }, t2.prototype.keys = function() {
    return this.mutations.reduce(function(t3, e) {
      return t3.add(e.key);
    }, on());
  }, t2.prototype.isEqual = function(t3) {
    return this.batchId === t3.batchId && q2(this.mutations, t3.mutations, function(t4, e) {
      return Re(t4, e);
    }) && q2(this.baseMutations, t3.baseMutations, function(t4, e) {
      return Re(t4, e);
    });
  }, t2;
}();
var Lr = function() {
  function t2(t3, e, n, r) {
    this.batch = t3, this.commitVersion = e, this.mutationResults = n, this.docVersions = r;
  }
  return t2.from = function(e, n, r) {
    O2(e.mutations.length === r.length);
    for (var i = nn(), o = e.mutations, s = 0; s < o.length; s++)
      i = i.insert(o[s].key, r[s].version);
    return new t2(e, n, r, i);
  }, t2;
}();
var Or = function() {
  function t2(t3, e, n, r, i, o, s) {
    i === void 0 && (i = j.min()), o === void 0 && (o = j.min()), s === void 0 && (s = X2.EMPTY_BYTE_STRING), this.target = t3, this.targetId = e, this.purpose = n, this.sequenceNumber = r, this.snapshotVersion = i, this.lastLimboFreeSnapshotVersion = o, this.resumeToken = s;
  }
  return t2.prototype.withSequenceNumber = function(e) {
    return new t2(this.target, this.targetId, this.purpose, e, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken);
  }, t2.prototype.withResumeToken = function(e, n) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, n, this.lastLimboFreeSnapshotVersion, e);
  }, t2.prototype.withLastLimboFreeSnapshotVersion = function(e) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, e, this.resumeToken);
  }, t2;
}();
var Pr = function(t2) {
  this.Lt = t2;
};
function Fr(t2, e) {
  if (e.document)
    return Ln(t2.Lt, e.document, !!e.hasCommittedMutations);
  if (e.noDocument) {
    var n = at.fromSegments(e.noDocument.path), r = Br(e.noDocument.readTime), i = St.newNoDocument(n, r);
    return e.hasCommittedMutations ? i.setHasCommittedMutations() : i;
  }
  if (e.unknownDocument) {
    var o = at.fromSegments(e.unknownDocument.path);
    r = Br(e.unknownDocument.version);
    return St.newUnknownDocument(o, r);
  }
  return L2();
}
function Mr(t2, e, n) {
  var r = Vr(n), i = e.key.path.popLast().toArray();
  if (e.isFoundDocument()) {
    var o = function(t3, e2) {
      return {
        name: Nn(t3, e2.key),
        fields: e2.data.value.mapValue.fields,
        updateTime: bn(t3, e2.version.toTimestamp())
      };
    }(t2.Lt, e), s = e.hasCommittedMutations;
    return new ur(null, null, o, s, r, i);
  }
  if (e.isNoDocument()) {
    var u = e.key.path.toArray(), a = Ur(e.version);
    s = e.hasCommittedMutations;
    return new ur(null, new or(u, a), null, s, r, i);
  }
  if (e.isUnknownDocument()) {
    var c = e.key.path.toArray(), h = Ur(e.version);
    return new ur(new sr(c, h), null, null, true, r, i);
  }
  return L2();
}
function Vr(t2) {
  var e = t2.toTimestamp();
  return [e.seconds, e.nanoseconds];
}
function qr(t2) {
  var e = new B2(t2[0], t2[1]);
  return j.fromTimestamp(e);
}
function Ur(t2) {
  var e = t2.toTimestamp();
  return new tr(e.seconds, e.nanoseconds);
}
function Br(t2) {
  var e = new B2(t2.seconds, t2.nanoseconds);
  return j.fromTimestamp(e);
}
function jr(t2, e) {
  for (var n = (e.baseMutations || []).map(function(e2) {
    return Pn(t2.Lt, e2);
  }), r = 0; r < e.mutations.length - 1; ++r) {
    var i = e.mutations[r];
    if (r + 1 < e.mutations.length && e.mutations[r + 1].transform !== void 0) {
      var o = e.mutations[r + 1];
      i.updateTransforms = o.transform.fieldTransforms, e.mutations.splice(r + 1, 1), ++r;
    }
  }
  var s = e.mutations.map(function(e2) {
    return Pn(t2.Lt, e2);
  }), u = B2.fromMillis(e.localWriteTimeMs);
  return new Rr(e.batchId, u, n, s);
}
function Kr(t2) {
  var e, n, r = Br(t2.readTime), i = t2.lastLimboFreeSnapshotVersion !== void 0 ? Br(t2.lastLimboFreeSnapshotVersion) : j.min();
  return t2.query.documents !== void 0 ? (O2((n = t2.query).documents.length === 1), e = ee(Ht(kn(n.documents[0])))) : e = function(t3) {
    return ee(Vn(t3));
  }(t2.query), new Or(e, t2.targetId, 0, t2.lastListenSequenceNumber, r, i, X2.fromBase64String(t2.resumeToken));
}
function Qr(t2, e) {
  var n, r = Ur(e.snapshotVersion), i = Ur(e.lastLimboFreeSnapshotVersion);
  n = Ct(e.target) ? Fn(t2.Lt, e.target) : Mn(t2.Lt, e.target);
  var o = e.resumeToken.toBase64();
  return new cr(e.targetId, At(e.target), r, o, e.sequenceNumber, i, n);
}
function Gr(t2) {
  var e = Vn({
    parent: t2.parent,
    structuredQuery: t2.structuredQuery
  });
  return t2.limitType === "LAST" ? ne(e, e.limit, "L") : e;
}
var zr = function() {
  function t2() {
  }
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return Wr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          id: (e2 = t4).bundleId,
          createTime: Br(e2.createTime),
          version: e2.version
        };
      var e2;
    });
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    return Wr(t3).put({
      bundleId: (n = e).id,
      createTime: Ur(Tn(n.createTime)),
      version: n.version
    });
    var n;
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return Hr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          name: (e2 = t4).name,
          query: Gr(e2.bundledQuery),
          readTime: Br(e2.readTime)
        };
      var e2;
    });
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return Hr(t3).put(function(t4) {
      return {
        name: t4.name,
        readTime: Ur(Tn(t4.readTime)),
        bundledQuery: t4.bundledQuery
      };
    }(e));
  }, t2;
}();
function Wr(t2) {
  return xr(t2, pr.store);
}
function Hr(t2) {
  return xr(t2, yr.store);
}
var Yr = function() {
  function t2() {
    this.Bt = new $r();
  }
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    return this.Bt.add(e), br.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    return br.resolve(this.Bt.getEntries(e));
  }, t2;
}();
var $r = function() {
  function t2() {
    this.index = {};
  }
  return t2.prototype.add = function(t3) {
    var e = t3.lastSegment(), n = t3.popLast(), r = this.index[e] || new Ye(W2.comparator), i = !r.has(n);
    return this.index[e] = r.add(n), i;
  }, t2.prototype.has = function(t3) {
    var e = t3.lastSegment(), n = t3.popLast(), r = this.index[e];
    return r && r.has(n);
  }, t2.prototype.getEntries = function(t3) {
    return (this.index[t3] || new Ye(W2.comparator)).toArray();
  }, t2;
}();
var Xr = function() {
  function t2() {
    this.qt = new $r();
  }
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    var n = this;
    if (!this.qt.has(e)) {
      var r = e.lastSegment(), i = e.popLast();
      t3.addOnCommittedListener(function() {
        n.qt.add(e);
      });
      var o = {
        collectionId: r,
        parent: $n(i)
      };
      return Jr(t3).put(o);
    }
    return br.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    var n = [], r = IDBKeyRange.bound([e, ""], [U2(e), ""], false, true);
    return Jr(t3).Nt(r).next(function(t4) {
      for (var r2 = 0, i = t4; r2 < i.length; r2++) {
        var o = i[r2];
        if (o.collectionId !== e)
          break;
        n.push(Zn(o.parent));
      }
      return n;
    });
  }, t2;
}();
function Jr(t2) {
  return xr(t2, lr.store);
}
var Zr = {
  didRun: false,
  sequenceNumbersCollected: 0,
  targetsRemoved: 0,
  documentsRemoved: 0
};
var ti = function() {
  function t2(t3, e, n) {
    this.cacheSizeCollectionThreshold = t3, this.percentileToCollect = e, this.maximumSequenceNumbersToCollect = n;
  }
  return t2.withCacheSize = function(e) {
    return new t2(e, t2.DEFAULT_COLLECTION_PERCENTILE, t2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);
  }, t2;
}();
function ei(t2, e, n) {
  var r = t2.store(rr.store), i = t2.store(ir.store), o = [], s = IDBKeyRange.only(n.batchId), u = 0, a = r.$t({
    range: s
  }, function(t3, e2, n2) {
    return u++, n2.delete();
  });
  o.push(a.next(function() {
    O2(u === 1);
  }));
  for (var c = [], h = 0, f = n.mutations; h < f.length; h++) {
    var l2 = f[h], d2 = ir.key(e, l2.key.path, n.batchId);
    o.push(i.delete(d2)), c.push(l2.key);
  }
  return br.waitFor(o).next(function() {
    return c;
  });
}
function ni(t2) {
  if (!t2)
    return 0;
  var e;
  if (t2.document)
    e = t2.document;
  else if (t2.unknownDocument)
    e = t2.unknownDocument;
  else {
    if (!t2.noDocument)
      throw L2();
    e = t2.noDocument;
  }
  return JSON.stringify(e).length;
}
ti.DEFAULT_COLLECTION_PERCENTILE = 10, ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT = 1e3, ti.DEFAULT = new ti(41943040, ti.DEFAULT_COLLECTION_PERCENTILE, ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT), ti.DISABLED = new ti(-1, 0, 0);
var ri = function() {
  function t2(t3, e, n, r) {
    this.userId = t3, this.R = e, this.Ut = n, this.referenceDelegate = r, this.Kt = {};
  }
  return t2.Qt = function(e, n, r, i) {
    return O2(e.uid !== ""), new t2(e.isAuthenticated() ? e.uid : "", n, r, i);
  }, t2.prototype.checkEmpty = function(t3) {
    var e = true, n = IDBKeyRange.bound([this.userId, Number.NEGATIVE_INFINITY], [this.userId, Number.POSITIVE_INFINITY]);
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: n
    }, function(t4, n2, r) {
      e = false, r.done();
    }).next(function() {
      return e;
    });
  }, t2.prototype.addMutationBatch = function(t3, e, n, r) {
    var i = this, o = si(t3), s = oi(t3);
    return s.add({}).next(function(u) {
      O2(typeof u == "number");
      for (var a = new Rr(u, e, n, r), c = function(t4, e2, n2) {
        var r2 = n2.baseMutations.map(function(e3) {
          return On(t4.Lt, e3);
        }), i2 = n2.mutations.map(function(e3) {
          return On(t4.Lt, e3);
        });
        return new rr(e2, n2.batchId, n2.localWriteTime.toMillis(), r2, i2);
      }(i.R, i.userId, a), h = [], f = new Ye(function(t4, e2) {
        return V2(t4.canonicalString(), e2.canonicalString());
      }), l2 = 0, d2 = r; l2 < d2.length; l2++) {
        var p2 = d2[l2], y2 = ir.key(i.userId, p2.key.path, u);
        f = f.add(p2.key.path.popLast()), h.push(s.put(c)), h.push(o.put(y2, ir.PLACEHOLDER));
      }
      return f.forEach(function(e2) {
        h.push(i.Ut.addToCollectionParentIndex(t3, e2));
      }), t3.addOnCommittedListener(function() {
        i.Kt[u] = a.keys();
      }), br.waitFor(h).next(function() {
        return a;
      });
    });
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    var n = this;
    return oi(t3).get(e).next(function(t4) {
      return t4 ? (O2(t4.userId === n.userId), jr(n.R, t4)) : null;
    });
  }, t2.prototype.jt = function(t3, e) {
    var n = this;
    return this.Kt[e] ? br.resolve(this.Kt[e]) : this.lookupMutationBatch(t3, e).next(function(t4) {
      if (t4) {
        var r = t4.keys();
        return n.Kt[e] = r, r;
      }
      return null;
    });
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n = this, r = e + 1, i = IDBKeyRange.lowerBound([this.userId, r]), o = null;
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: i
    }, function(t4, e2, i2) {
      e2.userId === n.userId && (O2(e2.batchId >= r), o = jr(n.R, e2)), i2.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getHighestUnacknowledgedBatchId = function(t3) {
    var e = IDBKeyRange.upperBound([this.userId, Number.POSITIVE_INFINITY]), n = -1;
    return oi(t3).$t({
      index: rr.userMutationsIndex,
      range: e,
      reverse: true
    }, function(t4, e2, r) {
      n = e2.batchId, r.done();
    }).next(function() {
      return n;
    });
  }, t2.prototype.getAllMutationBatches = function(t3) {
    var e = this, n = IDBKeyRange.bound([this.userId, -1], [this.userId, Number.POSITIVE_INFINITY]);
    return oi(t3).Nt(rr.userMutationsIndex, n).next(function(t4) {
      return t4.map(function(t5) {
        return jr(e.R, t5);
      });
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n = this, r = ir.prefixForPath(this.userId, e.path), i = IDBKeyRange.lowerBound(r), o = [];
    return si(t3).$t({
      range: i
    }, function(r2, i2, s) {
      var u = r2[0], a = r2[1], c = r2[2], h = Zn(a);
      if (u === n.userId && e.path.isEqual(h))
        return oi(t3).get(c).next(function(t4) {
          if (!t4)
            throw L2();
          O2(t4.userId === n.userId), o.push(jr(n.R, t4));
        });
      s.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n = this, r = new Ye(V2), i = [];
    return e.forEach(function(e2) {
      var o = ir.prefixForPath(n.userId, e2.path), s = IDBKeyRange.lowerBound(o), u = si(t3).$t({
        range: s
      }, function(t4, i2, o2) {
        var s2 = t4[0], u2 = t4[1], a = t4[2], c = Zn(u2);
        s2 === n.userId && e2.path.isEqual(c) ? r = r.add(a) : o2.done();
      });
      i.push(u);
    }), br.waitFor(i).next(function() {
      return n.Wt(t3, r);
    });
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n = this, r = e.path, i = r.length + 1, o = ir.prefixForPath(this.userId, r), s = IDBKeyRange.lowerBound(o), u = new Ye(V2);
    return si(t3).$t({
      range: s
    }, function(t4, e2, o2) {
      var s2 = t4[0], a = t4[1], c = t4[2], h = Zn(a);
      s2 === n.userId && r.isPrefixOf(h) ? h.length === i && (u = u.add(c)) : o2.done();
    }).next(function() {
      return n.Wt(t3, u);
    });
  }, t2.prototype.Wt = function(t3, e) {
    var n = this, r = [], i = [];
    return e.forEach(function(e2) {
      i.push(oi(t3).get(e2).next(function(t4) {
        if (t4 === null)
          throw L2();
        O2(t4.userId === n.userId), r.push(jr(n.R, t4));
      }));
    }), br.waitFor(i).next(function() {
      return r;
    });
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n = this;
    return ei(t3.Mt, this.userId, e).next(function(r) {
      return t3.addOnCommittedListener(function() {
        n.Gt(e.batchId);
      }), br.forEach(r, function(e2) {
        return n.referenceDelegate.markPotentiallyOrphaned(t3, e2);
      });
    });
  }, t2.prototype.Gt = function(t3) {
    delete this.Kt[t3];
  }, t2.prototype.performConsistencyCheck = function(t3) {
    var e = this;
    return this.checkEmpty(t3).next(function(n) {
      if (!n)
        return br.resolve();
      var r = IDBKeyRange.lowerBound(ir.prefixForUser(e.userId)), i = [];
      return si(t3).$t({
        range: r
      }, function(t4, n2, r2) {
        if (t4[0] === e.userId) {
          var o = Zn(t4[1]);
          i.push(o);
        } else
          r2.done();
      }).next(function() {
        O2(i.length === 0);
      });
    });
  }, t2.prototype.containsKey = function(t3, e) {
    return ii(t3, this.userId, e);
  }, t2.prototype.zt = function(t3) {
    var e = this;
    return ui(t3).get(this.userId).next(function(t4) {
      return t4 || new nr(e.userId, -1, "");
    });
  }, t2;
}();
function ii(t2, e, n) {
  var r = ir.prefixForPath(e, n.path), i = r[1], o = IDBKeyRange.lowerBound(r), s = false;
  return si(t2).$t({
    range: o,
    kt: true
  }, function(t3, n2, r2) {
    var o2 = t3[0], u = t3[1];
    t3[2], o2 === e && u === i && (s = true), r2.done();
  }).next(function() {
    return s;
  });
}
function oi(t2) {
  return xr(t2, rr.store);
}
function si(t2) {
  return xr(t2, ir.store);
}
function ui(t2) {
  return xr(t2, nr.store);
}
var ai = function() {
  function t2(t3) {
    this.Ht = t3;
  }
  return t2.prototype.next = function() {
    return this.Ht += 2, this.Ht;
  }, t2.Jt = function() {
    return new t2(0);
  }, t2.Yt = function() {
    return new t2(-1);
  }, t2;
}();
var ci = function() {
  function t2(t3, e) {
    this.referenceDelegate = t3, this.R = e;
  }
  return t2.prototype.allocateTargetId = function(t3) {
    var e = this;
    return this.Xt(t3).next(function(n) {
      var r = new ai(n.highestTargetId);
      return n.highestTargetId = r.next(), e.Zt(t3, n).next(function() {
        return n.highestTargetId;
      });
    });
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return j.fromTimestamp(new B2(t4.lastRemoteSnapshotVersion.seconds, t4.lastRemoteSnapshotVersion.nanoseconds));
    });
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return t4.highestListenSequenceNumber;
    });
  }, t2.prototype.setTargetsMetadata = function(t3, e, n) {
    var r = this;
    return this.Xt(t3).next(function(i) {
      return i.highestListenSequenceNumber = e, n && (i.lastRemoteSnapshotVersion = n.toTimestamp()), e > i.highestListenSequenceNumber && (i.highestListenSequenceNumber = e), r.Zt(t3, i);
    });
  }, t2.prototype.addTargetData = function(t3, e) {
    var n = this;
    return this.te(t3, e).next(function() {
      return n.Xt(t3).next(function(r) {
        return r.targetCount += 1, n.ee(e, r), n.Zt(t3, r);
      });
    });
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.te(t3, e);
  }, t2.prototype.removeTargetData = function(t3, e) {
    var n = this;
    return this.removeMatchingKeysForTargetId(t3, e.targetId).next(function() {
      return hi(t3).delete(e.targetId);
    }).next(function() {
      return n.Xt(t3);
    }).next(function(e2) {
      return O2(e2.targetCount > 0), e2.targetCount -= 1, n.Zt(t3, e2);
    });
  }, t2.prototype.removeTargets = function(t3, e, n) {
    var r = this, i = 0, o = [];
    return hi(t3).$t(function(s, u) {
      var a = Kr(u);
      a.sequenceNumber <= e && n.get(a.targetId) === null && (i++, o.push(r.removeTargetData(t3, a)));
    }).next(function() {
      return br.waitFor(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return hi(t3).$t(function(t4, n) {
      var r = Kr(n);
      e(r);
    });
  }, t2.prototype.Xt = function(t3) {
    return fi(t3).get(fr.key).next(function(t4) {
      return O2(t4 !== null), t4;
    });
  }, t2.prototype.Zt = function(t3, e) {
    return fi(t3).put(fr.key, e);
  }, t2.prototype.te = function(t3, e) {
    return hi(t3).put(Qr(this.R, e));
  }, t2.prototype.ee = function(t3, e) {
    var n = false;
    return t3.targetId > e.highestTargetId && (e.highestTargetId = t3.targetId, n = true), t3.sequenceNumber > e.highestListenSequenceNumber && (e.highestListenSequenceNumber = t3.sequenceNumber, n = true), n;
  }, t2.prototype.getTargetCount = function(t3) {
    return this.Xt(t3).next(function(t4) {
      return t4.targetCount;
    });
  }, t2.prototype.getTargetData = function(t3, e) {
    var n = At(e), r = IDBKeyRange.bound([n, Number.NEGATIVE_INFINITY], [n, Number.POSITIVE_INFINITY]), i = null;
    return hi(t3).$t({
      range: r,
      index: cr.queryTargetsIndexName
    }, function(t4, n2, r2) {
      var o = Kr(n2);
      kt(e, o.target) && (i = o, r2.done());
    }).next(function() {
      return i;
    });
  }, t2.prototype.addMatchingKeys = function(t3, e, n) {
    var r = this, i = [], o = li(t3);
    return e.forEach(function(e2) {
      var s = $n(e2.path);
      i.push(o.put(new hr(n, s))), i.push(r.referenceDelegate.addReference(t3, n, e2));
    }), br.waitFor(i);
  }, t2.prototype.removeMatchingKeys = function(t3, e, n) {
    var r = this, i = li(t3);
    return br.forEach(e, function(e2) {
      var o = $n(e2.path);
      return br.waitFor([i.delete([n, o]), r.referenceDelegate.removeReference(t3, n, e2)]);
    });
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    var n = li(t3), r = IDBKeyRange.bound([e], [e + 1], false, true);
    return n.delete(r);
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n = IDBKeyRange.bound([e], [e + 1], false, true), r = li(t3), i = on();
    return r.$t({
      range: n,
      kt: true
    }, function(t4, e2, n2) {
      var r2 = Zn(t4[1]), o = new at(r2);
      i = i.add(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.containsKey = function(t3, e) {
    var n = $n(e.path), r = IDBKeyRange.bound([n], [U2(n)], false, true), i = 0;
    return li(t3).$t({
      index: hr.documentTargetsIndex,
      kt: true,
      range: r
    }, function(t4, e2, n2) {
      var r2 = t4[0];
      t4[1], r2 !== 0 && (i++, n2.done());
    }).next(function() {
      return i > 0;
    });
  }, t2.prototype.lt = function(t3, e) {
    return hi(t3).get(e).next(function(t4) {
      return t4 ? Kr(t4) : null;
    });
  }, t2;
}();
function hi(t2) {
  return xr(t2, cr.store);
}
function fi(t2) {
  return xr(t2, fr.store);
}
function li(t2) {
  return xr(t2, hr.store);
}
function di(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      if (t2.code !== S2.FAILED_PRECONDITION || t2.message !== mr)
        throw t2;
      return k2("LocalStore", "Unexpectedly lost primary lease"), [2];
    });
  });
}
function pi(t2, e) {
  var n = t2[0], r = t2[1], i = e[0], o = e[1], s = V2(n, i);
  return s === 0 ? V2(r, o) : s;
}
var yi = function() {
  function t2(t3) {
    this.ne = t3, this.buffer = new Ye(pi), this.se = 0;
  }
  return t2.prototype.ie = function() {
    return ++this.se;
  }, t2.prototype.re = function(t3) {
    var e = [t3, this.ie()];
    if (this.buffer.size < this.ne)
      this.buffer = this.buffer.add(e);
    else {
      var n = this.buffer.last();
      pi(e, n) < 0 && (this.buffer = this.buffer.delete(n).add(e));
    }
  }, Object.defineProperty(t2.prototype, "maxValue", {
    get: function() {
      return this.buffer.last()[0];
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var vi = function() {
  function t2(t3, e) {
    this.garbageCollector = t3, this.asyncQueue = e, this.oe = false, this.ce = null;
  }
  return t2.prototype.start = function(t3) {
    this.garbageCollector.params.cacheSizeCollectionThreshold !== -1 && this.ue(t3);
  }, t2.prototype.stop = function() {
    this.ce && (this.ce.cancel(), this.ce = null);
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.ce !== null;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.ue = function(t3) {
    var e = this, i = this.oe ? 3e5 : 6e4;
    k2("LruGarbageCollector", "Garbage collection scheduled in " + i + "ms"), this.ce = this.asyncQueue.enqueueAfterDelay("lru_garbage_collection", i, function() {
      return __awaiter(e, void 0, void 0, function() {
        var e2;
        return __generator(this, function(n) {
          switch (n.label) {
            case 0:
              this.ce = null, this.oe = true, n.label = 1;
            case 1:
              return n.trys.push([1, 3, , 7]), [4, t3.collectGarbage(this.garbageCollector)];
            case 2:
              return n.sent(), [3, 7];
            case 3:
              return Sr(e2 = n.sent()) ? (k2("LruGarbageCollector", "Ignoring IndexedDB error during garbage collection: ", e2), [3, 6]) : [3, 4];
            case 4:
              return [4, di(e2)];
            case 5:
              n.sent(), n.label = 6;
            case 6:
              return [3, 7];
            case 7:
              return [4, this.ue(t3)];
            case 8:
              return n.sent(), [2];
          }
        });
      });
    });
  }, t2;
}();
var mi = function() {
  function t2(t3, e) {
    this.ae = t3, this.params = e;
  }
  return t2.prototype.calculateTargetCount = function(t3, e) {
    return this.ae.he(t3).next(function(t4) {
      return Math.floor(e / 100 * t4);
    });
  }, t2.prototype.nthSequenceNumber = function(t3, e) {
    var n = this;
    if (e === 0)
      return br.resolve(_.o);
    var r = new yi(e);
    return this.ae.forEachTarget(t3, function(t4) {
      return r.re(t4.sequenceNumber);
    }).next(function() {
      return n.ae.le(t3, function(t4) {
        return r.re(t4);
      });
    }).next(function() {
      return r.maxValue;
    });
  }, t2.prototype.removeTargets = function(t3, e, n) {
    return this.ae.removeTargets(t3, e, n);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    return this.ae.removeOrphanedDocuments(t3, e);
  }, t2.prototype.collect = function(t3, e) {
    var n = this;
    return this.params.cacheSizeCollectionThreshold === -1 ? (k2("LruGarbageCollector", "Garbage collection skipped; disabled"), br.resolve(Zr)) : this.getCacheSize(t3).next(function(r) {
      return r < n.params.cacheSizeCollectionThreshold ? (k2("LruGarbageCollector", "Garbage collection skipped; Cache size " + r + " is lower than threshold " + n.params.cacheSizeCollectionThreshold), Zr) : n.fe(t3, e);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.ae.getCacheSize(t3);
  }, t2.prototype.fe = function(t3, e) {
    var n, r, i, o, s, u, a, c = this, h = Date.now();
    return this.calculateTargetCount(t3, this.params.percentileToCollect).next(function(e2) {
      return e2 > c.params.maximumSequenceNumbersToCollect ? (k2("LruGarbageCollector", "Capping sequence numbers to collect down to the maximum of " + c.params.maximumSequenceNumbersToCollect + " from " + e2), r = c.params.maximumSequenceNumbersToCollect) : r = e2, o = Date.now(), c.nthSequenceNumber(t3, r);
    }).next(function(r2) {
      return n = r2, s = Date.now(), c.removeTargets(t3, n, e);
    }).next(function(e2) {
      return i = e2, u = Date.now(), c.removeOrphanedDocuments(t3, n);
    }).next(function(t4) {
      return a = Date.now(), A2() <= LogLevel.DEBUG && k2("LruGarbageCollector", "LRU Garbage Collection\n	Counted targets in " + (o - h) + "ms\n	Determined least recently used " + r + " in " + (s - o) + "ms\n	Removed " + i + " targets in " + (u - s) + "ms\n	Removed " + t4 + " documents in " + (a - u) + "ms\nTotal Duration: " + (a - h) + "ms"), br.resolve({
        didRun: true,
        sequenceNumbersCollected: r,
        targetsRemoved: i,
        documentsRemoved: t4
      });
    });
  }, t2;
}();
var gi = function() {
  function t2(t3, e) {
    this.db = t3, this.garbageCollector = function(t4, e2) {
      return new mi(t4, e2);
    }(this, e);
  }
  return t2.prototype.he = function(t3) {
    var e = this.de(t3);
    return this.db.getTargetCache().getTargetCount(t3).next(function(t4) {
      return e.next(function(e2) {
        return t4 + e2;
      });
    });
  }, t2.prototype.de = function(t3) {
    var e = 0;
    return this.le(t3, function(t4) {
      e++;
    }).next(function() {
      return e;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return this.db.getTargetCache().forEachTarget(t3, e);
  }, t2.prototype.le = function(t3, e) {
    return this.we(t3, function(t4, n) {
      return e(n);
    });
  }, t2.prototype.addReference = function(t3, e, n) {
    return wi(t3, n);
  }, t2.prototype.removeReference = function(t3, e, n) {
    return wi(t3, n);
  }, t2.prototype.removeTargets = function(t3, e, n) {
    return this.db.getTargetCache().removeTargets(t3, e, n);
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return wi(t3, e);
  }, t2.prototype._e = function(t3, e) {
    return function(t4, e2) {
      var n = false;
      return ui(t4).Ot(function(r) {
        return ii(t4, r, e2).next(function(t5) {
          return t5 && (n = true), br.resolve(!t5);
        });
      }).next(function() {
        return n;
      });
    }(t3, e);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    var n = this, r = this.db.getRemoteDocumentCache().newChangeBuffer(), i = [], o = 0;
    return this.we(t3, function(s, u) {
      if (u <= e) {
        var a = n._e(t3, s).next(function(e2) {
          if (!e2)
            return o++, r.getEntry(t3, s).next(function() {
              return r.removeEntry(s), li(t3).delete([0, $n(s.path)]);
            });
        });
        i.push(a);
      }
    }).next(function() {
      return br.waitFor(i);
    }).next(function() {
      return r.apply(t3);
    }).next(function() {
      return o;
    });
  }, t2.prototype.removeTarget = function(t3, e) {
    var n = e.withSequenceNumber(t3.currentSequenceNumber);
    return this.db.getTargetCache().updateTargetData(t3, n);
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    return wi(t3, e);
  }, t2.prototype.we = function(t3, e) {
    var n, r = li(t3), i = _.o;
    return r.$t({
      index: hr.documentTargetsIndex
    }, function(t4, r2) {
      var o = t4[0];
      t4[1];
      var s = r2.path, u = r2.sequenceNumber;
      o === 0 ? (i !== _.o && e(new at(Zn(n)), i), i = u, n = s) : i = _.o;
    }).next(function() {
      i !== _.o && e(new at(Zn(n)), i);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.db.getRemoteDocumentCache().getSize(t3);
  }, t2;
}();
function wi(t2, e) {
  return li(t2).put(function(t3, e2) {
    return new hr(0, $n(t3.path), e2);
  }(e, t2.currentSequenceNumber));
}
var bi = function() {
  function t2(t3, e) {
    this.mapKeyFn = t3, this.equalsFn = e, this.inner = {};
  }
  return t2.prototype.get = function(t3) {
    var e = this.mapKeyFn(t3), n = this.inner[e];
    if (n !== void 0)
      for (var r = 0, i = n; r < i.length; r++) {
        var o = i[r], s = o[0], u = o[1];
        if (this.equalsFn(s, t3))
          return u;
      }
  }, t2.prototype.has = function(t3) {
    return this.get(t3) !== void 0;
  }, t2.prototype.set = function(t3, e) {
    var n = this.mapKeyFn(t3), r = this.inner[n];
    if (r !== void 0) {
      for (var i = 0; i < r.length; i++)
        if (this.equalsFn(r[i][0], t3))
          return void (r[i] = [t3, e]);
      r.push([t3, e]);
    } else
      this.inner[n] = [[t3, e]];
  }, t2.prototype.delete = function(t3) {
    var e = this.mapKeyFn(t3), n = this.inner[e];
    if (n === void 0)
      return false;
    for (var r = 0; r < n.length; r++)
      if (this.equalsFn(n[r][0], t3))
        return n.length === 1 ? delete this.inner[e] : n.splice(r, 1), true;
    return false;
  }, t2.prototype.forEach = function(t3) {
    Q2(this.inner, function(e, n) {
      for (var r = 0, i = n; r < i.length; r++) {
        var o = i[r], s = o[0], u = o[1];
        t3(s, u);
      }
    });
  }, t2.prototype.isEmpty = function() {
    return G(this.inner);
  }, t2;
}();
var Ii = function() {
  function t2() {
    this.changes = new bi(function(t3) {
      return t3.toString();
    }, function(t3, e) {
      return t3.isEqual(e);
    }), this.changesApplied = false;
  }
  return t2.prototype.getReadTime = function(t3) {
    var e = this.changes.get(t3);
    return e ? e.readTime : j.min();
  }, t2.prototype.addEntry = function(t3, e) {
    this.assertNotApplied(), this.changes.set(t3.key, {
      document: t3,
      readTime: e
    });
  }, t2.prototype.removeEntry = function(t3, e) {
    e === void 0 && (e = null), this.assertNotApplied(), this.changes.set(t3, {
      document: St.newInvalidDocument(t3),
      readTime: e
    });
  }, t2.prototype.getEntry = function(t3, e) {
    this.assertNotApplied();
    var n = this.changes.get(e);
    return n !== void 0 ? br.resolve(n.document) : this.getFromCache(t3, e);
  }, t2.prototype.getEntries = function(t3, e) {
    return this.getAllFromCache(t3, e);
  }, t2.prototype.apply = function(t3) {
    return this.assertNotApplied(), this.changesApplied = true, this.applyChanges(t3);
  }, t2.prototype.assertNotApplied = function() {
  }, t2;
}();
var Ei = function() {
  function t2(t3, e) {
    this.R = t3, this.Ut = e;
  }
  return t2.prototype.addEntry = function(t3, e, n) {
    return Si(t3).put(Ni(e), n);
  }, t2.prototype.removeEntry = function(t3, e) {
    var n = Si(t3), r = Ni(e);
    return n.delete(r);
  }, t2.prototype.updateMetadata = function(t3, e) {
    var n = this;
    return this.getMetadata(t3).next(function(r) {
      return r.byteSize += e, n.me(t3, r);
    });
  }, t2.prototype.getEntry = function(t3, e) {
    var n = this;
    return Si(t3).get(Ni(e)).next(function(t4) {
      return n.ye(e, t4);
    });
  }, t2.prototype.ge = function(t3, e) {
    var n = this;
    return Si(t3).get(Ni(e)).next(function(t4) {
      return {
        document: n.ye(e, t4),
        size: ni(t4)
      };
    });
  }, t2.prototype.getEntries = function(t3, e) {
    var n = this, r = Je();
    return this.pe(t3, e, function(t4, e2) {
      var i = n.ye(t4, e2);
      r = r.insert(t4, i);
    }).next(function() {
      return r;
    });
  }, t2.prototype.Ee = function(t3, e) {
    var n = this, r = Je(), i = new ze(at.comparator);
    return this.pe(t3, e, function(t4, e2) {
      var o = n.ye(t4, e2);
      r = r.insert(t4, o), i = i.insert(t4, ni(e2));
    }).next(function() {
      return {
        documents: r,
        Te: i
      };
    });
  }, t2.prototype.pe = function(t3, e, n) {
    if (e.isEmpty())
      return br.resolve();
    var r = IDBKeyRange.bound(e.first().path.toArray(), e.last().path.toArray()), i = e.getIterator(), o = i.getNext();
    return Si(t3).$t({
      range: r
    }, function(t4, e2, r2) {
      for (var s = at.fromSegments(t4); o && at.comparator(o, s) < 0; )
        n(o, null), o = i.getNext();
      o && o.isEqual(s) && (n(o, e2), o = i.hasNext() ? i.getNext() : null), o ? r2.Ct(o.path.toArray()) : r2.done();
    }).next(function() {
      for (; o; )
        n(o, null), o = i.hasNext() ? i.getNext() : null;
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n) {
    var r = this, i = Je(), o = e.path.length + 1, s = {};
    if (n.isEqual(j.min())) {
      var u = e.path.toArray();
      s.range = IDBKeyRange.lowerBound(u);
    } else {
      var a = e.path.toArray(), c = Vr(n);
      s.range = IDBKeyRange.lowerBound([a, c], true), s.index = ur.collectionReadTimeIndex;
    }
    return Si(t3).$t(s, function(t4, n2, s2) {
      if (t4.length === o) {
        var u2 = Fr(r.R, n2);
        e.path.isPrefixOf(u2.key.path) ? se(e, u2) && (i = i.insert(u2.key, u2)) : s2.done();
      }
    }).next(function() {
      return i;
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new Ti(this, !!t3 && t3.trackRemovals);
  }, t2.prototype.getSize = function(t3) {
    return this.getMetadata(t3).next(function(t4) {
      return t4.byteSize;
    });
  }, t2.prototype.getMetadata = function(t3) {
    return _i(t3).get(ar.key).next(function(t4) {
      return O2(!!t4), t4;
    });
  }, t2.prototype.me = function(t3, e) {
    return _i(t3).put(ar.key, e);
  }, t2.prototype.ye = function(t3, e) {
    if (e) {
      var n = Fr(this.R, e);
      if (!n.isNoDocument() || !n.version.isEqual(j.min()))
        return n;
    }
    return St.newInvalidDocument(t3);
  }, t2;
}();
var Ti = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).Ie = t2, r.trackRemovals = n2, r.Ae = new bi(function(t3) {
      return t3.toString();
    }, function(t3, e2) {
      return t3.isEqual(e2);
    }), r;
  }
  return __extends(n, e), n.prototype.applyChanges = function(t2) {
    var e2 = this, n2 = [], r = 0, i = new Ye(function(t3, e3) {
      return V2(t3.canonicalString(), e3.canonicalString());
    });
    return this.changes.forEach(function(o, s) {
      var u = e2.Ae.get(o);
      if (s.document.isValidDocument()) {
        var a = Mr(e2.Ie.R, s.document, e2.getReadTime(o));
        i = i.add(o.path.popLast());
        var c = ni(a);
        r += c - u, n2.push(e2.Ie.addEntry(t2, o, a));
      } else if (r -= u, e2.trackRemovals) {
        var h = Mr(e2.Ie.R, St.newNoDocument(o, j.min()), e2.getReadTime(o));
        n2.push(e2.Ie.addEntry(t2, o, h));
      } else
        n2.push(e2.Ie.removeEntry(t2, o));
    }), i.forEach(function(r2) {
      n2.push(e2.Ie.Ut.addToCollectionParentIndex(t2, r2));
    }), n2.push(this.Ie.updateMetadata(t2, r)), br.waitFor(n2);
  }, n.prototype.getFromCache = function(t2, e2) {
    var n2 = this;
    return this.Ie.ge(t2, e2).next(function(t3) {
      return n2.Ae.set(e2, t3.size), t3.document;
    });
  }, n.prototype.getAllFromCache = function(t2, e2) {
    var n2 = this;
    return this.Ie.Ee(t2, e2).next(function(t3) {
      var e3 = t3.documents;
      return t3.Te.forEach(function(t4, e4) {
        n2.Ae.set(t4, e4);
      }), e3;
    });
  }, n;
}(Ii);
function _i(t2) {
  return xr(t2, ar.store);
}
function Si(t2) {
  return xr(t2, ur.store);
}
function Ni(t2) {
  return t2.path.toArray();
}
var Di = function() {
  function t2(t3) {
    this.R = t3;
  }
  return t2.prototype.Rt = function(t3, e, n, r) {
    var i = this;
    O2(n < r && n >= 0 && r <= 11);
    var o = new Ir("createOrUpgrade", e);
    n < 1 && r >= 1 && (function(t4) {
      t4.createObjectStore(er.store);
    }(t3), function(t4) {
      t4.createObjectStore(nr.store, {
        keyPath: nr.keyPath
      }), t4.createObjectStore(rr.store, {
        keyPath: rr.keyPath,
        autoIncrement: true
      }).createIndex(rr.userMutationsIndex, rr.userMutationsKeyPath, {
        unique: true
      }), t4.createObjectStore(ir.store);
    }(t3), Ai(t3), function(t4) {
      t4.createObjectStore(ur.store);
    }(t3));
    var s = br.resolve();
    return n < 3 && r >= 3 && (n !== 0 && (function(t4) {
      t4.deleteObjectStore(hr.store), t4.deleteObjectStore(cr.store), t4.deleteObjectStore(fr.store);
    }(t3), Ai(t3)), s = s.next(function() {
      return function(t4) {
        var e2 = t4.store(fr.store), n2 = new fr(0, 0, j.min().toTimestamp(), 0);
        return e2.put(fr.key, n2);
      }(o);
    })), n < 4 && r >= 4 && (n !== 0 && (s = s.next(function() {
      return function(t4, e2) {
        return e2.store(rr.store).Nt().next(function(n2) {
          t4.deleteObjectStore(rr.store), t4.createObjectStore(rr.store, {
            keyPath: rr.keyPath,
            autoIncrement: true
          }).createIndex(rr.userMutationsIndex, rr.userMutationsKeyPath, {
            unique: true
          });
          var r2 = e2.store(rr.store), i2 = n2.map(function(t5) {
            return r2.put(t5);
          });
          return br.waitFor(i2);
        });
      }(t3, o);
    })), s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(dr.store, {
          keyPath: dr.keyPath
        });
      }(t3);
    })), n < 5 && r >= 5 && (s = s.next(function() {
      return i.Re(o);
    })), n < 6 && r >= 6 && (s = s.next(function() {
      return function(t4) {
        t4.createObjectStore(ar.store);
      }(t3), i.be(o);
    })), n < 7 && r >= 7 && (s = s.next(function() {
      return i.ve(o);
    })), n < 8 && r >= 8 && (s = s.next(function() {
      return i.Pe(t3, o);
    })), n < 9 && r >= 9 && (s = s.next(function() {
      !function(t4) {
        t4.objectStoreNames.contains("remoteDocumentChanges") && t4.deleteObjectStore("remoteDocumentChanges");
      }(t3), function(t4) {
        var e2 = t4.objectStore(ur.store);
        e2.createIndex(ur.readTimeIndex, ur.readTimeIndexPath, {
          unique: false
        }), e2.createIndex(ur.collectionReadTimeIndex, ur.collectionReadTimeIndexPath, {
          unique: false
        });
      }(e);
    })), n < 10 && r >= 10 && (s = s.next(function() {
      return i.Ve(o);
    })), n < 11 && r >= 11 && (s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(pr.store, {
          keyPath: pr.keyPath
        });
      }(t3), function(t4) {
        t4.createObjectStore(yr.store, {
          keyPath: yr.keyPath
        });
      }(t3);
    })), s;
  }, t2.prototype.be = function(t3) {
    var e = 0;
    return t3.store(ur.store).$t(function(t4, n) {
      e += ni(n);
    }).next(function() {
      var n = new ar(e);
      return t3.store(ar.store).put(ar.key, n);
    });
  }, t2.prototype.Re = function(t3) {
    var e = this, n = t3.store(nr.store), r = t3.store(rr.store);
    return n.Nt().next(function(n2) {
      return br.forEach(n2, function(n3) {
        var i = IDBKeyRange.bound([n3.userId, -1], [n3.userId, n3.lastAcknowledgedBatchId]);
        return r.Nt(rr.userMutationsIndex, i).next(function(r2) {
          return br.forEach(r2, function(r3) {
            O2(r3.userId === n3.userId);
            var i2 = jr(e.R, r3);
            return ei(t3, n3.userId, i2).next(function() {
            });
          });
        });
      });
    });
  }, t2.prototype.ve = function(t3) {
    var e = t3.store(hr.store), n = t3.store(ur.store);
    return t3.store(fr.store).get(fr.key).next(function(t4) {
      var r = [];
      return n.$t(function(n2, i) {
        var o = new W2(n2), s = function(t5) {
          return [0, $n(t5)];
        }(o);
        r.push(e.get(s).next(function(n3) {
          return n3 ? br.resolve() : function(n4) {
            return e.put(new hr(0, $n(n4), t4.highestListenSequenceNumber));
          }(o);
        }));
      }).next(function() {
        return br.waitFor(r);
      });
    });
  }, t2.prototype.Pe = function(t3, e) {
    t3.createObjectStore(lr.store, {
      keyPath: lr.keyPath
    });
    var n = e.store(lr.store), r = new $r(), i = function(t4) {
      if (r.add(t4)) {
        var e2 = t4.lastSegment(), i2 = t4.popLast();
        return n.put({
          collectionId: e2,
          parent: $n(i2)
        });
      }
    };
    return e.store(ur.store).$t({
      kt: true
    }, function(t4, e2) {
      var n2 = new W2(t4);
      return i(n2.popLast());
    }).next(function() {
      return e.store(ir.store).$t({
        kt: true
      }, function(t4, e2) {
        t4[0];
        var n2 = t4[1];
        t4[2];
        var r2 = Zn(n2);
        return i(r2.popLast());
      });
    });
  }, t2.prototype.Ve = function(t3) {
    var e = this, n = t3.store(cr.store);
    return n.$t(function(t4, r) {
      var i = Kr(r), o = Qr(e.R, i);
      return n.put(o);
    });
  }, t2;
}();
function Ai(t2) {
  t2.createObjectStore(hr.store, {
    keyPath: hr.keyPath
  }).createIndex(hr.documentTargetsIndex, hr.documentTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(cr.store, {
    keyPath: cr.keyPath
  }).createIndex(cr.queryTargetsIndexName, cr.queryTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(fr.store);
}
var ki = "Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";
var Ci = function() {
  function t2(e, n, r, i, o, s, u, a, c, h) {
    if (this.allowTabSynchronization = e, this.persistenceKey = n, this.clientId = r, this.Se = o, this.window = s, this.document = u, this.De = c, this.Ce = h, this.Ne = null, this.xe = false, this.isPrimary = false, this.networkEnabled = true, this.Fe = null, this.inForeground = false, this.ke = null, this.$e = null, this.Oe = Number.NEGATIVE_INFINITY, this.Me = function(t3) {
      return Promise.resolve();
    }, !t2.yt())
      throw new N2(S2.UNIMPLEMENTED, "This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");
    this.referenceDelegate = new gi(this, i), this.Le = n + "main", this.R = new Pr(a), this.Be = new Er(this.Le, 11, new Di(this.R)), this.qe = new ci(this.referenceDelegate, this.R), this.Ut = new Xr(), this.Ue = function(t3, e2) {
      return new Ei(t3, e2);
    }(this.R, this.Ut), this.Ke = new zr(), this.window && this.window.localStorage ? this.Qe = this.window.localStorage : (this.Qe = null, h === false && C2("IndexedDbPersistence", "LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."));
  }
  return t2.prototype.start = function() {
    var t3 = this;
    return this.je().then(function() {
      if (!t3.isPrimary && !t3.allowTabSynchronization)
        throw new N2(S2.FAILED_PRECONDITION, ki);
      return t3.We(), t3.Ge(), t3.ze(), t3.runTransaction("getHighestListenSequenceNumber", "readonly", function(e) {
        return t3.qe.getHighestSequenceNumber(e);
      });
    }).then(function(e) {
      t3.Ne = new _(e, t3.De);
    }).then(function() {
      t3.xe = true;
    }).catch(function(e) {
      return t3.Be && t3.Be.close(), Promise.reject(e);
    });
  }, t2.prototype.He = function(t3) {
    var e = this;
    return this.Me = function(i) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          return this.started ? [2, t3(i)] : [2];
        });
      });
    }, t3(this.isPrimary);
  }, t2.prototype.setDatabaseDeletedListener = function(t3) {
    var e = this;
    this.Be.vt(function(i) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return i.newVersion === null ? [4, t3()] : [3, 2];
            case 1:
              e2.sent(), e2.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }, t2.prototype.setNetworkEnabled = function(t3) {
    var e = this;
    this.networkEnabled !== t3 && (this.networkEnabled = t3, this.Se.enqueueAndForget(function() {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return this.started ? [4, this.je()] : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    }));
  }, t2.prototype.je = function() {
    var t3 = this;
    return this.runTransaction("updateClientMetadataAndTryBecomePrimary", "readwrite", function(e) {
      return Ri(e).put(new dr(t3.clientId, Date.now(), t3.networkEnabled, t3.inForeground)).next(function() {
        if (t3.isPrimary)
          return t3.Je(e).next(function(e2) {
            e2 || (t3.isPrimary = false, t3.Se.enqueueRetryable(function() {
              return t3.Me(false);
            }));
          });
      }).next(function() {
        return t3.Ye(e);
      }).next(function(n) {
        return t3.isPrimary && !n ? t3.Xe(e).next(function() {
          return false;
        }) : !!n && t3.Ze(e).next(function() {
          return true;
        });
      });
    }).catch(function(e) {
      if (Sr(e))
        return k2("IndexedDbPersistence", "Failed to extend owner lease: ", e), t3.isPrimary;
      if (!t3.allowTabSynchronization)
        throw e;
      return k2("IndexedDbPersistence", "Releasing owner lease after error during lease refresh", e), false;
    }).then(function(e) {
      t3.isPrimary !== e && t3.Se.enqueueRetryable(function() {
        return t3.Me(e);
      }), t3.isPrimary = e;
    });
  }, t2.prototype.Je = function(t3) {
    var e = this;
    return xi(t3).get(er.key).next(function(t4) {
      return br.resolve(e.tn(t4));
    });
  }, t2.prototype.en = function(t3) {
    return Ri(t3).delete(this.clientId);
  }, t2.prototype.nn = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n, i, o = this;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return !this.isPrimary || this.sn(this.Oe, 18e5) ? [3, 2] : (this.Oe = Date.now(), [4, this.runTransaction("maybeGarbageCollectMultiClientState", "readwrite-primary", function(t4) {
              var e2 = xr(t4, dr.store);
              return e2.Nt().next(function(t5) {
                var n2 = o.rn(t5, 18e5), r2 = t5.filter(function(t6) {
                  return n2.indexOf(t6) === -1;
                });
                return br.forEach(r2, function(t6) {
                  return e2.delete(t6.clientId);
                }).next(function() {
                  return r2;
                });
              });
            }).catch(function() {
              return [];
            })]);
          case 1:
            if (t3 = r.sent(), this.Qe)
              for (e = 0, n = t3; e < n.length; e++)
                i = n[e], this.Qe.removeItem(this.on(i.clientId));
            r.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.ze = function() {
    var t3 = this;
    this.$e = this.Se.enqueueAfterDelay("client_metadata_refresh", 4e3, function() {
      return t3.je().then(function() {
        return t3.nn();
      }).then(function() {
        return t3.ze();
      });
    });
  }, t2.prototype.tn = function(t3) {
    return !!t3 && t3.ownerId === this.clientId;
  }, t2.prototype.Ye = function(t3) {
    var e = this;
    return this.Ce ? br.resolve(true) : xi(t3).get(er.key).next(function(n) {
      if (n !== null && e.sn(n.leaseTimestampMs, 5e3) && !e.cn(n.ownerId)) {
        if (e.tn(n) && e.networkEnabled)
          return true;
        if (!e.tn(n)) {
          if (!n.allowTabSynchronization)
            throw new N2(S2.FAILED_PRECONDITION, ki);
          return false;
        }
      }
      return !(!e.networkEnabled || !e.inForeground) || Ri(t3).Nt().next(function(t4) {
        return e.rn(t4, 5e3).find(function(t5) {
          if (e.clientId !== t5.clientId) {
            var n2 = !e.networkEnabled && t5.networkEnabled, r = !e.inForeground && t5.inForeground, i = e.networkEnabled === t5.networkEnabled;
            if (n2 || r && i)
              return true;
          }
          return false;
        }) === void 0;
      });
    }).next(function(t4) {
      return e.isPrimary !== t4 && k2("IndexedDbPersistence", "Client " + (t4 ? "is" : "is not") + " eligible for a primary lease."), t4;
    });
  }, t2.prototype.shutdown = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3 = this;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.xe = false, this.un(), this.$e && (this.$e.cancel(), this.$e = null), this.an(), this.hn(), [4, this.Be.runTransaction("shutdown", "readwrite", [er.store, dr.store], function(e2) {
              var n = new Cr(e2, _.o);
              return t3.Xe(n).next(function() {
                return t3.en(n);
              });
            })];
          case 1:
            return e.sent(), this.Be.close(), this.ln(), [2];
        }
      });
    });
  }, t2.prototype.rn = function(t3, e) {
    var n = this;
    return t3.filter(function(t4) {
      return n.sn(t4.updateTimeMs, e) && !n.cn(t4.clientId);
    });
  }, t2.prototype.fn = function() {
    var t3 = this;
    return this.runTransaction("getActiveClients", "readonly", function(e) {
      return Ri(e).Nt().next(function(e2) {
        return t3.rn(e2, 18e5).map(function(t4) {
          return t4.clientId;
        });
      });
    });
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.xe;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.getMutationQueue = function(t3) {
    return ri.Qt(t3, this.R, this.Ut, this.referenceDelegate);
  }, t2.prototype.getTargetCache = function() {
    return this.qe;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.Ue;
  }, t2.prototype.getIndexManager = function() {
    return this.Ut;
  }, t2.prototype.getBundleCache = function() {
    return this.Ke;
  }, t2.prototype.runTransaction = function(t3, e, n) {
    var r = this;
    k2("IndexedDbPersistence", "Starting transaction:", t3);
    var i, o = e === "readonly" ? "readonly" : "readwrite";
    return this.Be.runTransaction(t3, o, vr, function(o2) {
      return i = new Cr(o2, r.Ne ? r.Ne.next() : _.o), e === "readwrite-primary" ? r.Je(i).next(function(t4) {
        return !!t4 || r.Ye(i);
      }).next(function(e2) {
        if (!e2)
          throw C2("Failed to obtain primary lease for action '" + t3 + "'."), r.isPrimary = false, r.Se.enqueueRetryable(function() {
            return r.Me(false);
          }), new N2(S2.FAILED_PRECONDITION, mr);
        return n(i);
      }).next(function(t4) {
        return r.Ze(i).next(function() {
          return t4;
        });
      }) : r.dn(i).next(function() {
        return n(i);
      });
    }).then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.dn = function(t3) {
    var e = this;
    return xi(t3).get(er.key).next(function(t4) {
      if (t4 !== null && e.sn(t4.leaseTimestampMs, 5e3) && !e.cn(t4.ownerId) && !e.tn(t4) && !(e.Ce || e.allowTabSynchronization && t4.allowTabSynchronization))
        throw new N2(S2.FAILED_PRECONDITION, ki);
    });
  }, t2.prototype.Ze = function(t3) {
    var e = new er(this.clientId, this.allowTabSynchronization, Date.now());
    return xi(t3).put(er.key, e);
  }, t2.yt = function() {
    return Er.yt();
  }, t2.prototype.Xe = function(t3) {
    var e = this, n = xi(t3);
    return n.get(er.key).next(function(t4) {
      return e.tn(t4) ? (k2("IndexedDbPersistence", "Releasing primary lease."), n.delete(er.key)) : br.resolve();
    });
  }, t2.prototype.sn = function(t3, e) {
    var n = Date.now();
    return !(t3 < n - e || t3 > n && (C2("Detected an update time that is in the future: " + t3 + " > " + n), 1));
  }, t2.prototype.We = function() {
    var t3 = this;
    this.document !== null && typeof this.document.addEventListener == "function" && (this.ke = function() {
      t3.Se.enqueueAndForget(function() {
        return t3.inForeground = t3.document.visibilityState === "visible", t3.je();
      });
    }, this.document.addEventListener("visibilitychange", this.ke), this.inForeground = this.document.visibilityState === "visible");
  }, t2.prototype.an = function() {
    this.ke && (this.document.removeEventListener("visibilitychange", this.ke), this.ke = null);
  }, t2.prototype.Ge = function() {
    var t3, e = this;
    typeof ((t3 = this.window) === null || t3 === void 0 ? void 0 : t3.addEventListener) == "function" && (this.Fe = function() {
      e.un(), e.Se.enqueueAndForget(function() {
        return e.shutdown();
      });
    }, this.window.addEventListener("pagehide", this.Fe));
  }, t2.prototype.hn = function() {
    this.Fe && (this.window.removeEventListener("pagehide", this.Fe), this.Fe = null);
  }, t2.prototype.cn = function(t3) {
    var e;
    try {
      var n = ((e = this.Qe) === null || e === void 0 ? void 0 : e.getItem(this.on(t3))) !== null;
      return k2("IndexedDbPersistence", "Client '" + t3 + "' " + (n ? "is" : "is not") + " zombied in LocalStorage"), n;
    } catch (t4) {
      return C2("IndexedDbPersistence", "Failed to get zombied client id.", t4), false;
    }
  }, t2.prototype.un = function() {
    if (this.Qe)
      try {
        this.Qe.setItem(this.on(this.clientId), String(Date.now()));
      } catch (t3) {
        C2("Failed to set zombie client id.", t3);
      }
  }, t2.prototype.ln = function() {
    if (this.Qe)
      try {
        this.Qe.removeItem(this.on(this.clientId));
      } catch (t3) {
      }
  }, t2.prototype.on = function(t3) {
    return "firestore_zombie_" + this.persistenceKey + "_" + t3;
  }, t2;
}();
function xi(t2) {
  return xr(t2, er.store);
}
function Ri(t2) {
  return xr(t2, dr.store);
}
function Li(t2, e) {
  var n = t2.projectId;
  return t2.isDefaultDatabase || (n += "." + t2.database), "firestore/" + e + "/" + n + "/";
}
var Oi = function(t2, e) {
  this.progress = t2, this.wn = e;
};
var Pi = function() {
  function t2(t3, e, n) {
    this.Ue = t3, this._n = e, this.Ut = n;
  }
  return t2.prototype.mn = function(t3, e) {
    var n = this;
    return this._n.getAllMutationBatchesAffectingDocumentKey(t3, e).next(function(r) {
      return n.yn(t3, e, r);
    });
  }, t2.prototype.yn = function(t3, e, n) {
    return this.Ue.getEntry(t3, e).next(function(t4) {
      for (var e2 = 0, r = n; e2 < r.length; e2++) {
        r[e2].applyToLocalView(t4);
      }
      return t4;
    });
  }, t2.prototype.gn = function(t3, e) {
    t3.forEach(function(t4, n) {
      for (var r = 0, i = e; r < i.length; r++) {
        i[r].applyToLocalView(n);
      }
    });
  }, t2.prototype.pn = function(t3, e) {
    var n = this;
    return this.Ue.getEntries(t3, e).next(function(e2) {
      return n.En(t3, e2).next(function() {
        return e2;
      });
    });
  }, t2.prototype.En = function(t3, e) {
    var n = this;
    return this._n.getAllMutationBatchesAffectingDocumentKeys(t3, e).next(function(t4) {
      return n.gn(e, t4);
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n) {
    return function(t4) {
      return at.isDocumentKey(t4.path) && t4.collectionGroup === null && t4.filters.length === 0;
    }(e) ? this.Tn(t3, e.path) : Zt(e) ? this.In(t3, e, n) : this.An(t3, e, n);
  }, t2.prototype.Tn = function(t3, e) {
    return this.mn(t3, new at(e)).next(function(t4) {
      var e2 = tn();
      return t4.isFoundDocument() && (e2 = e2.insert(t4.key, t4)), e2;
    });
  }, t2.prototype.In = function(t3, e, n) {
    var r = this, i = e.collectionGroup, o = tn();
    return this.Ut.getCollectionParents(t3, i).next(function(s) {
      return br.forEach(s, function(s2) {
        var u = function(t4, e2) {
          return new zt(e2, null, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
        }(e, s2.child(i));
        return r.An(t3, u, n).next(function(t4) {
          t4.forEach(function(t5, e2) {
            o = o.insert(t5, e2);
          });
        });
      }).next(function() {
        return o;
      });
    });
  }, t2.prototype.An = function(t3, e, n) {
    var r, i, o = this;
    return this.Ue.getDocumentsMatchingQuery(t3, e, n).next(function(n2) {
      return r = n2, o._n.getAllMutationBatchesAffectingQuery(t3, e);
    }).next(function(e2) {
      return i = e2, o.Rn(t3, i, r).next(function(t4) {
        r = t4;
        for (var e3 = 0, n2 = i; e3 < n2.length; e3++)
          for (var o2 = n2[e3], s = 0, u = o2.mutations; s < u.length; s++) {
            var a = u[s], c = a.key, h = r.get(c);
            h == null && (h = St.newInvalidDocument(c), r = r.insert(c, h)), Ce(a, h, o2.localWriteTime), h.isFoundDocument() || (r = r.remove(c));
          }
      });
    }).next(function() {
      return r.forEach(function(t4, n2) {
        se(e, n2) || (r = r.remove(t4));
      }), r;
    });
  }, t2.prototype.Rn = function(t3, e, n) {
    for (var r = on(), i = 0, o = e; i < o.length; i++)
      for (var s = 0, u = o[i].mutations; s < u.length; s++) {
        var a = u[s];
        a instanceof Pe && n.get(a.key) === null && (r = r.add(a.key));
      }
    var c = n;
    return this.Ue.getEntries(t3, r).next(function(t4) {
      return t4.forEach(function(t5, e2) {
        e2.isFoundDocument() && (c = c.insert(t5, e2));
      }), c;
    });
  }, t2;
}();
var Fi = function() {
  function t2(t3, e, n, r) {
    this.targetId = t3, this.fromCache = e, this.bn = n, this.vn = r;
  }
  return t2.Pn = function(e, n) {
    for (var r = on(), i = on(), o = 0, s = n.docChanges; o < s.length; o++) {
      var u = s[o];
      switch (u.type) {
        case 0:
          r = r.add(u.doc.key);
          break;
        case 1:
          i = i.add(u.doc.key);
      }
    }
    return new t2(e, n.fromCache, r, i);
  }, t2;
}();
var Mi = function() {
  function t2() {
  }
  return t2.prototype.Vn = function(t3) {
    this.Sn = t3;
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n, r) {
    var i = this;
    return function(t4) {
      return t4.filters.length === 0 && t4.limit === null && t4.startAt == null && t4.endAt == null && (t4.explicitOrderBy.length === 0 || t4.explicitOrderBy.length === 1 && t4.explicitOrderBy[0].field.isKeyField());
    }(e) || n.isEqual(j.min()) ? this.Dn(t3, e) : this.Sn.pn(t3, r).next(function(o) {
      var s = i.Cn(e, o);
      return (Yt(e) || $t(e)) && i.Nn(e.limitType, s, r, n) ? i.Dn(t3, e) : (A2() <= LogLevel.DEBUG && k2("QueryEngine", "Re-using previous result from %s to execute query: %s", n.toString(), oe(e)), i.Sn.getDocumentsMatchingQuery(t3, e, n).next(function(t4) {
        return s.forEach(function(e2) {
          t4 = t4.insert(e2.key, e2);
        }), t4;
      }));
    });
  }, t2.prototype.Cn = function(t3, e) {
    var n = new Ye(ue(t3));
    return e.forEach(function(e2, r) {
      se(t3, r) && (n = n.add(r));
    }), n;
  }, t2.prototype.Nn = function(t3, e, n, r) {
    if (n.size !== e.size)
      return true;
    var i = t3 === "F" ? e.last() : e.first();
    return !!i && (i.hasPendingWrites || i.version.compareTo(r) > 0);
  }, t2.prototype.Dn = function(t3, e) {
    return A2() <= LogLevel.DEBUG && k2("QueryEngine", "Using full collection scan to execute query:", oe(e)), this.Sn.getDocumentsMatchingQuery(t3, e, j.min());
  }, t2;
}();
var Vi = function() {
  function t2(t3, e, n, r) {
    this.persistence = t3, this.xn = e, this.R = r, this.Fn = new ze(V2), this.kn = new bi(function(t4) {
      return At(t4);
    }, kt), this.$n = j.min(), this._n = t3.getMutationQueue(n), this.On = t3.getRemoteDocumentCache(), this.qe = t3.getTargetCache(), this.Mn = new Pi(this.On, this._n, this.persistence.getIndexManager()), this.Ke = t3.getBundleCache(), this.xn.Vn(this.Mn);
  }
  return t2.prototype.collectGarbage = function(t3) {
    var e = this;
    return this.persistence.runTransaction("Collect garbage", "readwrite-primary", function(n) {
      return t3.collect(n, e.Fn);
    });
  }, t2;
}();
function qi(t2, e, n, r) {
  return new Vi(t2, e, n, r);
}
function Ui(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return n = P2(t2), i = n._n, o = n.Mn, [4, n.persistence.runTransaction("Handle user change", "readonly", function(t3) {
            var r2;
            return n._n.getAllMutationBatches(t3).next(function(s2) {
              return r2 = s2, i = n.persistence.getMutationQueue(e), o = new Pi(n.On, i, n.persistence.getIndexManager()), i.getAllMutationBatches(t3);
            }).next(function(e2) {
              for (var n2 = [], i2 = [], s2 = on(), u = 0, a = r2; u < a.length; u++) {
                var c = a[u];
                n2.push(c.batchId);
                for (var h = 0, f = c.mutations; h < f.length; h++) {
                  var l2 = f[h];
                  s2 = s2.add(l2.key);
                }
              }
              for (var d2 = 0, p2 = e2; d2 < p2.length; d2++) {
                var y2 = p2[d2];
                i2.push(y2.batchId);
                for (var v2 = 0, m = y2.mutations; v2 < m.length; v2++) {
                  var g = m[v2];
                  s2 = s2.add(g.key);
                }
              }
              return o.pn(t3, s2).next(function(t4) {
                return {
                  Ln: t4,
                  removedBatchIds: n2,
                  addedBatchIds: i2
                };
              });
            });
          })];
        case 1:
          return s = r.sent(), [2, (n._n = i, n.Mn = o, n.xn.Vn(n.Mn), s)];
      }
    });
  });
}
function Bi(t2, e) {
  var n = P2(t2);
  return n.persistence.runTransaction("Acknowledge batch", "readwrite-primary", function(t3) {
    var r = e.batch.keys(), i = n.On.newChangeBuffer({
      trackRemovals: true
    });
    return function(t4, e2, n2, r2) {
      var i2 = n2.batch, o = i2.keys(), s = br.resolve();
      return o.forEach(function(t5) {
        s = s.next(function() {
          return r2.getEntry(e2, t5);
        }).next(function(e3) {
          var o2 = n2.docVersions.get(t5);
          O2(o2 !== null), e3.version.compareTo(o2) < 0 && (i2.applyToRemoteDocument(e3, n2), e3.isValidDocument() && r2.addEntry(e3, n2.commitVersion));
        });
      }), s.next(function() {
        return t4._n.removeMutationBatch(e2, i2);
      });
    }(n, t3, e, i).next(function() {
      return i.apply(t3);
    }).next(function() {
      return n._n.performConsistencyCheck(t3);
    }).next(function() {
      return n.Mn.pn(t3, r);
    });
  });
}
function ji(t2) {
  var e = P2(t2);
  return e.persistence.runTransaction("Get last remote snapshot version", "readonly", function(t3) {
    return e.qe.getLastRemoteSnapshotVersion(t3);
  });
}
function Ki(t2, e) {
  var n = P2(t2), r = e.snapshotVersion, i = n.Fn;
  return n.persistence.runTransaction("Apply remote event", "readwrite-primary", function(t3) {
    var o = n.On.newChangeBuffer({
      trackRemovals: true
    });
    i = n.Fn;
    var s = [];
    e.targetChanges.forEach(function(e2, o2) {
      var u2 = i.get(o2);
      if (u2) {
        s.push(n.qe.removeMatchingKeys(t3, e2.removedDocuments, o2).next(function() {
          return n.qe.addMatchingKeys(t3, e2.addedDocuments, o2);
        }));
        var a2 = e2.resumeToken;
        if (a2.approximateByteSize() > 0) {
          var c = u2.withResumeToken(a2, r).withSequenceNumber(t3.currentSequenceNumber);
          i = i.insert(o2, c), function(t4, e3, n2) {
            return O2(e3.resumeToken.approximateByteSize() > 0), t4.resumeToken.approximateByteSize() === 0 || (e3.snapshotVersion.toMicroseconds() - t4.snapshotVersion.toMicroseconds() >= 3e8 || n2.addedDocuments.size + n2.modifiedDocuments.size + n2.removedDocuments.size > 0);
          }(u2, c, e2) && s.push(n.qe.updateTargetData(t3, c));
        }
      }
    });
    var u = Je();
    if (e.documentUpdates.forEach(function(r2, i2) {
      e.resolvedLimboDocuments.has(r2) && s.push(n.persistence.referenceDelegate.updateLimboDocument(t3, r2));
    }), s.push(Qi(t3, o, e.documentUpdates, r, void 0).next(function(t4) {
      u = t4;
    })), !r.isEqual(j.min())) {
      var a = n.qe.getLastRemoteSnapshotVersion(t3).next(function(e2) {
        return n.qe.setTargetsMetadata(t3, t3.currentSequenceNumber, r);
      });
      s.push(a);
    }
    return br.waitFor(s).next(function() {
      return o.apply(t3);
    }).next(function() {
      return n.Mn.En(t3, u);
    }).next(function() {
      return u;
    });
  }).then(function(t3) {
    return n.Fn = i, t3;
  });
}
function Qi(t2, e, n, r, i) {
  var o = on();
  return n.forEach(function(t3) {
    return o = o.add(t3);
  }), e.getEntries(t2, o).next(function(t3) {
    var o2 = Je();
    return n.forEach(function(n2, s) {
      var u = t3.get(n2), a = (i == null ? void 0 : i.get(n2)) || r;
      s.isNoDocument() && s.version.isEqual(j.min()) ? (e.removeEntry(n2, a), o2 = o2.insert(n2, s)) : !u.isValidDocument() || s.version.compareTo(u.version) > 0 || s.version.compareTo(u.version) === 0 && u.hasPendingWrites ? (e.addEntry(s, a), o2 = o2.insert(n2, s)) : k2("LocalStore", "Ignoring outdated watch update for ", n2, ". Current version:", u.version, " Watch version:", s.version);
    }), o2;
  });
}
function Gi(t2, e) {
  var n = P2(t2);
  return n.persistence.runTransaction("Get next mutation batch", "readonly", function(t3) {
    return e === void 0 && (e = -1), n._n.getNextMutationBatchAfterBatchId(t3, e);
  });
}
function zi(t2, e) {
  var n = P2(t2);
  return n.persistence.runTransaction("Allocate target", "readwrite", function(t3) {
    var r;
    return n.qe.getTargetData(t3, e).next(function(i) {
      return i ? (r = i, br.resolve(r)) : n.qe.allocateTargetId(t3).next(function(i2) {
        return r = new Or(e, i2, 0, t3.currentSequenceNumber), n.qe.addTargetData(t3, r).next(function() {
          return r;
        });
      });
    });
  }).then(function(t3) {
    var r = n.Fn.get(t3.targetId);
    return (r === null || t3.snapshotVersion.compareTo(r.snapshotVersion) > 0) && (n.Fn = n.Fn.insert(t3.targetId, t3), n.kn.set(e, t3.targetId)), t3;
  });
}
function Wi(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o, s, u;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = P2(t2), o = n.Fn.get(e), s = i ? "readwrite" : "readwrite-primary", r.label = 1;
        case 1:
          return r.trys.push([1, 4, , 5]), i ? [3, 3] : [4, n.persistence.runTransaction("Release target", s, function(t3) {
            return n.persistence.referenceDelegate.removeTarget(t3, o);
          })];
        case 2:
          r.sent(), r.label = 3;
        case 3:
          return [3, 5];
        case 4:
          if (!Sr(u = r.sent()))
            throw u;
          return k2("LocalStore", "Failed to update sequence numbers for target " + e + ": " + u), [3, 5];
        case 5:
          return n.Fn = n.Fn.remove(e), n.kn.delete(o.target), [2];
      }
    });
  });
}
function Hi(t2, e, n) {
  var r = P2(t2), i = j.min(), o = on();
  return r.persistence.runTransaction("Execute query", "readonly", function(t3) {
    return function(t4, e2, n2) {
      var r2 = P2(t4), i2 = r2.kn.get(n2);
      return i2 !== void 0 ? br.resolve(r2.Fn.get(i2)) : r2.qe.getTargetData(e2, n2);
    }(r, t3, ee(e)).next(function(e2) {
      if (e2)
        return i = e2.lastLimboFreeSnapshotVersion, r.qe.getMatchingKeysForTargetId(t3, e2.targetId).next(function(t4) {
          o = t4;
        });
    }).next(function() {
      return r.xn.getDocumentsMatchingQuery(t3, e, n ? i : j.min(), n ? o : on());
    }).next(function(t4) {
      return {
        documents: t4,
        Bn: o
      };
    });
  });
}
function Yi(t2, e) {
  var n = P2(t2), r = P2(n.qe), i = n.Fn.get(e);
  return i ? Promise.resolve(i.target) : n.persistence.runTransaction("Get target data", "readonly", function(t3) {
    return r.lt(t3, e).next(function(t4) {
      return t4 ? t4.target : null;
    });
  });
}
function $i(t2) {
  var e = P2(t2);
  return e.persistence.runTransaction("Get new document changes", "readonly", function(t3) {
    return function(t4, e2, n) {
      var r = P2(t4), i = Je(), o = Vr(n), s = Si(e2), u = IDBKeyRange.lowerBound(o, true);
      return s.$t({
        index: ur.readTimeIndex,
        range: u
      }, function(t5, e3) {
        var n2 = Fr(r.R, e3);
        i = i.insert(n2.key, n2), o = e3.readTime;
      }).next(function() {
        return {
          wn: i,
          readTime: qr(o)
        };
      });
    }(e.On, t3, e.$n);
  }).then(function(t3) {
    var n = t3.wn, r = t3.readTime;
    return e.$n = r, n;
  });
}
function Xi(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n) {
      return [2, (e = P2(t2)).persistence.runTransaction("Synchronize last document change read time", "readonly", function(t3) {
        return function(t4) {
          var e2 = Si(t4), n2 = j.min();
          return e2.$t({
            index: ur.readTimeIndex,
            reverse: true
          }, function(t5, e3, r) {
            e3.readTime && (n2 = qr(e3.readTime)), r.done();
          }).next(function() {
            return n2;
          });
        }(t3);
      }).then(function(t3) {
        e.$n = t3;
      })];
    });
  });
}
function Ji(t2, e, i, o) {
  return __awaiter(this, void 0, void 0, function() {
    var n, s, u, a, c, h, f, l2, d2, p2;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          for (n = P2(t2), s = on(), u = Je(), a = nn(), c = 0, h = i; c < h.length; c++)
            f = h[c], l2 = e.qn(f.metadata.name), f.document && (s = s.add(l2)), u = u.insert(l2, e.Un(f)), a = a.insert(l2, e.Kn(f.metadata.readTime));
          return d2 = n.On.newChangeBuffer({
            trackRemovals: true
          }), [4, zi(n, function(t3) {
            return ee(Ht(W2.fromString("__bundle__/docs/" + t3)));
          }(o))];
        case 1:
          return p2 = r.sent(), [2, n.persistence.runTransaction("Apply bundle documents", "readwrite", function(t3) {
            return Qi(t3, d2, u, j.min(), a).next(function(e2) {
              return d2.apply(t3), e2;
            }).next(function(e2) {
              return n.qe.removeMatchingKeysForTargetId(t3, p2.targetId).next(function() {
                return n.qe.addMatchingKeys(t3, s, p2.targetId);
              }).next(function() {
                return n.Mn.En(t3, e2);
              }).next(function() {
                return e2;
              });
            });
          })];
      }
    });
  });
}
function Zi(t2, e, i) {
  return i === void 0 && (i = on()), __awaiter(this, void 0, void 0, function() {
    var n, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return [4, zi(t2, ee(Gr(e.bundledQuery)))];
        case 1:
          return n = r.sent(), [2, (o = P2(t2)).persistence.runTransaction("Save named query", "readwrite", function(t3) {
            var r2 = Tn(e.readTime);
            if (n.snapshotVersion.compareTo(r2) >= 0)
              return o.Ke.saveNamedQuery(t3, e);
            var s = n.withResumeToken(X2.EMPTY_BYTE_STRING, r2);
            return o.Fn = o.Fn.insert(s.targetId, s), o.qe.updateTargetData(t3, s).next(function() {
              return o.qe.removeMatchingKeysForTargetId(t3, n.targetId);
            }).next(function() {
              return o.qe.addMatchingKeys(t3, i, n.targetId);
            }).next(function() {
              return o.Ke.saveNamedQuery(t3, e);
            });
          })];
      }
    });
  });
}
var to = function() {
  function t2(t3) {
    this.R = t3, this.Qn = new Map(), this.jn = new Map();
  }
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return br.resolve(this.Qn.get(e));
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    var n;
    return this.Qn.set(e.id, {
      id: (n = e).id,
      version: n.version,
      createTime: Tn(n.createTime)
    }), br.resolve();
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return br.resolve(this.jn.get(e));
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return this.jn.set(e.name, function(t4) {
      return {
        name: t4.name,
        query: Gr(t4.bundledQuery),
        readTime: Tn(t4.readTime)
      };
    }(e)), br.resolve();
  }, t2;
}();
var eo = function() {
  function t2() {
    this.Wn = new Ye(no.Gn), this.zn = new Ye(no.Hn);
  }
  return t2.prototype.isEmpty = function() {
    return this.Wn.isEmpty();
  }, t2.prototype.addReference = function(t3, e) {
    var n = new no(t3, e);
    this.Wn = this.Wn.add(n), this.zn = this.zn.add(n);
  }, t2.prototype.Jn = function(t3, e) {
    var n = this;
    t3.forEach(function(t4) {
      return n.addReference(t4, e);
    });
  }, t2.prototype.removeReference = function(t3, e) {
    this.Yn(new no(t3, e));
  }, t2.prototype.Xn = function(t3, e) {
    var n = this;
    t3.forEach(function(t4) {
      return n.removeReference(t4, e);
    });
  }, t2.prototype.Zn = function(t3) {
    var e = this, n = new at(new W2([])), r = new no(n, t3), i = new no(n, t3 + 1), o = [];
    return this.zn.forEachInRange([r, i], function(t4) {
      e.Yn(t4), o.push(t4.key);
    }), o;
  }, t2.prototype.ts = function() {
    var t3 = this;
    this.Wn.forEach(function(e) {
      return t3.Yn(e);
    });
  }, t2.prototype.Yn = function(t3) {
    this.Wn = this.Wn.delete(t3), this.zn = this.zn.delete(t3);
  }, t2.prototype.es = function(t3) {
    var e = new at(new W2([])), n = new no(e, t3), r = new no(e, t3 + 1), i = on();
    return this.zn.forEachInRange([n, r], function(t4) {
      i = i.add(t4.key);
    }), i;
  }, t2.prototype.containsKey = function(t3) {
    var e = new no(t3, 0), n = this.Wn.firstAfterOrEqual(e);
    return n !== null && t3.isEqual(n.key);
  }, t2;
}();
var no = function() {
  function t2(t3, e) {
    this.key = t3, this.ns = e;
  }
  return t2.Gn = function(t3, e) {
    return at.comparator(t3.key, e.key) || V2(t3.ns, e.ns);
  }, t2.Hn = function(t3, e) {
    return V2(t3.ns, e.ns) || at.comparator(t3.key, e.key);
  }, t2;
}();
var ro = function() {
  function t2(t3, e) {
    this.Ut = t3, this.referenceDelegate = e, this._n = [], this.ss = 1, this.rs = new Ye(no.Gn);
  }
  return t2.prototype.checkEmpty = function(t3) {
    return br.resolve(this._n.length === 0);
  }, t2.prototype.addMutationBatch = function(t3, e, n, r) {
    var i = this.ss;
    this.ss++, this._n.length > 0 && this._n[this._n.length - 1];
    var o = new Rr(i, e, n, r);
    this._n.push(o);
    for (var s = 0, u = r; s < u.length; s++) {
      var a = u[s];
      this.rs = this.rs.add(new no(a.key, i)), this.Ut.addToCollectionParentIndex(t3, a.key.path.popLast());
    }
    return br.resolve(o);
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    return br.resolve(this.os(e));
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n = e + 1, r = this.cs(n), i = r < 0 ? 0 : r;
    return br.resolve(this._n.length > i ? this._n[i] : null);
  }, t2.prototype.getHighestUnacknowledgedBatchId = function() {
    return br.resolve(this._n.length === 0 ? -1 : this.ss - 1);
  }, t2.prototype.getAllMutationBatches = function(t3) {
    return br.resolve(this._n.slice());
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n = this, r = new no(e, 0), i = new no(e, Number.POSITIVE_INFINITY), o = [];
    return this.rs.forEachInRange([r, i], function(t4) {
      var e2 = n.os(t4.ns);
      o.push(e2);
    }), br.resolve(o);
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n = this, r = new Ye(V2);
    return e.forEach(function(t4) {
      var e2 = new no(t4, 0), i = new no(t4, Number.POSITIVE_INFINITY);
      n.rs.forEachInRange([e2, i], function(t5) {
        r = r.add(t5.ns);
      });
    }), br.resolve(this.us(r));
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n = e.path, r = n.length + 1, i = n;
    at.isDocumentKey(i) || (i = i.child(""));
    var o = new no(new at(i), 0), s = new Ye(V2);
    return this.rs.forEachWhile(function(t4) {
      var e2 = t4.key.path;
      return !!n.isPrefixOf(e2) && (e2.length === r && (s = s.add(t4.ns)), true);
    }, o), br.resolve(this.us(s));
  }, t2.prototype.us = function(t3) {
    var e = this, n = [];
    return t3.forEach(function(t4) {
      var r = e.os(t4);
      r !== null && n.push(r);
    }), n;
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n = this;
    O2(this.hs(e.batchId, "removed") === 0), this._n.shift();
    var r = this.rs;
    return br.forEach(e.mutations, function(i) {
      var o = new no(i.key, e.batchId);
      return r = r.delete(o), n.referenceDelegate.markPotentiallyOrphaned(t3, i.key);
    }).next(function() {
      n.rs = r;
    });
  }, t2.prototype.Gt = function(t3) {
  }, t2.prototype.containsKey = function(t3, e) {
    var n = new no(e, 0), r = this.rs.firstAfterOrEqual(n);
    return br.resolve(e.isEqual(r && r.key));
  }, t2.prototype.performConsistencyCheck = function(t3) {
    return this._n.length, br.resolve();
  }, t2.prototype.hs = function(t3, e) {
    return this.cs(t3);
  }, t2.prototype.cs = function(t3) {
    return this._n.length === 0 ? 0 : t3 - this._n[0].batchId;
  }, t2.prototype.os = function(t3) {
    var e = this.cs(t3);
    return e < 0 || e >= this._n.length ? null : this._n[e];
  }, t2;
}();
var io = function() {
  function t2(t3, e) {
    this.Ut = t3, this.ls = e, this.docs = new ze(at.comparator), this.size = 0;
  }
  return t2.prototype.addEntry = function(t3, e, n) {
    var r = e.key, i = this.docs.get(r), o = i ? i.size : 0, s = this.ls(e);
    return this.docs = this.docs.insert(r, {
      document: e.clone(),
      size: s,
      readTime: n
    }), this.size += s - o, this.Ut.addToCollectionParentIndex(t3, r.path.popLast());
  }, t2.prototype.removeEntry = function(t3) {
    var e = this.docs.get(t3);
    e && (this.docs = this.docs.remove(t3), this.size -= e.size);
  }, t2.prototype.getEntry = function(t3, e) {
    var n = this.docs.get(e);
    return br.resolve(n ? n.document.clone() : St.newInvalidDocument(e));
  }, t2.prototype.getEntries = function(t3, e) {
    var n = this, r = Je();
    return e.forEach(function(t4) {
      var e2 = n.docs.get(t4);
      r = r.insert(t4, e2 ? e2.document.clone() : St.newInvalidDocument(t4));
    }), br.resolve(r);
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n) {
    for (var r = Je(), i = new at(e.path.child("")), o = this.docs.getIteratorFrom(i); o.hasNext(); ) {
      var s = o.getNext(), u = s.key, a = s.value, c = a.document, h = a.readTime;
      if (!e.path.isPrefixOf(u.path))
        break;
      h.compareTo(n) <= 0 || se(e, c) && (r = r.insert(c.key, c.clone()));
    }
    return br.resolve(r);
  }, t2.prototype.fs = function(t3, e) {
    return br.forEach(this.docs, function(t4) {
      return e(t4);
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new oo(this);
  }, t2.prototype.getSize = function(t3) {
    return br.resolve(this.size);
  }, t2;
}();
var oo = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).Ie = t2, n2;
  }
  return __extends(n, e), n.prototype.applyChanges = function(t2) {
    var e2 = this, n2 = [];
    return this.changes.forEach(function(r, i) {
      i.document.isValidDocument() ? n2.push(e2.Ie.addEntry(t2, i.document, e2.getReadTime(r))) : e2.Ie.removeEntry(r);
    }), br.waitFor(n2);
  }, n.prototype.getFromCache = function(t2, e2) {
    return this.Ie.getEntry(t2, e2);
  }, n.prototype.getAllFromCache = function(t2, e2) {
    return this.Ie.getEntries(t2, e2);
  }, n;
}(Ii);
var so = function() {
  function t2(t3) {
    this.persistence = t3, this.ds = new bi(function(t4) {
      return At(t4);
    }, kt), this.lastRemoteSnapshotVersion = j.min(), this.highestTargetId = 0, this.ws = 0, this._s = new eo(), this.targetCount = 0, this.ys = ai.Jt();
  }
  return t2.prototype.forEachTarget = function(t3, e) {
    return this.ds.forEach(function(t4, n) {
      return e(n);
    }), br.resolve();
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return br.resolve(this.lastRemoteSnapshotVersion);
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return br.resolve(this.ws);
  }, t2.prototype.allocateTargetId = function(t3) {
    return this.highestTargetId = this.ys.next(), br.resolve(this.highestTargetId);
  }, t2.prototype.setTargetsMetadata = function(t3, e, n) {
    return n && (this.lastRemoteSnapshotVersion = n), e > this.ws && (this.ws = e), br.resolve();
  }, t2.prototype.te = function(t3) {
    this.ds.set(t3.target, t3);
    var e = t3.targetId;
    e > this.highestTargetId && (this.ys = new ai(e), this.highestTargetId = e), t3.sequenceNumber > this.ws && (this.ws = t3.sequenceNumber);
  }, t2.prototype.addTargetData = function(t3, e) {
    return this.te(e), this.targetCount += 1, br.resolve();
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.te(e), br.resolve();
  }, t2.prototype.removeTargetData = function(t3, e) {
    return this.ds.delete(e.target), this._s.Zn(e.targetId), this.targetCount -= 1, br.resolve();
  }, t2.prototype.removeTargets = function(t3, e, n) {
    var r = this, i = 0, o = [];
    return this.ds.forEach(function(s, u) {
      u.sequenceNumber <= e && n.get(u.targetId) === null && (r.ds.delete(s), o.push(r.removeMatchingKeysForTargetId(t3, u.targetId)), i++);
    }), br.waitFor(o).next(function() {
      return i;
    });
  }, t2.prototype.getTargetCount = function(t3) {
    return br.resolve(this.targetCount);
  }, t2.prototype.getTargetData = function(t3, e) {
    var n = this.ds.get(e) || null;
    return br.resolve(n);
  }, t2.prototype.addMatchingKeys = function(t3, e, n) {
    return this._s.Jn(e, n), br.resolve();
  }, t2.prototype.removeMatchingKeys = function(t3, e, n) {
    this._s.Xn(e, n);
    var r = this.persistence.referenceDelegate, i = [];
    return r && e.forEach(function(e2) {
      i.push(r.markPotentiallyOrphaned(t3, e2));
    }), br.waitFor(i);
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    return this._s.Zn(e), br.resolve();
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n = this._s.es(e);
    return br.resolve(n);
  }, t2.prototype.containsKey = function(t3, e) {
    return br.resolve(this._s.containsKey(e));
  }, t2;
}();
var uo = function() {
  function t2(t3, e) {
    var n = this;
    this.gs = {}, this.Ne = new _(0), this.xe = false, this.xe = true, this.referenceDelegate = t3(this), this.qe = new so(this), this.Ut = new Yr(), this.Ue = function(t4, e2) {
      return new io(t4, function(t5) {
        return n.referenceDelegate.ps(t5);
      });
    }(this.Ut), this.R = new Pr(e), this.Ke = new to(this.R);
  }
  return t2.prototype.start = function() {
    return Promise.resolve();
  }, t2.prototype.shutdown = function() {
    return this.xe = false, Promise.resolve();
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.xe;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.setDatabaseDeletedListener = function() {
  }, t2.prototype.setNetworkEnabled = function() {
  }, t2.prototype.getIndexManager = function() {
    return this.Ut;
  }, t2.prototype.getMutationQueue = function(t3) {
    var e = this.gs[t3.toKey()];
    return e || (e = new ro(this.Ut, this.referenceDelegate), this.gs[t3.toKey()] = e), e;
  }, t2.prototype.getTargetCache = function() {
    return this.qe;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.Ue;
  }, t2.prototype.getBundleCache = function() {
    return this.Ke;
  }, t2.prototype.runTransaction = function(t3, e, n) {
    var r = this;
    k2("MemoryPersistence", "Starting transaction:", t3);
    var i = new ao(this.Ne.next());
    return this.referenceDelegate.Es(), n(i).next(function(t4) {
      return r.referenceDelegate.Ts(i).next(function() {
        return t4;
      });
    }).toPromise().then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.Is = function(t3, e) {
    return br.or(Object.values(this.gs).map(function(n) {
      return function() {
        return n.containsKey(t3, e);
      };
    }));
  }, t2;
}();
var ao = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).currentSequenceNumber = t2, n2;
  }
  return __extends(n, e), n;
}(gr);
var co = function() {
  function t2(t3) {
    this.persistence = t3, this.As = new eo(), this.Rs = null;
  }
  return t2.bs = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "vs", {
    get: function() {
      if (this.Rs)
        return this.Rs;
      throw L2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.addReference = function(t3, e, n) {
    return this.As.addReference(n, e), this.vs.delete(n.toString()), br.resolve();
  }, t2.prototype.removeReference = function(t3, e, n) {
    return this.As.removeReference(n, e), this.vs.add(n.toString()), br.resolve();
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return this.vs.add(e.toString()), br.resolve();
  }, t2.prototype.removeTarget = function(t3, e) {
    var n = this;
    this.As.Zn(e.targetId).forEach(function(t4) {
      return n.vs.add(t4.toString());
    });
    var r = this.persistence.getTargetCache();
    return r.getMatchingKeysForTargetId(t3, e.targetId).next(function(t4) {
      t4.forEach(function(t5) {
        return n.vs.add(t5.toString());
      });
    }).next(function() {
      return r.removeTargetData(t3, e);
    });
  }, t2.prototype.Es = function() {
    this.Rs = new Set();
  }, t2.prototype.Ts = function(t3) {
    var e = this, n = this.persistence.getRemoteDocumentCache().newChangeBuffer();
    return br.forEach(this.vs, function(r) {
      var i = at.fromPath(r);
      return e.Ps(t3, i).next(function(t4) {
        t4 || n.removeEntry(i);
      });
    }).next(function() {
      return e.Rs = null, n.apply(t3);
    });
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    var n = this;
    return this.Ps(t3, e).next(function(t4) {
      t4 ? n.vs.delete(e.toString()) : n.vs.add(e.toString());
    });
  }, t2.prototype.ps = function(t3) {
    return 0;
  }, t2.prototype.Ps = function(t3, e) {
    var n = this;
    return br.or([function() {
      return br.resolve(n.As.containsKey(e));
    }, function() {
      return n.persistence.getTargetCache().containsKey(t3, e);
    }, function() {
      return n.persistence.Is(t3, e);
    }]);
  }, t2;
}();
var ho = function() {
  function t2(t3) {
    this.uid = t3;
  }
  return t2.prototype.isAuthenticated = function() {
    return this.uid != null;
  }, t2.prototype.toKey = function() {
    return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
  }, t2.prototype.isEqual = function(t3) {
    return t3.uid === this.uid;
  }, t2;
}();
function fo(t2, e) {
  return "firestore_clients_" + t2 + "_" + e;
}
function lo(t2, e, n) {
  var r = "firestore_mutations_" + t2 + "_" + n;
  return e.isAuthenticated() && (r += "_" + e.uid), r;
}
function po(t2, e) {
  return "firestore_targets_" + t2 + "_" + e;
}
ho.UNAUTHENTICATED = new ho(null), ho.GOOGLE_CREDENTIALS = new ho("google-credentials-uid"), ho.FIRST_PARTY = new ho("first-party-uid");
var yo = function() {
  function t2(t3, e, n, r) {
    this.user = t3, this.batchId = e, this.state = n, this.error = r;
  }
  return t2.Vs = function(e, n, r) {
    var i, o = JSON.parse(r), s = typeof o == "object" && ["pending", "acknowledged", "rejected"].indexOf(o.state) !== -1 && (o.error === void 0 || typeof o.error == "object");
    return s && o.error && ((s = typeof o.error.message == "string" && typeof o.error.code == "string") && (i = new N2(o.error.code, o.error.message))), s ? new t2(e, n, o.state, i) : (C2("SharedClientState", "Failed to parse mutation state for ID '" + n + "': " + r), null);
  }, t2.prototype.Ss = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var vo = function() {
  function t2(t3, e, n) {
    this.targetId = t3, this.state = e, this.error = n;
  }
  return t2.Vs = function(e, n) {
    var r, i = JSON.parse(n), o = typeof i == "object" && ["not-current", "current", "rejected"].indexOf(i.state) !== -1 && (i.error === void 0 || typeof i.error == "object");
    return o && i.error && ((o = typeof i.error.message == "string" && typeof i.error.code == "string") && (r = new N2(i.error.code, i.error.message))), o ? new t2(e, i.state, r) : (C2("SharedClientState", "Failed to parse target state for ID '" + e + "': " + n), null);
  }, t2.prototype.Ss = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var mo = function() {
  function t2(t3, e) {
    this.clientId = t3, this.activeTargetIds = e;
  }
  return t2.Vs = function(e, n) {
    for (var r = JSON.parse(n), i = typeof r == "object" && r.activeTargetIds instanceof Array, o = un(), s = 0; i && s < r.activeTargetIds.length; ++s)
      i = ut(r.activeTargetIds[s]), o = o.add(r.activeTargetIds[s]);
    return i ? new t2(e, o) : (C2("SharedClientState", "Failed to parse client data for instance '" + e + "': " + n), null);
  }, t2;
}();
var go = function() {
  function t2(t3, e) {
    this.clientId = t3, this.onlineState = e;
  }
  return t2.Vs = function(e) {
    var n = JSON.parse(e);
    return typeof n == "object" && ["Unknown", "Online", "Offline"].indexOf(n.onlineState) !== -1 && typeof n.clientId == "string" ? new t2(n.clientId, n.onlineState) : (C2("SharedClientState", "Failed to parse online state: " + e), null);
  }, t2;
}();
var wo = function() {
  function t2() {
    this.activeTargetIds = un();
  }
  return t2.prototype.Ds = function(t3) {
    this.activeTargetIds = this.activeTargetIds.add(t3);
  }, t2.prototype.Cs = function(t3) {
    this.activeTargetIds = this.activeTargetIds.delete(t3);
  }, t2.prototype.Ss = function() {
    var t3 = {
      activeTargetIds: this.activeTargetIds.toArray(),
      updateTimeMs: Date.now()
    };
    return JSON.stringify(t3);
  }, t2;
}();
var bo = function() {
  function t2(t3, e, n, r, i) {
    this.window = t3, this.Se = e, this.persistenceKey = n, this.Ns = r, this.syncEngine = null, this.onlineStateHandler = null, this.sequenceNumberHandler = null, this.xs = this.Fs.bind(this), this.ks = new ze(V2), this.started = false, this.$s = [];
    var o = n.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    this.storage = this.window.localStorage, this.currentUser = i, this.Os = fo(this.persistenceKey, this.Ns), this.Ms = function(t4) {
      return "firestore_sequence_number_" + t4;
    }(this.persistenceKey), this.ks = this.ks.insert(this.Ns, new wo()), this.Ls = new RegExp("^firestore_clients_" + o + "_([^_]*)$"), this.Bs = new RegExp("^firestore_mutations_" + o + "_(\\d+)(?:_(.*))?$"), this.qs = new RegExp("^firestore_targets_" + o + "_(\\d+)$"), this.Us = function(t4) {
      return "firestore_online_state_" + t4;
    }(this.persistenceKey), this.Ks = function(t4) {
      return "firestore_bundle_loaded_" + t4;
    }(this.persistenceKey), this.window.addEventListener("storage", this.xs);
  }
  return t2.yt = function(t3) {
    return !(!t3 || !t3.localStorage);
  }, t2.prototype.start = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n, i, o, s, u, a, c, h, f, l2 = this;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return [4, this.syncEngine.fn()];
          case 1:
            for (t3 = r.sent(), e = 0, n = t3; e < n.length; e++)
              (i = n[e]) !== this.Ns && (o = this.getItem(fo(this.persistenceKey, i))) && (s = mo.Vs(i, o)) && (this.ks = this.ks.insert(s.clientId, s));
            for (this.Qs(), (u = this.storage.getItem(this.Us)) && (a = this.js(u)) && this.Ws(a), c = 0, h = this.$s; c < h.length; c++)
              f = h[c], this.Fs(f);
            return this.$s = [], this.window.addEventListener("pagehide", function() {
              return l2.shutdown();
            }), this.started = true, [2];
        }
      });
    });
  }, t2.prototype.writeSequenceNumber = function(t3) {
    this.setItem(this.Ms, JSON.stringify(t3));
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.Gs(this.ks);
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    var e = false;
    return this.ks.forEach(function(n, r) {
      r.activeTargetIds.has(t3) && (e = true);
    }), e;
  }, t2.prototype.addPendingMutation = function(t3) {
    this.zs(t3, "pending");
  }, t2.prototype.updateMutationState = function(t3, e, n) {
    this.zs(t3, e, n), this.Hs(t3);
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    var e = "not-current";
    if (this.isActiveQueryTarget(t3)) {
      var n = this.storage.getItem(po(this.persistenceKey, t3));
      if (n) {
        var r = vo.Vs(t3, n);
        r && (e = r.state);
      }
    }
    return this.Js.Ds(t3), this.Qs(), e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.Js.Cs(t3), this.Qs();
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.Js.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    this.removeItem(po(this.persistenceKey, t3));
  }, t2.prototype.updateQueryState = function(t3, e, n) {
    this.Ys(t3, e, n);
  }, t2.prototype.handleUserChange = function(t3, e, n) {
    var r = this;
    e.forEach(function(t4) {
      r.Hs(t4);
    }), this.currentUser = t3, n.forEach(function(t4) {
      r.addPendingMutation(t4);
    });
  }, t2.prototype.setOnlineState = function(t3) {
    this.Xs(t3);
  }, t2.prototype.notifyBundleLoaded = function() {
    this.Zs();
  }, t2.prototype.shutdown = function() {
    this.started && (this.window.removeEventListener("storage", this.xs), this.removeItem(this.Os), this.started = false);
  }, t2.prototype.getItem = function(t3) {
    var e = this.storage.getItem(t3);
    return k2("SharedClientState", "READ", t3, e), e;
  }, t2.prototype.setItem = function(t3, e) {
    k2("SharedClientState", "SET", t3, e), this.storage.setItem(t3, e);
  }, t2.prototype.removeItem = function(t3) {
    k2("SharedClientState", "REMOVE", t3), this.storage.removeItem(t3);
  }, t2.prototype.Fs = function(t3) {
    var e = this, i = t3;
    if (i.storageArea === this.storage) {
      if (k2("SharedClientState", "EVENT", i.key, i.newValue), i.key === this.Os)
        return void C2("Received WebStorage notification for local change. Another client might have garbage-collected our state");
      this.Se.enqueueRetryable(function() {
        return __awaiter(e, void 0, void 0, function() {
          var t4, e2, n, o, s, u;
          return __generator(this, function(r) {
            if (this.started) {
              if (i.key !== null) {
                if (this.Ls.test(i.key)) {
                  if (i.newValue == null)
                    return t4 = this.ti(i.key), [2, this.ei(t4, null)];
                  if (e2 = this.ni(i.key, i.newValue))
                    return [2, this.ei(e2.clientId, e2)];
                } else if (this.Bs.test(i.key)) {
                  if (i.newValue !== null && (n = this.si(i.key, i.newValue)))
                    return [2, this.ii(n)];
                } else if (this.qs.test(i.key)) {
                  if (i.newValue !== null && (o = this.ri(i.key, i.newValue)))
                    return [2, this.oi(o)];
                } else if (i.key === this.Us) {
                  if (i.newValue !== null && (s = this.js(i.newValue)))
                    return [2, this.Ws(s)];
                } else if (i.key === this.Ms)
                  (u = function(t5) {
                    var e3 = _.o;
                    if (t5 != null)
                      try {
                        var n2 = JSON.parse(t5);
                        O2(typeof n2 == "number"), e3 = n2;
                      } catch (t6) {
                        C2("SharedClientState", "Failed to read sequence number from WebStorage", t6);
                      }
                    return e3;
                  }(i.newValue)) !== _.o && this.sequenceNumberHandler(u);
                else if (i.key === this.Ks)
                  return [2, this.syncEngine.ci()];
              }
            } else
              this.$s.push(i);
            return [2];
          });
        });
      });
    }
  }, Object.defineProperty(t2.prototype, "Js", {
    get: function() {
      return this.ks.get(this.Ns);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Qs = function() {
    this.setItem(this.Os, this.Js.Ss());
  }, t2.prototype.zs = function(t3, e, n) {
    var r = new yo(this.currentUser, t3, e, n), i = lo(this.persistenceKey, this.currentUser, t3);
    this.setItem(i, r.Ss());
  }, t2.prototype.Hs = function(t3) {
    var e = lo(this.persistenceKey, this.currentUser, t3);
    this.removeItem(e);
  }, t2.prototype.Xs = function(t3) {
    var e = {
      clientId: this.Ns,
      onlineState: t3
    };
    this.storage.setItem(this.Us, JSON.stringify(e));
  }, t2.prototype.Ys = function(t3, e, n) {
    var r = po(this.persistenceKey, t3), i = new vo(t3, e, n);
    this.setItem(r, i.Ss());
  }, t2.prototype.Zs = function() {
    this.setItem(this.Ks, "value-not-used");
  }, t2.prototype.ti = function(t3) {
    var e = this.Ls.exec(t3);
    return e ? e[1] : null;
  }, t2.prototype.ni = function(t3, e) {
    var n = this.ti(t3);
    return mo.Vs(n, e);
  }, t2.prototype.si = function(t3, e) {
    var n = this.Bs.exec(t3), r = Number(n[1]), i = n[2] !== void 0 ? n[2] : null;
    return yo.Vs(new ho(i), r, e);
  }, t2.prototype.ri = function(t3, e) {
    var n = this.qs.exec(t3), r = Number(n[1]);
    return vo.Vs(r, e);
  }, t2.prototype.js = function(t3) {
    return go.Vs(t3);
  }, t2.prototype.ii = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        return t3.user.uid === this.currentUser.uid ? [2, this.syncEngine.ui(t3.batchId, t3.state, t3.error)] : (k2("SharedClientState", "Ignoring mutation for non-active user " + t3.user.uid), [2]);
      });
    });
  }, t2.prototype.oi = function(t3) {
    return this.syncEngine.ai(t3.targetId, t3.state, t3.error);
  }, t2.prototype.ei = function(t3, e) {
    var n = this, r = e ? this.ks.insert(t3, e) : this.ks.remove(t3), i = this.Gs(this.ks), o = this.Gs(r), s = [], u = [];
    return o.forEach(function(t4) {
      i.has(t4) || s.push(t4);
    }), i.forEach(function(t4) {
      o.has(t4) || u.push(t4);
    }), this.syncEngine.hi(s, u).then(function() {
      n.ks = r;
    });
  }, t2.prototype.Ws = function(t3) {
    this.ks.get(t3.clientId) && this.onlineStateHandler(t3.onlineState);
  }, t2.prototype.Gs = function(t3) {
    var e = un();
    return t3.forEach(function(t4, n) {
      e = e.unionWith(n.activeTargetIds);
    }), e;
  }, t2;
}();
var Io = function() {
  function t2() {
    this.li = new wo(), this.fi = {}, this.onlineStateHandler = null, this.sequenceNumberHandler = null;
  }
  return t2.prototype.addPendingMutation = function(t3) {
  }, t2.prototype.updateMutationState = function(t3, e, n) {
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    return this.li.Ds(t3), this.fi[t3] || "not-current";
  }, t2.prototype.updateQueryState = function(t3, e, n) {
    this.fi[t3] = e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.li.Cs(t3);
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.li.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    delete this.fi[t3];
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.li.activeTargetIds;
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    return this.li.activeTargetIds.has(t3);
  }, t2.prototype.start = function() {
    return this.li = new wo(), Promise.resolve();
  }, t2.prototype.handleUserChange = function(t3, e, n) {
  }, t2.prototype.setOnlineState = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2.prototype.writeSequenceNumber = function(t3) {
  }, t2.prototype.notifyBundleLoaded = function() {
  }, t2;
}();
var Eo = function() {
  function t2() {
  }
  return t2.prototype.di = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2;
}();
var To = function() {
  function t2() {
    var t3 = this;
    this.wi = function() {
      return t3._i();
    }, this.mi = function() {
      return t3.yi();
    }, this.gi = [], this.pi();
  }
  return t2.prototype.di = function(t3) {
    this.gi.push(t3);
  }, t2.prototype.shutdown = function() {
    window.removeEventListener("online", this.wi), window.removeEventListener("offline", this.mi);
  }, t2.prototype.pi = function() {
    window.addEventListener("online", this.wi), window.addEventListener("offline", this.mi);
  }, t2.prototype._i = function() {
    k2("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
    for (var t3 = 0, e = this.gi; t3 < e.length; t3++) {
      (0, e[t3])(0);
    }
  }, t2.prototype.yi = function() {
    k2("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
    for (var t3 = 0, e = this.gi; t3 < e.length; t3++) {
      (0, e[t3])(1);
    }
  }, t2.yt = function() {
    return typeof window != "undefined" && window.addEventListener !== void 0 && window.removeEventListener !== void 0;
  }, t2;
}();
var _o = {
  BatchGetDocuments: "batchGet",
  Commit: "commit",
  RunQuery: "runQuery"
};
var So = function() {
  function t2(t3) {
    this.Ei = t3.Ei, this.Ti = t3.Ti;
  }
  return t2.prototype.Ii = function(t3) {
    this.Ai = t3;
  }, t2.prototype.Ri = function(t3) {
    this.bi = t3;
  }, t2.prototype.onMessage = function(t3) {
    this.vi = t3;
  }, t2.prototype.close = function() {
    this.Ti();
  }, t2.prototype.send = function(t3) {
    this.Ei(t3);
  }, t2.prototype.Pi = function() {
    this.Ai();
  }, t2.prototype.Vi = function(t3) {
    this.bi(t3);
  }, t2.prototype.Si = function(t3) {
    this.vi(t3);
  }, t2;
}();
var No = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this, t2) || this).forceLongPolling = t2.forceLongPolling, n2.autoDetectLongPolling = t2.autoDetectLongPolling, n2.useFetchStreams = t2.useFetchStreams, n2;
  }
  return __extends(n, e), n.prototype.ki = function(t2, e2, n2, r) {
    return new Promise(function(i, o) {
      var s = new XhrIo();
      s.listenOnce(EventType.COMPLETE, function() {
        try {
          switch (s.getLastErrorCode()) {
            case ErrorCode.NO_ERROR:
              var e3 = s.getResponseJson();
              k2("Connection", "XHR received:", JSON.stringify(e3)), i(e3);
              break;
            case ErrorCode.TIMEOUT:
              k2("Connection", 'RPC "' + t2 + '" timed out'), o(new N2(S2.DEADLINE_EXCEEDED, "Request time out"));
              break;
            case ErrorCode.HTTP_ERROR:
              var n3 = s.getStatus();
              if (k2("Connection", 'RPC "' + t2 + '" failed with status:', n3, "response text:", s.getResponseText()), n3 > 0) {
                var r2 = s.getResponseJson().error;
                if (r2 && r2.status && r2.message) {
                  var u2 = function(t3) {
                    var e4 = t3.toLowerCase().replace(/_/g, "-");
                    return Object.values(S2).indexOf(e4) >= 0 ? e4 : S2.UNKNOWN;
                  }(r2.status);
                  o(new N2(u2, r2.message));
                } else
                  o(new N2(S2.UNKNOWN, "Server responded with status " + s.getStatus()));
              } else
                o(new N2(S2.UNAVAILABLE, "Connection failed."));
              break;
            default:
              L2();
          }
        } finally {
          k2("Connection", 'RPC "' + t2 + '" completed.');
        }
      });
      var u = JSON.stringify(r);
      s.send(e2, "POST", u, n2, 15);
    });
  }, n.prototype.Oi = function(t2, e2) {
    var n2 = [this.Di, "/", "google.firestore.v1.Firestore", "/", t2, "/channel"], r = createWebChannelTransport(), i = getStatEventTarget(), f = {
      httpSessionIdParam: "gsessionid",
      initMessageHeaders: {},
      messageUrlParams: {
        database: "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database
      },
      sendRawJson: true,
      supportsCrossDomainXhr: true,
      internalChannelParams: {
        forwardChannelRequestTimeoutMs: 6e5
      },
      forceLongPolling: this.forceLongPolling,
      detectBufferingProxy: this.autoDetectLongPolling
    };
    this.useFetchStreams && (f.xmlHttpFactory = new FetchXmlHttpFactory({})), this.Fi(f.initMessageHeaders, e2), isMobileCordova() || isReactNative() || isElectron() || isIE() || isUWP() || isBrowserExtension() || (f.httpHeadersOverwriteParam = "$httpHeaders");
    var l2 = n2.join("");
    k2("Connection", "Creating WebChannel: " + l2, f);
    var d2 = r.createWebChannel(l2, f), p2 = false, y2 = false, v2 = new So({
      Ei: function(t3) {
        y2 ? k2("Connection", "Not sending because WebChannel is closed:", t3) : (p2 || (k2("Connection", "Opening WebChannel transport."), d2.open(), p2 = true), k2("Connection", "WebChannel sending:", t3), d2.send(t3));
      },
      Ti: function() {
        return d2.close();
      }
    }), m = function(t3, e3, n3) {
      t3.listen(e3, function(t4) {
        try {
          n3(t4);
        } catch (t5) {
          setTimeout(function() {
            throw t5;
          }, 0);
        }
      });
    };
    return m(d2, WebChannel.EventType.OPEN, function() {
      y2 || k2("Connection", "WebChannel transport opened.");
    }), m(d2, WebChannel.EventType.CLOSE, function() {
      y2 || (y2 = true, k2("Connection", "WebChannel transport closed"), v2.Vi());
    }), m(d2, WebChannel.EventType.ERROR, function(t3) {
      y2 || (y2 = true, x2("Connection", "WebChannel transport errored:", t3), v2.Vi(new N2(S2.UNAVAILABLE, "The operation could not be completed")));
    }), m(d2, WebChannel.EventType.MESSAGE, function(t3) {
      var e3;
      if (!y2) {
        var n3 = t3.data[0];
        O2(!!n3);
        var r2 = n3, i2 = r2.error || ((e3 = r2[0]) === null || e3 === void 0 ? void 0 : e3.error);
        if (i2) {
          k2("Connection", "WebChannel received error:", i2);
          var o = i2.status, s = function(t4) {
            var e4 = qe[t4];
            if (e4 !== void 0)
              return Ge(e4);
          }(o), u = i2.message;
          s === void 0 && (s = S2.INTERNAL, u = "Unknown error status: " + o + " with message " + i2.message), y2 = true, v2.Vi(new N2(s, u)), d2.close();
        } else
          k2("Connection", "WebChannel received:", n3), v2.Si(n3);
      }
    }), m(i, Event.STAT_EVENT, function(t3) {
      t3.stat === Stat.PROXY ? k2("Connection", "Detected buffering proxy") : t3.stat === Stat.NOPROXY && k2("Connection", "Detected no buffering proxy");
    }), setTimeout(function() {
      v2.Pi();
    }, 0), v2;
  }, n;
}(function() {
  function t2(t3) {
    this.databaseInfo = t3, this.databaseId = t3.databaseId;
    var e = t3.ssl ? "https" : "http";
    this.Di = e + "://" + t3.host, this.Ci = "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database + "/documents";
  }
  return t2.prototype.Ni = function(t3, e, n, r) {
    var i = this.xi(t3, e);
    k2("RestConnection", "Sending: ", i, n);
    var o = {};
    return this.Fi(o, r), this.ki(t3, i, o, n).then(function(t4) {
      return k2("RestConnection", "Received: ", t4), t4;
    }, function(e2) {
      throw x2("RestConnection", t3 + " failed with error: ", e2, "url: ", i, "request:", n), e2;
    });
  }, t2.prototype.$i = function(t3, e, n, r) {
    return this.Ni(t3, e, n, r);
  }, t2.prototype.Fi = function(t3, e) {
    if (t3["X-Goog-Api-Client"] = "gl-js/ fire/8.7.0", t3["Content-Type"] = "text/plain", this.databaseInfo.appId && (t3["X-Firebase-GMPID"] = this.databaseInfo.appId), e)
      for (var n in e.authHeaders)
        e.authHeaders.hasOwnProperty(n) && (t3[n] = e.authHeaders[n]);
  }, t2.prototype.xi = function(t3, e) {
    var n = _o[t3];
    return this.Di + "/v1/" + e + ":" + n;
  }, t2;
}());
function Do() {
  return typeof window != "undefined" ? window : null;
}
function Ao() {
  return typeof document != "undefined" ? document : null;
}
function ko(t2) {
  return new wn(t2, true);
}
var Co = function() {
  function t2(t3, e, n, r, i) {
    n === void 0 && (n = 1e3), r === void 0 && (r = 1.5), i === void 0 && (i = 6e4), this.Se = t3, this.timerId = e, this.Mi = n, this.Li = r, this.Bi = i, this.qi = 0, this.Ui = null, this.Ki = Date.now(), this.reset();
  }
  return t2.prototype.reset = function() {
    this.qi = 0;
  }, t2.prototype.Qi = function() {
    this.qi = this.Bi;
  }, t2.prototype.ji = function(t3) {
    var e = this;
    this.cancel();
    var n = Math.floor(this.qi + this.Wi()), r = Math.max(0, Date.now() - this.Ki), i = Math.max(0, n - r);
    i > 0 && k2("ExponentialBackoff", "Backing off for " + i + " ms (base delay: " + this.qi + " ms, delay with jitter: " + n + " ms, last attempt: " + r + " ms ago)"), this.Ui = this.Se.enqueueAfterDelay(this.timerId, i, function() {
      return e.Ki = Date.now(), t3();
    }), this.qi *= this.Li, this.qi < this.Mi && (this.qi = this.Mi), this.qi > this.Bi && (this.qi = this.Bi);
  }, t2.prototype.Gi = function() {
    this.Ui !== null && (this.Ui.skipDelay(), this.Ui = null);
  }, t2.prototype.cancel = function() {
    this.Ui !== null && (this.Ui.cancel(), this.Ui = null);
  }, t2.prototype.Wi = function() {
    return (Math.random() - 0.5) * this.qi;
  }, t2;
}();
var xo = function() {
  function t2(t3, e, n, r, i, o) {
    this.Se = t3, this.zi = n, this.Hi = r, this.Ji = i, this.listener = o, this.state = 0, this.Yi = 0, this.Xi = null, this.stream = null, this.Zi = new Co(t3, e);
  }
  return t2.prototype.tr = function() {
    return this.state === 1 || this.state === 2 || this.state === 4;
  }, t2.prototype.er = function() {
    return this.state === 2;
  }, t2.prototype.start = function() {
    this.state !== 3 ? this.auth() : this.nr();
  }, t2.prototype.stop = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.tr() ? [4, this.close(0)] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.sr = function() {
    this.state = 0, this.Zi.reset();
  }, t2.prototype.ir = function() {
    var t3 = this;
    this.er() && this.Xi === null && (this.Xi = this.Se.enqueueAfterDelay(this.zi, 6e4, function() {
      return t3.rr();
    }));
  }, t2.prototype.cr = function(t3) {
    this.ur(), this.stream.send(t3);
  }, t2.prototype.rr = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return this.er() ? [2, this.close(0)] : [2];
      });
    });
  }, t2.prototype.ur = function() {
    this.Xi && (this.Xi.cancel(), this.Xi = null);
  }, t2.prototype.close = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            return this.ur(), this.Zi.cancel(), this.Yi++, t3 !== 3 ? this.Zi.reset() : e && e.code === S2.RESOURCE_EXHAUSTED ? (C2(e.toString()), C2("Using maximum backoff delay to prevent overloading the backend."), this.Zi.Qi()) : e && e.code === S2.UNAUTHENTICATED && this.Ji.invalidateToken(), this.stream !== null && (this.ar(), this.stream.close(), this.stream = null), this.state = t3, [4, this.listener.Ri(e)];
          case 1:
            return n.sent(), [2];
        }
      });
    });
  }, t2.prototype.ar = function() {
  }, t2.prototype.auth = function() {
    var t3 = this;
    this.state = 1;
    var e = this.hr(this.Yi), n = this.Yi;
    this.Ji.getToken().then(function(e2) {
      t3.Yi === n && t3.lr(e2);
    }, function(n2) {
      e(function() {
        var e2 = new N2(S2.UNKNOWN, "Fetching auth token failed: " + n2.message);
        return t3.dr(e2);
      });
    });
  }, t2.prototype.lr = function(t3) {
    var e = this, n = this.hr(this.Yi);
    this.stream = this.wr(t3), this.stream.Ii(function() {
      n(function() {
        return e.state = 2, e.listener.Ii();
      });
    }), this.stream.Ri(function(t4) {
      n(function() {
        return e.dr(t4);
      });
    }), this.stream.onMessage(function(t4) {
      n(function() {
        return e.onMessage(t4);
      });
    });
  }, t2.prototype.nr = function() {
    var t3 = this;
    this.state = 4, this.Zi.ji(function() {
      return __awaiter(t3, void 0, void 0, function() {
        return __generator(this, function(t4) {
          return this.state = 0, this.start(), [2];
        });
      });
    });
  }, t2.prototype.dr = function(t3) {
    return k2("PersistentStream", "close with error: " + t3), this.stream = null, this.close(3, t3);
  }, t2.prototype.hr = function(t3) {
    var e = this;
    return function(n) {
      e.Se.enqueueAndForget(function() {
        return e.Yi === t3 ? n() : (k2("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve());
      });
    };
  }, t2;
}();
var Ro = function(e) {
  function n(t2, n2, r, i, o) {
    var s = this;
    return (s = e.call(this, t2, "listen_stream_connection_backoff", "listen_stream_idle", n2, r, o) || this).R = i, s;
  }
  return __extends(n, e), n.prototype.wr = function(t2) {
    return this.Hi.Oi("Listen", t2);
  }, n.prototype.onMessage = function(t2) {
    this.Zi.reset();
    var e2 = function(t3, e3) {
      var n3;
      if ("targetChange" in e3) {
        e3.targetChange;
        var r = function(t4) {
          return t4 === "NO_CHANGE" ? 0 : t4 === "ADD" ? 1 : t4 === "REMOVE" ? 2 : t4 === "CURRENT" ? 3 : t4 === "RESET" ? 4 : L2();
        }(e3.targetChange.targetChangeType || "NO_CHANGE"), i = e3.targetChange.targetIds || [], o = function(t4, e4) {
          return t4.I ? (O2(e4 === void 0 || typeof e4 == "string"), X2.fromBase64String(e4 || "")) : (O2(e4 === void 0 || e4 instanceof Uint8Array), X2.fromUint8Array(e4 || new Uint8Array()));
        }(t3, e3.targetChange.resumeToken), s = (u = e3.targetChange.cause) && function(t4) {
          var e4 = t4.code === void 0 ? S2.UNKNOWN : Ge(t4.code);
          return new N2(e4, t4.message || "");
        }(u);
        n3 = new ln(r, i, o, s || null);
      } else if ("documentChange" in e3) {
        e3.documentChange, (r = e3.documentChange).document, r.document.name, r.document.updateTime, i = Dn(t3, r.document.name), o = Tn(r.document.updateTime);
        var u = new Tt({
          mapValue: {
            fields: r.document.fields
          }
        }), a = (s = St.newFoundDocument(i, o, u), r.targetIds || []), c = r.removedTargetIds || [];
        n3 = new hn(a, c, s.key, s);
      } else if ("documentDelete" in e3)
        e3.documentDelete, (r = e3.documentDelete).document, i = Dn(t3, r.document), o = r.readTime ? Tn(r.readTime) : j.min(), u = St.newNoDocument(i, o), s = r.removedTargetIds || [], n3 = new hn([], s, u.key, u);
      else if ("documentRemove" in e3)
        e3.documentRemove, (r = e3.documentRemove).document, i = Dn(t3, r.document), o = r.removedTargetIds || [], n3 = new hn([], o, i, null);
      else {
        if (!("filter" in e3))
          return L2();
        e3.filter;
        var h = e3.filter;
        h.targetId, r = h.count || 0, i = new Ke(r), o = h.targetId, n3 = new fn(o, i);
      }
      return n3;
    }(this.R, t2), n2 = function(t3) {
      if (!("targetChange" in t3))
        return j.min();
      var e3 = t3.targetChange;
      return e3.targetIds && e3.targetIds.length ? j.min() : e3.readTime ? Tn(e3.readTime) : j.min();
    }(t2);
    return this.listener._r(e2, n2);
  }, n.prototype.mr = function(t2) {
    var e2 = {};
    e2.database = Cn(this.R), e2.addTarget = function(t3, e3) {
      var n3, r = e3.target;
      return (n3 = Ct(r) ? {
        documents: Fn(t3, r)
      } : {
        query: Mn(t3, r)
      }).targetId = e3.targetId, e3.resumeToken.approximateByteSize() > 0 ? n3.resumeToken = In(t3, e3.resumeToken) : e3.snapshotVersion.compareTo(j.min()) > 0 && (n3.readTime = bn(t3, e3.snapshotVersion.toTimestamp())), n3;
    }(this.R, t2);
    var n2 = function(t3, e3) {
      var n3 = function(t4, e4) {
        switch (e4) {
          case 0:
            return null;
          case 1:
            return "existence-filter-mismatch";
          case 2:
            return "limbo-document";
          default:
            return L2();
        }
      }(0, e3.purpose);
      return n3 == null ? null : {
        "goog-listen-tags": n3
      };
    }(this.R, t2);
    n2 && (e2.labels = n2), this.cr(e2);
  }, n.prototype.yr = function(t2) {
    var e2 = {};
    e2.database = Cn(this.R), e2.removeTarget = t2, this.cr(e2);
  }, n;
}(xo);
var Lo = function(e) {
  function n(t2, n2, r, i, o) {
    var s = this;
    return (s = e.call(this, t2, "write_stream_connection_backoff", "write_stream_idle", n2, r, o) || this).R = i, s.gr = false, s;
  }
  return __extends(n, e), Object.defineProperty(n.prototype, "pr", {
    get: function() {
      return this.gr;
    },
    enumerable: false,
    configurable: true
  }), n.prototype.start = function() {
    this.gr = false, this.lastStreamToken = void 0, e.prototype.start.call(this);
  }, n.prototype.ar = function() {
    this.gr && this.Er([]);
  }, n.prototype.wr = function(t2) {
    return this.Hi.Oi("Write", t2);
  }, n.prototype.onMessage = function(t2) {
    if (O2(!!t2.streamToken), this.lastStreamToken = t2.streamToken, this.gr) {
      this.Zi.reset();
      var e2 = function(t3, e3) {
        return t3 && t3.length > 0 ? (O2(e3 !== void 0), t3.map(function(t4) {
          return function(t5, e4) {
            var n3 = t5.updateTime ? Tn(t5.updateTime) : Tn(e4);
            return n3.isEqual(j.min()) && (n3 = Tn(e4)), new Se(n3, t5.transformResults || []);
          }(t4, e3);
        })) : [];
      }(t2.writeResults, t2.commitTime), n2 = Tn(t2.commitTime);
      return this.listener.Tr(n2, e2);
    }
    return O2(!t2.writeResults || t2.writeResults.length === 0), this.gr = true, this.listener.Ir();
  }, n.prototype.Ar = function() {
    var t2 = {};
    t2.database = Cn(this.R), this.cr(t2);
  }, n.prototype.Er = function(t2) {
    var e2 = this, n2 = {
      streamToken: this.lastStreamToken,
      writes: t2.map(function(t3) {
        return On(e2.R, t3);
      })
    };
    this.cr(n2);
  }, n;
}(xo);
var Oo = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).credentials = t2, i.Hi = n2, i.R = r, i.Rr = false, i;
  }
  return __extends(n, e), n.prototype.br = function() {
    if (this.Rr)
      throw new N2(S2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, n.prototype.Ni = function(t2, e2, n2) {
    var r = this;
    return this.br(), this.credentials.getToken().then(function(i) {
      return r.Hi.Ni(t2, e2, n2, i);
    }).catch(function(t3) {
      throw t3.name === "FirebaseError" ? (t3.code === S2.UNAUTHENTICATED && r.credentials.invalidateToken(), t3) : new N2(S2.UNKNOWN, t3.toString());
    });
  }, n.prototype.$i = function(t2, e2, n2) {
    var r = this;
    return this.br(), this.credentials.getToken().then(function(i) {
      return r.Hi.$i(t2, e2, n2, i);
    }).catch(function(t3) {
      throw t3.name === "FirebaseError" ? (t3.code === S2.UNAUTHENTICATED && r.credentials.invalidateToken(), t3) : new N2(S2.UNKNOWN, t3.toString());
    });
  }, n.prototype.terminate = function() {
    this.Rr = true;
  }, n;
}(function() {
});
var Po = function() {
  function t2(t3, e) {
    this.asyncQueue = t3, this.onlineStateHandler = e, this.state = "Unknown", this.vr = 0, this.Pr = null, this.Vr = true;
  }
  return t2.prototype.Sr = function() {
    var t3 = this;
    this.vr === 0 && (this.Dr("Unknown"), this.Pr = this.asyncQueue.enqueueAfterDelay("online_state_timeout", 1e4, function() {
      return t3.Pr = null, t3.Cr("Backend didn't respond within 10 seconds."), t3.Dr("Offline"), Promise.resolve();
    }));
  }, t2.prototype.Nr = function(t3) {
    this.state === "Online" ? this.Dr("Unknown") : (this.vr++, this.vr >= 1 && (this.Fr(), this.Cr("Connection failed 1 times. Most recent error: " + t3.toString()), this.Dr("Offline")));
  }, t2.prototype.set = function(t3) {
    this.Fr(), this.vr = 0, t3 === "Online" && (this.Vr = false), this.Dr(t3);
  }, t2.prototype.Dr = function(t3) {
    t3 !== this.state && (this.state = t3, this.onlineStateHandler(t3));
  }, t2.prototype.Cr = function(t3) {
    var e = "Could not reach Cloud Firestore backend. " + t3 + "\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";
    this.Vr ? (C2(e), this.Vr = false) : k2("OnlineStateTracker", e);
  }, t2.prototype.Fr = function() {
    this.Pr !== null && (this.Pr.cancel(), this.Pr = null);
  }, t2;
}();
var Fo = function(t2, e, i, o, s) {
  var u = this;
  this.localStore = t2, this.datastore = e, this.asyncQueue = i, this.remoteSyncer = {}, this.kr = [], this.$r = new Map(), this.Or = new Set(), this.Mr = [], this.Lr = s, this.Lr.di(function(t3) {
    i.enqueueAndForget(function() {
      return __awaiter(u, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return Go(this) ? (k2("RemoteStore", "Restarting streams for network reachability change."), [4, function(t5) {
                return __awaiter(this, void 0, void 0, function() {
                  var e2;
                  return __generator(this, function(n) {
                    switch (n.label) {
                      case 0:
                        return (e2 = P2(t5)).Or.add(4), [4, Vo(e2)];
                      case 1:
                        return n.sent(), e2.Br.set("Unknown"), e2.Or.delete(4), [4, Mo(e2)];
                      case 2:
                        return n.sent(), [2];
                    }
                  });
                });
              }(this)]) : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }), this.Br = new Po(i, o);
};
function Mo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          if (!Go(t2))
            return [3, 4];
          e = 0, n = t2.Mr, r.label = 1;
        case 1:
          return e < n.length ? [4, (0, n[e])(true)] : [3, 4];
        case 2:
          r.sent(), r.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function Vo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          e = 0, n = t2.Mr, r.label = 1;
        case 1:
          return e < n.length ? [4, (0, n[e])(false)] : [3, 4];
        case 2:
          r.sent(), r.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
function qo(t2, e) {
  var n = P2(t2);
  n.$r.has(e.targetId) || (n.$r.set(e.targetId, e), Qo(n) ? Ko(n) : ss(n).er() && Bo(n, e));
}
function Uo(t2, e) {
  var n = P2(t2), r = ss(n);
  n.$r.delete(e), r.er() && jo(n, e), n.$r.size === 0 && (r.er() ? r.ir() : Go(n) && n.Br.set("Unknown"));
}
function Bo(t2, e) {
  t2.qr.U(e.targetId), ss(t2).mr(e);
}
function jo(t2, e) {
  t2.qr.U(e), ss(t2).yr(e);
}
function Ko(t2) {
  t2.qr = new pn({
    getRemoteKeysForTarget: function(e) {
      return t2.remoteSyncer.getRemoteKeysForTarget(e);
    },
    lt: function(e) {
      return t2.$r.get(e) || null;
    }
  }), ss(t2).start(), t2.Br.Sr();
}
function Qo(t2) {
  return Go(t2) && !ss(t2).tr() && t2.$r.size > 0;
}
function Go(t2) {
  return P2(t2).Or.size === 0;
}
function zo(t2) {
  t2.qr = void 0;
}
function Wo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return t2.$r.forEach(function(e2, n) {
        Bo(t2, e2);
      }), [2];
    });
  });
}
function Ho(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n) {
      return zo(t2), Qo(t2) ? (t2.Br.Nr(e), Ko(t2)) : t2.Br.set("Unknown"), [2];
    });
  });
}
function Yo(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var o, s, u;
    return __generator(this, function(a) {
      switch (a.label) {
        case 0:
          if (t2.Br.set("Online"), !(e instanceof ln && e.state === 2 && e.cause))
            return [3, 6];
          a.label = 1;
        case 1:
          return a.trys.push([1, 3, , 5]), [
            4,
            function(t3, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n, i2, o2, s2;
                return __generator(this, function(r) {
                  switch (r.label) {
                    case 0:
                      n = e2.cause, i2 = 0, o2 = e2.targetIds, r.label = 1;
                    case 1:
                      return i2 < o2.length ? (s2 = o2[i2], t3.$r.has(s2) ? [4, t3.remoteSyncer.rejectListen(s2, n)] : [3, 3]) : [3, 5];
                    case 2:
                      r.sent(), t3.$r.delete(s2), t3.qr.removeTarget(s2), r.label = 3;
                    case 3:
                      r.label = 4;
                    case 4:
                      return i2++, [3, 1];
                    case 5:
                      return [2];
                  }
                });
              });
            }(t2, e)
          ];
        case 2:
          return a.sent(), [3, 5];
        case 3:
          return o = a.sent(), k2("RemoteStore", "Failed to remove targets %s: %s ", e.targetIds.join(","), o), [4, $o(t2, o)];
        case 4:
          return a.sent(), [3, 5];
        case 5:
          return [3, 13];
        case 6:
          if (e instanceof hn ? t2.qr.X(e) : e instanceof fn ? t2.qr.rt(e) : t2.qr.et(e), i.isEqual(j.min()))
            return [3, 13];
          a.label = 7;
        case 7:
          return a.trys.push([7, 11, , 13]), [4, ji(t2.localStore)];
        case 8:
          return s = a.sent(), i.compareTo(s) >= 0 ? [
            4,
            function(t3, e2) {
              var n = t3.qr.ut(e2);
              return n.targetChanges.forEach(function(n2, r) {
                if (n2.resumeToken.approximateByteSize() > 0) {
                  var i2 = t3.$r.get(r);
                  i2 && t3.$r.set(r, i2.withResumeToken(n2.resumeToken, e2));
                }
              }), n.targetMismatches.forEach(function(e3) {
                var n2 = t3.$r.get(e3);
                if (n2) {
                  t3.$r.set(e3, n2.withResumeToken(X2.EMPTY_BYTE_STRING, n2.snapshotVersion)), jo(t3, e3);
                  var r = new Or(n2.target, e3, 1, n2.sequenceNumber);
                  Bo(t3, r);
                }
              }), t3.remoteSyncer.applyRemoteEvent(n);
            }(t2, i)
          ] : [3, 10];
        case 9:
          a.sent(), a.label = 10;
        case 10:
          return [3, 13];
        case 11:
          return k2("RemoteStore", "Failed to raise snapshot:", u = a.sent()), [4, $o(t2, u)];
        case 12:
          return a.sent(), [3, 13];
        case 13:
          return [2];
      }
    });
  });
}
function $o(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var o = this;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          if (!Sr(e))
            throw e;
          return t2.Or.add(1), [4, Vo(t2)];
        case 1:
          return s.sent(), t2.Br.set("Offline"), i || (i = function() {
            return ji(t2.localStore);
          }), t2.asyncQueue.enqueueRetryable(function() {
            return __awaiter(o, void 0, void 0, function() {
              return __generator(this, function(e2) {
                switch (e2.label) {
                  case 0:
                    return k2("RemoteStore", "Retrying IndexedDB access"), [4, i()];
                  case 1:
                    return e2.sent(), t2.Or.delete(1), [4, Mo(t2)];
                  case 2:
                    return e2.sent(), [2];
                }
              });
            });
          }), [2];
      }
    });
  });
}
function Xo(t2, e) {
  return e().catch(function(n) {
    return $o(t2, n, e);
  });
}
function Jo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n, i, o, s;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          e = P2(t2), n = us(e), i = e.kr.length > 0 ? e.kr[e.kr.length - 1].batchId : -1, r.label = 1;
        case 1:
          if (!function(t3) {
            return Go(t3) && t3.kr.length < 10;
          }(e))
            return [3, 7];
          r.label = 2;
        case 2:
          return r.trys.push([2, 4, , 6]), [4, Gi(e.localStore, i)];
        case 3:
          return (o = r.sent()) === null ? (e.kr.length === 0 && n.ir(), [3, 7]) : (i = o.batchId, function(t3, e2) {
            t3.kr.push(e2);
            var n2 = us(t3);
            n2.er() && n2.pr && n2.Er(e2.mutations);
          }(e, o), [3, 6]);
        case 4:
          return s = r.sent(), [4, $o(e, s)];
        case 5:
          return r.sent(), [3, 6];
        case 6:
          return [3, 1];
        case 7:
          return Zo(e) && ts(e), [2];
      }
    });
  });
}
function Zo(t2) {
  return Go(t2) && !us(t2).tr() && t2.kr.length > 0;
}
function ts(t2) {
  us(t2).start();
}
function es(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return us(t2).Ar(), [2];
    });
  });
}
function ns(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n, i, o;
    return __generator(this, function(r) {
      for (e = us(t2), n = 0, i = t2.kr; n < i.length; n++)
        o = i[n], e.Er(o.mutations);
      return [2];
    });
  });
}
function rs(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return n = t2.kr.shift(), o = Lr.from(n, e, i), [4, Xo(t2, function() {
            return t2.remoteSyncer.applySuccessfulWrite(o);
          })];
        case 1:
          return r.sent(), [4, Jo(t2)];
        case 2:
          return r.sent(), [2];
      }
    });
  });
}
function is(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return e && us(t2).pr ? [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n, i2;
              return __generator(this, function(r) {
                switch (r.label) {
                  case 0:
                    return Qe(i2 = e2.code) && i2 !== S2.ABORTED ? (n = t3.kr.shift(), us(t3).sr(), [4, Xo(t3, function() {
                      return t3.remoteSyncer.rejectFailedWrite(n.batchId, e2);
                    })]) : [3, 3];
                  case 1:
                    return r.sent(), [4, Jo(t3)];
                  case 2:
                    r.sent(), r.label = 3;
                  case 3:
                    return [2];
                }
              });
            });
          }(t2, e)] : [3, 2];
        case 1:
          i.sent(), i.label = 2;
        case 2:
          return Zo(t2) && ts(t2), [2];
      }
    });
  });
}
function os(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return n = P2(t2), e ? (n.Or.delete(2), [4, Mo(n)]) : [3, 2];
        case 1:
          return r.sent(), [3, 5];
        case 2:
          return e ? [3, 4] : (n.Or.add(2), [4, Vo(n)]);
        case 3:
          r.sent(), n.Br.set("Unknown"), r.label = 4;
        case 4:
          r.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function ss(t2) {
  var e = this;
  return t2.Ur || (t2.Ur = function(t3, e2, n) {
    var r = P2(t3);
    return r.br(), new Ro(e2, r.Hi, r.credentials, r.R, n);
  }(t2.datastore, t2.asyncQueue, {
    Ii: Wo.bind(null, t2),
    Ri: Ho.bind(null, t2),
    _r: Yo.bind(null, t2)
  }), t2.Mr.push(function(i) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return i ? (t2.Ur.sr(), Qo(t2) ? Ko(t2) : t2.Br.set("Unknown"), [3, 3]) : [3, 1];
          case 1:
            return [4, t2.Ur.stop()];
          case 2:
            e2.sent(), zo(t2), e2.label = 3;
          case 3:
            return [2];
        }
      });
    });
  })), t2.Ur;
}
function us(t2) {
  var e = this;
  return t2.Kr || (t2.Kr = function(t3, e2, n) {
    var r = P2(t3);
    return r.br(), new Lo(e2, r.Hi, r.credentials, r.R, n);
  }(t2.datastore, t2.asyncQueue, {
    Ii: es.bind(null, t2),
    Ri: is.bind(null, t2),
    Ir: ns.bind(null, t2),
    Tr: rs.bind(null, t2)
  }), t2.Mr.push(function(i) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return i ? (t2.Kr.sr(), [4, Jo(t2)]) : [3, 2];
          case 1:
            return e2.sent(), [3, 4];
          case 2:
            return [4, t2.Kr.stop()];
          case 3:
            e2.sent(), t2.kr.length > 0 && (k2("RemoteStore", "Stopping write stream with " + t2.kr.length + " pending writes"), t2.kr = []), e2.label = 4;
          case 4:
            return [2];
        }
      });
    });
  })), t2.Kr;
}
var as = function() {
  function t2(t3, e, n, r, i) {
    this.asyncQueue = t3, this.timerId = e, this.targetTimeMs = n, this.op = r, this.removalCallback = i, this.deferred = new wr(), this.then = this.deferred.promise.then.bind(this.deferred.promise), this.deferred.promise.catch(function(t4) {
    });
  }
  return t2.createAndSchedule = function(e, n, r, i, o) {
    var s = new t2(e, n, Date.now() + r, i, o);
    return s.start(r), s;
  }, t2.prototype.start = function(t3) {
    var e = this;
    this.timerHandle = setTimeout(function() {
      return e.handleDelayElapsed();
    }, t3);
  }, t2.prototype.skipDelay = function() {
    return this.handleDelayElapsed();
  }, t2.prototype.cancel = function(t3) {
    this.timerHandle !== null && (this.clearTimeout(), this.deferred.reject(new N2(S2.CANCELLED, "Operation cancelled" + (t3 ? ": " + t3 : ""))));
  }, t2.prototype.handleDelayElapsed = function() {
    var t3 = this;
    this.asyncQueue.enqueueAndForget(function() {
      return t3.timerHandle !== null ? (t3.clearTimeout(), t3.op().then(function(e) {
        return t3.deferred.resolve(e);
      })) : Promise.resolve();
    });
  }, t2.prototype.clearTimeout = function() {
    this.timerHandle !== null && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
  }, t2;
}();
function cs(t2, e) {
  if (C2("AsyncQueue", e + ": " + t2), Sr(t2))
    return new N2(S2.UNAVAILABLE, e + ": " + t2);
  throw t2;
}
var hs = function() {
  function t2(t3) {
    this.comparator = t3 ? function(e, n) {
      return t3(e, n) || at.comparator(e.key, n.key);
    } : function(t4, e) {
      return at.comparator(t4.key, e.key);
    }, this.keyedMap = tn(), this.sortedSet = new ze(this.comparator);
  }
  return t2.emptySet = function(e) {
    return new t2(e.comparator);
  }, t2.prototype.has = function(t3) {
    return this.keyedMap.get(t3) != null;
  }, t2.prototype.get = function(t3) {
    return this.keyedMap.get(t3);
  }, t2.prototype.first = function() {
    return this.sortedSet.minKey();
  }, t2.prototype.last = function() {
    return this.sortedSet.maxKey();
  }, t2.prototype.isEmpty = function() {
    return this.sortedSet.isEmpty();
  }, t2.prototype.indexOf = function(t3) {
    var e = this.keyedMap.get(t3);
    return e ? this.sortedSet.indexOf(e) : -1;
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.sortedSet.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3) {
    this.sortedSet.inorderTraversal(function(e, n) {
      return t3(e), false;
    });
  }, t2.prototype.add = function(t3) {
    var e = this.delete(t3.key);
    return e.copy(e.keyedMap.insert(t3.key, t3), e.sortedSet.insert(t3, null));
  }, t2.prototype.delete = function(t3) {
    var e = this.get(t3);
    return e ? this.copy(this.keyedMap.remove(t3), this.sortedSet.remove(e)) : this;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n = this.sortedSet.getIterator(), r = e.sortedSet.getIterator(); n.hasNext(); ) {
      var i = n.getNext().key, o = r.getNext().key;
      if (!i.isEqual(o))
        return false;
    }
    return true;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e.toString());
    }), t3.length === 0 ? "DocumentSet ()" : "DocumentSet (\n  " + t3.join("  \n") + "\n)";
  }, t2.prototype.copy = function(e, n) {
    var r = new t2();
    return r.comparator = this.comparator, r.keyedMap = e, r.sortedSet = n, r;
  }, t2;
}();
var fs = function() {
  function t2() {
    this.Qr = new ze(at.comparator);
  }
  return t2.prototype.track = function(t3) {
    var e = t3.doc.key, n = this.Qr.get(e);
    n ? t3.type !== 0 && n.type === 3 ? this.Qr = this.Qr.insert(e, t3) : t3.type === 3 && n.type !== 1 ? this.Qr = this.Qr.insert(e, {
      type: n.type,
      doc: t3.doc
    }) : t3.type === 2 && n.type === 2 ? this.Qr = this.Qr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : t3.type === 2 && n.type === 0 ? this.Qr = this.Qr.insert(e, {
      type: 0,
      doc: t3.doc
    }) : t3.type === 1 && n.type === 0 ? this.Qr = this.Qr.remove(e) : t3.type === 1 && n.type === 2 ? this.Qr = this.Qr.insert(e, {
      type: 1,
      doc: n.doc
    }) : t3.type === 0 && n.type === 1 ? this.Qr = this.Qr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : L2() : this.Qr = this.Qr.insert(e, t3);
  }, t2.prototype.jr = function() {
    var t3 = [];
    return this.Qr.inorderTraversal(function(e, n) {
      t3.push(n);
    }), t3;
  }, t2;
}();
var ls = function() {
  function t2(t3, e, n, r, i, o, s, u) {
    this.query = t3, this.docs = e, this.oldDocs = n, this.docChanges = r, this.mutatedKeys = i, this.fromCache = o, this.syncStateChanged = s, this.excludesMetadataChanges = u;
  }
  return t2.fromInitialDocuments = function(e, n, r, i) {
    var o = [];
    return n.forEach(function(t3) {
      o.push({
        type: 0,
        doc: t3
      });
    }), new t2(e, n, hs.emptySet(n), o, r, i, true, false);
  }, Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return !this.mutatedKeys.isEmpty();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    if (!(this.fromCache === t3.fromCache && this.syncStateChanged === t3.syncStateChanged && this.mutatedKeys.isEqual(t3.mutatedKeys) && re(this.query, t3.query) && this.docs.isEqual(t3.docs) && this.oldDocs.isEqual(t3.oldDocs)))
      return false;
    var e = this.docChanges, n = t3.docChanges;
    if (e.length !== n.length)
      return false;
    for (var r = 0; r < e.length; r++)
      if (e[r].type !== n[r].type || !e[r].doc.isEqual(n[r].doc))
        return false;
    return true;
  }, t2;
}();
var ds = function() {
  this.Wr = void 0, this.listeners = [];
};
var ps = function() {
  this.queries = new bi(function(t2) {
    return ie(t2);
  }, re), this.onlineState = "Unknown", this.Gr = new Set();
};
function ys(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s, u, a, c;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          if (n = P2(t2), i = e.query, o = false, (s = n.queries.get(i)) || (o = true, s = new ds()), !o)
            return [3, 4];
          r.label = 1;
        case 1:
          return r.trys.push([1, 3, , 4]), u = s, [4, n.onListen(i)];
        case 2:
          return u.Wr = r.sent(), [3, 4];
        case 3:
          return a = r.sent(), c = cs(a, "Initialization of query '" + oe(e.query) + "' failed"), [2, void e.onError(c)];
        case 4:
          return n.queries.set(i, s), s.listeners.push(e), e.zr(n.onlineState), s.Wr && e.Hr(s.Wr) && ws(n), [2];
      }
    });
  });
}
function vs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s, u;
    return __generator(this, function(r) {
      return n = P2(t2), i = e.query, o = false, (s = n.queries.get(i)) && (u = s.listeners.indexOf(e)) >= 0 && (s.listeners.splice(u, 1), o = s.listeners.length === 0), o ? [2, (n.queries.delete(i), n.onUnlisten(i))] : [2];
    });
  });
}
function ms(t2, e) {
  for (var n = P2(t2), r = false, i = 0, o = e; i < o.length; i++) {
    var s = o[i], u = s.query, a = n.queries.get(u);
    if (a) {
      for (var c = 0, h = a.listeners; c < h.length; c++) {
        h[c].Hr(s) && (r = true);
      }
      a.Wr = s;
    }
  }
  r && ws(n);
}
function gs(t2, e, n) {
  var r = P2(t2), i = r.queries.get(e);
  if (i)
    for (var o = 0, s = i.listeners; o < s.length; o++) {
      s[o].onError(n);
    }
  r.queries.delete(e);
}
function ws(t2) {
  t2.Gr.forEach(function(t3) {
    t3.next();
  });
}
var bs = function() {
  function t2(t3, e, n) {
    this.query = t3, this.Jr = e, this.Yr = false, this.Xr = null, this.onlineState = "Unknown", this.options = n || {};
  }
  return t2.prototype.Hr = function(t3) {
    if (!this.options.includeMetadataChanges) {
      for (var e = [], n = 0, r = t3.docChanges; n < r.length; n++) {
        var i = r[n];
        i.type !== 3 && e.push(i);
      }
      t3 = new ls(t3.query, t3.docs, t3.oldDocs, e, t3.mutatedKeys, t3.fromCache, t3.syncStateChanged, true);
    }
    var o = false;
    return this.Yr ? this.Zr(t3) && (this.Jr.next(t3), o = true) : this.eo(t3, this.onlineState) && (this.no(t3), o = true), this.Xr = t3, o;
  }, t2.prototype.onError = function(t3) {
    this.Jr.error(t3);
  }, t2.prototype.zr = function(t3) {
    this.onlineState = t3;
    var e = false;
    return this.Xr && !this.Yr && this.eo(this.Xr, t3) && (this.no(this.Xr), e = true), e;
  }, t2.prototype.eo = function(t3, e) {
    if (!t3.fromCache)
      return true;
    var n = e !== "Offline";
    return !(this.options.so && n || t3.docs.isEmpty() && e !== "Offline");
  }, t2.prototype.Zr = function(t3) {
    if (t3.docChanges.length > 0)
      return true;
    var e = this.Xr && this.Xr.hasPendingWrites !== t3.hasPendingWrites;
    return !(!t3.syncStateChanged && !e) && this.options.includeMetadataChanges === true;
  }, t2.prototype.no = function(t3) {
    t3 = ls.fromInitialDocuments(t3.query, t3.docs, t3.mutatedKeys, t3.fromCache), this.Yr = true, this.Jr.next(t3);
  }, t2;
}();
var Is = function() {
  function t2(t3, e) {
    this.payload = t3, this.byteLength = e;
  }
  return t2.prototype.io = function() {
    return "metadata" in this.payload;
  }, t2;
}();
var Es = function() {
  function t2(t3) {
    this.R = t3;
  }
  return t2.prototype.qn = function(t3) {
    return Dn(this.R, t3);
  }, t2.prototype.Un = function(t3) {
    return t3.metadata.exists ? Ln(this.R, t3.document, false) : St.newNoDocument(this.qn(t3.metadata.name), this.Kn(t3.metadata.readTime));
  }, t2.prototype.Kn = function(t3) {
    return Tn(t3);
  }, t2;
}();
var Ts = function() {
  function t2(t3, e, n) {
    this.ro = t3, this.localStore = e, this.R = n, this.queries = [], this.documents = [], this.progress = _s(t3);
  }
  return t2.prototype.oo = function(t3) {
    this.progress.bytesLoaded += t3.byteLength;
    var e = this.progress.documentsLoaded;
    return t3.payload.namedQuery ? this.queries.push(t3.payload.namedQuery) : t3.payload.documentMetadata ? (this.documents.push({
      metadata: t3.payload.documentMetadata
    }), t3.payload.documentMetadata.exists || ++e) : t3.payload.document && (this.documents[this.documents.length - 1].document = t3.payload.document, ++e), e !== this.progress.documentsLoaded ? (this.progress.documentsLoaded = e, Object.assign({}, this.progress)) : null;
  }, t2.prototype.co = function(t3) {
    for (var e = new Map(), n = new Es(this.R), r = 0, i = t3; r < i.length; r++) {
      var o = i[r];
      if (o.metadata.queries)
        for (var s = n.qn(o.metadata.name), u = 0, a = o.metadata.queries; u < a.length; u++) {
          var c = a[u], h = (e.get(c) || on()).add(s);
          e.set(c, h);
        }
    }
    return e;
  }, t2.prototype.complete = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n, i, o;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return [4, Ji(this.localStore, new Es(this.R), this.documents, this.ro.id)];
          case 1:
            t3 = r.sent(), e = this.co(this.documents), n = 0, i = this.queries, r.label = 2;
          case 2:
            return n < i.length ? (o = i[n], [4, Zi(this.localStore, o, e.get(o.name))]) : [3, 5];
          case 3:
            r.sent(), r.label = 4;
          case 4:
            return n++, [3, 2];
          case 5:
            return [2, (this.progress.taskState = "Success", new Oi(Object.assign({}, this.progress), t3))];
        }
      });
    });
  }, t2;
}();
function _s(t2) {
  return {
    taskState: "Running",
    documentsLoaded: 0,
    bytesLoaded: 0,
    totalDocuments: t2.totalDocuments,
    totalBytes: t2.totalBytes
  };
}
var Ss = function(t2) {
  this.key = t2;
};
var Ns = function(t2) {
  this.key = t2;
};
var Ds = function() {
  function t2(t3, e) {
    this.query = t3, this.uo = e, this.ao = null, this.current = false, this.ho = on(), this.mutatedKeys = on(), this.lo = ue(t3), this.fo = new hs(this.lo);
  }
  return Object.defineProperty(t2.prototype, "wo", {
    get: function() {
      return this.uo;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype._o = function(t3, e) {
    var n = this, r = e ? e.mo : new fs(), i = e ? e.fo : this.fo, o = e ? e.mutatedKeys : this.mutatedKeys, s = i, u = false, a = Yt(this.query) && i.size === this.query.limit ? i.last() : null, c = $t(this.query) && i.size === this.query.limit ? i.first() : null;
    if (t3.inorderTraversal(function(t4, e2) {
      var h2 = i.get(t4), f = se(n.query, e2) ? e2 : null, l2 = !!h2 && n.mutatedKeys.has(h2.key), d2 = !!f && (f.hasLocalMutations || n.mutatedKeys.has(f.key) && f.hasCommittedMutations), p2 = false;
      h2 && f ? h2.data.isEqual(f.data) ? l2 !== d2 && (r.track({
        type: 3,
        doc: f
      }), p2 = true) : n.yo(h2, f) || (r.track({
        type: 2,
        doc: f
      }), p2 = true, (a && n.lo(f, a) > 0 || c && n.lo(f, c) < 0) && (u = true)) : !h2 && f ? (r.track({
        type: 0,
        doc: f
      }), p2 = true) : h2 && !f && (r.track({
        type: 1,
        doc: h2
      }), p2 = true, (a || c) && (u = true)), p2 && (f ? (s = s.add(f), o = d2 ? o.add(t4) : o.delete(t4)) : (s = s.delete(t4), o = o.delete(t4)));
    }), Yt(this.query) || $t(this.query))
      for (; s.size > this.query.limit; ) {
        var h = Yt(this.query) ? s.last() : s.first();
        s = s.delete(h.key), o = o.delete(h.key), r.track({
          type: 1,
          doc: h
        });
      }
    return {
      fo: s,
      mo: r,
      Nn: u,
      mutatedKeys: o
    };
  }, t2.prototype.yo = function(t3, e) {
    return t3.hasLocalMutations && e.hasCommittedMutations && !e.hasLocalMutations;
  }, t2.prototype.applyChanges = function(t3, e, n) {
    var r = this, i = this.fo;
    this.fo = t3.fo, this.mutatedKeys = t3.mutatedKeys;
    var o = t3.mo.jr();
    o.sort(function(t4, e2) {
      return function(t5, e3) {
        var n2 = function(t6) {
          switch (t6) {
            case 0:
              return 1;
            case 2:
            case 3:
              return 2;
            case 1:
              return 0;
            default:
              return L2();
          }
        };
        return n2(t5) - n2(e3);
      }(t4.type, e2.type) || r.lo(t4.doc, e2.doc);
    }), this.po(n);
    var s = e ? this.Eo() : [], u = this.ho.size === 0 && this.current ? 1 : 0, a = u !== this.ao;
    return this.ao = u, o.length !== 0 || a ? {
      snapshot: new ls(this.query, t3.fo, i, o, t3.mutatedKeys, u === 0, a, false),
      To: s
    } : {
      To: s
    };
  }, t2.prototype.zr = function(t3) {
    return this.current && t3 === "Offline" ? (this.current = false, this.applyChanges({
      fo: this.fo,
      mo: new fs(),
      mutatedKeys: this.mutatedKeys,
      Nn: false
    }, false)) : {
      To: []
    };
  }, t2.prototype.Io = function(t3) {
    return !this.uo.has(t3) && !!this.fo.has(t3) && !this.fo.get(t3).hasLocalMutations;
  }, t2.prototype.po = function(t3) {
    var e = this;
    t3 && (t3.addedDocuments.forEach(function(t4) {
      return e.uo = e.uo.add(t4);
    }), t3.modifiedDocuments.forEach(function(t4) {
    }), t3.removedDocuments.forEach(function(t4) {
      return e.uo = e.uo.delete(t4);
    }), this.current = t3.current);
  }, t2.prototype.Eo = function() {
    var t3 = this;
    if (!this.current)
      return [];
    var e = this.ho;
    this.ho = on(), this.fo.forEach(function(e2) {
      t3.Io(e2.key) && (t3.ho = t3.ho.add(e2.key));
    });
    var n = [];
    return e.forEach(function(e2) {
      t3.ho.has(e2) || n.push(new Ns(e2));
    }), this.ho.forEach(function(t4) {
      e.has(t4) || n.push(new Ss(t4));
    }), n;
  }, t2.prototype.Ao = function(t3) {
    this.uo = t3.Bn, this.ho = on();
    var e = this._o(t3.documents);
    return this.applyChanges(e, true);
  }, t2.prototype.Ro = function() {
    return ls.fromInitialDocuments(this.query, this.fo, this.mutatedKeys, this.ao === 0);
  }, t2;
}();
var As = function(t2, e, n) {
  this.query = t2, this.targetId = e, this.view = n;
};
var ks = function(t2) {
  this.key = t2, this.bo = false;
};
var Cs = function() {
  function t2(t3, e, n, r, i, o) {
    this.localStore = t3, this.remoteStore = e, this.eventManager = n, this.sharedClientState = r, this.currentUser = i, this.maxConcurrentLimboResolutions = o, this.vo = {}, this.Po = new bi(function(t4) {
      return ie(t4);
    }, re), this.Vo = new Map(), this.So = new Set(), this.Do = new ze(at.comparator), this.Co = new Map(), this.No = new eo(), this.xo = {}, this.Fo = new Map(), this.ko = ai.Yt(), this.onlineState = "Unknown", this.$o = void 0;
  }
  return Object.defineProperty(t2.prototype, "isPrimaryClient", {
    get: function() {
      return this.$o === true;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
function xs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s, u, a;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return n = su(t2), (s = n.Po.get(e)) ? (i = s.targetId, n.sharedClientState.addLocalQueryTarget(i), o = s.view.Ro(), [3, 4]) : [3, 1];
        case 1:
          return [4, zi(n.localStore, ee(e))];
        case 2:
          return u = r.sent(), a = n.sharedClientState.addLocalQueryTarget(u.targetId), i = u.targetId, [4, Rs(n, e, i, a === "current")];
        case 3:
          o = r.sent(), n.isPrimaryClient && qo(n.remoteStore, u), r.label = 4;
        case 4:
          return [2, o];
      }
    });
  });
}
function Rs(t2, e, i, o) {
  return __awaiter(this, void 0, void 0, function() {
    var s, u, a, c, h, f;
    return __generator(this, function(l2) {
      switch (l2.label) {
        case 0:
          return t2.Oo = function(e2, i2, o2) {
            return function(t3, e3, i3, o3) {
              return __awaiter(this, void 0, void 0, function() {
                var n, s2, u2;
                return __generator(this, function(r) {
                  switch (r.label) {
                    case 0:
                      return n = e3.view._o(i3), n.Nn ? [4, Hi(t3.localStore, e3.query, false).then(function(t4) {
                        var r2 = t4.documents;
                        return e3.view._o(r2, n);
                      })] : [3, 2];
                    case 1:
                      n = r.sent(), r.label = 2;
                    case 2:
                      return s2 = o3 && o3.targetChanges.get(e3.targetId), u2 = e3.view.applyChanges(n, t3.isPrimaryClient, s2), [2, (Gs(t3, e3.targetId, u2.To), u2.snapshot)];
                  }
                });
              });
            }(t2, e2, i2, o2);
          }, [4, Hi(t2.localStore, e, true)];
        case 1:
          return s = l2.sent(), u = new Ds(e, s.Bn), a = u._o(s.documents), c = cn.createSynthesizedTargetChangeForCurrentChange(i, o && t2.onlineState !== "Offline"), h = u.applyChanges(a, t2.isPrimaryClient, c), Gs(t2, i, h.To), f = new As(e, i, u), [2, (t2.Po.set(e, f), t2.Vo.has(i) ? t2.Vo.get(i).push(e) : t2.Vo.set(i, [e]), h.snapshot)];
      }
    });
  });
}
function Ls(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return n = P2(t2), i = n.Po.get(e), (o = n.Vo.get(i.targetId)).length > 1 ? [2, (n.Vo.set(i.targetId, o.filter(function(t3) {
            return !re(t3, e);
          })), void n.Po.delete(e))] : n.isPrimaryClient ? (n.sharedClientState.removeLocalQueryTarget(i.targetId), n.sharedClientState.isActiveQueryTarget(i.targetId) ? [3, 2] : [4, Wi(n.localStore, i.targetId, false).then(function() {
            n.sharedClientState.clearQueryState(i.targetId), Uo(n.remoteStore, i.targetId), Ks(n, i.targetId);
          }).catch(di)]) : [3, 3];
        case 1:
          r.sent(), r.label = 2;
        case 2:
          return [3, 5];
        case 3:
          return Ks(n, i.targetId), [4, Wi(n.localStore, i.targetId, true)];
        case 4:
          r.sent(), r.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
function Os(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o, s, u;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = uu(t2), r.label = 1;
        case 1:
          return r.trys.push([1, 5, , 6]), [4, function(t3, e2) {
            var n2, r2 = P2(t3), i2 = B2.now(), o2 = e2.reduce(function(t4, e3) {
              return t4.add(e3.key);
            }, on());
            return r2.persistence.runTransaction("Locally write mutations", "readwrite", function(t4) {
              return r2.Mn.pn(t4, o2).next(function(o3) {
                n2 = o3;
                for (var s2 = [], u2 = 0, a = e2; u2 < a.length; u2++) {
                  var c = a[u2], h = xe(c, n2.get(c.key));
                  h != null && s2.push(new Pe(c.key, h, _t(h.value.mapValue), Ne.exists(true)));
                }
                return r2._n.addMutationBatch(t4, i2, s2, e2);
              });
            }).then(function(t4) {
              return t4.applyToLocalDocumentSet(n2), {
                batchId: t4.batchId,
                changes: n2
              };
            });
          }(n.localStore, e)];
        case 2:
          return o = r.sent(), n.sharedClientState.addPendingMutation(o.batchId), function(t3, e2, n2) {
            var r2 = t3.xo[t3.currentUser.toKey()];
            r2 || (r2 = new ze(V2)), r2 = r2.insert(e2, n2), t3.xo[t3.currentUser.toKey()] = r2;
          }(n, o.batchId, i), [4, Hs(n, o.changes)];
        case 3:
          return r.sent(), [4, Jo(n.remoteStore)];
        case 4:
          return r.sent(), [3, 6];
        case 5:
          return s = r.sent(), u = cs(s, "Failed to persist write"), i.reject(u), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Ps(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = P2(t2), r.label = 1;
        case 1:
          return r.trys.push([1, 4, , 6]), [4, Ki(n.localStore, e)];
        case 2:
          return i = r.sent(), e.targetChanges.forEach(function(t3, e2) {
            var r2 = n.Co.get(e2);
            r2 && (O2(t3.addedDocuments.size + t3.modifiedDocuments.size + t3.removedDocuments.size <= 1), t3.addedDocuments.size > 0 ? r2.bo = true : t3.modifiedDocuments.size > 0 ? O2(r2.bo) : t3.removedDocuments.size > 0 && (O2(r2.bo), r2.bo = false));
          }), [4, Hs(n, i, e)];
        case 3:
          return r.sent(), [3, 6];
        case 4:
          return [4, di(r.sent())];
        case 5:
          return r.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Fs(t2, e, n) {
  var r = P2(t2);
  if (r.isPrimaryClient && n === 0 || !r.isPrimaryClient && n === 1) {
    var i = [];
    r.Po.forEach(function(t3, n2) {
      var r2 = n2.view.zr(e);
      r2.snapshot && i.push(r2.snapshot);
    }), function(t3, e2) {
      var n2 = P2(t3);
      n2.onlineState = e2;
      var r2 = false;
      n2.queries.forEach(function(t4, n3) {
        for (var i2 = 0, o = n3.listeners; i2 < o.length; i2++) {
          o[i2].zr(e2) && (r2 = true);
        }
      }), r2 && ws(n2);
    }(r.eventManager, e), i.length && r.vo._r(i), r.onlineState = e, r.isPrimaryClient && r.sharedClientState.setOnlineState(e);
  }
}
function Ms(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o, s, u, a, c;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return (n = P2(t2)).sharedClientState.updateQueryState(e, "rejected", i), o = n.Co.get(e), (s = o && o.key) ? (u = (u = new ze(at.comparator)).insert(s, St.newNoDocument(s, j.min())), a = on().add(s), c = new an(j.min(), new Map(), new Ye(V2), u, a), [4, Ps(n, c)]) : [3, 2];
        case 1:
          return r.sent(), n.Do = n.Do.remove(s), n.Co.delete(e), Ws(n), [3, 4];
        case 2:
          return [4, Wi(n.localStore, e, false).then(function() {
            return Ks(n, e, i);
          }).catch(di)];
        case 3:
          r.sent(), r.label = 4;
        case 4:
          return [2];
      }
    });
  });
}
function Vs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = P2(t2), i = e.batch.batchId, r.label = 1;
        case 1:
          return r.trys.push([1, 4, , 6]), [4, Bi(n.localStore, e)];
        case 2:
          return o = r.sent(), js(n, i, null), Bs(n, i), n.sharedClientState.updateMutationState(i, "acknowledged"), [4, Hs(n, o)];
        case 3:
          return r.sent(), [3, 6];
        case 4:
          return [4, di(r.sent())];
        case 5:
          return r.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function qs(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = P2(t2), r.label = 1;
        case 1:
          return r.trys.push([1, 4, , 6]), [4, function(t3, e2) {
            var n2 = P2(t3);
            return n2.persistence.runTransaction("Reject batch", "readwrite-primary", function(t4) {
              var r2;
              return n2._n.lookupMutationBatch(t4, e2).next(function(e3) {
                return O2(e3 !== null), r2 = e3.keys(), n2._n.removeMutationBatch(t4, e3);
              }).next(function() {
                return n2._n.performConsistencyCheck(t4);
              }).next(function() {
                return n2.Mn.pn(t4, r2);
              });
            });
          }(n.localStore, e)];
        case 2:
          return o = r.sent(), js(n, e, i), Bs(n, e), n.sharedClientState.updateMutationState(e, "rejected", i), [4, Hs(n, o)];
        case 3:
          return r.sent(), [3, 6];
        case 4:
          return [4, di(r.sent())];
        case 5:
          return r.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
function Us(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s, u;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          Go((n = P2(t2)).remoteStore) || k2("SyncEngine", "The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."), r.label = 1;
        case 1:
          return r.trys.push([1, 3, , 4]), [4, function(t3) {
            var e2 = P2(t3);
            return e2.persistence.runTransaction("Get highest unacknowledged batch id", "readonly", function(t4) {
              return e2._n.getHighestUnacknowledgedBatchId(t4);
            });
          }(n.localStore)];
        case 2:
          return (i = r.sent()) === -1 ? [2, void e.resolve()] : ((o = n.Fo.get(i) || []).push(e), n.Fo.set(i, o), [3, 4]);
        case 3:
          return s = r.sent(), u = cs(s, "Initialization of waitForPendingWrites() operation failed"), e.reject(u), [3, 4];
        case 4:
          return [2];
      }
    });
  });
}
function Bs(t2, e) {
  (t2.Fo.get(e) || []).forEach(function(t3) {
    t3.resolve();
  }), t2.Fo.delete(e);
}
function js(t2, e, n) {
  var r = P2(t2), i = r.xo[r.currentUser.toKey()];
  if (i) {
    var o = i.get(e);
    o && (n ? o.reject(n) : o.resolve(), i = i.remove(e)), r.xo[r.currentUser.toKey()] = i;
  }
}
function Ks(t2, e, n) {
  n === void 0 && (n = null), t2.sharedClientState.removeLocalQueryTarget(e);
  for (var r = 0, i = t2.Vo.get(e); r < i.length; r++) {
    var o = i[r];
    t2.Po.delete(o), n && t2.vo.Mo(o, n);
  }
  t2.Vo.delete(e), t2.isPrimaryClient && t2.No.Zn(e).forEach(function(e2) {
    t2.No.containsKey(e2) || Qs(t2, e2);
  });
}
function Qs(t2, e) {
  t2.So.delete(e.path.canonicalString());
  var n = t2.Do.get(e);
  n !== null && (Uo(t2.remoteStore, n), t2.Do = t2.Do.remove(e), t2.Co.delete(n), Ws(t2));
}
function Gs(t2, e, n) {
  for (var r = 0, i = n; r < i.length; r++) {
    var o = i[r];
    o instanceof Ss ? (t2.No.addReference(o.key, e), zs(t2, o)) : o instanceof Ns ? (k2("SyncEngine", "Document no longer in limbo: " + o.key), t2.No.removeReference(o.key, e), t2.No.containsKey(o.key) || Qs(t2, o.key)) : L2();
  }
}
function zs(t2, e) {
  var n = e.key, r = n.path.canonicalString();
  t2.Do.get(n) || t2.So.has(r) || (k2("SyncEngine", "New document in limbo: " + n), t2.So.add(r), Ws(t2));
}
function Ws(t2) {
  for (; t2.So.size > 0 && t2.Do.size < t2.maxConcurrentLimboResolutions; ) {
    var e = t2.So.values().next().value;
    t2.So.delete(e);
    var n = new at(W2.fromString(e)), r = t2.ko.next();
    t2.Co.set(r, new ks(n)), t2.Do = t2.Do.insert(n, r), qo(t2.remoteStore, new Or(ee(Ht(n.path)), r, 2, _.o));
  }
}
function Hs(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var o, s, u, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          return o = P2(t2), s = [], u = [], a = [], o.Po.isEmpty() ? [3, 3] : (o.Po.forEach(function(t3, n) {
            a.push(o.Oo(n, e, i).then(function(t4) {
              if (t4) {
                o.isPrimaryClient && o.sharedClientState.updateQueryState(n.targetId, t4.fromCache ? "not-current" : "current"), s.push(t4);
                var e2 = Fi.Pn(n.targetId, t4);
                u.push(e2);
              }
            }));
          }), [4, Promise.all(a)]);
        case 1:
          return c.sent(), o.vo._r(s), [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n, i2, o2, s2, u2, a2, c2, h, f;
              return __generator(this, function(r) {
                switch (r.label) {
                  case 0:
                    n = P2(t3), r.label = 1;
                  case 1:
                    return r.trys.push([1, 3, , 4]), [4, n.persistence.runTransaction("notifyLocalViewChanges", "readwrite", function(t4) {
                      return br.forEach(e2, function(e3) {
                        return br.forEach(e3.bn, function(r2) {
                          return n.persistence.referenceDelegate.addReference(t4, e3.targetId, r2);
                        }).next(function() {
                          return br.forEach(e3.vn, function(r2) {
                            return n.persistence.referenceDelegate.removeReference(t4, e3.targetId, r2);
                          });
                        });
                      });
                    })];
                  case 2:
                    return r.sent(), [3, 4];
                  case 3:
                    if (!Sr(i2 = r.sent()))
                      throw i2;
                    return k2("LocalStore", "Failed to update sequence numbers: " + i2), [3, 4];
                  case 4:
                    for (o2 = 0, s2 = e2; o2 < s2.length; o2++)
                      u2 = s2[o2], a2 = u2.targetId, u2.fromCache || (c2 = n.Fn.get(a2), h = c2.snapshotVersion, f = c2.withLastLimboFreeSnapshotVersion(h), n.Fn = n.Fn.insert(a2, f));
                    return [2];
                }
              });
            });
          }(o.localStore, u)];
        case 2:
          c.sent(), c.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function Ys(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return (n = P2(t2)).currentUser.isEqual(e) ? [3, 3] : (k2("SyncEngine", "User change. New user:", e.toKey()), [4, Ui(n.localStore, e)]);
        case 1:
          return i = r.sent(), n.currentUser = e, function(t3, e2) {
            t3.Fo.forEach(function(t4) {
              t4.forEach(function(t5) {
                t5.reject(new N2(S2.CANCELLED, "'waitForPendingWrites' promise is rejected due to a user change."));
              });
            }), t3.Fo.clear();
          }(n), n.sharedClientState.handleUserChange(e, i.removedBatchIds, i.addedBatchIds), [4, Hs(n, i.Ln)];
        case 2:
          r.sent(), r.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
function $s(t2, e) {
  var n = P2(t2), r = n.Co.get(e);
  if (r && r.bo)
    return on().add(r.key);
  var i = on(), o = n.Vo.get(e);
  if (!o)
    return i;
  for (var s = 0, u = o; s < u.length; s++) {
    var a = u[s], c = n.Po.get(a);
    i = i.unionWith(c.view.wo);
  }
  return i;
}
function Xs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return [4, Hi((n = P2(t2)).localStore, e.query, true)];
        case 1:
          return i = r.sent(), o = e.view.Ao(i), [2, (n.isPrimaryClient && Gs(n, e.targetId, o.To), o)];
      }
    });
  });
}
function Js(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n) {
      return [2, $i((e = P2(t2)).localStore).then(function(t3) {
        return Hs(e, t3);
      })];
    });
  });
}
function Zs(t2, e, i, o) {
  return __awaiter(this, void 0, void 0, function() {
    var n, s;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return [4, function(t3, e2) {
            var n2 = P2(t3), r2 = P2(n2._n);
            return n2.persistence.runTransaction("Lookup mutation documents", "readonly", function(t4) {
              return r2.jt(t4, e2).next(function(e3) {
                return e3 ? n2.Mn.pn(t4, e3) : br.resolve(null);
              });
            });
          }((n = P2(t2)).localStore, e)];
        case 1:
          return (s = r.sent()) === null ? [3, 6] : i !== "pending" ? [3, 3] : [4, Jo(n.remoteStore)];
        case 2:
          return r.sent(), [3, 4];
        case 3:
          i === "acknowledged" || i === "rejected" ? (js(n, e, o || null), Bs(n, e), function(t3, e2) {
            P2(P2(t3)._n).Gt(e2);
          }(n.localStore, e)) : L2(), r.label = 4;
        case 4:
          return [4, Hs(n, s)];
        case 5:
          return r.sent(), [3, 7];
        case 6:
          k2("SyncEngine", "Cannot apply mutation batch with id: " + e), r.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function tu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i, o, s, u, a, c, h;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return su(n = P2(t2)), uu(n), e !== true || n.$o === true ? [3, 3] : (i = n.sharedClientState.getAllActiveQueryTargets(), [4, eu(n, i.toArray())]);
        case 1:
          return o = r.sent(), n.$o = true, [4, os(n.remoteStore, true)];
        case 2:
          for (r.sent(), s = 0, u = o; s < u.length; s++)
            a = u[s], qo(n.remoteStore, a);
          return [3, 7];
        case 3:
          return e !== false || n.$o === false ? [3, 7] : (c = [], h = Promise.resolve(), n.Vo.forEach(function(t3, e2) {
            n.sharedClientState.isLocalQueryTarget(e2) ? c.push(e2) : h = h.then(function() {
              return Ks(n, e2), Wi(n.localStore, e2, true);
            }), Uo(n.remoteStore, e2);
          }), [4, h]);
        case 4:
          return r.sent(), [4, eu(n, c)];
        case 5:
          return r.sent(), function(t3) {
            var e2 = P2(t3);
            e2.Co.forEach(function(t4, n2) {
              Uo(e2.remoteStore, n2);
            }), e2.No.ts(), e2.Co = new Map(), e2.Do = new ze(at.comparator);
          }(n), n.$o = false, [4, os(n.remoteStore, false)];
        case 6:
          r.sent(), r.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
function eu(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, i2, o, s, u, a, c, h, f, l2, d2, p2, y2, v2;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          n = P2(t2), i2 = [], o = [], s = 0, u = e, r.label = 1;
        case 1:
          return s < u.length ? (a = u[s], c = void 0, (h = n.Vo.get(a)) && h.length !== 0 ? [4, zi(n.localStore, ee(h[0]))] : [3, 7]) : [3, 13];
        case 2:
          c = r.sent(), f = 0, l2 = h, r.label = 3;
        case 3:
          return f < l2.length ? (d2 = l2[f], p2 = n.Po.get(d2), [4, Xs(n, p2)]) : [3, 6];
        case 4:
          (y2 = r.sent()).snapshot && o.push(y2.snapshot), r.label = 5;
        case 5:
          return f++, [3, 3];
        case 6:
          return [3, 11];
        case 7:
          return [4, Yi(n.localStore, a)];
        case 8:
          return v2 = r.sent(), [4, zi(n.localStore, v2)];
        case 9:
          return c = r.sent(), [4, Rs(n, nu(v2), a, false)];
        case 10:
          r.sent(), r.label = 11;
        case 11:
          i2.push(c), r.label = 12;
        case 12:
          return s++, [3, 1];
        case 13:
          return [2, (n.vo._r(o), i2)];
      }
    });
  });
}
function nu(t2) {
  return Wt(t2.path, t2.collectionGroup, t2.orderBy, t2.filters, t2.limit, "F", t2.startAt, t2.endAt);
}
function ru(t2) {
  var e = P2(t2);
  return P2(P2(e.localStore).persistence).fn();
}
function iu(t2, e, i, o) {
  return __awaiter(this, void 0, void 0, function() {
    var n, s, u;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return (n = P2(t2)).$o ? (k2("SyncEngine", "Ignoring unexpected query state notification."), [3, 8]) : [3, 1];
        case 1:
          if (!n.Vo.has(e))
            return [3, 8];
          switch (i) {
            case "current":
            case "not-current":
              return [3, 2];
            case "rejected":
              return [3, 5];
          }
          return [3, 7];
        case 2:
          return [4, $i(n.localStore)];
        case 3:
          return s = r.sent(), u = an.createSynthesizedRemoteEventForCurrentChange(e, i === "current"), [4, Hs(n, s, u)];
        case 4:
          return r.sent(), [3, 8];
        case 5:
          return [4, Wi(n.localStore, e, true)];
        case 6:
          return r.sent(), Ks(n, e, o), [3, 8];
        case 7:
          L2(), r.label = 8;
        case 8:
          return [2];
      }
    });
  });
}
function ou(t2, e, i) {
  return __awaiter(this, void 0, void 0, function() {
    var n, o, s, u, a, c, h, f, l2, d2;
    return __generator(this, function(p2) {
      switch (p2.label) {
        case 0:
          if (!(n = su(t2)).$o)
            return [3, 10];
          o = 0, s = e, p2.label = 1;
        case 1:
          return o < s.length ? (u = s[o], n.Vo.has(u) ? (k2("SyncEngine", "Adding an already active target " + u), [3, 5]) : [4, Yi(n.localStore, u)]) : [3, 6];
        case 2:
          return a = p2.sent(), [4, zi(n.localStore, a)];
        case 3:
          return c = p2.sent(), [4, Rs(n, nu(a), c.targetId, false)];
        case 4:
          p2.sent(), qo(n.remoteStore, c), p2.label = 5;
        case 5:
          return o++, [3, 1];
        case 6:
          h = function(t3) {
            return __generator(this, function(e2) {
              switch (e2.label) {
                case 0:
                  return n.Vo.has(t3) ? [4, Wi(n.localStore, t3, false).then(function() {
                    Uo(n.remoteStore, t3), Ks(n, t3);
                  }).catch(di)] : [3, 2];
                case 1:
                  e2.sent(), e2.label = 2;
                case 2:
                  return [2];
              }
            });
          }, f = 0, l2 = i, p2.label = 7;
        case 7:
          return f < l2.length ? (d2 = l2[f], [5, h(d2)]) : [3, 10];
        case 8:
          p2.sent(), p2.label = 9;
        case 9:
          return f++, [3, 7];
        case 10:
          return [2];
      }
    });
  });
}
function su(t2) {
  var e = P2(t2);
  return e.remoteStore.remoteSyncer.applyRemoteEvent = Ps.bind(null, e), e.remoteStore.remoteSyncer.getRemoteKeysForTarget = $s.bind(null, e), e.remoteStore.remoteSyncer.rejectListen = Ms.bind(null, e), e.vo._r = ms.bind(null, e.eventManager), e.vo.Mo = gs.bind(null, e.eventManager), e;
}
function uu(t2) {
  var e = P2(t2);
  return e.remoteStore.remoteSyncer.applySuccessfulWrite = Vs.bind(null, e), e.remoteStore.remoteSyncer.rejectFailedWrite = qs.bind(null, e), e;
}
var cu = function() {
  function t2() {
    this.synchronizeTabs = false;
  }
  return t2.prototype.initialize = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.R = ko(t3.databaseInfo.databaseId), this.sharedClientState = this.Bo(t3), this.persistence = this.qo(t3), [4, this.persistence.start()];
          case 1:
            return e.sent(), this.gcScheduler = this.Uo(t3), this.localStore = this.Ko(t3), [2];
        }
      });
    });
  }, t2.prototype.Uo = function(t3) {
    return null;
  }, t2.prototype.Ko = function(t3) {
    return qi(this.persistence, new Mi(), t3.initialUser, this.R);
  }, t2.prototype.qo = function(t3) {
    return new uo(co.bs, this.R);
  }, t2.prototype.Bo = function(t3) {
    return new Io();
  }, t2.prototype.terminate = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.gcScheduler && this.gcScheduler.stop(), [4, this.sharedClientState.shutdown()];
          case 1:
            return t3.sent(), [4, this.persistence.shutdown()];
          case 2:
            return t3.sent(), [2];
        }
      });
    });
  }, t2;
}();
var hu = function(e) {
  function i(t2, n, r) {
    var i2 = this;
    return (i2 = e.call(this) || this).Qo = t2, i2.cacheSizeBytes = n, i2.forceOwnership = r, i2.synchronizeTabs = false, i2;
  }
  return __extends(i, e), i.prototype.initialize = function(t2) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            return [4, e.prototype.initialize.call(this, t2)];
          case 1:
            return n.sent(), [4, Xi(this.localStore)];
          case 2:
            return n.sent(), [4, this.Qo.initialize(this, t2)];
          case 3:
            return n.sent(), [4, uu(this.Qo.syncEngine)];
          case 4:
            return n.sent(), [4, Jo(this.Qo.remoteStore)];
          case 5:
            return n.sent(), [2];
        }
      });
    });
  }, i.prototype.Ko = function(t2) {
    return qi(this.persistence, new Mi(), t2.initialUser, this.R);
  }, i.prototype.Uo = function(t2) {
    var e2 = this.persistence.referenceDelegate.garbageCollector;
    return new vi(e2, t2.asyncQueue);
  }, i.prototype.qo = function(t2) {
    var e2 = Li(t2.databaseInfo.databaseId, t2.databaseInfo.persistenceKey), n = this.cacheSizeBytes !== void 0 ? ti.withCacheSize(this.cacheSizeBytes) : ti.DEFAULT;
    return new Ci(this.synchronizeTabs, e2, t2.clientId, n, t2.asyncQueue, Do(), Ao(), this.R, this.sharedClientState, !!this.forceOwnership);
  }, i.prototype.Bo = function(t2) {
    return new Io();
  }, i;
}(cu);
var fu = function(e) {
  function i(t2, n) {
    var r = this;
    return (r = e.call(this, t2, n, false) || this).Qo = t2, r.cacheSizeBytes = n, r.synchronizeTabs = true, r;
  }
  return __extends(i, e), i.prototype.initialize = function(t2) {
    return __awaiter(this, void 0, void 0, function() {
      var i2, o = this;
      return __generator(this, function(s) {
        switch (s.label) {
          case 0:
            return [4, e.prototype.initialize.call(this, t2)];
          case 1:
            return s.sent(), i2 = this.Qo.syncEngine, this.sharedClientState instanceof bo ? (this.sharedClientState.syncEngine = {
              ui: Zs.bind(null, i2),
              ai: iu.bind(null, i2),
              hi: ou.bind(null, i2),
              fn: ru.bind(null, i2),
              ci: Js.bind(null, i2)
            }, [4, this.sharedClientState.start()]) : [3, 3];
          case 2:
            s.sent(), s.label = 3;
          case 3:
            return [4, this.persistence.He(function(t3) {
              return __awaiter(o, void 0, void 0, function() {
                return __generator(this, function(e2) {
                  switch (e2.label) {
                    case 0:
                      return [4, tu(this.Qo.syncEngine, t3)];
                    case 1:
                      return e2.sent(), this.gcScheduler && (t3 && !this.gcScheduler.started ? this.gcScheduler.start(this.localStore) : t3 || this.gcScheduler.stop()), [2];
                  }
                });
              });
            })];
          case 4:
            return s.sent(), [2];
        }
      });
    });
  }, i.prototype.Bo = function(t2) {
    var e2 = Do();
    if (!bo.yt(e2))
      throw new N2(S2.UNIMPLEMENTED, "IndexedDB persistence is only available on platforms that support LocalStorage.");
    var n = Li(t2.databaseInfo.databaseId, t2.databaseInfo.persistenceKey);
    return new bo(e2, t2.asyncQueue, n, t2.clientId, t2.initialUser);
  }, i;
}(hu);
var lu = function() {
  function t2() {
  }
  return t2.prototype.initialize = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      var n = this;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return this.localStore ? [3, 2] : (this.localStore = t3.localStore, this.sharedClientState = t3.sharedClientState, this.datastore = this.createDatastore(e), this.remoteStore = this.createRemoteStore(e), this.eventManager = this.createEventManager(e), this.syncEngine = this.createSyncEngine(e, !t3.synchronizeTabs), this.sharedClientState.onlineStateHandler = function(t4) {
              return Fs(n.syncEngine, t4, 1);
            }, this.remoteStore.remoteSyncer.handleCredentialChange = Ys.bind(null, this.syncEngine), [4, os(this.remoteStore, this.syncEngine.isPrimaryClient)]);
          case 1:
            r.sent(), r.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.createEventManager = function(t3) {
    return new ps();
  }, t2.prototype.createDatastore = function(t3) {
    var e, n = ko(t3.databaseInfo.databaseId), r = (e = t3.databaseInfo, new No(e));
    return function(t4, e2, n2) {
      return new Oo(t4, e2, n2);
    }(t3.credentials, r, n);
  }, t2.prototype.createRemoteStore = function(t3) {
    var e, n, r, i, o, s = this;
    return e = this.localStore, n = this.datastore, r = t3.asyncQueue, i = function(t4) {
      return Fs(s.syncEngine, t4, 0);
    }, o = To.yt() ? new To() : new Eo(), new Fo(e, n, r, i, o);
  }, t2.prototype.createSyncEngine = function(t3, e) {
    return function(t4, e2, n, r, i, o, s) {
      var u = new Cs(t4, e2, n, r, i, o);
      return s && (u.$o = true), u;
    }(this.localStore, this.remoteStore, this.eventManager, this.sharedClientState, t3.initialUser, t3.maxConcurrentLimboResolutions, e);
  }, t2.prototype.terminate = function() {
    return function(t3) {
      return __awaiter(this, void 0, void 0, function() {
        var e;
        return __generator(this, function(n) {
          switch (n.label) {
            case 0:
              return e = P2(t3), k2("RemoteStore", "RemoteStore shutting down."), e.Or.add(5), [4, Vo(e)];
            case 1:
              return n.sent(), e.Lr.shutdown(), e.Br.set("Unknown"), [2];
          }
        });
      });
    }(this.remoteStore);
  }, t2;
}();
var pu = function() {
  function t2(t3) {
    this.observer = t3, this.muted = false;
  }
  return t2.prototype.next = function(t3) {
    this.observer.next && this.jo(this.observer.next, t3);
  }, t2.prototype.error = function(t3) {
    this.observer.error ? this.jo(this.observer.error, t3) : console.error("Uncaught Error in snapshot listener:", t3);
  }, t2.prototype.Wo = function() {
    this.muted = true;
  }, t2.prototype.jo = function(t3, e) {
    var n = this;
    this.muted || setTimeout(function() {
      n.muted || t3(e);
    }, 0);
  }, t2;
}();
var yu = function() {
  function t2(t3, e) {
    var n = this;
    this.Go = t3, this.R = e, this.metadata = new wr(), this.buffer = new Uint8Array(), this.zo = new TextDecoder("utf-8"), this.Ho().then(function(t4) {
      t4 && t4.io() ? n.metadata.resolve(t4.payload.metadata) : n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             " + JSON.stringify(t4 == null ? void 0 : t4.payload)));
    }, function(t4) {
      return n.metadata.reject(t4);
    });
  }
  return t2.prototype.close = function() {
    return this.Go.cancel();
  }, t2.prototype.getMetadata = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, this.metadata.promise];
      });
    });
  }, t2.prototype.Lo = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.getMetadata()];
          case 1:
            return [2, (t3.sent(), this.Ho())];
        }
      });
    });
  }, t2.prototype.Ho = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n, i;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return [4, this.Jo()];
          case 1:
            return (t3 = r.sent()) === null ? [2, null] : (e = this.zo.decode(t3), n = Number(e), isNaN(n) && this.Yo("length string (" + e + ") is not valid number"), [4, this.Xo(n)]);
          case 2:
            return i = r.sent(), [2, new Is(JSON.parse(i), t3.length + n)];
        }
      });
    });
  }, t2.prototype.Zo = function() {
    return this.buffer.findIndex(function(t3) {
      return t3 === "{".charCodeAt(0);
    });
  }, t2.prototype.Jo = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            return this.Zo() < 0 ? [4, this.tc()] : [3, 3];
          case 1:
            if (n.sent())
              return [3, 3];
            n.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return this.buffer.length === 0 ? [2, null] : ((t3 = this.Zo()) < 0 && this.Yo("Reached the end of bundle when a length string is expected."), e = this.buffer.slice(0, t3), [2, (this.buffer = this.buffer.slice(t3), e)]);
        }
      });
    });
  }, t2.prototype.Xo = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e;
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            return this.buffer.length < t3 ? [4, this.tc()] : [3, 3];
          case 1:
            n.sent() && this.Yo("Reached the end of bundle when more is expected."), n.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return e = this.zo.decode(this.buffer.slice(0, t3)), [2, (this.buffer = this.buffer.slice(t3), e)];
        }
      });
    });
  }, t2.prototype.Yo = function(t3) {
    throw this.Go.cancel(), new Error("Invalid bundle format: " + t3);
  }, t2.prototype.tc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            return [4, this.Go.read()];
          case 1:
            return (t3 = n.sent()).done || ((e = new Uint8Array(this.buffer.length + t3.value.length)).set(this.buffer), e.set(t3.value, this.buffer.length), this.buffer = e), [2, t3.done];
        }
      });
    });
  }, t2;
}();
var vu = function() {
  function t2(t3) {
    this.datastore = t3, this.readVersions = new Map(), this.mutations = [], this.committed = false, this.lastWriteError = null, this.writtenDocs = new Set();
  }
  return t2.prototype.lookup = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, i = this;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.mutations.length > 0)
              throw new N2(S2.INVALID_ARGUMENT, "Firestore transactions require all reads to be executed before all writes.");
            return [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n, i2, o2, s, u, a;
                return __generator(this, function(r) {
                  switch (r.label) {
                    case 0:
                      return n = P2(t4), i2 = Cn(n.R) + "/documents", o2 = {
                        documents: e2.map(function(t5) {
                          return Nn(n.R, t5);
                        })
                      }, [4, n.$i("BatchGetDocuments", i2, o2)];
                    case 1:
                      return s = r.sent(), u = new Map(), s.forEach(function(t5) {
                        var e3 = function(t6, e4) {
                          return "found" in e4 ? function(t7, e5) {
                            O2(!!e5.found), e5.found.name, e5.found.updateTime;
                            var n2 = Dn(t7, e5.found.name), r2 = Tn(e5.found.updateTime), i3 = new Tt({
                              mapValue: {
                                fields: e5.found.fields
                              }
                            });
                            return St.newFoundDocument(n2, r2, i3);
                          }(t6, e4) : "missing" in e4 ? function(t7, e5) {
                            O2(!!e5.missing), O2(!!e5.readTime);
                            var n2 = Dn(t7, e5.missing), r2 = Tn(e5.readTime);
                            return St.newNoDocument(n2, r2);
                          }(t6, e4) : L2();
                        }(n.R, t5);
                        u.set(e3.key.toString(), e3);
                      }), a = [], [2, (e2.forEach(function(t5) {
                        var e3 = u.get(t5.toString());
                        O2(!!e3), a.push(e3);
                      }), a)];
                  }
                });
              });
            }(this.datastore, t3)];
          case 1:
            return [2, ((e = o.sent()).forEach(function(t4) {
              return i.recordVersion(t4);
            }), e)];
        }
      });
    });
  }, t2.prototype.set = function(t3, e) {
    this.write(e.toMutation(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.update = function(t3, e) {
    try {
      this.write(e.toMutation(t3, this.preconditionForUpdate(t3)));
    } catch (t4) {
      this.lastWriteError = t4;
    }
    this.writtenDocs.add(t3.toString());
  }, t2.prototype.delete = function(t3) {
    this.write(new Be(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.commit = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.lastWriteError)
              throw this.lastWriteError;
            return t3 = this.readVersions, this.mutations.forEach(function(e2) {
              t3.delete(e2.key.toString());
            }), t3.forEach(function(t4, n) {
              var r = at.fromPath(n);
              e.mutations.push(new je(r, e.precondition(r)));
            }), [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n, i2, o;
                return __generator(this, function(r) {
                  switch (r.label) {
                    case 0:
                      return n = P2(t4), i2 = Cn(n.R) + "/documents", o = {
                        writes: e2.map(function(t5) {
                          return On(n.R, t5);
                        })
                      }, [4, n.Ni("Commit", i2, o)];
                    case 1:
                      return r.sent(), [2];
                  }
                });
              });
            }(this.datastore, this.mutations)];
          case 1:
            return i.sent(), this.committed = true, [2];
        }
      });
    });
  }, t2.prototype.recordVersion = function(t3) {
    var e;
    if (t3.isFoundDocument())
      e = t3.version;
    else {
      if (!t3.isNoDocument())
        throw L2();
      e = j.min();
    }
    var n = this.readVersions.get(t3.key.toString());
    if (n) {
      if (!e.isEqual(n))
        throw new N2(S2.ABORTED, "Document version changed between two reads.");
    } else
      this.readVersions.set(t3.key.toString(), e);
  }, t2.prototype.precondition = function(t3) {
    var e = this.readVersions.get(t3.toString());
    return !this.writtenDocs.has(t3.toString()) && e ? Ne.updateTime(e) : Ne.none();
  }, t2.prototype.preconditionForUpdate = function(t3) {
    var e = this.readVersions.get(t3.toString());
    if (!this.writtenDocs.has(t3.toString()) && e) {
      if (e.isEqual(j.min()))
        throw new N2(S2.INVALID_ARGUMENT, "Can't update a document that doesn't exist.");
      return Ne.updateTime(e);
    }
    return Ne.exists(true);
  }, t2.prototype.write = function(t3) {
    this.ensureCommitNotCalled(), this.mutations.push(t3);
  }, t2.prototype.ensureCommitNotCalled = function() {
  }, t2;
}();
var mu = function() {
  function t2(t3, e, n, r) {
    this.asyncQueue = t3, this.datastore = e, this.updateFunction = n, this.deferred = r, this.ec = 5, this.Zi = new Co(this.asyncQueue, "transaction_retry");
  }
  return t2.prototype.run = function() {
    this.ec -= 1, this.nc();
  }, t2.prototype.nc = function() {
    var t3 = this;
    this.Zi.ji(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, e, n = this;
        return __generator(this, function(r) {
          return t4 = new vu(this.datastore), (e = this.sc(t4)) && e.then(function(e2) {
            n.asyncQueue.enqueueAndForget(function() {
              return t4.commit().then(function() {
                n.deferred.resolve(e2);
              }).catch(function(t5) {
                n.ic(t5);
              });
            });
          }).catch(function(t5) {
            n.ic(t5);
          }), [2];
        });
      });
    });
  }, t2.prototype.sc = function(t3) {
    try {
      var e = this.updateFunction(t3);
      return !ot(e) && e.catch && e.then ? e : (this.deferred.reject(Error("Transaction callback must return a Promise")), null);
    } catch (t4) {
      return this.deferred.reject(t4), null;
    }
  }, t2.prototype.ic = function(t3) {
    var e = this;
    this.ec > 0 && this.rc(t3) ? (this.ec -= 1, this.asyncQueue.enqueueAndForget(function() {
      return e.nc(), Promise.resolve();
    })) : this.deferred.reject(t3);
  }, t2.prototype.rc = function(t3) {
    if (t3.name === "FirebaseError") {
      var e = t3.code;
      return e === "aborted" || e === "failed-precondition" || !Qe(e);
    }
    return false;
  }, t2;
}();
var gu = function() {
  function t2(t3, e, i) {
    var o = this;
    this.credentials = t3, this.asyncQueue = e, this.databaseInfo = i, this.user = ho.UNAUTHENTICATED, this.clientId = M2.u(), this.credentialListener = function() {
      return Promise.resolve();
    }, this.credentials.setChangeListener(e, function(t4) {
      return __awaiter(o, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return k2("FirestoreClient", "Received user=", t4.uid), [4, this.credentialListener(t4)];
            case 1:
              return e2.sent(), this.user = t4, [2];
          }
        });
      });
    });
  }
  return t2.prototype.getConfiguration = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, {
          asyncQueue: this.asyncQueue,
          databaseInfo: this.databaseInfo,
          clientId: this.clientId,
          credentials: this.credentials,
          initialUser: this.user,
          maxConcurrentLimboResolutions: 100
        }];
      });
    });
  }, t2.prototype.setCredentialChangeListener = function(t3) {
    this.credentialListener = t3;
  }, t2.prototype.verifyNotTerminated = function() {
    if (this.asyncQueue.isShuttingDown)
      throw new N2(S2.FAILED_PRECONDITION, "The client has already been terminated.");
  }, t2.prototype.terminate = function() {
    var t3 = this;
    this.asyncQueue.enterRestrictedMode();
    var e = new wr();
    return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, n;
        return __generator(this, function(r) {
          switch (r.label) {
            case 0:
              return r.trys.push([0, 5, , 6]), this.onlineComponents ? [4, this.onlineComponents.terminate()] : [3, 2];
            case 1:
              r.sent(), r.label = 2;
            case 2:
              return this.offlineComponents ? [4, this.offlineComponents.terminate()] : [3, 4];
            case 3:
              r.sent(), r.label = 4;
            case 4:
              return this.credentials.removeChangeListener(), e.resolve(), [3, 6];
            case 5:
              return t4 = r.sent(), n = cs(t4, "Failed to shutdown persistence"), e.reject(n), [3, 6];
            case 6:
              return [2];
          }
        });
      });
    }), e.promise;
  }, t2;
}();
function wu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s = this;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), k2("FirestoreClient", "Initializing OfflineComponentProvider"), [4, t2.getConfiguration()];
        case 1:
          return i = u.sent(), [4, e.initialize(i)];
        case 2:
          return u.sent(), o = i.initialUser, t2.setCredentialChangeListener(function(t3) {
            return __awaiter(s, void 0, void 0, function() {
              return __generator(this, function(n) {
                switch (n.label) {
                  case 0:
                    return o.isEqual(t3) ? [3, 2] : [4, Ui(e.localStore, t3)];
                  case 1:
                    n.sent(), o = t3, n.label = 2;
                  case 2:
                    return [2];
                }
              });
            });
          }), e.persistence.setDatabaseDeletedListener(function() {
            return t2.terminate();
          }), t2.offlineComponents = e, [2];
      }
    });
  });
}
function bu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), [4, Iu(t2)];
        case 1:
          return i = s.sent(), k2("FirestoreClient", "Initializing OnlineComponentProvider"), [4, t2.getConfiguration()];
        case 2:
          return o = s.sent(), [4, e.initialize(i, o)];
        case 3:
          return s.sent(), t2.setCredentialChangeListener(function(t3) {
            return function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n, i2;
                return __generator(this, function(r) {
                  switch (r.label) {
                    case 0:
                      return (n = P2(t4)).asyncQueue.verifyOperationInProgress(), k2("RemoteStore", "RemoteStore received new credentials"), i2 = Go(n), n.Or.add(3), [4, Vo(n)];
                    case 1:
                      return r.sent(), i2 && n.Br.set("Unknown"), [4, n.remoteSyncer.handleCredentialChange(e2)];
                    case 2:
                      return r.sent(), n.Or.delete(3), [4, Mo(n)];
                    case 3:
                      return r.sent(), [2];
                  }
                });
              });
            }(e.remoteStore, t3);
          }), t2.onlineComponents = e, [2];
      }
    });
  });
}
function Iu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.offlineComponents ? [3, 2] : (k2("FirestoreClient", "Using default OfflineComponentProvider"), [4, wu(t2, new cu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.offlineComponents];
      }
    });
  });
}
function Eu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.onlineComponents ? [3, 2] : (k2("FirestoreClient", "Using default OnlineComponentProvider"), [4, bu(t2, new lu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.onlineComponents];
      }
    });
  });
}
function Tu(t2) {
  return Iu(t2).then(function(t3) {
    return t3.persistence;
  });
}
function _u(t2) {
  return Iu(t2).then(function(t3) {
    return t3.localStore;
  });
}
function Su(t2) {
  return Eu(t2).then(function(t3) {
    return t3.remoteStore;
  });
}
function Nu(t2) {
  return Eu(t2).then(function(t3) {
    return t3.syncEngine;
  });
}
function Du(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n;
    return __generator(this, function(r) {
      switch (r.label) {
        case 0:
          return [4, Eu(t2)];
        case 1:
          return e = r.sent(), [2, ((n = e.eventManager).onListen = xs.bind(null, e.syncEngine), n.onUnlisten = Ls.bind(null, e.syncEngine), n)];
      }
    });
  });
}
function Au(t2, e, i) {
  var o = this;
  i === void 0 && (i = {});
  var s = new wr();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(o, void 0, void 0, function() {
      var n;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return n = function(t3, e2, n2, r2, i2) {
              var o2 = new pu({
                next: function(o3) {
                  e2.enqueueAndForget(function() {
                    return vs(t3, s2);
                  });
                  var u = o3.docs.has(n2);
                  !u && o3.fromCache ? i2.reject(new N2(S2.UNAVAILABLE, "Failed to get document because the client is offline.")) : u && o3.fromCache && r2 && r2.source === "server" ? i2.reject(new N2(S2.UNAVAILABLE, 'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')) : i2.resolve(o3);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s2 = new bs(Ht(n2.path), o2, {
                includeMetadataChanges: true,
                so: true
              });
              return ys(t3, s2);
            }, [4, Du(t2)];
          case 1:
            return [2, n.apply(void 0, [r.sent(), t2.asyncQueue, e, i, s])];
        }
      });
    });
  }), s.promise;
}
function ku(t2, e, i) {
  var o = this;
  i === void 0 && (i = {});
  var s = new wr();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(o, void 0, void 0, function() {
      var n;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return n = function(t3, e2, n2, r2, i2) {
              var o2 = new pu({
                next: function(n3) {
                  e2.enqueueAndForget(function() {
                    return vs(t3, s2);
                  }), n3.fromCache && r2.source === "server" ? i2.reject(new N2(S2.UNAVAILABLE, 'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')) : i2.resolve(n3);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s2 = new bs(n2, o2, {
                includeMetadataChanges: true,
                so: true
              });
              return ys(t3, s2);
            }, [4, Du(t2)];
          case 1:
            return [2, n.apply(void 0, [r.sent(), t2.asyncQueue, e, i, s])];
        }
      });
    });
  }), s.promise;
}
var Cu = function(t2, e, n, r, i, o, s, u) {
  this.databaseId = t2, this.appId = e, this.persistenceKey = n, this.host = r, this.ssl = i, this.forceLongPolling = o, this.autoDetectLongPolling = s, this.useFetchStreams = u;
};
var xu = function() {
  function t2(t3, e) {
    this.projectId = t3, this.database = e || "(default)";
  }
  return Object.defineProperty(t2.prototype, "isDefaultDatabase", {
    get: function() {
      return this.database === "(default)";
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return e instanceof t2 && e.projectId === this.projectId && e.database === this.database;
  }, t2;
}();
var Ru = new Map();
var Lu = function(t2, e) {
  this.user = e, this.type = "OAuth", this.authHeaders = {}, this.authHeaders.Authorization = "Bearer " + t2;
};
var Ou = function() {
  function t2() {
    this.changeListener = null;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
  }, t2.prototype.setChangeListener = function(t3, e) {
    this.changeListener = e, t3.enqueueRetryable(function() {
      return e(ho.UNAUTHENTICATED);
    });
  }, t2.prototype.removeChangeListener = function() {
    this.changeListener = null;
  }, t2;
}();
var Pu = function() {
  function t2(t3) {
    this.token = t3, this.changeListener = null;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(this.token);
  }, t2.prototype.invalidateToken = function() {
  }, t2.prototype.setChangeListener = function(t3, e) {
    var n = this;
    this.changeListener = e, t3.enqueueRetryable(function() {
      return e(n.token.user);
    });
  }, t2.prototype.removeChangeListener = function() {
    this.changeListener = null;
  }, t2;
}();
var Fu = function() {
  function t2(t3) {
    var e = this;
    this.currentUser = ho.UNAUTHENTICATED, this.oc = new wr(), this.cc = 0, this.forceRefresh = false, this.auth = null, this.asyncQueue = null, this.uc = function() {
      e.cc++, e.currentUser = e.ac(), e.oc.resolve(), e.changeListener && e.asyncQueue.enqueueRetryable(function() {
        return e.changeListener(e.currentUser);
      });
    };
    var n = function(t4) {
      k2("FirebaseCredentialsProvider", "Auth detected"), e.auth = t4, e.auth.addAuthTokenListener(e.uc);
    };
    t3.onInit(function(t4) {
      return n(t4);
    }), setTimeout(function() {
      if (!e.auth) {
        var r = t3.getImmediate({
          optional: true
        });
        r ? n(r) : (k2("FirebaseCredentialsProvider", "Auth not yet detected"), e.oc.resolve());
      }
    }, 0);
  }
  return t2.prototype.getToken = function() {
    var t3 = this, e = this.cc, n = this.forceRefresh;
    return this.forceRefresh = false, this.auth ? this.auth.getToken(n).then(function(n2) {
      return t3.cc !== e ? (k2("FirebaseCredentialsProvider", "getToken aborted due to token change."), t3.getToken()) : n2 ? (O2(typeof n2.accessToken == "string"), new Lu(n2.accessToken, t3.currentUser)) : null;
    }) : Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
    this.forceRefresh = true;
  }, t2.prototype.setChangeListener = function(t3, e) {
    var i = this;
    this.asyncQueue = t3, this.asyncQueue.enqueueRetryable(function() {
      return __awaiter(i, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return [4, this.oc.promise];
            case 1:
              return t4.sent(), [4, e(this.currentUser)];
            case 2:
              return t4.sent(), this.changeListener = e, [2];
          }
        });
      });
    });
  }, t2.prototype.removeChangeListener = function() {
    this.auth && this.auth.removeAuthTokenListener(this.uc), this.changeListener = function() {
      return Promise.resolve();
    };
  }, t2.prototype.ac = function() {
    var t3 = this.auth && this.auth.getUid();
    return O2(t3 === null || typeof t3 == "string"), new ho(t3);
  }, t2;
}();
var Mu = function() {
  function t2(t3, e, n) {
    this.hc = t3, this.lc = e, this.fc = n, this.type = "FirstParty", this.user = ho.FIRST_PARTY;
  }
  return Object.defineProperty(t2.prototype, "authHeaders", {
    get: function() {
      var t3 = {
        "X-Goog-AuthUser": this.lc
      }, e = this.hc.auth.getAuthHeaderValueForFirstParty([]);
      return e && (t3.Authorization = e), this.fc && (t3["X-Goog-Iam-Authorization-Token"] = this.fc), t3;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Vu = function() {
  function t2(t3, e, n) {
    this.hc = t3, this.lc = e, this.fc = n;
  }
  return t2.prototype.getToken = function() {
    return Promise.resolve(new Mu(this.hc, this.lc, this.fc));
  }, t2.prototype.setChangeListener = function(t3, e) {
    t3.enqueueRetryable(function() {
      return e(ho.FIRST_PARTY);
    });
  }, t2.prototype.removeChangeListener = function() {
  }, t2.prototype.invalidateToken = function() {
  }, t2;
}();
function qu(t2, e, n) {
  if (!n)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + t2 + "() cannot be called with an empty " + e + ".");
}
function Uu(t2, e) {
  if (e === void 0)
    return {
      merge: false
    };
  if (e.mergeFields !== void 0 && e.merge !== void 0)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid options passed to function " + t2 + '(): You cannot specify both "merge" and "mergeFields".');
  return e;
}
function Bu(t2, e, n, r) {
  if (e === true && r === true)
    throw new N2(S2.INVALID_ARGUMENT, t2 + " and " + n + " cannot be used together.");
}
function ju(t2) {
  if (!at.isDocumentKey(t2))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t2 + " has " + t2.length + ".");
}
function Ku(t2) {
  if (at.isDocumentKey(t2))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid collection reference. Collection references must have an odd number of segments, but " + t2 + " has " + t2.length + ".");
}
function Qu(t2) {
  if (t2 === void 0)
    return "undefined";
  if (t2 === null)
    return "null";
  if (typeof t2 == "string")
    return t2.length > 20 && (t2 = t2.substring(0, 20) + "..."), JSON.stringify(t2);
  if (typeof t2 == "number" || typeof t2 == "boolean")
    return "" + t2;
  if (typeof t2 == "object") {
    if (t2 instanceof Array)
      return "an array";
    var e = function(t3) {
      if (t3.constructor) {
        var e2 = /function\s+([^\s(]+)\s*\(/.exec(t3.constructor.toString());
        if (e2 && e2.length > 1)
          return e2[1];
      }
      return null;
    }(t2);
    return e ? "a custom " + e + " object" : "an object";
  }
  return typeof t2 == "function" ? "a function" : L2();
}
function Gu(t2, e) {
  if ("_delegate" in t2 && (t2 = t2._delegate), !(t2 instanceof e)) {
    if (e.name === t2.constructor.name)
      throw new N2(S2.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
    var n = Qu(t2);
    throw new N2(S2.INVALID_ARGUMENT, "Expected type '" + e.name + "', but it was: " + n);
  }
  return t2;
}
function zu(t2, e) {
  if (e <= 0)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + t2 + "() requires a positive number, but it was: " + e + ".");
}
var Wu = function() {
  function t2(t3) {
    var e;
    if (t3.host === void 0) {
      if (t3.ssl !== void 0)
        throw new N2(S2.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
      this.host = "firestore.googleapis.com", this.ssl = true;
    } else
      this.host = t3.host, this.ssl = (e = t3.ssl) === null || e === void 0 || e;
    if (this.credentials = t3.credentials, this.ignoreUndefinedProperties = !!t3.ignoreUndefinedProperties, t3.cacheSizeBytes === void 0)
      this.cacheSizeBytes = 41943040;
    else {
      if (t3.cacheSizeBytes !== -1 && t3.cacheSizeBytes < 1048576)
        throw new N2(S2.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
      this.cacheSizeBytes = t3.cacheSizeBytes;
    }
    this.experimentalForceLongPolling = !!t3.experimentalForceLongPolling, this.experimentalAutoDetectLongPolling = !!t3.experimentalAutoDetectLongPolling, this.useFetchStreams = !!t3.useFetchStreams, Bu("experimentalForceLongPolling", t3.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", t3.experimentalAutoDetectLongPolling);
  }
  return t2.prototype.isEqual = function(t3) {
    return this.host === t3.host && this.ssl === t3.ssl && this.credentials === t3.credentials && this.cacheSizeBytes === t3.cacheSizeBytes && this.experimentalForceLongPolling === t3.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === t3.experimentalAutoDetectLongPolling && this.ignoreUndefinedProperties === t3.ignoreUndefinedProperties && this.useFetchStreams === t3.useFetchStreams;
  }, t2;
}();
var Hu = function() {
  function t2(t3, e) {
    this.type = "firestore-lite", this._persistenceKey = "(lite)", this._settings = new Wu({}), this._settingsFrozen = false, t3 instanceof xu ? (this._databaseId = t3, this._credentials = new Ou()) : (this._app = t3, this._databaseId = function(t4) {
      if (!Object.prototype.hasOwnProperty.apply(t4.options, ["projectId"]))
        throw new N2(S2.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
      return new xu(t4.options.projectId);
    }(t3), this._credentials = new Fu(e));
  }
  return Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this._app)
        throw new N2(S2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this._app;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_initialized", {
    get: function() {
      return this._settingsFrozen;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_terminated", {
    get: function() {
      return this._terminateTask !== void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype._setSettings = function(t3) {
    if (this._settingsFrozen)
      throw new N2(S2.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
    this._settings = new Wu(t3), t3.credentials !== void 0 && (this._credentials = function(t4) {
      if (!t4)
        return new Ou();
      switch (t4.type) {
        case "gapi":
          var e = t4.client;
          return O2(!(typeof e != "object" || e === null || !e.auth || !e.auth.getAuthHeaderValueForFirstParty)), new Vu(e, t4.sessionIndex || "0", t4.iamToken || null);
        case "provider":
          return t4.client;
        default:
          throw new N2(S2.INVALID_ARGUMENT, "makeCredentialsProvider failed due to invalid credential type");
      }
    }(t3.credentials));
  }, t2.prototype._getSettings = function() {
    return this._settings;
  }, t2.prototype._freezeSettings = function() {
    return this._settingsFrozen = true, this._settings;
  }, t2.prototype._delete = function() {
    return this._terminateTask || (this._terminateTask = this._terminate()), this._terminateTask;
  }, t2.prototype.toJSON = function() {
    return {
      app: this._app,
      databaseId: this._databaseId,
      settings: this._settings
    };
  }, t2.prototype._terminate = function() {
    return t3 = this, (e = Ru.get(t3)) && (k2("ComponentProvider", "Removing Datastore"), Ru.delete(t3), e.terminate()), Promise.resolve();
    var t3, e;
  }, t2;
}();
var Yu = function() {
  function t2(t3, e, n) {
    this.converter = e, this._key = n, this.type = "document", this.firestore = t3;
  }
  return Object.defineProperty(t2.prototype, "_path", {
    get: function() {
      return this._key.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this._key.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new Xu(this.firestore, this.converter, this._key.path.popLast());
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._key);
  }, t2;
}();
var $u = function() {
  function t2(t3, e, n) {
    this.converter = e, this._query = n, this.type = "query", this.firestore = t3;
  }
  return t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._query);
  }, t2;
}();
var Xu = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this, t2, n2, Ht(r)) || this)._path = r, i.type = "collection", i;
  }
  return __extends(n, e), Object.defineProperty(n.prototype, "id", {
    get: function() {
      return this._query.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(n.prototype, "path", {
    get: function() {
      return this._query.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(n.prototype, "parent", {
    get: function() {
      var t2 = this._path.popLast();
      return t2.isEmpty() ? null : new Yu(this.firestore, null, new at(t2));
    },
    enumerable: false,
    configurable: true
  }), n.prototype.withConverter = function(t2) {
    return new n(this.firestore, t2, this._path);
  }, n;
}($u);
function Ju(t2, n) {
  for (var r, i = [], o = 2; o < arguments.length; o++)
    i[o - 2] = arguments[o];
  if (t2 = getModularInstance(t2), qu("collection", "path", n), t2 instanceof Hu)
    return Ku(r = W2.fromString.apply(W2, __spreadArray([n], i))), new Xu(t2, null, r);
  if (!(t2 instanceof Yu || t2 instanceof Xu))
    throw new N2(S2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Ku(r = W2.fromString.apply(W2, __spreadArray([t2.path], i)).child(W2.fromString(n))), new Xu(t2.firestore, null, r);
}
function Zu(t2, n) {
  for (var r, i = [], o = 2; o < arguments.length; o++)
    i[o - 2] = arguments[o];
  if (t2 = getModularInstance(t2), arguments.length === 1 && (n = M2.u()), qu("doc", "path", n), t2 instanceof Hu)
    return ju(r = W2.fromString.apply(W2, __spreadArray([n], i))), new Yu(t2, null, new at(r));
  if (!(t2 instanceof Yu || t2 instanceof Xu))
    throw new N2(S2.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return ju(r = t2._path.child(W2.fromString.apply(W2, __spreadArray([n], i)))), new Yu(t2.firestore, t2 instanceof Xu ? t2.converter : null, new at(r));
}
function ta2(t2, e) {
  return t2 = getModularInstance(t2), e = getModularInstance(e), (t2 instanceof Yu || t2 instanceof Xu) && (e instanceof Yu || e instanceof Xu) && t2.firestore === e.firestore && t2.path === e.path && t2.converter === e.converter;
}
function ea2(t2, e) {
  return t2 = getModularInstance(t2), e = getModularInstance(e), t2 instanceof $u && e instanceof $u && t2.firestore === e.firestore && re(t2._query, e._query) && t2.converter === e.converter;
}
var na2 = function() {
  function t2() {
    var t3 = this;
    this.dc = Promise.resolve(), this.wc = [], this._c = false, this.mc = [], this.yc = null, this.gc = false, this.Ec = [], this.Zi = new Co(this, "async_queue_retry"), this.Tc = function() {
      var e2 = Ao();
      e2 && k2("AsyncQueue", "Visibility state changed to " + e2.visibilityState), t3.Zi.Gi();
    };
    var e = Ao();
    e && typeof e.addEventListener == "function" && e.addEventListener("visibilitychange", this.Tc);
  }
  return Object.defineProperty(t2.prototype, "isShuttingDown", {
    get: function() {
      return this._c;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.enqueueAndForget = function(t3) {
    this.enqueue(t3);
  }, t2.prototype.enqueueAndForgetEvenWhileRestricted = function(t3) {
    this.Ic(), this.Ac(t3);
  }, t2.prototype.enterRestrictedMode = function() {
    if (!this._c) {
      this._c = true;
      var t3 = Ao();
      t3 && typeof t3.removeEventListener == "function" && t3.removeEventListener("visibilitychange", this.Tc);
    }
  }, t2.prototype.enqueue = function(t3) {
    return this.Ic(), this._c ? new Promise(function(t4) {
    }) : this.Ac(t3);
  }, t2.prototype.enqueueRetryable = function(t3) {
    var e = this;
    this.enqueueAndForget(function() {
      return e.wc.push(t3), e.Rc();
    });
  }, t2.prototype.Rc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n) {
        switch (n.label) {
          case 0:
            if (this.wc.length === 0)
              return [3, 5];
            n.label = 1;
          case 1:
            return n.trys.push([1, 3, , 4]), [4, this.wc[0]()];
          case 2:
            return n.sent(), this.wc.shift(), this.Zi.reset(), [3, 4];
          case 3:
            if (!Sr(t3 = n.sent()))
              throw t3;
            return k2("AsyncQueue", "Operation failed with retryable error: " + t3), [3, 4];
          case 4:
            this.wc.length > 0 && this.Zi.ji(function() {
              return e.Rc();
            }), n.label = 5;
          case 5:
            return [2];
        }
      });
    });
  }, t2.prototype.Ac = function(t3) {
    var e = this, n = this.dc.then(function() {
      return e.gc = true, t3().catch(function(t4) {
        throw e.yc = t4, e.gc = false, C2("INTERNAL UNHANDLED ERROR: ", function(t5) {
          var e2 = t5.message || "";
          return t5.stack && (e2 = t5.stack.includes(t5.message) ? t5.stack : t5.message + "\n" + t5.stack), e2;
        }(t4)), t4;
      }).then(function(t4) {
        return e.gc = false, t4;
      });
    });
    return this.dc = n, n;
  }, t2.prototype.enqueueAfterDelay = function(t3, e, n) {
    var r = this;
    this.Ic(), this.Ec.indexOf(t3) > -1 && (e = 0);
    var i = as.createAndSchedule(this, t3, e, n, function(t4) {
      return r.bc(t4);
    });
    return this.mc.push(i), i;
  }, t2.prototype.Ic = function() {
    this.yc && L2();
  }, t2.prototype.verifyOperationInProgress = function() {
  }, t2.prototype.vc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return [4, t3 = this.dc];
          case 1:
            e.sent(), e.label = 2;
          case 2:
            if (t3 !== this.dc)
              return [3, 0];
            e.label = 3;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.Pc = function(t3) {
    for (var e = 0, n = this.mc; e < n.length; e++) {
      if (n[e].timerId === t3)
        return true;
    }
    return false;
  }, t2.prototype.Vc = function(t3) {
    var e = this;
    return this.vc().then(function() {
      e.mc.sort(function(t4, e2) {
        return t4.targetTimeMs - e2.targetTimeMs;
      });
      for (var n = 0, r = e.mc; n < r.length; n++) {
        var i = r[n];
        if (i.skipDelay(), t3 !== "all" && i.timerId === t3)
          break;
      }
      return e.vc();
    });
  }, t2.prototype.Sc = function(t3) {
    this.Ec.push(t3);
  }, t2.prototype.bc = function(t3) {
    var e = this.mc.indexOf(t3);
    this.mc.splice(e, 1);
  }, t2;
}();
function ra2(t2) {
  return function(t3, e) {
    if (typeof t3 != "object" || t3 === null)
      return false;
    for (var n = t3, r = 0, i = ["next", "error", "complete"]; r < i.length; r++) {
      var o = i[r];
      if (o in n && typeof n[o] == "function")
        return true;
    }
    return false;
  }(t2);
}
var ia2 = function() {
  function t2() {
    this._progressObserver = {}, this._taskCompletionResolver = new wr(), this._lastProgress = {
      taskState: "Running",
      totalBytes: 0,
      totalDocuments: 0,
      bytesLoaded: 0,
      documentsLoaded: 0
    };
  }
  return t2.prototype.onProgress = function(t3, e, n) {
    this._progressObserver = {
      next: t3,
      error: e,
      complete: n
    };
  }, t2.prototype.catch = function(t3) {
    return this._taskCompletionResolver.promise.catch(t3);
  }, t2.prototype.then = function(t3, e) {
    return this._taskCompletionResolver.promise.then(t3, e);
  }, t2.prototype._completeWith = function(t3) {
    this._updateProgress(t3), this._progressObserver.complete && this._progressObserver.complete(), this._taskCompletionResolver.resolve(t3);
  }, t2.prototype._failWith = function(t3) {
    this._lastProgress.taskState = "Error", this._progressObserver.next && this._progressObserver.next(this._lastProgress), this._progressObserver.error && this._progressObserver.error(t3), this._taskCompletionResolver.reject(t3);
  }, t2.prototype._updateProgress = function(t3) {
    this._lastProgress = t3, this._progressObserver.next && this._progressObserver.next(t3);
  }, t2;
}();
var oa2 = -1;
var sa2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2, n2) || this).type = "firestore", r._queue = new na2(), r._persistenceKey = "name" in t2 ? t2.name : "[DEFAULT]", r;
  }
  return __extends(n, e), n.prototype._terminate = function() {
    return this._firestoreClient || aa2(this), this._firestoreClient.terminate();
  }, n;
}(Hu);
function ua2(t2) {
  return t2._firestoreClient || aa2(t2), t2._firestoreClient.verifyNotTerminated(), t2._firestoreClient;
}
function aa2(t2) {
  var e, n = t2._freezeSettings(), r = function(t3, e2, n2, r2) {
    return new Cu(t3, e2, n2, r2.host, r2.ssl, r2.experimentalForceLongPolling, r2.experimentalAutoDetectLongPolling, r2.useFetchStreams);
  }(t2._databaseId, ((e = t2._app) === null || e === void 0 ? void 0 : e.options.appId) || "", t2._persistenceKey, n);
  t2._firestoreClient = new gu(t2._credentials, t2._queue, r);
}
function ca(t2, e, i) {
  var o = this, s = new wr();
  return t2.asyncQueue.enqueue(function() {
    return __awaiter(o, void 0, void 0, function() {
      var n;
      return __generator(this, function(r) {
        switch (r.label) {
          case 0:
            return r.trys.push([0, 3, , 4]), [4, wu(t2, i)];
          case 1:
            return r.sent(), [4, bu(t2, e)];
          case 2:
            return r.sent(), s.resolve(), [3, 4];
          case 3:
            if (!function(t3) {
              return t3.name === "FirebaseError" ? t3.code === S2.FAILED_PRECONDITION || t3.code === S2.UNIMPLEMENTED : !(typeof DOMException != "undefined" && t3 instanceof DOMException) || (t3.code === 22 || t3.code === 20 || t3.code === 11);
            }(n = r.sent()))
              throw n;
            return console.warn("Error enabling offline persistence. Falling back to persistence disabled: " + n), s.reject(n), [3, 4];
          case 4:
            return [2];
        }
      });
    });
  }).then(function() {
    return s.promise;
  });
}
function ha2(t2) {
  if (t2._initialized || t2._terminated)
    throw new N2(S2.FAILED_PRECONDITION, "Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");
}
var fa2 = function() {
  function t2() {
    for (var t3 = [], e = 0; e < arguments.length; e++)
      t3[e] = arguments[e];
    for (var n = 0; n < t3.length; ++n)
      if (t3[n].length === 0)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
    this._internalPath = new Y2(t3);
  }
  return t2.prototype.isEqual = function(t3) {
    return this._internalPath.isEqual(t3._internalPath);
  }, t2;
}();
var la2 = function() {
  function t2(t3) {
    this._byteString = t3;
  }
  return t2.fromBase64String = function(e) {
    try {
      return new t2(X2.fromBase64String(e));
    } catch (e2) {
      throw new N2(S2.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + e2);
    }
  }, t2.fromUint8Array = function(e) {
    return new t2(X2.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return this._byteString.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return this._byteString.toUint8Array();
  }, t2.prototype.toString = function() {
    return "Bytes(base64: " + this.toBase64() + ")";
  }, t2.prototype.isEqual = function(t3) {
    return this._byteString.isEqual(t3._byteString);
  }, t2;
}();
var da2 = function(t2) {
  this._methodName = t2;
};
var pa2 = function() {
  function t2(t3, e) {
    if (!isFinite(t3) || t3 < -90 || t3 > 90)
      throw new N2(S2.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + t3);
    if (!isFinite(e) || e < -180 || e > 180)
      throw new N2(S2.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + e);
    this._lat = t3, this._long = e;
  }
  return Object.defineProperty(t2.prototype, "latitude", {
    get: function() {
      return this._lat;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "longitude", {
    get: function() {
      return this._long;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this._lat === t3._lat && this._long === t3._long;
  }, t2.prototype.toJSON = function() {
    return {
      latitude: this._lat,
      longitude: this._long
    };
  }, t2.prototype._compareTo = function(t3) {
    return V2(this._lat, t3._lat) || V2(this._long, t3._long);
  }, t2;
}();
var ya2 = /^__.*__$/;
var va = function() {
  function t2(t3, e, n) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n;
  }
  return t2.prototype.toMutation = function(t3, e) {
    return this.fieldMask !== null ? new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms) : new Oe(t3, this.data, e, this.fieldTransforms);
  }, t2;
}();
var ma2 = function() {
  function t2(t3, e, n) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n;
  }
  return t2.prototype.toMutation = function(t3, e) {
    return new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms);
  }, t2;
}();
function ga(t2) {
  switch (t2) {
    case 0:
    case 2:
    case 1:
      return true;
    case 3:
    case 4:
      return false;
    default:
      throw L2();
  }
}
var wa = function() {
  function t2(t3, e, n, r, i, o) {
    this.settings = t3, this.databaseId = e, this.R = n, this.ignoreUndefinedProperties = r, i === void 0 && this.Dc(), this.fieldTransforms = i || [], this.fieldMask = o || [];
  }
  return Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this.settings.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Cc", {
    get: function() {
      return this.settings.Cc;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Nc = function(e) {
    return new t2(Object.assign(Object.assign({}, this.settings), e), this.databaseId, this.R, this.ignoreUndefinedProperties, this.fieldTransforms, this.fieldMask);
  }, t2.prototype.xc = function(t3) {
    var e, n = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r = this.Nc({
      path: n,
      Fc: false
    });
    return r.kc(t3), r;
  }, t2.prototype.$c = function(t3) {
    var e, n = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r = this.Nc({
      path: n,
      Fc: false
    });
    return r.Dc(), r;
  }, t2.prototype.Oc = function(t3) {
    return this.Nc({
      path: void 0,
      Fc: true
    });
  }, t2.prototype.Mc = function(t3) {
    return qa2(t3, this.settings.methodName, this.settings.Lc || false, this.path, this.settings.Bc);
  }, t2.prototype.contains = function(t3) {
    return this.fieldMask.find(function(e) {
      return t3.isPrefixOf(e);
    }) !== void 0 || this.fieldTransforms.find(function(e) {
      return t3.isPrefixOf(e.field);
    }) !== void 0;
  }, t2.prototype.Dc = function() {
    if (this.path)
      for (var t3 = 0; t3 < this.path.length; t3++)
        this.kc(this.path.get(t3));
  }, t2.prototype.kc = function(t3) {
    if (t3.length === 0)
      throw this.Mc("Document fields must not be empty");
    if (ga(this.Cc) && ya2.test(t3))
      throw this.Mc('Document fields cannot begin and end with "__"');
  }, t2;
}();
var ba2 = function() {
  function t2(t3, e, n) {
    this.databaseId = t3, this.ignoreUndefinedProperties = e, this.R = n || ko(t3);
  }
  return t2.prototype.qc = function(t3, e, n, r) {
    return r === void 0 && (r = false), new wa({
      Cc: t3,
      methodName: e,
      Bc: n,
      path: Y2.emptyPath(),
      Fc: false,
      Lc: r
    }, this.databaseId, this.R, this.ignoreUndefinedProperties);
  }, t2;
}();
function Ia2(t2) {
  var e = t2._freezeSettings(), n = ko(t2._databaseId);
  return new ba2(t2._databaseId, !!e.ignoreUndefinedProperties, n);
}
function Ea(t2, e, n, r, i, o) {
  o === void 0 && (o = {});
  var s = t2.qc(o.merge || o.mergeFields ? 2 : 0, e, n, i);
  Pa("Data must be an object, but it was:", s, r);
  var u, a, c = La2(r, s);
  if (o.merge)
    u = new $(s.fieldMask), a = s.fieldTransforms;
  else if (o.mergeFields) {
    for (var h = [], f = 0, l2 = o.mergeFields; f < l2.length; f++) {
      var d2 = Fa2(e, l2[f], n);
      if (!s.contains(d2))
        throw new N2(S2.INVALID_ARGUMENT, "Field '" + d2 + "' is specified in your field mask but missing from your input data.");
      Ua2(h, d2) || h.push(d2);
    }
    u = new $(h), a = s.fieldTransforms.filter(function(t3) {
      return u.covers(t3.field);
    });
  } else
    u = null, a = s.fieldTransforms;
  return new va(new Tt(c), u, a);
}
var Ta = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype._toFieldTransform = function(t2) {
    if (t2.Cc !== 2)
      throw t2.Cc === 1 ? t2.Mc(this._methodName + "() can only appear at the top level of your update data") : t2.Mc(this._methodName + "() cannot be used with set() unless you pass {merge:true}");
    return t2.fieldMask.push(t2.path), null;
  }, n.prototype.isEqual = function(t2) {
    return t2 instanceof n;
  }, n;
}(da2);
function _a(t2, e, n) {
  return new wa({
    Cc: 3,
    Bc: e.settings.Bc,
    methodName: t2._methodName,
    Fc: n
  }, e.databaseId, e.R, e.ignoreUndefinedProperties);
}
var Sa2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype._toFieldTransform = function(t2) {
    return new _e(t2.path, new ve());
  }, n.prototype.isEqual = function(t2) {
    return t2 instanceof n;
  }, n;
}(da2);
var Na2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2) || this).Uc = n2, r;
  }
  return __extends(n, e), n.prototype._toFieldTransform = function(t2) {
    var e2 = _a(this, t2, true), n2 = this.Uc.map(function(t3) {
      return Ra2(t3, e2);
    }), r = new me(n2);
    return new _e(t2.path, r);
  }, n.prototype.isEqual = function(t2) {
    return this === t2;
  }, n;
}(da2);
var Da = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2) || this).Uc = n2, r;
  }
  return __extends(n, e), n.prototype._toFieldTransform = function(t2) {
    var e2 = _a(this, t2, true), n2 = this.Uc.map(function(t3) {
      return Ra2(t3, e2);
    }), r = new we(n2);
    return new _e(t2.path, r);
  }, n.prototype.isEqual = function(t2) {
    return this === t2;
  }, n;
}(da2);
var Aa2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2) || this).Kc = n2, r;
  }
  return __extends(n, e), n.prototype._toFieldTransform = function(t2) {
    var e2 = new Ie(t2.R, fe(t2.R, this.Kc));
    return new _e(t2.path, e2);
  }, n.prototype.isEqual = function(t2) {
    return this === t2;
  }, n;
}(da2);
function ka2(t2, e, n, r) {
  var i = t2.qc(1, e, n);
  Pa("Data must be an object, but it was:", i, r);
  var o = [], s = Tt.empty();
  Q2(r, function(t3, r2) {
    var u2 = Va2(e, t3, n);
    r2 = getModularInstance(r2);
    var a = i.$c(u2);
    if (r2 instanceof Ta)
      o.push(u2);
    else {
      var c = Ra2(r2, a);
      c != null && (o.push(u2), s.set(u2, c));
    }
  });
  var u = new $(o);
  return new ma2(s, u, i.fieldTransforms);
}
function Ca2(t2, e, n, r, i, o) {
  var s = t2.qc(1, e, n), u = [Fa2(e, r, n)], a = [i];
  if (o.length % 2 != 0)
    throw new N2(S2.INVALID_ARGUMENT, "Function " + e + "() needs to be called with an even number of arguments that alternate between field names and values.");
  for (var c = 0; c < o.length; c += 2)
    u.push(Fa2(e, o[c])), a.push(o[c + 1]);
  for (var h = [], l2 = Tt.empty(), d2 = u.length - 1; d2 >= 0; --d2)
    if (!Ua2(h, u[d2])) {
      var p2 = u[d2], y2 = a[d2];
      y2 = getModularInstance(y2);
      var v2 = s.$c(p2);
      if (y2 instanceof Ta)
        h.push(p2);
      else {
        var m = Ra2(y2, v2);
        m != null && (h.push(p2), l2.set(p2, m));
      }
    }
  var g = new $(h);
  return new ma2(l2, g, s.fieldTransforms);
}
function xa2(t2, e, n, r) {
  return r === void 0 && (r = false), Ra2(n, t2.qc(r ? 4 : 3, e));
}
function Ra2(t2, e) {
  if (Oa(t2 = getModularInstance(t2)))
    return Pa("Unsupported field value:", e, t2), La2(t2, e);
  if (t2 instanceof da2)
    return function(t3, e2) {
      if (!ga(e2.Cc))
        throw e2.Mc(t3._methodName + "() can only be used with update() and set()");
      if (!e2.path)
        throw e2.Mc(t3._methodName + "() is not currently supported inside arrays");
      var n = t3._toFieldTransform(e2);
      n && e2.fieldTransforms.push(n);
    }(t2, e), null;
  if (t2 === void 0 && e.ignoreUndefinedProperties)
    return null;
  if (e.path && e.fieldMask.push(e.path), t2 instanceof Array) {
    if (e.settings.Fc && e.Cc !== 4)
      throw e.Mc("Nested arrays are not supported");
    return function(t3, e2) {
      for (var n = [], r = 0, i = 0, o = t3; i < o.length; i++) {
        var s = Ra2(o[i], e2.Oc(r));
        s == null && (s = {
          nullValue: "NULL_VALUE"
        }), n.push(s), r++;
      }
      return {
        arrayValue: {
          values: n
        }
      };
    }(t2, e);
  }
  return function(t3, e2) {
    if ((t3 = getModularInstance(t3)) === null)
      return {
        nullValue: "NULL_VALUE"
      };
    if (typeof t3 == "number")
      return fe(e2.R, t3);
    if (typeof t3 == "boolean")
      return {
        booleanValue: t3
      };
    if (typeof t3 == "string")
      return {
        stringValue: t3
      };
    if (t3 instanceof Date) {
      var n = B2.fromDate(t3);
      return {
        timestampValue: bn(e2.R, n)
      };
    }
    if (t3 instanceof B2) {
      n = new B2(t3.seconds, 1e3 * Math.floor(t3.nanoseconds / 1e3));
      return {
        timestampValue: bn(e2.R, n)
      };
    }
    if (t3 instanceof pa2)
      return {
        geoPointValue: {
          latitude: t3.latitude,
          longitude: t3.longitude
        }
      };
    if (t3 instanceof la2)
      return {
        bytesValue: In(e2.R, t3._byteString)
      };
    if (t3 instanceof Yu) {
      n = e2.databaseId;
      var r = t3.firestore._databaseId;
      if (!r.isEqual(n))
        throw e2.Mc("Document reference is for database " + r.projectId + "/" + r.database + " but should be for database " + n.projectId + "/" + n.database);
      return {
        referenceValue: _n(t3.firestore._databaseId || e2.databaseId, t3._key.path)
      };
    }
    throw e2.Mc("Unsupported field value: " + Qu(t3));
  }(t2, e);
}
function La2(t2, e) {
  var n = {};
  return G(t2) ? e.path && e.path.length > 0 && e.fieldMask.push(e.path) : Q2(t2, function(t3, r) {
    var i = Ra2(r, e.xc(t3));
    i != null && (n[t3] = i);
  }), {
    mapValue: {
      fields: n
    }
  };
}
function Oa(t2) {
  return !(typeof t2 != "object" || t2 === null || t2 instanceof Array || t2 instanceof Date || t2 instanceof B2 || t2 instanceof pa2 || t2 instanceof la2 || t2 instanceof Yu || t2 instanceof da2);
}
function Pa(t2, e, n) {
  if (!Oa(n) || !function(t3) {
    return typeof t3 == "object" && t3 !== null && (Object.getPrototypeOf(t3) === Object.prototype || Object.getPrototypeOf(t3) === null);
  }(n)) {
    var r = Qu(n);
    throw r === "an object" ? e.Mc(t2 + " a custom object") : e.Mc(t2 + " " + r);
  }
}
function Fa2(t2, e, n) {
  if ((e = getModularInstance(e)) instanceof fa2)
    return e._internalPath;
  if (typeof e == "string")
    return Va2(t2, e);
  throw qa2("Field path arguments must be of type string or FieldPath.", t2, false, void 0, n);
}
var Ma2 = new RegExp("[~\\*/\\[\\]]");
function Va2(t2, n, r) {
  if (n.search(Ma2) >= 0)
    throw qa2("Invalid field path (" + n + "). Paths must not contain '~', '*', '/', '[', or ']'", t2, false, void 0, r);
  try {
    return new (fa2.bind.apply(fa2, __spreadArray([void 0], n.split("."))))()._internalPath;
  } catch (e) {
    throw qa2("Invalid field path (" + n + "). Paths must not be empty, begin with '.', end with '.', or contain '..'", t2, false, void 0, r);
  }
}
function qa2(t2, e, n, r, i) {
  var o = r && !r.isEmpty(), s = i !== void 0, u = "Function " + e + "() called with invalid data";
  n && (u += " (via `toFirestore()`)");
  var a = "";
  return (o || s) && (a += " (found", o && (a += " in field " + r), s && (a += " in document " + i), a += ")"), new N2(S2.INVALID_ARGUMENT, (u += ". ") + t2 + a);
}
function Ua2(t2, e) {
  return t2.some(function(t3) {
    return t3.isEqual(e);
  });
}
var Ba = function() {
  function t2(t3, e, n, r, i) {
    this._firestore = t3, this._userDataWriter = e, this._key = n, this._document = r, this._converter = i;
  }
  return Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new Yu(this._firestore, this._converter, this._key);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.exists = function() {
    return this._document !== null;
  }, t2.prototype.data = function() {
    if (this._document) {
      if (this._converter) {
        var t3 = new ja2(this._firestore, this._userDataWriter, this._key, this._document, null);
        return this._converter.fromFirestore(t3);
      }
      return this._userDataWriter.convertValue(this._document.data.value);
    }
  }, t2.prototype.get = function(t3) {
    if (this._document) {
      var e = this._document.data.field(Ka2("DocumentSnapshot.get", t3));
      if (e !== null)
        return this._userDataWriter.convertValue(e);
    }
  }, t2;
}();
var ja2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype.data = function() {
    return e.prototype.data.call(this);
  }, n;
}(Ba);
function Ka2(t2, e) {
  return typeof e == "string" ? Va2(t2, e) : e instanceof fa2 ? e._internalPath : e._delegate._internalPath;
}
var Qa = function() {
  function t2(t3, e) {
    this.hasPendingWrites = t3, this.fromCache = e;
  }
  return t2.prototype.isEqual = function(t3) {
    return this.hasPendingWrites === t3.hasPendingWrites && this.fromCache === t3.fromCache;
  }, t2;
}();
var Ga2 = function(e) {
  function n(t2, n2, r, i, o, s) {
    var u = this;
    return (u = e.call(this, t2, n2, r, i, s) || this)._firestore = t2, u._firestoreImpl = t2, u.metadata = o, u;
  }
  return __extends(n, e), n.prototype.exists = function() {
    return e.prototype.exists.call(this);
  }, n.prototype.data = function(t2) {
    if (t2 === void 0 && (t2 = {}), this._document) {
      if (this._converter) {
        var e2 = new za2(this._firestore, this._userDataWriter, this._key, this._document, this.metadata, null);
        return this._converter.fromFirestore(e2, t2);
      }
      return this._userDataWriter.convertValue(this._document.data.value, t2.serverTimestamps);
    }
  }, n.prototype.get = function(t2, e2) {
    if (e2 === void 0 && (e2 = {}), this._document) {
      var n2 = this._document.data.field(Ka2("DocumentSnapshot.get", t2));
      if (n2 !== null)
        return this._userDataWriter.convertValue(n2, e2.serverTimestamps);
    }
  }, n;
}(Ba);
var za2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype.data = function(t2) {
    return t2 === void 0 && (t2 = {}), e.prototype.data.call(this, t2);
  }, n;
}(Ga2);
var Wa2 = function() {
  function t2(t3, e, n, r) {
    this._firestore = t3, this._userDataWriter = e, this._snapshot = r, this.metadata = new Qa(r.hasPendingWrites, r.fromCache), this.query = n;
  }
  return Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = [];
      return this.forEach(function(e) {
        return t3.push(e);
      }), t3;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._snapshot.docs.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this.size === 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3, e) {
    var n = this;
    this._snapshot.docs.forEach(function(r) {
      t3.call(e, new za2(n._firestore, n._userDataWriter, r.key, r, new Qa(n._snapshot.mutatedKeys.has(r.key), n._snapshot.fromCache), n.query.converter));
    });
  }, t2.prototype.docChanges = function(t3) {
    t3 === void 0 && (t3 = {});
    var e = !!t3.includeMetadataChanges;
    if (e && this._snapshot.excludesMetadataChanges)
      throw new N2(S2.INVALID_ARGUMENT, "To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");
    return this._cachedChanges && this._cachedChangesIncludeMetadataChanges === e || (this._cachedChanges = function(t4, e2) {
      if (t4._snapshot.oldDocs.isEmpty()) {
        var n = 0;
        return t4._snapshot.docChanges.map(function(e3) {
          return {
            type: "added",
            doc: new za2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Qa(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query.converter),
            oldIndex: -1,
            newIndex: n++
          };
        });
      }
      var r = t4._snapshot.oldDocs;
      return t4._snapshot.docChanges.filter(function(t5) {
        return e2 || t5.type !== 3;
      }).map(function(e3) {
        var n2 = new za2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Qa(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query.converter), i = -1, o = -1;
        return e3.type !== 0 && (i = r.indexOf(e3.doc.key), r = r.delete(e3.doc.key)), e3.type !== 1 && (o = (r = r.add(e3.doc)).indexOf(e3.doc.key)), {
          type: Ha2(e3.type),
          doc: n2,
          oldIndex: i,
          newIndex: o
        };
      });
    }(this, e), this._cachedChangesIncludeMetadataChanges = e), this._cachedChanges;
  }, t2;
}();
function Ha2(t2) {
  switch (t2) {
    case 0:
      return "added";
    case 2:
    case 3:
      return "modified";
    case 1:
      return "removed";
    default:
      return L2();
  }
}
function Ya2(t2, e) {
  return t2 instanceof Ga2 && e instanceof Ga2 ? t2._firestore === e._firestore && t2._key.isEqual(e._key) && (t2._document === null ? e._document === null : t2._document.isEqual(e._document)) && t2._converter === e._converter : t2 instanceof Wa2 && e instanceof Wa2 && t2._firestore === e._firestore && ea2(t2.query, e.query) && t2.metadata.isEqual(e.metadata) && t2._snapshot.isEqual(e._snapshot);
}
function $a2(t2) {
  if ($t(t2) && t2.explicitOrderBy.length === 0)
    throw new N2(S2.UNIMPLEMENTED, "limitToLast() queries require specifying at least one orderBy() clause");
}
var Xa2 = function() {
};
function Ja2(t2) {
  for (var e = [], n = 1; n < arguments.length; n++)
    e[n - 1] = arguments[n];
  for (var r = 0, i = e; r < i.length; r++) {
    var o = i[r];
    t2 = o._apply(t2);
  }
  return t2;
}
var Za2 = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).Qc = t2, i.jc = n2, i.Wc = r, i.type = "where", i;
  }
  return __extends(n, e), n.prototype._apply = function(t2) {
    var e2 = Ia2(t2.firestore), n2 = function(t3, e3, n3, r, i, o, s) {
      var u;
      if (i.isKeyField()) {
        if (o === "array-contains" || o === "array-contains-any")
          throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. You can't perform '" + o + "' queries on FieldPath.documentId().");
        if (o === "in" || o === "not-in") {
          sc2(s, o);
          for (var a = [], c = 0, h = s; c < h.length; c++) {
            var f = h[c];
            a.push(oc2(r, t3, f));
          }
          u = {
            arrayValue: {
              values: a
            }
          };
        } else
          u = oc2(r, t3, s);
      } else
        o !== "in" && o !== "not-in" && o !== "array-contains-any" || sc2(s, o), u = xa2(n3, "where", s, o === "in" || o === "not-in");
      var l2 = xt.create(i, o, u);
      return function(t4, e4) {
        if (e4.g()) {
          var n4 = Jt(t4);
          if (n4 !== null && !n4.isEqual(e4.field))
            throw new N2(S2.INVALID_ARGUMENT, "Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '" + n4.toString() + "' and '" + e4.field.toString() + "'");
          var r2 = Xt(t4);
          r2 !== null && uc2(t4, e4.field, r2);
        }
        var i2 = function(t5, e5) {
          for (var n5 = 0, r3 = t5.filters; n5 < r3.length; n5++) {
            var i3 = r3[n5];
            if (e5.indexOf(i3.op) >= 0)
              return i3.op;
          }
          return null;
        }(t4, function(t5) {
          switch (t5) {
            case "!=":
              return ["!=", "not-in"];
            case "array-contains":
              return ["array-contains", "array-contains-any", "not-in"];
            case "in":
              return ["array-contains-any", "in", "not-in"];
            case "array-contains-any":
              return ["array-contains", "array-contains-any", "in", "not-in"];
            case "not-in":
              return ["array-contains", "array-contains-any", "in", "not-in", "!="];
            default:
              return [];
          }
        }(e4.op));
        if (i2 !== null)
          throw i2 === e4.op ? new N2(S2.INVALID_ARGUMENT, "Invalid query. You cannot use more than one '" + e4.op.toString() + "' filter.") : new N2(S2.INVALID_ARGUMENT, "Invalid query. You cannot use '" + e4.op.toString() + "' filters with '" + i2.toString() + "' filters.");
      }(t3, l2), l2;
    }(t2._query, 0, e2, t2.firestore._databaseId, this.Qc, this.jc, this.Wc);
    return new $u(t2.firestore, t2.converter, function(t3, e3) {
      var n3 = t3.filters.concat([e3]);
      return new zt(t3.path, t3.collectionGroup, t3.explicitOrderBy.slice(), n3, t3.limit, t3.limitType, t3.startAt, t3.endAt);
    }(t2._query, n2));
  }, n;
}(Xa2);
var tc2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this) || this).Qc = t2, r.Gc = n2, r.type = "orderBy", r;
  }
  return __extends(n, e), n.prototype._apply = function(t2) {
    var e2 = function(t3, e3, n2) {
      if (t3.startAt !== null)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You must not call startAt() or startAfter() before calling orderBy().");
      if (t3.endAt !== null)
        throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You must not call endAt() or endBefore() before calling orderBy().");
      var r = new jt(e3, n2);
      return function(t4, e4) {
        if (Xt(t4) === null) {
          var n3 = Jt(t4);
          n3 !== null && uc2(t4, n3, e4.field);
        }
      }(t3, r), r;
    }(t2._query, this.Qc, this.Gc);
    return new $u(t2.firestore, t2.converter, function(t3, e3) {
      var n2 = t3.explicitOrderBy.concat([e3]);
      return new zt(t3.path, t3.collectionGroup, n2, t3.filters.slice(), t3.limit, t3.limitType, t3.startAt, t3.endAt);
    }(t2._query, e2));
  }, n;
}(Xa2);
var ec2 = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).type = t2, i.zc = n2, i.Hc = r, i;
  }
  return __extends(n, e), n.prototype._apply = function(t2) {
    return new $u(t2.firestore, t2.converter, ne(t2._query, this.zc, this.Hc));
  }, n;
}(Xa2);
var nc2 = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).type = t2, i.Jc = n2, i.Yc = r, i;
  }
  return __extends(n, e), n.prototype._apply = function(t2) {
    var e2 = ic2(t2, this.type, this.Jc, this.Yc);
    return new $u(t2.firestore, t2.converter, function(t3, e3) {
      return new zt(t3.path, t3.collectionGroup, t3.explicitOrderBy.slice(), t3.filters.slice(), t3.limit, t3.limitType, e3, t3.endAt);
    }(t2._query, e2));
  }, n;
}(Xa2);
var rc2 = function(e) {
  function n(t2, n2, r) {
    var i = this;
    return (i = e.call(this) || this).type = t2, i.Jc = n2, i.Yc = r, i;
  }
  return __extends(n, e), n.prototype._apply = function(t2) {
    var e2 = ic2(t2, this.type, this.Jc, this.Yc);
    return new $u(t2.firestore, t2.converter, function(t3, e3) {
      return new zt(t3.path, t3.collectionGroup, t3.explicitOrderBy.slice(), t3.filters.slice(), t3.limit, t3.limitType, t3.startAt, e3);
    }(t2._query, e2));
  }, n;
}(Xa2);
function ic2(t2, e, n, r) {
  if (n[0] = getModularInstance(n[0]), n[0] instanceof Ba)
    return function(t3, e2, n2, r2, i2) {
      if (!r2)
        throw new N2(S2.NOT_FOUND, "Can't use a DocumentSnapshot that doesn't exist for " + n2 + "().");
      for (var o = [], s = 0, u = te(t3); s < u.length; s++) {
        var a = u[s];
        if (a.field.isKeyField())
          o.push(vt(e2, r2.key));
        else {
          var c = r2.data.field(a.field);
          if (nt(c))
            throw new N2(S2.INVALID_ARGUMENT, 'Invalid query. You are trying to start or end a query using a document for which the field "' + a.field + '" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');
          if (c === null) {
            var h = a.field.canonicalString();
            throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You are trying to start or end a query using a document for which the field '" + h + "' (used as the orderBy) does not exist.");
          }
          o.push(c);
        }
      }
      return new Ut(o, i2);
    }(t2._query, t2.firestore._databaseId, e, n[0]._document, r);
  var i = Ia2(t2.firestore);
  return function(t3, e2, n2, r2, i2, o) {
    var s = t3.explicitOrderBy;
    if (i2.length > s.length)
      throw new N2(S2.INVALID_ARGUMENT, "Too many arguments provided to " + r2 + "(). The number of arguments must be less than or equal to the number of orderBy() clauses");
    for (var u = [], a = 0; a < i2.length; a++) {
      var c = i2[a];
      if (s[a].field.isKeyField()) {
        if (typeof c != "string")
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. Expected a string for document ID in " + r2 + "(), but got a " + typeof c);
        if (!Zt(t3) && c.indexOf("/") !== -1)
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to " + r2 + "() must be a plain document ID, but '" + c + "' contains a slash.");
        var h = t3.path.child(W2.fromString(c));
        if (!at.isDocumentKey(h))
          throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to " + r2 + "() must result in a valid document path, but '" + h + "' is not because it contains an odd number of segments.");
        var f = new at(h);
        u.push(vt(e2, f));
      } else {
        var l2 = xa2(n2, r2, c);
        u.push(l2);
      }
    }
    return new Ut(u, o);
  }(t2._query, t2.firestore._databaseId, i, e, n, r);
}
function oc2(t2, e, n) {
  if (typeof (n = getModularInstance(n)) == "string") {
    if (n === "")
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");
    if (!Zt(e) && n.indexOf("/") !== -1)
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '" + n + "' contains a '/' character.");
    var r = e.path.child(W2.fromString(n));
    if (!at.isDocumentKey(r))
      throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '" + r + "' is not because it has an odd number of segments (" + r.length + ").");
    return vt(t2, new at(r));
  }
  if (n instanceof Yu)
    return vt(t2, n._key);
  throw new N2(S2.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: " + Qu(n) + ".");
}
function sc2(t2, e) {
  if (!Array.isArray(t2) || t2.length === 0)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. A non-empty array is required for '" + e.toString() + "' filters.");
  if (t2.length > 10)
    throw new N2(S2.INVALID_ARGUMENT, "Invalid Query. '" + e.toString() + "' filters support a maximum of 10 elements in the value array.");
}
function uc2(t2, e, n) {
  if (!n.isEqual(e))
    throw new N2(S2.INVALID_ARGUMENT, "Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '" + e.toString() + "' and so you must also use '" + e.toString() + "' as your first argument to orderBy(), but your first orderBy() is on field '" + n.toString() + "' instead.");
}
var ac2 = function() {
  function t2() {
  }
  return t2.prototype.convertValue = function(t3, e) {
    switch (e === void 0 && (e = "none"), ct(t3)) {
      case 0:
        return null;
      case 1:
        return t3.booleanValue;
      case 2:
        return tt(t3.integerValue || t3.doubleValue);
      case 3:
        return this.convertTimestamp(t3.timestampValue);
      case 4:
        return this.convertServerTimestamp(t3, e);
      case 5:
        return t3.stringValue;
      case 6:
        return this.convertBytes(et(t3.bytesValue));
      case 7:
        return this.convertReference(t3.referenceValue);
      case 8:
        return this.convertGeoPoint(t3.geoPointValue);
      case 9:
        return this.convertArray(t3.arrayValue, e);
      case 10:
        return this.convertObject(t3.mapValue, e);
      default:
        throw L2();
    }
  }, t2.prototype.convertObject = function(t3, e) {
    var n = this, r = {};
    return Q2(t3.fields, function(t4, i) {
      r[t4] = n.convertValue(i, e);
    }), r;
  }, t2.prototype.convertGeoPoint = function(t3) {
    return new pa2(tt(t3.latitude), tt(t3.longitude));
  }, t2.prototype.convertArray = function(t3, e) {
    var n = this;
    return (t3.values || []).map(function(t4) {
      return n.convertValue(t4, e);
    });
  }, t2.prototype.convertServerTimestamp = function(t3, e) {
    switch (e) {
      case "previous":
        var n = rt(t3);
        return n == null ? null : this.convertValue(n, e);
      case "estimate":
        return this.convertTimestamp(it(t3));
      default:
        return null;
    }
  }, t2.prototype.convertTimestamp = function(t3) {
    var e = Z2(t3);
    return new B2(e.seconds, e.nanos);
  }, t2.prototype.convertDocumentKey = function(t3, e) {
    var n = W2.fromString(t3);
    O2(Yn(n));
    var r = new xu(n.get(1), n.get(3)), i = new at(n.popFirst(5));
    return r.isEqual(e) || C2("Document " + i + " contains a document reference within a different database (" + r.projectId + "/" + r.database + ") which is not supported. It will be treated as a reference in the current database (" + e.projectId + "/" + e.database + ") instead."), i;
  }, t2;
}();
function cc2(t2, e, n) {
  return t2 ? n && (n.merge || n.mergeFields) ? t2.toFirestore(e, n) : t2.toFirestore(e) : e;
}
var hc2 = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).firestore = t2, n2;
  }
  return __extends(n, e), n.prototype.convertBytes = function(t2) {
    return new la2(t2);
  }, n.prototype.convertReference = function(t2) {
    var e2 = this.convertDocumentKey(t2, this.firestore._databaseId);
    return new Yu(this.firestore, null, e2);
  }, n;
}(ac2);
var fc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._commitHandler = e, this._mutations = [], this._committed = false, this._dataReader = Ia2(t3);
  }
  return t2.prototype.set = function(t3, e, n) {
    this._verifyNotCommitted();
    var r = lc2(t3, this._firestore), i = cc2(r.converter, e, n), o = Ea(this._dataReader, "WriteBatch.set", r._key, i, r.converter !== null, n);
    return this._mutations.push(o.toMutation(r._key, Ne.none())), this;
  }, t2.prototype.update = function(t3, e, n) {
    for (var r = [], i = 3; i < arguments.length; i++)
      r[i - 3] = arguments[i];
    this._verifyNotCommitted();
    var o, s = lc2(t3, this._firestore);
    return o = typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(this._dataReader, "WriteBatch.update", s._key, e, n, r) : ka2(this._dataReader, "WriteBatch.update", s._key, e), this._mutations.push(o.toMutation(s._key, Ne.exists(true))), this;
  }, t2.prototype.delete = function(t3) {
    this._verifyNotCommitted();
    var e = lc2(t3, this._firestore);
    return this._mutations = this._mutations.concat(new Be(e._key, Ne.none())), this;
  }, t2.prototype.commit = function() {
    return this._verifyNotCommitted(), this._committed = true, this._mutations.length > 0 ? this._commitHandler(this._mutations) : Promise.resolve();
  }, t2.prototype._verifyNotCommitted = function() {
    if (this._committed)
      throw new N2(S2.FAILED_PRECONDITION, "A write batch can no longer be used after commit() has been called.");
  }, t2;
}();
function lc2(t2, e) {
  if ((t2 = getModularInstance(t2)).firestore !== e)
    throw new N2(S2.INVALID_ARGUMENT, "Provided document reference is from a different Firestore instance.");
  return t2;
}
var dc2 = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).firestore = t2, n2;
  }
  return __extends(n, e), n.prototype.convertBytes = function(t2) {
    return new la2(t2);
  }, n.prototype.convertReference = function(t2) {
    var e2 = this.convertDocumentKey(t2, this.firestore._databaseId);
    return new Yu(this.firestore, null, e2);
  }, n;
}(ac2);
function pc2(t2, e, n) {
  for (var r = [], i = 3; i < arguments.length; i++)
    r[i - 3] = arguments[i];
  t2 = Gu(t2, Yu);
  var o = Gu(t2.firestore, sa2), s = Ia2(o);
  return vc2(o, [(typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(s, "updateDoc", t2._key, e, n, r) : ka2(s, "updateDoc", t2._key, e)).toMutation(t2._key, Ne.exists(true))]);
}
function yc2(t2) {
  for (var e, i, o, s = [], u = 1; u < arguments.length; u++)
    s[u - 1] = arguments[u];
  t2 = getModularInstance(t2);
  var a = {
    includeMetadataChanges: false
  }, c = 0;
  typeof s[c] != "object" || ra2(s[c]) || (a = s[c], c++);
  var h, l2, d2, p2 = {
    includeMetadataChanges: a.includeMetadataChanges
  };
  if (ra2(s[c])) {
    var y2 = s[c];
    s[c] = (e = y2.next) === null || e === void 0 ? void 0 : e.bind(y2), s[c + 1] = (i = y2.error) === null || i === void 0 ? void 0 : i.bind(y2), s[c + 2] = (o = y2.complete) === null || o === void 0 ? void 0 : o.bind(y2);
  }
  if (t2 instanceof Yu)
    l2 = Gu(t2.firestore, sa2), d2 = Ht(t2._key.path), h = {
      next: function(e2) {
        s[c] && s[c](mc2(l2, t2, e2));
      },
      error: s[c + 1],
      complete: s[c + 2]
    };
  else {
    var v2 = Gu(t2, $u);
    l2 = Gu(v2.firestore, sa2), d2 = v2._query;
    var m = new dc2(l2);
    h = {
      next: function(t3) {
        s[c] && s[c](new Wa2(l2, m, v2, t3));
      },
      error: s[c + 1],
      complete: s[c + 2]
    }, $a2(t2._query);
  }
  return function(t3, e2, i2, o2) {
    var s2 = this, u2 = new pu(o2), a2 = new bs(e2, u2, i2);
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(s2, void 0, void 0, function() {
        var e3;
        return __generator(this, function(n) {
          switch (n.label) {
            case 0:
              return e3 = ys, [4, Du(t3)];
            case 1:
              return [2, e3.apply(void 0, [n.sent(), a2])];
          }
        });
      });
    }), function() {
      u2.Wo(), t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(s2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(n) {
            switch (n.label) {
              case 0:
                return e3 = vs, [4, Du(t3)];
              case 1:
                return [2, e3.apply(void 0, [n.sent(), a2])];
            }
          });
        });
      });
    };
  }(ua2(l2), d2, p2, h);
}
function vc2(t2, e) {
  return function(t3, e2) {
    var i = this, o = new wr();
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(i, void 0, void 0, function() {
        var n;
        return __generator(this, function(r) {
          switch (r.label) {
            case 0:
              return n = Os, [4, Nu(t3)];
            case 1:
              return [2, n.apply(void 0, [r.sent(), e2, o])];
          }
        });
      });
    }), o.promise;
  }(ua2(t2), e);
}
function mc2(t2, e, n) {
  var r = n.docs.get(e._key), i = new dc2(t2);
  return new Ga2(t2, i, e._key, r, new Qa(n.hasPendingWrites, n.fromCache), e.converter);
}
var gc2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2, n2) || this)._firestore = t2, r;
  }
  return __extends(n, e), n.prototype.get = function(t2) {
    var n2 = this, r = lc2(t2, this._firestore), i = new dc2(this._firestore);
    return e.prototype.get.call(this, t2).then(function(t3) {
      return new Ga2(n2._firestore, i, r._key, t3._document, new Qa(false, false), r.converter);
    });
  }, n;
}(function() {
  function t2(t3, e) {
    this._firestore = t3, this._transaction = e, this._dataReader = Ia2(t3);
  }
  return t2.prototype.get = function(t3) {
    var e = this, n = lc2(t3, this._firestore), r = new hc2(this._firestore);
    return this._transaction.lookup([n._key]).then(function(t4) {
      if (!t4 || t4.length !== 1)
        return L2();
      var i = t4[0];
      if (i.isFoundDocument())
        return new Ba(e._firestore, r, i.key, i, n.converter);
      if (i.isNoDocument())
        return new Ba(e._firestore, r, n._key, null, n.converter);
      throw L2();
    });
  }, t2.prototype.set = function(t3, e, n) {
    var r = lc2(t3, this._firestore), i = cc2(r.converter, e, n), o = Ea(this._dataReader, "Transaction.set", r._key, i, r.converter !== null, n);
    return this._transaction.set(r._key, o), this;
  }, t2.prototype.update = function(t3, e, n) {
    for (var r = [], i = 3; i < arguments.length; i++)
      r[i - 3] = arguments[i];
    var o, s = lc2(t3, this._firestore);
    return o = typeof (e = getModularInstance(e)) == "string" || e instanceof fa2 ? Ca2(this._dataReader, "Transaction.update", s._key, e, n, r) : ka2(this._dataReader, "Transaction.update", s._key, e), this._transaction.update(s._key, o), this;
  }, t2.prototype.delete = function(t3) {
    var e = lc2(t3, this._firestore);
    return this._transaction.delete(e._key), this;
  }, t2;
}());
function wc2() {
  if (typeof Uint8Array == "undefined")
    throw new N2(S2.UNIMPLEMENTED, "Uint8Arrays are not available in this environment.");
}
function bc2() {
  if (typeof atob == "undefined")
    throw new N2(S2.UNIMPLEMENTED, "Blobs are unavailable in Firestore in this environment.");
}
var Ic2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.fromBase64String = function(e) {
    return bc2(), new t2(la2.fromBase64String(e));
  }, t2.fromUint8Array = function(e) {
    return wc2(), new t2(la2.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return bc2(), this._delegate.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return wc2(), this._delegate.toUint8Array();
  }, t2.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, t2.prototype.toString = function() {
    return "Blob(base64: " + this.toBase64() + ")";
  }, t2;
}();
var Ec2 = function() {
  function t2() {
  }
  return t2.prototype.enableIndexedDbPersistence = function(t3, e) {
    return function(t4, e2) {
      ha2(t4 = Gu(t4, sa2));
      var n = ua2(t4), r = t4._freezeSettings(), i = new lu();
      return ca(n, i, new hu(i, r.cacheSizeBytes, e2 == null ? void 0 : e2.forceOwnership));
    }(t3._delegate, {
      forceOwnership: e
    });
  }, t2.prototype.enableMultiTabIndexedDbPersistence = function(t3) {
    return function(t4) {
      ha2(t4 = Gu(t4, sa2));
      var e = ua2(t4), n = t4._freezeSettings(), r = new lu();
      return ca(e, r, new fu(r, n.cacheSizeBytes));
    }(t3._delegate);
  }, t2.prototype.clearIndexedDbPersistence = function(t3) {
    return function(t4) {
      var e = this;
      if (t4._initialized && !t4._terminated)
        throw new N2(S2.FAILED_PRECONDITION, "Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");
      var i = new wr();
      return t4._queue.enqueueAndForgetEvenWhileRestricted(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(o) {
            switch (o.label) {
              case 0:
                return o.trys.push([0, 2, , 3]), [4, function(t5) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n) {
                      switch (n.label) {
                        case 0:
                          return Er.yt() ? (e3 = t5 + "main", [4, Er.delete(e3)]) : [2, Promise.resolve()];
                        case 1:
                          return n.sent(), [2];
                      }
                    });
                  });
                }(Li(t4._databaseId, t4._persistenceKey))];
              case 1:
                return o.sent(), i.resolve(), [3, 3];
              case 2:
                return e2 = o.sent(), i.reject(e2), [3, 3];
              case 3:
                return [2];
            }
          });
        });
      }), i.promise;
    }(t3._delegate);
  }, t2;
}();
var Tc2 = function() {
  function t2(t3, e, n) {
    var r = this;
    this._delegate = e, this.Xc = n, this.INTERNAL = {
      delete: function() {
        return r.terminate();
      }
    }, t3 instanceof xu || (this.Zc = t3);
  }
  return Object.defineProperty(t2.prototype, "_databaseId", {
    get: function() {
      return this._delegate._databaseId;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.settings = function(t3) {
    var e = this._delegate._getSettings();
    t3.merge || e.host === t3.host || x2("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."), t3.merge && delete (t3 = Object.assign(Object.assign({}, e), t3)).merge, this._delegate._setSettings(t3);
  }, t2.prototype.useEmulator = function(t3, e, n) {
    n === void 0 && (n = {}), function(t4, e2, n2, r) {
      r === void 0 && (r = {});
      var i = (t4 = Gu(t4, Hu))._getSettings();
      if (i.host !== "firestore.googleapis.com" && i.host !== e2 && x2("Host has been set in both settings() and useEmulator(), emulator host will be used"), t4._setSettings(Object.assign(Object.assign({}, i), {
        host: e2 + ":" + n2,
        ssl: false
      })), r.mockUserToken) {
        var o = createMockUserToken(r.mockUserToken), s = r.mockUserToken.sub || r.mockUserToken.user_id;
        if (!s)
          throw new N2(S2.INVALID_ARGUMENT, "mockUserToken must contain 'sub' or 'user_id' field!");
        t4._credentials = new Pu(new Lu(o, new ho(s)));
      }
    }(this._delegate, t3, e, n);
  }, t2.prototype.enableNetwork = function() {
    return function(t3) {
      var e = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2, n;
          return __generator(this, function(r) {
            switch (r.label) {
              case 0:
                return [4, Tu(t3)];
              case 1:
                return e2 = r.sent(), [4, Su(t3)];
              case 2:
                return n = r.sent(), [2, (e2.setNetworkEnabled(true), function(t4) {
                  var e3 = P2(t4);
                  return e3.Or.delete(0), Mo(e3);
                }(n))];
            }
          });
        });
      });
    }(ua2(Gu(this._delegate, sa2)));
  }, t2.prototype.disableNetwork = function() {
    return function(t3) {
      var e = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2, i;
          return __generator(this, function(o) {
            switch (o.label) {
              case 0:
                return [4, Tu(t3)];
              case 1:
                return e2 = o.sent(), [4, Su(t3)];
              case 2:
                return i = o.sent(), [2, (e2.setNetworkEnabled(false), function(t4) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n) {
                      switch (n.label) {
                        case 0:
                          return (e3 = P2(t4)).Or.add(0), [4, Vo(e3)];
                        case 1:
                          return n.sent(), e3.Br.set("Offline"), [2];
                      }
                    });
                  });
                }(i))];
            }
          });
        });
      });
    }(ua2(Gu(this._delegate, sa2)));
  }, t2.prototype.enablePersistence = function(t3) {
    var e = false, n = false;
    return t3 && Bu("synchronizeTabs", e = !!t3.synchronizeTabs, "experimentalForceOwningTab", n = !!t3.experimentalForceOwningTab), e ? this.Xc.enableMultiTabIndexedDbPersistence(this) : this.Xc.enableIndexedDbPersistence(this, n);
  }, t2.prototype.clearPersistence = function() {
    return this.Xc.clearIndexedDbPersistence(this);
  }, t2.prototype.terminate = function() {
    return this.Zc && (this.Zc._removeServiceInstance("firestore"), this.Zc._removeServiceInstance("firestore-exp")), this._delegate._delete();
  }, t2.prototype.waitForPendingWrites = function() {
    return function(t3) {
      var e = this, i = new wr();
      return t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(n) {
            switch (n.label) {
              case 0:
                return e2 = Us, [4, Nu(t3)];
              case 1:
                return [2, e2.apply(void 0, [n.sent(), i])];
            }
          });
        });
      }), i.promise;
    }(ua2(Gu(this._delegate, sa2)));
  }, t2.prototype.onSnapshotsInSync = function(t3) {
    return function(t4, e) {
      return function(t5, e2) {
        var i = this, o = new pu(e2);
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(i, void 0, void 0, function() {
            var e3;
            return __generator(this, function(n) {
              switch (n.label) {
                case 0:
                  return e3 = function(t6, e4) {
                    P2(t6).Gr.add(e4), e4.next();
                  }, [4, Du(t5)];
                case 1:
                  return [2, e3.apply(void 0, [n.sent(), o])];
              }
            });
          });
        }), function() {
          o.Wo(), t5.asyncQueue.enqueueAndForget(function() {
            return __awaiter(i, void 0, void 0, function() {
              var e3;
              return __generator(this, function(n) {
                switch (n.label) {
                  case 0:
                    return e3 = function(t6, e4) {
                      P2(t6).Gr.delete(e4);
                    }, [4, Du(t5)];
                  case 1:
                    return [2, e3.apply(void 0, [n.sent(), o])];
                }
              });
            });
          });
        };
      }(ua2(t4 = Gu(t4, sa2)), ra2(e) ? e : {
        next: e
      });
    }(this._delegate, t3);
  }, Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this.Zc)
        throw new N2(S2.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this.Zc;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.collection = function(t3) {
    try {
      return new Vc2(this, Ju(this._delegate, t3));
    } catch (t4) {
      throw Cc2(t4, "collection()", "Firestore.collection()");
    }
  }, t2.prototype.doc = function(t3) {
    try {
      return new kc2(this, Zu(this._delegate, t3));
    } catch (t4) {
      throw Cc2(t4, "doc()", "Firestore.doc()");
    }
  }, t2.prototype.collectionGroup = function(t3) {
    try {
      return new Pc2(this, function(t4, e) {
        if (t4 = Gu(t4, Hu), qu("collectionGroup", "collection id", e), e.indexOf("/") >= 0)
          throw new N2(S2.INVALID_ARGUMENT, "Invalid collection ID '" + e + "' passed to function collectionGroup(). Collection IDs must not contain '/'.");
        return new $u(t4, null, function(t5) {
          return new zt(W2.emptyPath(), t5);
        }(e));
      }(this._delegate, t3));
    } catch (t4) {
      throw Cc2(t4, "collectionGroup()", "Firestore.collectionGroup()");
    }
  }, t2.prototype.runTransaction = function(t3) {
    var e = this;
    return function(t4, e2) {
      return function(t5, e3) {
        var i = this, o = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(i, void 0, void 0, function() {
            var n;
            return __generator(this, function(r) {
              switch (r.label) {
                case 0:
                  return [4, function(t6) {
                    return Eu(t6).then(function(t7) {
                      return t7.datastore;
                    });
                  }(t5)];
                case 1:
                  return n = r.sent(), new mu(t5.asyncQueue, n, e3, o).run(), [2];
              }
            });
          });
        }), o.promise;
      }(ua2(t4), function(n) {
        return e2(new gc2(t4, n));
      });
    }(this._delegate, function(n) {
      return t3(new Nc2(e, n));
    });
  }, t2.prototype.batch = function() {
    var t3 = this;
    return ua2(this._delegate), new Dc2(new fc2(this._delegate, function(e) {
      return vc2(t3._delegate, e);
    }));
  }, t2.prototype.loadBundle = function(t3) {
    throw new N2(S2.FAILED_PRECONDITION, '"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, t2.prototype.namedQuery = function(t3) {
    throw new N2(S2.FAILED_PRECONDITION, '"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, t2;
}();
var _c = function(e) {
  function n(t2) {
    var n2 = this;
    return (n2 = e.call(this) || this).firestore = t2, n2;
  }
  return __extends(n, e), n.prototype.convertBytes = function(t2) {
    return new Ic2(new la2(t2));
  }, n.prototype.convertReference = function(t2) {
    var e2 = this.convertDocumentKey(t2, this.firestore._databaseId);
    return kc2.tu(e2, this.firestore, null);
  }, n;
}(ac2);
function Sc2(t2) {
  var e;
  e = t2, D2.setLogLevel(e);
}
var Nc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.prototype.get = function(t3) {
    var e = this, n = qc2(t3);
    return this._delegate.get(n).then(function(t4) {
      return new Lc2(e._firestore, new Ga2(e._firestore._delegate, e._userDataWriter, t4._key, t4._document, t4.metadata, n.converter));
    });
  }, t2.prototype.set = function(t3, e, n) {
    var r = qc2(t3);
    return n ? (Uu("Transaction.set", n), this._delegate.set(r, e, n)) : this._delegate.set(r, e), this;
  }, t2.prototype.update = function(t3, n, r) {
    for (var i, o = [], s = 3; s < arguments.length; s++)
      o[s - 3] = arguments[s];
    var u = qc2(t3);
    return arguments.length === 2 ? this._delegate.update(u, n) : (i = this._delegate).update.apply(i, __spreadArray([u, n, r], o)), this;
  }, t2.prototype.delete = function(t3) {
    var e = qc2(t3);
    return this._delegate.delete(e), this;
  }, t2;
}();
var Dc2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.prototype.set = function(t3, e, n) {
    var r = qc2(t3);
    return n ? (Uu("WriteBatch.set", n), this._delegate.set(r, e, n)) : this._delegate.set(r, e), this;
  }, t2.prototype.update = function(t3, n, r) {
    for (var i, o = [], s = 3; s < arguments.length; s++)
      o[s - 3] = arguments[s];
    var u = qc2(t3);
    return arguments.length === 2 ? this._delegate.update(u, n) : (i = this._delegate).update.apply(i, __spreadArray([u, n, r], o)), this;
  }, t2.prototype.delete = function(t3) {
    var e = qc2(t3);
    return this._delegate.delete(e), this;
  }, t2.prototype.commit = function() {
    return this._delegate.commit();
  }, t2;
}();
var Ac2 = function() {
  function t2(t3, e, n) {
    this._firestore = t3, this._userDataWriter = e, this._delegate = n;
  }
  return t2.prototype.fromFirestore = function(t3, e) {
    var n = new za2(this._firestore._delegate, this._userDataWriter, t3._key, t3._document, t3.metadata, null);
    return this._delegate.fromFirestore(new Oc2(this._firestore, n), e != null ? e : {});
  }, t2.prototype.toFirestore = function(t3, e) {
    return e ? this._delegate.toFirestore(t3, e) : this._delegate.toFirestore(t3);
  }, t2.eu = function(e, n) {
    var r = t2.nu, i = r.get(e);
    i || (i = new WeakMap(), r.set(e, i));
    var o = i.get(n);
    return o || (o = new t2(e, new _c(e), n), i.set(n, o)), o;
  }, t2;
}();
Ac2.nu = new WeakMap();
var kc2 = function() {
  function t2(t3, e) {
    this.firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.su = function(e, n, r) {
    if (e.length % 2 != 0)
      throw new N2(S2.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + e.canonicalString() + " has " + e.length);
    return new t2(n, new Yu(n._delegate, r, new at(e)));
  }, t2.tu = function(e, n, r) {
    return new t2(n, new Yu(n._delegate, r, e));
  }, Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new Vc2(this.firestore, this._delegate.parent);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.collection = function(t3) {
    try {
      return new Vc2(this.firestore, Ju(this._delegate, t3));
    } catch (t4) {
      throw Cc2(t4, "collection()", "DocumentReference.collection()");
    }
  }, t2.prototype.isEqual = function(t3) {
    return (t3 = getModularInstance(t3)) instanceof Yu && ta2(this._delegate, t3);
  }, t2.prototype.set = function(t3, e) {
    e = Uu("DocumentReference.set", e);
    try {
      return function(t4, e2, n) {
        t4 = Gu(t4, Yu);
        var r = Gu(t4.firestore, sa2), i = cc2(t4.converter, e2, n);
        return vc2(r, [Ea(Ia2(r), "setDoc", t4._key, i, t4.converter !== null, n).toMutation(t4._key, Ne.none())]);
      }(this._delegate, t3, e);
    } catch (t4) {
      throw Cc2(t4, "setDoc()", "DocumentReference.set()");
    }
  }, t2.prototype.update = function(t3, n) {
    for (var r = [], i = 2; i < arguments.length; i++)
      r[i - 2] = arguments[i];
    try {
      return arguments.length === 1 ? pc2(this._delegate, t3) : pc2.apply(void 0, __spreadArray([this._delegate, t3, n], r));
    } catch (t4) {
      throw Cc2(t4, "updateDoc()", "DocumentReference.update()");
    }
  }, t2.prototype.delete = function() {
    return vc2(Gu((t3 = this._delegate).firestore, sa2), [new Be(t3._key, Ne.none())]);
    var t3;
  }, t2.prototype.onSnapshot = function() {
    for (var t3 = this, e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    var r = xc2(e), i = Rc2(e, function(e2) {
      return new Lc2(t3.firestore, new Ga2(t3.firestore._delegate, t3._userDataWriter, e2._key, e2._document, e2.metadata, t3._delegate.converter));
    });
    return yc2(this._delegate, r, i);
  }, t2.prototype.get = function(t3) {
    var e = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Gu(t4, Yu);
      var e2 = Gu(t4.firestore, sa2), i = ua2(e2), o = new dc2(e2);
      return function(t5, e3) {
        var i2 = this, o2 = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(i2, void 0, void 0, function() {
            var i3;
            return __generator(this, function(s) {
              switch (s.label) {
                case 0:
                  return i3 = function(t6, e4, i4) {
                    return __awaiter(this, void 0, void 0, function() {
                      var n, o3;
                      return __generator(this, function(r) {
                        switch (r.label) {
                          case 0:
                            return r.trys.push([0, 2, , 3]), [4, function(t7, e5) {
                              var n2 = P2(t7);
                              return n2.persistence.runTransaction("read document", "readonly", function(t8) {
                                return n2.Mn.mn(t8, e5);
                              });
                            }(t6, e4)];
                          case 1:
                            return (o3 = r.sent()).isFoundDocument() ? i4.resolve(o3) : o3.isNoDocument() ? i4.resolve(null) : i4.reject(new N2(S2.UNAVAILABLE, "Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")), [3, 3];
                          case 2:
                            return n = r.sent(), o3 = cs(n, "Failed to get document '" + e4 + " from cache"), i4.reject(o3), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, _u(t5)];
                case 1:
                  return [2, i3.apply(void 0, [s.sent(), e3, o2])];
              }
            });
          });
        }), o2.promise;
      }(i, t4._key).then(function(n) {
        return new Ga2(e2, o, t4._key, n, new Qa(n !== null && n.hasLocalMutations, true), t4.converter);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Gu(t4, Yu);
      var e2 = Gu(t4.firestore, sa2);
      return Au(ua2(e2), t4._key, {
        source: "server"
      }).then(function(n) {
        return mc2(e2, t4, n);
      });
    }(this._delegate) : function(t4) {
      t4 = Gu(t4, Yu);
      var e2 = Gu(t4.firestore, sa2);
      return Au(ua2(e2), t4._key).then(function(n) {
        return mc2(e2, t4, n);
      });
    }(this._delegate)).then(function(t4) {
      return new Lc2(e.firestore, new Ga2(e.firestore._delegate, e._userDataWriter, t4._key, t4._document, t4.metadata, e._delegate.converter));
    });
  }, t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e ? this._delegate.withConverter(Ac2.eu(this.firestore, e)) : this._delegate.withConverter(null));
  }, t2;
}();
function Cc2(t2, e, n) {
  return t2.message = t2.message.replace(e, n), t2;
}
function xc2(t2) {
  for (var e = 0, n = t2; e < n.length; e++) {
    var r = n[e];
    if (typeof r == "object" && !ra2(r))
      return r;
  }
  return {};
}
function Rc2(t2, e) {
  var n, r, i;
  return {
    next: function(t3) {
      i.next && i.next(e(t3));
    },
    error: (n = (i = ra2(t2[0]) ? t2[0] : ra2(t2[1]) ? t2[1] : typeof t2[0] == "function" ? {
      next: t2[0],
      error: t2[1],
      complete: t2[2]
    } : {
      next: t2[1],
      error: t2[2],
      complete: t2[3]
    }).error) === null || n === void 0 ? void 0 : n.bind(i),
    complete: (r = i.complete) === null || r === void 0 ? void 0 : r.bind(i)
  };
}
var Lc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new kc2(this._firestore, this._delegate.ref);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "exists", {
    get: function() {
      return this._delegate.exists();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.data = function(t3) {
    return this._delegate.data(t3);
  }, t2.prototype.get = function(t3, e) {
    return this._delegate.get(t3, e);
  }, t2.prototype.isEqual = function(t3) {
    return Ya2(this._delegate, t3._delegate);
  }, t2;
}();
var Oc2 = function(e) {
  function n() {
    return e !== null && e.apply(this, arguments) || this;
  }
  return __extends(n, e), n.prototype.data = function(t2) {
    return this._delegate.data(t2);
  }, n;
}(Lc2);
var Pc2 = function() {
  function t2(t3, e) {
    this.firestore = t3, this._delegate = e, this._userDataWriter = new _c(t3);
  }
  return t2.prototype.where = function(e, n, r) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3, e2, n2) {
        var r2 = e2, i = Ka2("where", t3);
        return new Za2(i, r2, n2);
      }(e, n, r)));
    } catch (e2) {
      throw Cc2(e2, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, t2.prototype.orderBy = function(e, n) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3, e2) {
        e2 === void 0 && (e2 = "asc");
        var n2 = e2, r = Ka2("orderBy", t3);
        return new tc2(r, n2);
      }(e, n)));
    } catch (e2) {
      throw Cc2(e2, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, t2.prototype.limit = function(e) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3) {
        return zu("limit", t3), new ec2("limit", t3, "F");
      }(e)));
    } catch (e2) {
      throw Cc2(e2, "limit()", "Query.limit()");
    }
  }, t2.prototype.limitToLast = function(e) {
    try {
      return new t2(this.firestore, Ja2(this._delegate, function(t3) {
        return zu("limitToLast", t3), new ec2("limitToLast", t3, "L");
      }(e)));
    } catch (e2) {
      throw Cc2(e2, "limitToLast()", "Query.limitToLast()");
    }
  }, t2.prototype.startAt = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new nc2("startAt", t3, true);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc2(e2, "startAt()", "Query.startAt()");
    }
  }, t2.prototype.startAfter = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new nc2("startAfter", t3, false);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc2(e2, "startAfter()", "Query.startAfter()");
    }
  }, t2.prototype.endBefore = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new rc2("endBefore", t3, true);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc2(e2, "endBefore()", "Query.endBefore()");
    }
  }, t2.prototype.endAt = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    try {
      return new t2(this.firestore, Ja2(this._delegate, function() {
        for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
          t3[e2] = arguments[e2];
        return new rc2("endAt", t3, false);
      }.apply(void 0, e)));
    } catch (e2) {
      throw Cc2(e2, "endAt()", "Query.endAt()");
    }
  }, t2.prototype.isEqual = function(t3) {
    return ea2(this._delegate, t3._delegate);
  }, t2.prototype.get = function(t3) {
    var e = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Gu(t4, $u);
      var e2 = Gu(t4.firestore, sa2), i = ua2(e2), o = new dc2(e2);
      return function(t5, e3) {
        var i2 = this, o2 = new wr();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(i2, void 0, void 0, function() {
            var i3;
            return __generator(this, function(s) {
              switch (s.label) {
                case 0:
                  return i3 = function(t6, e4, i4) {
                    return __awaiter(this, void 0, void 0, function() {
                      var n, o3, s2, u, a;
                      return __generator(this, function(r) {
                        switch (r.label) {
                          case 0:
                            return r.trys.push([0, 2, , 3]), [4, Hi(t6, e4, true)];
                          case 1:
                            return a = r.sent(), n = new Ds(e4, a.Bn), o3 = n._o(a.documents), s2 = n.applyChanges(o3, false), i4.resolve(s2.snapshot), [3, 3];
                          case 2:
                            return u = r.sent(), a = cs(u, "Failed to execute query '" + e4 + " against cache"), i4.reject(a), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, [4, _u(t5)];
                case 1:
                  return [2, i3.apply(void 0, [s.sent(), e3, o2])];
              }
            });
          });
        }), o2.promise;
      }(i, t4._query).then(function(n) {
        return new Wa2(e2, o, t4, n);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Gu(t4, $u);
      var e2 = Gu(t4.firestore, sa2), n = ua2(e2), r = new dc2(e2);
      return ku(n, t4._query, {
        source: "server"
      }).then(function(n2) {
        return new Wa2(e2, r, t4, n2);
      });
    }(this._delegate) : function(t4) {
      t4 = Gu(t4, $u);
      var e2 = Gu(t4.firestore, sa2), n = ua2(e2), r = new dc2(e2);
      return $a2(t4._query), ku(n, t4._query).then(function(n2) {
        return new Wa2(e2, r, t4, n2);
      });
    }(this._delegate)).then(function(t4) {
      return new Mc2(e.firestore, new Wa2(e.firestore._delegate, e._userDataWriter, e._delegate, t4._snapshot));
    });
  }, t2.prototype.onSnapshot = function() {
    for (var t3 = this, e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    var r = xc2(e), i = Rc2(e, function(e2) {
      return new Mc2(t3.firestore, new Wa2(t3.firestore._delegate, t3._userDataWriter, t3._delegate, e2._snapshot));
    });
    return yc2(this._delegate, r, i);
  }, t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e ? this._delegate.withConverter(Ac2.eu(this.firestore, e)) : this._delegate.withConverter(null));
  }, t2;
}();
var Fc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "type", {
    get: function() {
      return this._delegate.type;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "doc", {
    get: function() {
      return new Oc2(this._firestore, this._delegate.doc);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "oldIndex", {
    get: function() {
      return this._delegate.oldIndex;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "newIndex", {
    get: function() {
      return this._delegate.newIndex;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Mc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._delegate = e;
  }
  return Object.defineProperty(t2.prototype, "query", {
    get: function() {
      return new Pc2(this._firestore, this._delegate.query);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._delegate.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this._delegate.empty;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = this;
      return this._delegate.docs.map(function(e) {
        return new Oc2(t3._firestore, e);
      });
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.docChanges = function(t3) {
    var e = this;
    return this._delegate.docChanges(t3).map(function(t4) {
      return new Fc2(e._firestore, t4);
    });
  }, t2.prototype.forEach = function(t3, e) {
    var n = this;
    this._delegate.forEach(function(r) {
      t3.call(e, new Oc2(n._firestore, r));
    });
  }, t2.prototype.isEqual = function(t3) {
    return Ya2(this._delegate, t3._delegate);
  }, t2;
}();
var Vc2 = function(e) {
  function n(t2, n2) {
    var r = this;
    return (r = e.call(this, t2, n2) || this).firestore = t2, r._delegate = n2, r;
  }
  return __extends(n, e), Object.defineProperty(n.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(n.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(n.prototype, "parent", {
    get: function() {
      var t2 = this._delegate.parent;
      return t2 ? new kc2(this.firestore, t2) : null;
    },
    enumerable: false,
    configurable: true
  }), n.prototype.doc = function(t2) {
    try {
      return new kc2(this.firestore, t2 === void 0 ? Zu(this._delegate) : Zu(this._delegate, t2));
    } catch (t3) {
      throw Cc2(t3, "doc()", "CollectionReference.doc()");
    }
  }, n.prototype.add = function(t2) {
    var e2 = this;
    return function(t3, e3) {
      var n2 = Gu(t3.firestore, sa2), r = Zu(t3), i = cc2(t3.converter, e3);
      return vc2(n2, [Ea(Ia2(t3.firestore), "addDoc", r._key, i, t3.converter !== null, {}).toMutation(r._key, Ne.exists(false))]).then(function() {
        return r;
      });
    }(this._delegate, t2).then(function(t3) {
      return new kc2(e2.firestore, t3);
    });
  }, n.prototype.isEqual = function(t2) {
    return ta2(this._delegate, t2._delegate);
  }, n.prototype.withConverter = function(t2) {
    return new n(this.firestore, t2 ? this._delegate.withConverter(Ac2.eu(this.firestore, t2)) : this._delegate.withConverter(null));
  }, n;
}(Pc2);
function qc2(t2) {
  return Gu(t2, Yu);
}
var Uc2 = function() {
  function t2() {
    for (var t3 = [], n = 0; n < arguments.length; n++)
      t3[n] = arguments[n];
    this._delegate = new (fa2.bind.apply(fa2, __spreadArray([void 0], t3)))();
  }
  return t2.documentId = function() {
    return new t2(Y2.keyField().canonicalString());
  }, t2.prototype.isEqual = function(t3) {
    return (t3 = getModularInstance(t3)) instanceof fa2 && this._delegate._internalPath.isEqual(t3._internalPath);
  }, t2;
}();
var Bc2 = function() {
  function t2(t3) {
    this._delegate = t3;
  }
  return t2.serverTimestamp = function() {
    var e = new Sa2("serverTimestamp");
    return e._methodName = "FieldValue.serverTimestamp", new t2(e);
  }, t2.delete = function() {
    var e = new Ta("deleteField");
    return e._methodName = "FieldValue.delete", new t2(e);
  }, t2.arrayUnion = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    var r = function() {
      for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
        t3[e2] = arguments[e2];
      return new Na2("arrayUnion", t3);
    }.apply(void 0, e);
    return r._methodName = "FieldValue.arrayUnion", new t2(r);
  }, t2.arrayRemove = function() {
    for (var e = [], n = 0; n < arguments.length; n++)
      e[n] = arguments[n];
    var r = function() {
      for (var t3 = [], e2 = 0; e2 < arguments.length; e2++)
        t3[e2] = arguments[e2];
      return new Da("arrayRemove", t3);
    }.apply(void 0, e);
    return r._methodName = "FieldValue.arrayRemove", new t2(r);
  }, t2.increment = function(e) {
    var n = function(t3) {
      return new Aa2("increment", t3);
    }(e);
    return n._methodName = "FieldValue.increment", new t2(n);
  }, t2.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, t2;
}();

// node_modules/@firebase/firestore/dist/esm5/index.js
var P3 = {
  Firestore: Tc2,
  GeoPoint: pa2,
  Timestamp: B2,
  Blob: Ic2,
  Transaction: Nc2,
  WriteBatch: Dc2,
  DocumentReference: kc2,
  DocumentSnapshot: Lc2,
  Query: Pc2,
  QueryDocumentSnapshot: Oc2,
  QuerySnapshot: Mc2,
  CollectionReference: Vc2,
  FieldPath: Uc2,
  FieldValue: Bc2,
  setLogLevel: Sc2,
  CACHE_SIZE_UNLIMITED: oa2
};
function d(e) {
  !function(e2, r) {
    e2.INTERNAL.registerComponent(new Component("firestore", function(e3) {
      var t2 = e3.getProvider("app").getImmediate();
      return r(t2, e3.getProvider("auth-internal"));
    }, "PUBLIC").setServiceProps(Object.assign({}, P3)));
  }(e, function(e2, s) {
    return new Tc2(e2, new sa2(e2, s), new Ec2());
  }), e.registerVersion("@firebase/firestore", "2.3.8");
}
d(index_esm_default);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//# sourceMappingURL=firebase_firestore.js.map
